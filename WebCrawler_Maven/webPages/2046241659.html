<!doctype html><!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]--><!--[if gt IE 8]><!-->
<html class="no-js" lang="en"> <!--<![endif]--> 
 <head> 
  <meta charset="utf-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>Frequently Asked Questions — Tornado 6.1 documentation</title> 
  <link rel="shortcut icon" href="_static/favicon.ico"> 
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script> 
  <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script> 
  <script type="text/javascript" src="_static/jquery.js"></script> 
  <script type="text/javascript" src="_static/underscore.js"></script> 
  <script type="text/javascript" src="_static/doctools.js"></script> 
  <script type="text/javascript" src="_static/language_data.js"></script> 
  <script async type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-doc-embed.js"></script> 
  <script type="text/javascript" src="_static/js/theme.js"></script> 
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css"> 
  <link rel="stylesheet" href="_static/pygments.css" type="text/css"> 
  <link rel="index" title="Index" href="genindex.html"> 
  <link rel="search" title="Search" href="search.html"> 
  <link rel="next" title="Release notes" href="releases.html"> 
  <link rel="prev" title="tornado.util — General-purpose utilities" href="util.html"> <!-- RTD Extra Head --> <!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
--> 
  <link rel="canonical" href="https://www.tornadoweb.org/en/stable/faq.html"> 
  <link rel="stylesheet" href="https://assets.readthedocs.org/static/css/readthedocs-doc-embed.css" type="text/css"> 
  <script type="application/json" id="READTHEDOCS_DATA">{"ad_free": true, "api_host": "https://readthedocs.org", "build_date": "2020-10-31T00:02:56Z", "builder": "sphinx", "canonical_url": "https://www.tornadoweb.org/en/stable/", "commit": "2047e7ae", "docroot": "/docs/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "faq", "programming_language": "py", "project": "tornado", "proxied_api_host": "/_", "source_suffix": ".rst", "subprojects": {}, "theme": "sphinx_rtd_theme", "user_analytics_code": "UA-39143969-1", "version": "stable"}</script> <!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
--> 
  <script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script> 
  <script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-analytics.js" async></script> <!-- end RTD <extrahead> --> 
 </head> 
 <body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav"> 
   <nav data-toggle="wy-nav-shift" class="wy-nav-side"> 
    <div class="wy-side-scroll"> 
     <div class="wy-side-nav-search"> <a href="index.html" class="icon icon-home"> Tornado </a> 
      <div class="version">
        stable 
      </div> 
      <div role="search"> 
       <form id="rtd-search-form" class="wy-form" action="search.html" method="get"> 
        <input type="text" name="q" placeholder="Search docs"> 
        <input type="hidden" name="check_keywords" value="yes"> 
        <input type="hidden" name="area" value="default"> 
       </form> 
      </div> 
     </div> 
     <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation"> 
      <ul class="current"> 
       <li class="toctree-l1"><a class="reference internal" href="guide.html">User’s guide</a></li> 
       <li class="toctree-l1"><a class="reference internal" href="webframework.html">Web framework</a></li> 
       <li class="toctree-l1"><a class="reference internal" href="http.html">HTTP servers and clients</a></li> 
       <li class="toctree-l1"><a class="reference internal" href="networking.html">Asynchronous networking</a></li> 
       <li class="toctree-l1"><a class="reference internal" href="coroutine.html">Coroutines and concurrency</a></li> 
       <li class="toctree-l1"><a class="reference internal" href="integration.html">Integration with other services</a></li> 
       <li class="toctree-l1"><a class="reference internal" href="utilities.html">Utilities</a></li> 
       <li class="toctree-l1 current"><a class="current reference internal" href="#">Frequently Asked Questions</a></li> 
       <li class="toctree-l1"><a class="reference internal" href="releases.html">Release notes</a></li> 
      </ul> 
     </div> 
    </div> 
   </nav> 
   <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"> 
    <nav class="wy-nav-top" aria-label="top navigation"> <i data-toggle="wy-nav-top" class="fa fa-bars"></i> <a href="index.html">Tornado</a> 
    </nav> 
    <div class="wy-nav-content"> 
     <div class="rst-content"> 
      <div role="navigation" aria-label="breadcrumbs navigation"> 
       <ul class="wy-breadcrumbs"> 
        <li><a href="index.html">Docs</a> »</li> 
        <li>Frequently Asked Questions</li> 
        <li class="wy-breadcrumbs-aside"> <a href="https://github.com/tornadoweb/tornado/blob/stable/docs/faq.rst" class="fa fa-github"> Edit on GitHub</a> </li> 
       </ul> 
       <hr> 
      </div> 
      <div role="main" class="document" itemscope itemtype="http://schema.org/Article"> 
       <div itemprop="articleBody"> 
        <div class="section" id="frequently-asked-questions"> 
         <h1>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Permalink to this headline">¶</a></h1> 
         <div class="contents local topic" id="contents"> 
          <ul class="simple"> 
           <li><a class="reference internal" href="#why-isn-t-this-example-with-time-sleep-running-in-parallel" id="id2">Why isn’t this example with <code class="docutils literal notranslate"><span class="pre">time.sleep()</span></code> running in parallel?</a></li> 
           <li><a class="reference internal" href="#my-code-is-asynchronous-why-is-it-not-running-in-parallel-in-two-browser-tabs" id="id3">My code is asynchronous. Why is it not running in parallel in two browser tabs?</a></li> 
          </ul> 
         </div> 
         <div class="section" id="why-isn-t-this-example-with-time-sleep-running-in-parallel"> 
          <h2><a class="toc-backref" href="#id2">Why isn’t this example with <code class="docutils literal notranslate"><span class="pre">time.sleep()</span></code> running in parallel?</a><a class="headerlink" href="#why-isn-t-this-example-with-time-sleep-running-in-parallel" title="Permalink to this headline">¶</a></h2> 
          <p>Many people’s first foray into Tornado’s concurrency looks something like this:</p> 
          <div class="highlight-default notranslate">
           <div class="highlight">
            <pre><span></span><span class="k">class</span> <span class="nc">BadExampleHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre>
           </div> 
          </div> 
          <p>Fetch this handler twice at the same time and you’ll see that the second five-second countdown doesn’t start until the first one has completely finished. The reason for this is that <a class="reference external" href="https://docs.python.org/3.6/library/time.html#time.sleep" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">time.sleep</span></code></a> is a <strong>blocking</strong> function: it doesn’t allow control to return to the <a class="reference internal" href="ioloop.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal notranslate"><span class="pre">IOLoop</span></code></a> so that other handlers can be run.</p> 
          <p>Of course, <a class="reference external" href="https://docs.python.org/3.6/library/time.html#time.sleep" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">time.sleep</span></code></a> is really just a placeholder in these examples, the point is to show what happens when something in a handler gets slow. No matter what the real code is doing, to achieve concurrency blocking code must be replaced with non-blocking equivalents. This means one of three things:</p> 
          <ol class="arabic"> 
           <li><p class="first"><em>Find a coroutine-friendly equivalent.</em> For <a class="reference external" href="https://docs.python.org/3.6/library/time.html#time.sleep" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">time.sleep</span></code></a>, use <a class="reference internal" href="gen.html#tornado.gen.sleep" title="tornado.gen.sleep"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tornado.gen.sleep</span></code></a> (or <a class="reference external" href="https://docs.python.org/3.6/library/asyncio-task.html#asyncio.sleep" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">asyncio.sleep</span></code></a>) instead:</p> 
            <div class="highlight-default notranslate">
             <div class="highlight">
              <pre><span></span><span class="k">class</span> <span class="nc">CoroutineSleepHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">gen</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre>
             </div> 
            </div> <p>When this option is available, it is usually the best approach. See the <a class="reference external" href="https://github.com/tornadoweb/tornado/wiki/Links">Tornado wiki</a> for links to asynchronous libraries that may be useful.</p> </li> 
           <li><p class="first"><em>Find a callback-based equivalent.</em> Similar to the first option, callback-based libraries are available for many tasks, although they are slightly more complicated to use than a library designed for coroutines. Adapt the callback-based function into a future:</p> 
            <div class="highlight-default notranslate">
             <div class="highlight">
              <pre><span></span><span class="k">class</span> <span class="nc">CoroutineTimeoutHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">io_loop</span> <span class="o">=</span> <span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">concurrent</span><span class="o">.</span><span class="n">Future</span><span class="p">()</span>
            <span class="n">do_something_with_callback</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">set_result</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">f</span>
</pre>
             </div> 
            </div> <p>Again, the <a class="reference external" href="https://github.com/tornadoweb/tornado/wiki/Links">Tornado wiki</a> can be useful to find suitable libraries.</p> </li> 
           <li><p class="first"><em>Run the blocking code on another thread.</em> When asynchronous libraries are not available, <a class="reference external" href="https://docs.python.org/3.6/library/concurrent.futures.html#concurrent.futures.ThreadPoolExecutor" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">concurrent.futures.ThreadPoolExecutor</span></code></a> can be used to run any blocking code on another thread. This is a universal solution that can be used for any blocking function whether an asynchronous counterpart exists or not:</p> 
            <div class="highlight-default notranslate">
             <div class="highlight">
              <pre><span></span><span class="k">class</span> <span class="nc">ThreadPoolHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre>
             </div> 
            </div> </li> 
          </ol> 
          <p>See the <a class="reference internal" href="guide/async.html"><span class="doc">Asynchronous I/O</span></a> chapter of the Tornado user’s guide for more on blocking and asynchronous functions.</p> 
         </div> 
         <div class="section" id="my-code-is-asynchronous-why-is-it-not-running-in-parallel-in-two-browser-tabs"> 
          <h2><a class="toc-backref" href="#id3">My code is asynchronous. Why is it not running in parallel in two browser tabs?</a><a class="headerlink" href="#my-code-is-asynchronous-why-is-it-not-running-in-parallel-in-two-browser-tabs" title="Permalink to this headline">¶</a></h2> 
          <p>Even when a handler is asynchronous and non-blocking, it can be surprisingly tricky to verify this. Browsers will recognize that you are trying to load the same page in two different tabs and delay the second request until the first has finished. To work around this and see that the server is in fact working in parallel, do one of two things:</p> 
          <ul class="simple"> 
           <li>Add something to your urls to make them unique. Instead of <code class="docutils literal notranslate"><span class="pre">http://localhost:8888</span></code> in both tabs, load <code class="docutils literal notranslate"><span class="pre">http://localhost:8888/?x=1</span></code> in one and <code class="docutils literal notranslate"><span class="pre">http://localhost:8888/?x=2</span></code> in the other.</li> 
           <li>Use two different browsers. For example, Firefox will be able to load a url even while that same url is being loaded in a Chrome tab.</li> 
          </ul> 
         </div> 
        </div> 
       </div> 
      </div> 
      <footer> 
       <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation"> <a href="releases.html" class="btn btn-neutral float-right" title="Release notes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a> <a href="util.html" class="btn btn-neutral float-left" title="tornado.util — General-purpose utilities" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a> 
       </div> 
       <hr> 
       <div role="contentinfo"> 
        <p> © Copyright The Tornado Authors <span class="commit"> Revision <code>2047e7ae</code>. </span> </p> 
       </div> Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 
      </footer> 
     </div> 
    </div> 
   </section> 
  </div> 
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions"> <span class="rst-current-version" data-toggle="rst-current-version"> <span class="fa fa-book"> Read the Docs</span> v: stable <span class="fa fa-caret-down"></span> </span> 
   <div class="rst-other-versions"> 
    <dl> 
     <dt>
      Versions
     </dt> 
     <dd>
      <a href="/en/latest/">latest</a>
     </dd> 
     <dd>
      <a href="/en/stable/">stable</a>
     </dd> 
     <dd>
      <a href="/en/branch6.0/">branch6.0</a>
     </dd> 
     <dd>
      <a href="/en/branch5.1/">branch5.1</a>
     </dd> 
     <dd>
      <a href="/en/branch4.5/">branch4.5</a>
     </dd> 
    </dl> 
    <dl> 
     <dt>
      Downloads
     </dt> 
     <dd>
      <a href="//www.tornadoweb.org/_/downloads/en/stable/pdf/">pdf</a>
     </dd> 
     <dd>
      <a href="//www.tornadoweb.org/_/downloads/en/stable/htmlzip/">html</a>
     </dd> 
     <dd>
      <a href="//www.tornadoweb.org/_/downloads/en/stable/epub/">epub</a>
     </dd> 
    </dl> 
    <dl> 
     <dt>
      On Read the Docs
     </dt> 
     <dd> <a href="//readthedocs.org/projects/tornado/?fromdocs=tornado">Project Home</a> 
     </dd> 
     <dd> <a href="//readthedocs.org/builds/tornado/?fromdocs=tornado">Builds</a> 
     </dd> 
    </dl> 
    <hr> Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>. 
   </div> 
  </div> 
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  
 </body>
</html>