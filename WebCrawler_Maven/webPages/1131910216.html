<!doctype html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"> 
 <head> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1"> 
  <meta name="Description" content="Documentation on the Roundup issue tracker, version 2.1.0."> 
  <meta content="Critical documentation on how to upgrade the Roundup Issue Tracker. Actions that must or can be taken when upgrading from one version to another are documented here." language="en" name="description"> 
  <title>Upgrading to newer versions of Roundup - Roundup 2.1.0 documentation</title> 
  <link rel="stylesheet" href="../_static/style.css" type="text/css"> 
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css"> 
  <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '../',
          VERSION:     '2.1.0',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script> 
  <script type="text/javascript" src="../_static/jquery.js"></script> 
  <script type="text/javascript" src="../_static/underscore.js"></script> 
  <script type="text/javascript" src="../_static/doctools.js"></script> 
  <script type="text/javascript" src="../_static/language_data.js"></script> 
  <link rel="canonical" href="https://www.roundup-tracker.org/docs/upgrading.html"> 
  <link rel="index" title="Index" href="../genindex.html"> 
  <link rel="search" title="Search" href="../search.html"> 
  <link rel="top" title="Roundup 2.1.0 documentation" href="../index.html"> 
  <link rel="up" title="Docs" href="../docs.html"> 
  <link rel="next" title="Roundup FAQ" href="FAQ.html"> 
  <link rel="prev" title="Installing Roundup" href="installation.html"> 
 </head> 
 <body> 
  <div class="header">
   <h1>Roundup</h1> 
   <div id="searchbox" style="display: none"> 
    <form class="search" action="../search.html" method="get"> 
     <input type="text" aria-label="Enter search terms" name="q" size="18"> 
     <input type="submit" value="Search"> 
     <input type="hidden" name="check_keywords" value="yes"> 
     <input type="hidden" name="area" value="default"> 
    </form> 
   </div> 
   <script type="text/javascript">$('#searchbox').show(0);</script> 
  </div> 
  <div class="navigation"> 
   <div class="menu"> 
    <ul class="current"> 
     <li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li> 
     <li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/roundup/">Download</a></li> 
     <li class="toctree-l1 current"><a class="reference internal" href="../docs.html">Docs</a>
      <ul class="current"> 
       <li class="toctree-l2"><a class="reference internal" href="features.html">Roundup Features</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="installation.html">Installing Roundup</a></li> 
       <li class="toctree-l2 current"><a class="current reference internal" href="#">Upgrading to newer versions of Roundup</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="FAQ.html">Roundup FAQ</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="user_guide.html">User Guide</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="customizing.html">Customising Roundup</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="admin_guide.html">Administration Guide</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="debugging.html">Debugging Aids</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="xmlrpc.html">XML-RPC access to Roundup</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="rest.html">REST API for Roundup</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="tracker_templates.html">Roundup Tracker Templates</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="glossary.html">Roundup Glossary</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="acknowledgements.html">Acknowledgements</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="license.html">License</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="overview.html">Design Overview</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="design.html">Design (original)</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="developers.html">Developing Roundup</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="mysql.html">Notes about the MySQL Database backend</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="postgresql.html">Notes about the PostgreSQL Database backend</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="implementation.html">Richard Jones implementation notes</a></li> 
      </ul> </li> 
     <li class="toctree-l1"><a class="reference external" href="https://issues.roundup-tracker.org">Issues</a></li> 
     <li class="toctree-l1"><a class="reference internal" href="../contact.html">Contact</a></li> 
     <li class="toctree-l1"><a class="reference external" href="https://wiki.roundup-tracker.org">Wiki</a></li> 
     <li class="toctree-l1"><a class="reference internal" href="../code.html">Code</a></li> 
    </ul> 
   </div> 
  </div> 
  <div class="content"> 
   <div id="subnav"> <a title="Installing Roundup" href="installation.html"> Prev</a> <a title="Roundup FAQ" href="FAQ.html"> Next</a> <a title="Index" href="../genindex.html"> Index</a> 
   </div> 
   <div class="section" id="upgrading-to-newer-versions-of-roundup"> <span id="index-0"></span>
    <h1>Upgrading to newer versions of Roundup</h1> 
    <p>Please read each section carefully and edit your tracker home files accordingly. Note that there is information about upgrade procedures in the <a class="reference external" href="admin_guide.html">administration guide</a>.</p> 
    <p>If a specific version transition isn’t mentioned here (eg. 0.6.7 to 0.6.8) then you don’t need to do anything. If you’re upgrading from 0.5.6 to 0.6.8 though, you’ll need to check the “0.5 to 0.6” and “0.6.x to 0.6.3” steps.</p> 
    <p><strong>IMPORTANT</strong> The v1.5.x releases of Roundup were the last to support Python v2.5 and v2.6. Starting with the v1.6 releases of Roundup Python version 2.7 that is newer than 2.7.2 is required to run roundup. Starting with Roundup version 2.0.0 we also support Python 3 versions newer than 3.4.</p> 
    <p>Contents:</p> 
    <div class="contents local topic" id="contents"> 
     <ul class="simple"> 
      <li><a class="reference internal" href="#migrating-from-2-0-0-to-2-1-0" id="id12">Migrating from 2.0.0 to 2.1.0</a>
       <ul> 
        <li><a class="reference internal" href="#rdbms-version-change-from-5-to-6" id="id13">Rdbms version change from 5 to 6 (**)</a></li> 
        <li><a class="reference internal" href="#setuptools-is-now-required-to-install" id="id14">Setuptools is now required to install</a></li> 
        <li><a class="reference internal" href="#define-authentication-header" id="id15">Define Authentication Header</a></li> 
        <li><a class="reference internal" href="#classname-format-enforced" id="id16">Classname Format Enforced</a></li> 
        <li><a class="reference internal" href="#jquery-updated-with-updates-to-user-help-html" id="id17">jQuery updated with updates to user.help.html</a></li> 
        <li><a class="reference internal" href="#roundup-admin-security-stops-on-incorrect-properties" id="id18">Roundup-admin security stops on incorrect properties</a></li> 
        <li><a class="reference internal" href="#futureproof-devel-and-responsive-timezone-selection-extension" id="id19">Futureproof devel and responsive timezone selection extension</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#migrating-from-1-6-x-to-2-0-0" id="id20">Migrating from 1.6.X to 2.0.0</a>
       <ul> 
        <li><a class="reference internal" href="#python-2-mysql-users-must-read" id="id21">Python 2 MYSQL users MUST READ</a></li> 
        <li><a class="reference internal" href="#upgrade-tracker-s-config-ini-file" id="id22">Upgrade tracker’s config.ini file</a></li> 
        <li><a class="reference internal" href="#python-3-support" id="id23">Python 3 support</a></li> 
        <li><a class="reference internal" href="#rate-limit-new-user-registration" id="id24">Rate Limit New User Registration</a></li> 
        <li><a class="reference internal" href="#pgp-mail-processing" id="id25">PGP mail processing</a></li> 
        <li><a class="reference internal" href="#mysql-client-module" id="id26">MySQL client module</a></li> 
        <li><a class="reference internal" href="#xmlrpc-access-role" id="id27">XMLRPC Access Role</a></li> 
        <li><a class="reference internal" href="#new-values-for-db-tx-source" id="id28">New values for db.tx_Source</a></li> 
        <li><a class="reference internal" href="#csv-export-changes" id="id29">CSV export changes</a></li> 
        <li><a class="reference internal" href="#update-userauditor-py-to-restrict-usernames" id="id30">Update userauditor.py to restrict usernames</a></li> 
        <li><a class="reference internal" href="#consider-reindexing-if-you-use-european-languages" id="id31">Consider reindexing if you use European languages</a></li> 
        <li><a class="reference internal" href="#merge-improvements-in-statusauditor-py" id="id32">Merge improvements in statusauditor.py</a></li> 
        <li><a class="reference internal" href="#responsive-template-changes" id="id33">Responsive template changes</a></li> 
        <li><a class="reference internal" href="#jinja-template-changes" id="id34">Jinja template changes</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#migrating-from-1-5-1-to-1-6-0" id="id35">Migrating from 1.5.1 to 1.6.0</a>
       <ul> 
        <li><a class="reference internal" href="#update-tracker-config-file" id="id36">Update tracker config file</a></li> 
        <li><a class="reference internal" href="#make-sure-that-user-can-view-labelprop-on-classes-required" id="id37">Make sure that user can view labelprop on classes (REQUIRED)</a></li> 
        <li><a class="reference internal" href="#cross-site-request-forgery-detection-added" id="id38">Cross Site Request Forgery Detection Added</a>
         <ul> 
          <li><a class="reference internal" href="#errors-and-troubleshooting-csrf-in-url" id="id39">Errors and Troubleshooting - @csrf in url</a></li> 
          <li><a class="reference internal" href="#errors-and-troubleshooting-attributeerror-list-object-no-attribute-value" id="id40">Errors and Troubleshooting - AttributeError list object no attribute value</a></li> 
          <li><a class="reference internal" href="#errors-and-troubleshooting-xmlrpc-required-header-missing" id="id41">Errors and Troubleshooting - xmlrpc Required Header Missing</a></li> 
         </ul> </li> 
        <li><a class="reference internal" href="#support-for-samesite-cookie-option-for-session-cookie" id="id42">Support for SameSite cookie option for session cookie</a></li> 
        <li><a class="reference internal" href="#fix-for-path-traversal-changes-template-resolution" id="id43">Fix for path traversal changes template resolution</a></li> 
        <li><a class="reference internal" href="#database-back-end-specified-in-config-ini-required" id="id44">Database back end specified in config.ini (REQUIRED)</a></li> 
        <li><a class="reference internal" href="#new-config-file-option-indexer-added" id="id45">New config file option ‘indexer’ added</a>
         <ul> 
          <li><a class="reference internal" href="#errors-and-troubleshooting-full-text-searching-not-working" id="id46">Errors and Troubleshooting - Full text searching not working</a>
           <ul> 
            <li><a class="reference internal" href="#xapian-error-with-flint-when-reindexing" id="id47">Xapian error with flint when reindexing</a></li> 
           </ul> </li> 
         </ul> </li> 
        <li><a class="reference internal" href="#stemming-improved-in-xapian-indexer" id="id48">Stemming improved in Xapian Indexer</a></li> 
        <li><a class="reference internal" href="#new-config-file-option-replyto-address-added" id="id49">New config file option ‘replyto_address’ added</a></li> 
        <li><a class="reference internal" href="#login-from-a-search-or-after-logout-works-better-required" id="id50">Login from a search or after logout works better (REQUIRED)</a>
         <ul> 
          <li><a class="reference internal" href="#errors-and-troubleshooting-unrecognized-scheme-in" id="id51">Errors and Troubleshooting - Unrecognized scheme in …</a></li> 
         </ul> </li> 
        <li><a class="reference internal" href="#option-to-make-adding-multiple-keywords-more-convenient" id="id52">Option to make adding multiple keywords more convenient</a></li> 
        <li><a class="reference internal" href="#helper-popups-trigger-change-events-on-the-original-page" id="id53">Helper popups trigger change events on the original page</a></li> 
        <li><a class="reference internal" href="#html-generic-404-html-in-trackers-use-page-template" id="id54">html/_generic.404.html in trackers use page template</a></li> 
        <li><a class="reference internal" href="#organize-templates-into-subdirectories" id="id55">Organize templates into subdirectories</a></li> 
        <li><a class="reference internal" href="#properly-quote-query-dispname-displayed-name-in-page-html" id="id56">Properly quote query dispname (displayed name) in page.html</a></li> 
        <li><a class="reference internal" href="#allow-show-unassigned-issues-link-to-work-for-anonymous-user" id="id57">Allow “Show Unassigned” issues link to work for Anonymous user</a>
         <ul> 
          <li><a class="reference internal" href="#errors-and-troubleshooting-unassigned-issues-for-anonymous" id="id58">Errors and Troubleshooting - Unassigned issues for anonymous</a></li> 
         </ul> </li> 
        <li><a class="reference internal" href="#improvements-in-classic-tracker-query-edit-html-template" id="id59">Improvements in Classic Tracker query.edit.html template</a>
         <ul> 
          <li><a class="reference internal" href="#errors-and-troubleshooting-public-queries-listed-twice-when-editing" id="id60">Errors and Troubleshooting - Public queries listed twice when editing</a></li> 
         </ul> </li> 
        <li><a class="reference internal" href="#fix-security-issues-in-query-item-html-template" id="id61">Fix security issues in query.item.html template</a></li> 
        <li><a class="reference internal" href="#enhancement-to-check-command-for-permissions" id="id62">Enhancement to check command for Permissions</a></li> 
        <li><a class="reference internal" href="#changes-to-property-permissions" id="id63">Changes to property permissions</a></li> 
        <li><a class="reference internal" href="#improve-query-editing" id="id64">Improve query editing</a></li> 
        <li><a class="reference internal" href="#new-l-loghttpvialogger-option-to-roundup-server" id="id65">New -L (loghttpvialogger) option to roundup-server</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#migrating-from-1-5-0-to-1-5-1" id="id66">Migrating from 1.5.0 to 1.5.1</a>
       <ul> 
        <li><a class="reference internal" href="#user-data-visibility" id="id67">User data visibility</a></li> 
        <li><a class="reference internal" href="#xss-protection-for-custom-actions" id="id68">XSS protection for custom actions</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#migrating-from-1-4-20-to-1-4-21" id="id69">Migrating from 1.4.20 to 1.4.21</a></li> 
      <li><a class="reference internal" href="#migrating-from-1-4-19-to-1-4-20" id="id70">Migrating from 1.4.19 to 1.4.20</a></li> 
      <li><a class="reference internal" href="#migrating-from-1-4-17-to-1-4-18" id="id71">Migrating from 1.4.17 to 1.4.18</a></li> 
      <li><a class="reference internal" href="#migrating-from-1-4-x-to-1-4-17" id="id72">Migrating from 1.4.x to 1.4.17</a></li> 
      <li><a class="reference internal" href="#migrating-from-1-4-x-to-1-4-12" id="id73">Migrating from 1.4.x to 1.4.12</a>
       <ul> 
        <li><a class="reference internal" href="#fixing-some-potential-security-holes" id="id74">Fixing some potential security holes</a></li> 
        <li><a class="reference internal" href="#some-html-interface-tweaks" id="id75">Some HTML interface tweaks</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#migrating-from-1-4-x-to-1-4-11" id="id76">Migrating from 1.4.x to 1.4.11</a>
       <ul> 
        <li><a class="reference internal" href="#close-potential-security-hole" id="id77">Close potential security hole</a></li> 
        <li><a class="reference internal" href="#grant-the-register-permission-to-the-anonymous-role" id="id78">Grant the “Register” permission to the Anonymous role</a></li> 
        <li><a class="reference internal" href="#generic-class-editor-may-now-restore-retired-items" id="id79">Generic class editor may now restore retired items</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#migrating-from-1-4-x-to-1-4-9" id="id80">Migrating from 1.4.x to 1.4.9</a>
       <ul> 
        <li><a class="reference internal" href="#customized-mailgw-class" id="id81">Customized MailGW Class</a></li> 
        <li><a class="reference internal" href="#fix-the-remove-button-in-issue-files-and-messages-lists" id="id82">Fix the “remove” button in issue files and messages lists</a></li> 
        <li><a class="reference internal" href="#fixing-the-retire-button-in-user-management-list" id="id83">Fixing the “retire” button in user management list</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#migrating-from-1-4-x-to-1-4-7" id="id84">Migrating from 1.4.x to 1.4.7</a>
       <ul> 
        <li><a class="reference internal" href="#grant-the-retire-permission-to-users-for-their-queries" id="id85">Grant the “retire” permission to users for their queries</a></li> 
        <li><a class="reference internal" href="#fix-the-retire-link-in-the-users-list-for-admin-users" id="id86">Fix the “retire” link in the users list for admin users</a></li> 
        <li><a class="reference internal" href="#fix-for-python-2-6-users" id="id87">Fix for Python 2.6+ users</a></li> 
        <li><a class="reference internal" href="#trackers-currently-allowing-html-file-uploading" id="id88">Trackers currently allowing HTML file uploading</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#migrating-from-1-4-2-to-1-4-3" id="id89">Migrating from 1.4.2 to 1.4.3</a></li> 
      <li><a class="reference internal" href="#migrating-from-1-4-x-to-1-4-2" id="id90">Migrating from 1.4.x to 1.4.2</a></li> 
      <li><a class="reference internal" href="#migrating-from-1-3-3-to-1-4-0" id="id91">Migrating from 1.3.3 to 1.4.0</a></li> 
      <li><a class="reference internal" href="#migrating-from-1-2-x-to-1-3-0" id="id92">Migrating from 1.2.x to 1.3.0</a>
       <ul> 
        <li><a class="reference internal" href="#web-interface-changes" id="id93">1.3.0 Web interface changes</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#migrating-from-1-1-2-to-1-2-0" id="id94">Migrating from 1.1.2 to 1.2.0</a>
       <ul> 
        <li><a class="reference internal" href="#sorting-and-grouping-by-multiple-properties" id="id95">1.2.0 Sorting and grouping by multiple properties</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#migrating-from-1-1-0-to-1-1-1" id="id96">Migrating from 1.1.0 to 1.1.1</a>
       <ul> 
        <li><a class="reference internal" href="#clear-this-message" id="id97">1.1.1 “Clear this message”</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#migrating-from-1-0-x-to-1-1-0" id="id98">Migrating from 1.0.x to 1.1.0</a>
       <ul> 
        <li><a class="reference internal" href="#login-for-session-only" id="id99">1.1 Login “For Session Only”</a></li> 
        <li><a class="reference internal" href="#query-display-name" id="id100">1.1 Query Display Name</a></li> 
        <li><a class="reference internal" href="#id1" id="id101">1.1 “Clear this message”</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#migrating-from-0-8-x-to-1-0" id="id102">Migrating from 0.8.x to 1.0</a>
       <ul> 
        <li><a class="reference internal" href="#new-query-permissions" id="id103">1.0 New Query Permissions</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#migrating-from-0-8-0-to-0-8-3" id="id104">Migrating from 0.8.0 to 0.8.3</a>
       <ul> 
        <li><a class="reference internal" href="#nosy-handling-changes" id="id105">0.8.3 Nosy Handling Changes</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#migrating-from-0-7-1-to-0-8-0" id="id106">Migrating from 0.7.1 to 0.8.0</a>
       <ul> 
        <li><a class="reference internal" href="#backend-changes" id="id107">0.8.0 Backend changes</a></li> 
        <li><a class="reference internal" href="#api-changes" id="id108">0.8.0 API changes</a></li> 
        <li><a class="reference internal" href="#new-tracker-layout" id="id109">0.8.0 New tracker layout</a></li> 
        <li><a class="reference internal" href="#permissions-changes" id="id110">0.8.0 Permissions Changes</a></li> 
        <li><a class="reference internal" href="#use-of-templatingutils" id="id111">0.8.0 Use of TemplatingUtils</a></li> 
        <li><a class="reference internal" href="#logging-configuration" id="id112">0.8.0 Logging Configuration</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#migrating-from-0-7-2-to-0-7-3" id="id113">Migrating from 0.7.2 to 0.7.3</a>
       <ul> 
        <li><a class="reference internal" href="#configuration" id="id114">0.7.3 Configuration</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#migrating-from-0-7-0-to-0-7-2" id="id115">Migrating from 0.7.0 to 0.7.2</a>
       <ul> 
        <li><a class="reference internal" href="#default-timezone-is-now-required" id="id116">0.7.2 DEFAULT_TIMEZONE is now required</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#migrating-from-0-7-0-to-0-7-1" id="id117">Migrating from 0.7.0 to 0.7.1</a>
       <ul> 
        <li><a class="reference internal" href="#permission-assignments" id="id118">0.7.1 Permission assignments</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#migrating-from-0-6-to-0-7" id="id119">Migrating from 0.6 to 0.7</a>
       <ul> 
        <li><a class="reference internal" href="#id2" id="id120">0.7.0 Permission assignments</a></li> 
        <li><a class="reference internal" href="#getting-the-current-user-id" id="id121">0.7.0 Getting the current user id</a></li> 
        <li><a class="reference internal" href="#zroundup-changes" id="id122">0.7.0 ZRoundup changes</a></li> 
        <li><a class="reference internal" href="#edit-collision-detection" id="id123">0.7.0 Edit collision detection</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#migrating-from-0-6-x-to-0-6-3" id="id124">Migrating from 0.6.x to 0.6.3</a>
       <ul> 
        <li><a class="reference internal" href="#id3" id="id125">0.6.3 Configuration</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#migrating-from-0-5-to-0-6" id="id126">Migrating from 0.5 to 0.6</a>
       <ul> 
        <li><a class="reference internal" href="#id4" id="id127">0.6.0 Configuration</a></li> 
        <li><a class="reference internal" href="#templating-changes" id="id128">0.6.0 Templating changes</a></li> 
        <li><a class="reference internal" href="#form-handling-changes" id="id129">0.6.0 Form handling changes</a></li> 
        <li><a class="reference internal" href="#multilingual-character-set-support" id="id130">0.6.0 Multilingual character set support</a></li> 
        <li><a class="reference internal" href="#user-timezone-support" id="id131">0.6.0 User timezone support</a></li> 
        <li><a class="reference internal" href="#search-page-structure" id="id132">0.6.0 Search page structure</a></li> 
        <li><a class="reference internal" href="#notes-for-metakit-backend-users" id="id133">0.6.0 Notes for metakit backend users</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#migrating-from-0-4-x-to-0-5-0" id="id134">Migrating from 0.4.x to 0.5.0</a>
       <ul> 
        <li><a class="reference internal" href="#id7" id="id135">0.5.0 Configuration</a></li> 
        <li><a class="reference internal" href="#schema-specification" id="id136">0.5.0 Schema Specification</a>
         <ul> 
          <li><a class="reference internal" href="#database-backend-changes" id="id137">0.5.0 Database backend changes</a></li> 
          <li><a class="reference internal" href="#journalling-changes" id="id138">0.5.0 Journalling changes</a></li> 
          <li><a class="reference internal" href="#user-schema-changes" id="id139">0.5.0 User schema changes</a></li> 
          <li><a class="reference internal" href="#security-settings" id="id140">0.5.0 Security Settings</a></li> 
          <li><a class="reference internal" href="#user-changes" id="id141">0.5.0 User changes</a></li> 
         </ul> </li> 
        <li><a class="reference internal" href="#cgi-interface-changes" id="id142">0.5.0 CGI interface changes</a></li> 
        <li><a class="reference internal" href="#html-templating" id="id143">0.5.0 HTML templating</a></li> 
        <li><a class="reference internal" href="#detectors" id="id144">0.5.0 Detectors</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#migrating-from-0-4-1-to-0-4-2" id="id145">Migrating from 0.4.1 to 0.4.2</a>
       <ul> 
        <li><a class="reference internal" href="#id8" id="id146">0.4.2 Configuration</a></li> 
        <li><a class="reference internal" href="#changes-to-detectors" id="id147">0.4.2 Changes to detectors</a></li> 
        <li><a class="reference internal" href="#html-templating-changes" id="id148">0.4.2 HTML templating changes</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#migrating-from-0-4-0-to-0-4-1" id="id149">Migrating from 0.4.0 to 0.4.1</a>
       <ul> 
        <li><a class="reference internal" href="#files-storage" id="id150">0.4.1 Files storage</a></li> 
        <li><a class="reference internal" href="#id9" id="id151">0.4.1 Configuration</a></li> 
        <li><a class="reference internal" href="#alternate-e-mail-addresses" id="id152">0.4.1 Alternate E-Mail Addresses</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#migrating-from-0-3-x-to-0-4-0" id="id153">Migrating from 0.3.x to 0.4.0</a>
       <ul> 
        <li><a class="reference internal" href="#message-id-and-in-reply-to-addition" id="id154">0.4.0 Message-ID and In-Reply-To addition</a></li> 
        <li><a class="reference internal" href="#id10" id="id155">0.4.0 Configuration</a></li> 
        <li><a class="reference internal" href="#cgi-script-roundup-cgi" id="id156">0.4.0 CGI script roundup.cgi</a></li> 
        <li><a class="reference internal" href="#nosy-reactor" id="id157">0.4.0 Nosy reactor</a></li> 
        <li><a class="reference internal" href="#id11" id="id158">0.4.0 HTML templating</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#migrating-from-0-2-x-to-0-3-x" id="id159">Migrating from 0.2.x to 0.3.x</a>
       <ul> 
        <li><a class="reference internal" href="#x-cookie-authentication-changes" id="id160">0.3.x Cookie Authentication changes</a></li> 
        <li><a class="reference internal" href="#x-password-encoding" id="id161">0.3.x Password encoding</a></li> 
        <li><a class="reference internal" href="#x-configuration" id="id162">0.3.x Configuration</a></li> 
        <li><a class="reference internal" href="#x-cgi-script-roundup-cgi" id="id163">0.3.x CGI script roundup.cgi</a></li> 
       </ul> </li> 
     </ul> 
    </div> 
    <div class="section" id="migrating-from-2-0-0-to-2-1-0"> <span id="index-1"></span>
     <h2><a class="toc-backref" href="#id12">Migrating from 2.0.0 to 2.1.0</a></h2> 
     <div class="section" id="rdbms-version-change-from-5-to-6"> 
      <h3><a class="toc-backref" href="#id13">Rdbms version change from 5 to 6 (**)</a></h3> 
      <p>To fix an issue with importing databases, the database has to be upgraded for rdbms backends.</p> 
      <p>You should run the <code class="docutils literal notranslate"><span class="pre">roundup-admin</span> <span class="pre">migrate</span></code> command for your tracker once you’ve installed the latest codebase.</p> 
      <p>Do this before you use the web, command-line or mail interface and before any users access the tracker.</p> 
      <p>If successful, this command will respond with either “Tracker updated” (if you’ve not previously run it on an RDBMS backend) or “No migration action required” (if you have run it, or have used another interface to the tracker, or are using anydbm).</p> 
      <p>This only changes the schema for the mysql backend. It has no effect other than upgrading the revision on other rdbms backends.</p> 
      <p>On the mysql backend it creates the database index that makes sure the key field for your class is unique.</p> 
      <p>If your update/migration fails, you will see an:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">IntegrityError</span><span class="p">:</span> <span class="p">(</span><span class="mi">1062</span><span class="p">,</span> <span class="s2">"Duplicate entry '0-NULL' for key '_user_key_retired_idx'"</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>it means you have two non-retired members of the class with the same key field. E.G. two non-retired users with the same username.</p> 
      <p>Debug this using roundup-admin using the list command. For example dump the user class by the key field <code class="docutils literal notranslate"><span class="pre">username</span></code>:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span>$ roundup-admin -i &lt;tracker_home&gt; list user username
  1: admin
  2: anonymous
  3: demo
  4: agent
  5: provisional
  6: foo@example.com
  7: dupe
  8: dupe
  ...
</pre>
       </div> 
      </div> 
      <p>then search the usernames for duplicates. Once you have identified the duplicate username (<code class="docutils literal notranslate"><span class="pre">dupe</span></code> above), you should retire the other active duplicates or change the username for the duplicate. To retire <code class="docutils literal notranslate"><span class="pre">7:</span> <span class="pre">dupe</span></code>, you run:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">roundup</span><span class="o">-</span><span class="n">admin</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">tracker_home</span><span class="o">&gt;</span> <span class="n">retire</span> <span class="n">user7</span>
</pre>
       </div> 
      </div> 
      <p>(use <code class="docutils literal notranslate"><span class="pre">restore</span> <span class="pre">user7</span></code> if you retired the wrong item). If you want to rename the entry use:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">roundup</span><span class="o">-</span><span class="n">admin</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">tracker_home</span><span class="o">&gt;</span> <span class="nb">set</span> <span class="n">user7</span> <span class="n">username</span><span class="o">=</span><span class="n">dupe1</span>
</pre>
       </div> 
      </div> 
      <p>Keep doing this until you have no more duplicates. Then run the update/migrate again.</p> 
      <p>If you have duplicate non-retired entries in your database, please email roundup-users at lists.sourceforge.net. We are interested in how many issues this has caused. Duplicate creation should occur only when two or more mysql processes run in parallel and both of them creating an item with the same key. So this should be a rare event. The internal duplicate prevention checks should work in other cases.</p> 
      <p>For the nerds: if you had a new installation that was created at version 5, the uniqueness of a key was not enforced at the database level. If you had a database that was at version 4 and then upgraded to version 5 you have the uniqueness enforcing constraint. Running migrate updates to schema version 6 and installs the unique index constraint if it is missing.</p> 
     </div> 
     <div class="section" id="setuptools-is-now-required-to-install"> 
      <h3><a class="toc-backref" href="#id14">Setuptools is now required to install</a></h3> 
      <p>Roundup install now uses setuptools rather than distutils. You must install setuptools. Use the version packgaged by your OS vendor. If your OS vendor doesn’t supply setuptools use <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">setuptools</span></code>. (You may need pip3 rather than pip if using python3.)</p> 
     </div> 
     <div class="section" id="define-authentication-header"> 
      <h3><a class="toc-backref" href="#id15">Define Authentication Header</a></h3> 
      <p>The web server in front of roundup (apache, nginx) can perform user authentication. It can pass the authenticated username to the backend in a variable. By default roundup looks for the <code class="docutils literal notranslate"><span class="pre">REMOTE_USER</span></code> variable. This can be changed by setting the parameter <code class="docutils literal notranslate"><span class="pre">http_auth_header</span></code> in the <code class="docutils literal notranslate"><span class="pre">[web]</span></code> section of the tracker’s <code class="docutils literal notranslate"><span class="pre">config.ini</span></code> file to a different value. The value is case sensitive. If the value is unset (the default) the REMOTE_USER variable is used.</p> 
      <p>If you are running roundup using <code class="docutils literal notranslate"><span class="pre">roundup-server</span></code> behind a proxy that authenticates the user you need to configure <code class="docutils literal notranslate"><span class="pre">roundup-server</span></code> to pass the HTTP header with the authenticated username to the tracker. By default <code class="docutils literal notranslate"><span class="pre">roundup-server</span></code> looks for the <code class="docutils literal notranslate"><span class="pre">REMOTE_USER</span></code> header for the authenticated user. You can copy an arbitrary header variable to the tracker using the <code class="docutils literal notranslate"><span class="pre">-I</span></code> option to roundup-server (or the equivalent option in the roundup-server config file).</p> 
      <p>For example to use the <code class="docutils literal notranslate"><span class="pre">uid_variable</span></code> header, two configuration changes are needed: First configure <code class="docutils literal notranslate"><span class="pre">roundup-server</span></code> to pass the header to the tracker using:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">roundup</span><span class="o">-</span><span class="n">server</span> <span class="o">-</span><span class="n">I</span> <span class="n">uid_variable</span> <span class="o">....</span>
</pre>
       </div> 
      </div> 
      <p>note that the header is passed exactly as supplied by the upstream server. It is <strong>not</strong> prefixed with <code class="docutils literal notranslate"><span class="pre">HTTP_</span></code> like other headers since you are explicitly allowing the header. Multiple comma separated headers can be passed to the <code class="docutils literal notranslate"><span class="pre">-I</span></code> option. These could be used in a detector or other tracker extensions, but only one header can be used by the tracker as an authentication header.</p> 
      <p>To make the tracker honor the new variable changing the tracker <code class="docutils literal notranslate"><span class="pre">config.ini</span></code> to read:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="p">[</span><span class="n">web</span><span class="p">]</span>
<span class="o">...</span>
<span class="n">http_auth_header</span> <span class="o">=</span> <span class="n">uid_variable</span>
</pre>
       </div> 
      </div> 
      <p>At the time this is written, support is experimental. If you use it you should notify the roundup maintainers using the roundup-users at lists.sourceforge.net mailing list.</p> 
     </div> 
     <div class="section" id="classname-format-enforced"> 
      <h3><a class="toc-backref" href="#id16">Classname Format Enforced</a></h3> 
      <p>Check schema.py and look at all Class(), IssueClass(), FileClass() calls. The second argument is the classname. All classnames must:</p> 
      <blockquote> 
       <div>
        <ul class="simple"> 
         <li>start with an alphabetic character</li> 
         <li>consist of alphanumerics and ‘_’</li> 
         <li>not end with a digit</li> 
        </ul> 
       </div>
      </blockquote> 
      <p>this was not enforced before. Using non-standard classnames could lead to other issues.</p> 
     </div> 
     <div class="section" id="jquery-updated-with-updates-to-user-help-html"> 
      <h3><a class="toc-backref" href="#id17">jQuery updated with updates to user.help.html</a></h3> 
      <p>The devel and responsive templates shipped with an old version of jQuery with some security issues. It has been updated to the current version: 3.5.1. If your tracker is based on one of these templates (see the <code class="docutils literal notranslate"><span class="pre">TEMPLATE-INFO.txt</span></code> file in your tracker), remove the old <code class="docutils literal notranslate"><span class="pre">html/jquery.js</span></code> file from your tracker and copy the new <code class="docutils literal notranslate"><span class="pre">jquery-3.5.1.js</span></code> file from the template directory to your tracker’s <code class="docutils literal notranslate"><span class="pre">html</span></code> directory. Also copy in the new <code class="docutils literal notranslate"><span class="pre">user.help.html</span></code> file. It now references the new <code class="docutils literal notranslate"><span class="pre">jquery-3.5.1.js</span></code> file and also fixes a bug that prevented applying the change from the helper to the field on the main form.</p> 
     </div> 
     <div class="section" id="roundup-admin-security-stops-on-incorrect-properties"> 
      <h3><a class="toc-backref" href="#id18">Roundup-admin security stops on incorrect properties</a></h3> 
      <p>The <code class="docutils literal notranslate"><span class="pre">roundup-admin</span> <span class="pre">...</span> <span class="pre">security</span></code> command used to continue running through the rest of the security roles after reporting a property error. Now it stops after reporting the incorrect property.</p> 
      <p>If run non-interactively, it exits with status 1. It can now be used in a startup script to detect permission errors.</p> 
     </div> 
     <div class="section" id="futureproof-devel-and-responsive-timezone-selection-extension"> 
      <h3><a class="toc-backref" href="#id19">Futureproof devel and responsive timezone selection extension</a></h3> 
      <p>The devel and responsive (derived from devel) templates use a select control to list all available timezones when pytz is used. It sanitizes the data using cgi.escape. Cgi.escape is deprecated and removed in newer pythons. Change your <code class="docutils literal notranslate"><span class="pre">extensions/timezone.py</span></code> file by applying the following patch manually:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">-</span><span class="kn">import</span> <span class="nn">cgi</span>
<span class="o">+</span><span class="k">try</span><span class="p">:</span>
<span class="o">+</span>    <span class="kn">from</span> <span class="nn">html</span> <span class="k">import</span> <span class="n">escape</span>
<span class="o">+</span><span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
<span class="o">+</span>    <span class="kn">from</span> <span class="nn">cgi</span> <span class="k">import</span> <span class="n">escape</span>

 <span class="k">try</span><span class="p">:</span>
     <span class="kn">import</span> <span class="nn">pytz</span>
<span class="o">@@</span> <span class="o">-</span><span class="mi">25</span><span class="p">,</span><span class="mi">7</span> <span class="o">+</span><span class="mi">28</span><span class="p">,</span><span class="mi">7</span> <span class="o">@@</span>
             <span class="n">s</span> <span class="o">=</span> <span class="s1">' '</span>
             <span class="k">if</span> <span class="n">zone</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                 <span class="n">s</span> <span class="o">=</span> <span class="s1">'selected=selected '</span>
<span class="o">-</span>            <span class="n">z</span> <span class="o">=</span> <span class="n">cgi</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
<span class="o">+</span>            <span class="n">z</span> <span class="o">=</span> <span class="n">escape</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>See <a class="reference external" href="https://issues.roundup-tracker.org/issue2551136">https://issues.roundup-tracker.org/issue2551136</a> for more details.</p> 
     </div> 
    </div> 
    <div class="section" id="migrating-from-1-6-x-to-2-0-0"> <span id="index-2"></span>
     <h2><a class="toc-backref" href="#id20">Migrating from 1.6.X to 2.0.0</a></h2> 
     <div class="section" id="python-2-mysql-users-must-read"> <span id="index-3"></span>
      <h3><a class="toc-backref" href="#id21">Python 2 MYSQL users MUST READ</a></h3> 
      <p>To fix issues with encoding of data and text searching, roundup now explicitly sets the database connection character set. Roundup prior to 2.0 used the default character set which was not always utf-8. All roundup data is manipulated in utf-8. This mismatch causes issues with searches and result in corrupted data in the database if it was not properly represented across the charset conversions.</p> 
      <p>This issue exists when running roundup under python 2. Note that there are more changes required for running roundup 2.0 if you choose to use python3. See <a class="reference internal" href="#python-3-support">Python 3 support</a>.</p> 
      <p>In an upgraded <code class="docutils literal notranslate"><span class="pre">config.ini</span></code> (see next section) the <code class="docutils literal notranslate"><span class="pre">[rdbms]</span></code> section has a key <code class="docutils literal notranslate"><span class="pre">mysql_charset</span></code> set by default to <code class="docutils literal notranslate"><span class="pre">utf8mb4</span></code>.</p> 
      <p>It should be possible to change <code class="docutils literal notranslate"><span class="pre">utf8mb4</span></code> to any mysql charset. So if you know what charset is enabled (e.g. via a setting in ~roundup/.my.cnf, or the default charset for the database) you can set it in <code class="docutils literal notranslate"><span class="pre">config.ini</span></code> and not need to covert the database. However the underlying issues with misconverted data and bad searches will still exist if they did before.</p> 
      <p>None of the roundup developers run mysql, so the exact steps to take during the upgrade were tested with test and not production databases.</p> 
      <p><strong>Before doing anything else:</strong></p> 
      <blockquote> 
       <div>
        <p>Backup the mysql database using mysql dump or other mysql supported tool.</p> 
        <p>Backup roundup using your current backup tool and take the roundup instance offline.</p> 
       </div>
      </blockquote> 
      <p>Then the following steps (similar to the conversion in needed for Python 3) should work:</p> 
      <ol class="arabic"> 
       <li><p class="first">Export the tracker database using your <strong>current</strong> 1.6 instance:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="n">roundup</span><span class="o">-</span><span class="n">admin</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">trackerdir</span><span class="o">&gt;</span> <span class="n">exporttables</span> <span class="o">&lt;</span><span class="n">export_dir</span><span class="o">&gt;</span>
</pre>
         </div> 
        </div> <p>replacing tracker_dir and export_dir as appropriate.</p> </li> 
       <li><p class="first">Import the exported database using the <strong>new</strong> 2.0 roundup:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="n">roundup</span><span class="o">-</span><span class="n">admin</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">trackerdir</span><span class="o">&gt;</span> <span class="n">importtables</span> <span class="o">&lt;</span><span class="n">export_dir</span><span class="o">&gt;</span>
</pre>
         </div> 
        </div> <p>replacing tracker_dir and export_dir as appropriate.</p> </li> 
      </ol> 
      <p>The imported data should overwrite the original data. Note it is critically important that the <code class="docutils literal notranslate"><span class="pre">exporttables</span></code> be done with the <em>old tracker</em> and the <code class="docutils literal notranslate"><span class="pre">importtables</span></code> be done with the <em>new tracker</em>. An import/export cycle between roundup 1.6.0 and roundup 2.0 has been done successfully. So the export format for 1.6 and 2.0 should be compatible.</p> 
      <p>Note that <code class="docutils literal notranslate"><span class="pre">importtables</span></code> is new in roundup-2.0, so you will not be able to import the result of <code class="docutils literal notranslate"><span class="pre">exporttables</span></code> using any 1.x version of roundup.</p> 
      <p>Following the same sequence as above using <code class="docutils literal notranslate"><span class="pre">export</span></code> and <code class="docutils literal notranslate"><span class="pre">import</span></code> should also work, but it will export all the files and messages. This will take longer but may be worth trying if the <code class="docutils literal notranslate"><span class="pre">exporttables</span></code> and <code class="docutils literal notranslate"><span class="pre">importtables</span></code> method fails for some reason.</p> 
      <p>Another way that should be faster, but is untested is to use mysql dump to dump the database. <a class="reference external" href="https://makandracards.com/makandra/595-dumping-and-importing-from-to-mysql-in-an-utf-8-safe-way">https://makandracards.com/makandra/595-dumping-and-importing-from-to-mysql-in-an-utf-8-safe-way</a> recommends:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span>Note that when your MySQL server is not set to UTF-8 you need to do
mysqldump --default-character-set=latin1 (!) to get a correctly
encoded dump. In that case you will also need to remove the SET
NAMES='latin1' comment at the top of the dump, so the target machine
won't change its UTF-8 charset when sourcing.
</pre>
       </div> 
      </div> 
      <p>Then import the dump. Removing <code class="docutils literal notranslate"><span class="pre">SET</span> <span class="pre">NAMES</span></code> should allow the import to use UTF-8.</p> 
      <p>Please report success or issues with this conversion to the roundup-users AT lists.sourceforge.net mailing list.</p> 
      <p>As people report successful or unsuccessful conversions, we will update the errata page at: <a class="reference external" href="https://wiki.roundup-tracker.org/ReleaseErrata">https://wiki.roundup-tracker.org/ReleaseErrata</a>.</p> 
     </div> 
     <div class="section" id="upgrade-tracker-s-config-ini-file"> 
      <h3><a class="toc-backref" href="#id22">Upgrade tracker’s config.ini file</a></h3> 
      <p>Once you have installed the new roundup, use:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">roundup</span><span class="o">-</span><span class="n">admin</span> <span class="o">-</span><span class="n">i</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">tracker</span> <span class="n">updateconfig</span> <span class="n">newconfig</span><span class="o">.</span><span class="n">ini</span>
</pre>
       </div> 
      </div> 
      <p>to generate a new ini file preserving all your settings. You can then merge any local comments from the tracker’s <code class="docutils literal notranslate"><span class="pre">config.ini</span></code> into <code class="docutils literal notranslate"><span class="pre">newconfig.ini</span></code>. Compare the old and new files and configure any new settings as you want. Then replace <code class="docutils literal notranslate"><span class="pre">config.ini</span></code> with the <code class="docutils literal notranslate"><span class="pre">newconfig.ini</span></code> file.</p> 
     </div> 
     <div class="section" id="python-3-support"> 
      <h3><a class="toc-backref" href="#id23">Python 3 support</a></h3> 
      <p>Many of the <code class="docutils literal notranslate"><span class="pre">.html</span></code> and <code class="docutils literal notranslate"><span class="pre">.py</span></code> files from Roundup that are copied into tracker directories have changed for Python 3 support. If you wish to move an existing tracker to Python 3, you need to merge in those changes. Also you need to make sure that locally created python code in the tracker is correct for Python 3.</p> 
      <p>If your tracker uses the <code class="docutils literal notranslate"><span class="pre">anydbm</span></code> or <code class="docutils literal notranslate"><span class="pre">mysql</span></code> backends, you also need to export the tracker contents using <code class="docutils literal notranslate"><span class="pre">roundup-admin</span> <span class="pre">export</span></code> running under Python 2, and them import them using <code class="docutils literal notranslate"><span class="pre">roundup-admin</span> <span class="pre">import</span></code> running under Python 3. This is detailed in the documention for migrating to a different backend. If using the <code class="docutils literal notranslate"><span class="pre">sqlite</span></code> backend, you do not need to export and import, but need to delete the <code class="docutils literal notranslate"><span class="pre">db/otks</span></code> and <code class="docutils literal notranslate"><span class="pre">db/sessions</span></code> files when changing Python version. If using the <code class="docutils literal notranslate"><span class="pre">postgresql</span></code> backend, you do not need to export and import and no other special database-related steps are needed.</p> 
      <p>If you use the whoosh indexer, you will need to reindex. It looks like a database created with Python 2 leads to Unicode decode errors when accessed by Python 3. Reindexing can take a while (see details below look for “reindexing”).</p> 
      <p>Octal values in config.ini change from the Python 2 representation with a leading <code class="docutils literal notranslate"><span class="pre">0</span></code> (<code class="docutils literal notranslate"><span class="pre">022</span></code>). They now use a leading <code class="docutils literal notranslate"><span class="pre">0o</span></code> (<code class="docutils literal notranslate"><span class="pre">0o22</span></code>). Note that the <code class="docutils literal notranslate"><span class="pre">0o</span></code> format is properly handled under python 2. You can use the <code class="docutils literal notranslate"><span class="pre">newconfig.ini</span></code> generated using <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">roundup-admin</span> <span class="pre">-i</span> <span class="pre">...</span> <span class="pre">updateconfig</span> <span class="pre">newconfig.ini</span></code> if you want to go back to using python 2. (Note going back to Python 2 will require the same steps as moving from 2 to 3 except using Python 3 to perform the export.)</p> 
     </div> 
     <div class="section" id="rate-limit-new-user-registration"> 
      <h3><a class="toc-backref" href="#id24">Rate Limit New User Registration</a></h3> 
      <p>The new user registration form can be abused by bots to allow automated registration for spamming. This can be limited by using the new <code class="docutils literal notranslate"><span class="pre">config.ini</span></code> <code class="docutils literal notranslate"><span class="pre">[web]</span></code> option called <code class="docutils literal notranslate"><span class="pre">registration_delay</span></code>. The default is 4 and is the number of seconds between the time the form was generated and the time the form is processed.</p> 
      <p>If you do not modify the <code class="docutils literal notranslate"><span class="pre">user.register.html</span></code> template in your tracker’s html directory, you <em>must</em> set this to 0. Otherwise you will see the error:</p> 
      <blockquote> 
       <div>
        Form is corrupted, missing: opaqueregister.
       </div>
      </blockquote> 
      <p>If set to 0, the rate limit check is disabled.</p> 
      <p>If you want to use this, you can change your <code class="docutils literal notranslate"><span class="pre">user.register.html</span></code> file to include:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"opaqueregister"</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"value python: utils.timestamp()"</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
      <p>The hidden input field can be placed right after the form declaration that starts with:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">"POST"</span> <span class="n">onSubmit</span><span class="o">=</span><span class="s2">"return submit_once()"</span>
</pre>
       </div> 
      </div> 
      <p>If you have applied Erik Forsberg’s tracker level patch to implement (see: <a class="reference external" href="https://hg.python.org/tracker/python-dev/rev/83477f735132">https://hg.python.org/tracker/python-dev/rev/83477f735132</a>), you can back the code out of the tracker. You must change the name of the field in the html template to <code class="docutils literal notranslate"><span class="pre">opaqueregistration</span></code> from <code class="docutils literal notranslate"><span class="pre">opaque</span></code> in order to use the core code.</p> 
     </div> 
     <div class="section" id="pgp-mail-processing"> 
      <h3><a class="toc-backref" href="#id25">PGP mail processing</a></h3> 
      <p>Roundup now uses the <code class="docutils literal notranslate"><span class="pre">gpg</span></code> module instead of <code class="docutils literal notranslate"><span class="pre">pyme</span></code> to process PGP mail. If you have PGP processing enabled, make sure the <code class="docutils literal notranslate"><span class="pre">gpg</span></code> module is installed.</p> 
     </div> 
     <div class="section" id="mysql-client-module"> 
      <h3><a class="toc-backref" href="#id26">MySQL client module</a></h3> 
      <p>Although the <code class="docutils literal notranslate"><span class="pre">MySQLdb</span></code> module from <a class="reference external" href="https://pypi.org/project/MySQL-python/">https://pypi.org/project/MySQL-python/</a> is still supported, it is recommended to switch to the updated module from <a class="reference external" href="https://pypi.org/project/mysqlclient/">https://pypi.org/project/mysqlclient/</a>.</p> 
     </div> 
     <div class="section" id="xmlrpc-access-role"> 
      <h3><a class="toc-backref" href="#id27">XMLRPC Access Role</a></h3> 
      <p>A new permission has been added to control access to the XMLRPC endpoint. If the user doesn’t have the new “Xmlrpc Access” permission, they will not be able to log in using the /xmlrpc end point. To add this new permission to the “User” role you should change your tracker’s schema.py and add:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="s1">'Xmlrpc Access'</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>This is usually included near where other permissions like “Web Access” or “Email Access” are assigned.</p> 
     </div> 
     <div class="section" id="new-values-for-db-tx-source"> 
      <h3><a class="toc-backref" href="#id28">New values for db.tx_Source</a></h3> 
      <p>The database attribute tx_Source reports “xmlrpc” and “rest” when the /xmlrpc and /rest web endpoints are used. Check all code (extensions, detectors, lib) in trackers looking for tx_Source. If you have code like:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">tx_Source</span> <span class="o">==</span> <span class="s2">"web"</span><span class="p">:</span>
</pre>
       </div> 
      </div> 
      <p>or:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">tx_Source</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'web'</span><span class="p">,</span> <span class="s1">'email-sig-openpgp'</span><span class="p">,</span> <span class="s1">'cli'</span> <span class="p">]:</span>
</pre>
       </div> 
      </div> 
      <p>you may need to change these to include matches to “rest” and “xmlrpc”. For example:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">tx_Source</span> <span class="ow">in</span> <span class="p">[</span> <span class="s2">"web"</span><span class="p">,</span> <span class="s2">"rest"</span><span class="p">,</span> <span class="s2">"xmlrpc"</span> <span class="p">]</span>
</pre>
       </div> 
      </div> 
      <p>or:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">tx_Source</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'web'</span><span class="p">,</span> <span class="s1">'rest'</span><span class="p">,</span> <span class="s1">'xmlrpc'</span><span class="p">,</span> <span class="s1">'email-sig-openpgp'</span><span class="p">,</span> <span class="s1">'cli'</span> <span class="p">]:</span>
</pre>
       </div> 
      </div> 
     </div> 
     <div class="section" id="csv-export-changes"> 
      <h3><a class="toc-backref" href="#id29">CSV export changes</a></h3> 
      <p>The original Roundup CSV export function for indexes reported id numbers for links. The wiki had a version that resolved the id’s to names, so it would report <code class="docutils literal notranslate"><span class="pre">open</span></code> rather than <code class="docutils literal notranslate"><span class="pre">2</span></code> or <code class="docutils literal notranslate"><span class="pre">user2;user3</span></code> rather than <code class="docutils literal notranslate"><span class="pre">[2,3]</span></code>.</p> 
      <p>Many people added the enhanced version to their extensions directory.</p> 
      <p>The enhanced version was made the default in roundup 2.0. If you want to use the old version (that returns id’s), you can replace references to <code class="docutils literal notranslate"><span class="pre">export_csv</span></code> with <code class="docutils literal notranslate"><span class="pre">export_csv_id</span></code> in templates.</p> 
      <p>Both core csv export functions have been changed to force quoting of all exported fields. To incorporate this change in any CSV export extension you may have added, change references in your code from:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">wfile</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>to:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">wfile</span><span class="p">,</span> <span class="n">quoting</span><span class="o">=</span><span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_NONNUMERIC</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>this forces all (non-numeric) fields to be quoted and empty quotes to be added for missing parameters.</p> 
      <p>This turns exported values that may look like formulas into strings so some versions of Excel won’t try to interpret them as a formula.</p> 
     </div> 
     <div class="section" id="update-userauditor-py-to-restrict-usernames"> 
      <h3><a class="toc-backref" href="#id30">Update userauditor.py to restrict usernames</a></h3> 
      <p>A username can be created with embedded commas and &lt; and &gt; characters. Even though the &lt; and &gt; are usually escaped when displayed, the embedded comma makes it difficult to edit lists of users as they are comma separated.</p> 
      <p>If you have not modified your tracker’s userauditor.py, you can just copy the userauditor.py from the classic template into your tracker’s detectors directory. Otherwise merge the changes from the template userauditor.py. <a class="reference external" href="https://issues.roundup-tracker.org/issue2550921">https://issues.roundup-tracker.org/issue2550921</a> may be helpful.</p> 
     </div> 
     <div class="section" id="consider-reindexing-if-you-use-european-languages"> 
      <h3><a class="toc-backref" href="#id31">Consider reindexing if you use European languages</a></h3> 
      <p>A couple of bugs dealing with incorrect indexing of European languages (Russian and German were reported) have been fixed. Note reindexing all your data may take a long time. See: <a class="reference external" href="https://issues.roundup-tracker.org/issue1195739">https://issues.roundup-tracker.org/issue1195739</a> and <a class="reference external" href="https://issues.roundup-tracker.org/issue1344046">https://issues.roundup-tracker.org/issue1344046</a> for a description of the problem. If you determine that this a problem for your tracker, you can use:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">roundup</span><span class="o">-</span><span class="n">admin</span> <span class="o">-</span><span class="n">i</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">tracker</span> <span class="n">reindex</span>
</pre>
       </div> 
      </div> 
      <p>to rewrite your full text indexes. The tracker used for reindex timing had 140MB of file/message data and 2500 issues with a slow 5400RPM SATA drive. Using native indexing with sqlite took about 45 minutes. Using whoosh took about 2 hours. Using xapian took about 6 hours. All examples were with Python 2. Anecdotal evidence shows Python 3 is faster, but YMMV.</p> 
     </div> 
     <div class="section" id="merge-improvements-in-statusauditor-py"> 
      <h3><a class="toc-backref" href="#id32">Merge improvements in statusauditor.py</a></h3> 
      <p>By default the detector statusauditor.py will change the status from “unread” to “chatting” when a second message is added to an issue. The distributed classic and jinja templates implement this feature in their copies of <code class="docutils literal notranslate"><span class="pre">detectors/statusauditor.py</span></code>.</p> 
      <p>This can be a problem. Consider a person sending email to create an issue. Then the person sends a followup message to add some additional information to the issue. The followup message will trigger the status change from “unread” to “chatting”. This is misleading since the person is “chatting” with themselves.</p> 
      <p>Statusauditor.py has been enhanced to prevent the status from changing to “chatting” until a second user (person) adds a message. If you want this functionality, you need to merge the distributed statusauditor.py with your tracker’s statusauditor.py. If you have not customized your tracker’s statusauditor.py, copy the one from the distibuted template. In addition to the python file, you also must copy/merge the distributed <code class="docutils literal notranslate"><span class="pre">detectors/config.ini</span></code> into your tracker’s detectors directory. Most people can copy <code class="docutils literal notranslate"><span class="pre">detectors/config.ini</span></code> from the distributed templates as they won’t have a <code class="docutils literal notranslate"><span class="pre">detectors/config.ini</span></code> file. (Note this is <code class="docutils literal notranslate"><span class="pre">detectors/config.ini</span></code> do not confuse it with the main <code class="docutils literal notranslate"><span class="pre">config.ini</span></code> file at the root of the tracker home.)</p> 
      <p>This enhancement is disabled by default. Enable it by changing the value in <code class="docutils literal notranslate"><span class="pre">detectors/config.ini</span></code> from:</p> 
      <blockquote> 
       <div>
        chatting_requires_two_users = False
       </div>
      </blockquote> 
      <p>to</p> 
      <blockquote> 
       <div>
        chatting_requires_two_users = True
       </div>
      </blockquote> 
      <p>(the values <code class="docutils literal notranslate"><span class="pre">no</span></code> and <code class="docutils literal notranslate"><span class="pre">yes</span></code> can also be used). Restart the tracker to enable the change.</p> 
      <p>If you don’t do this quite right you will see one of two error messages in the web interface when you try to update an issue with a message:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">Edit</span> <span class="n">Error</span><span class="p">:</span> <span class="n">Unsupported</span> <span class="n">configuration</span> <span class="n">option</span><span class="p">:</span> <span class="n">Option</span>
   <span class="n">STATUSAUDITOR_CHATTING_REQUIRES_TWO_USERS</span> <span class="ow">not</span> <span class="n">found</span> <span class="ow">in</span>
   <span class="n">detectors</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">ini</span><span class="o">.</span>
<span class="n">Contact</span> <span class="n">tracker</span> <span class="n">admin</span> <span class="n">to</span> <span class="n">fix</span><span class="o">.</span>
</pre>
       </div> 
      </div> 
      <p>This happens if detectors/config.ini is not found or is missing the <code class="docutils literal notranslate"><span class="pre">chatting_requires_two_users</span></code> option in the <code class="docutils literal notranslate"><span class="pre">statusauditor</span></code> section.</p> 
      <p>If you have an incorrect value (say you use <code class="docutils literal notranslate"><span class="pre">T</span></code> rather than <code class="docutils literal notranslate"><span class="pre">True</span></code>) you see a different error:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">Edit</span> <span class="n">Error</span><span class="p">:</span> <span class="n">Invalid</span> <span class="n">value</span> <span class="k">for</span>
  <span class="n">DETECTOR</span><span class="p">::</span><span class="n">STATUSAUDITOR_CHATTING_REQUIRES_TWO_USERS</span><span class="p">:</span> <span class="s1">'T'</span>
<span class="n">Allowed</span> <span class="n">values</span><span class="p">:</span> <span class="n">yes</span><span class="p">,</span> <span class="n">no</span>
</pre>
       </div> 
      </div> 
      <p>to fix this set the value to <code class="docutils literal notranslate"><span class="pre">yes</span></code> (True) or <code class="docutils literal notranslate"><span class="pre">no</span></code> (False).</p> 
     </div> 
     <div class="section" id="responsive-template-changes"> 
      <h3><a class="toc-backref" href="#id33">Responsive template changes</a></h3> 
      <p>There have been some changes to the responsive template. You can diff/merge these changes into your responsive template based tracker.</p> 
     </div> 
     <div class="section" id="jinja-template-changes"> 
      <h3><a class="toc-backref" href="#id34">Jinja template changes</a></h3> 
      <p>Auto escaping has been enabled in the jinja template engine, this means it is no longer necessary to manually escape dynamic strings with “|e”, but strings that should not be escaped need to be marked with “|safe” (e.g. “{{ context.history()|u|safe }}”). Also, the i18n extension has been enabled and the template has been updated to use the extension for translatable text instead of explicit “i18n.gettext” calls:</p> 
      <blockquote> 
       <div>
        {% trans %}List of issues{% endtrans %}
       </div>
      </blockquote> 
      <p>instead of:</p> 
      <blockquote> 
       <div>
        {{ i18n.gettext(‘List of issues’)|u }}
       </div>
      </blockquote> 
      <p>The jinja template has been upgraded to use bootstrap 4.1.3 (from 2.2.2). You can diff/merge changes into your jinja template based tracker.</p> 
      <p>Also search _generic.index.html, navigation.html and file.index.html in the html directory of your tracker. Look for:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"@action"</span>
</pre>
       </div> 
      </div> 
      <p>where the value is a jinja expression that calls i18n.gettext. Set the value to the argument of the gettext call. E.G. replace:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"@action"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"{{ i18n.gettext('editCSV')|u }}"</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
      <p>with:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"@action"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"editCSV"</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
      <p>The action keywords should not be translated.</p> 
     </div> 
    </div> 
    <div class="section" id="migrating-from-1-5-1-to-1-6-0"> <span id="index-4"></span>
     <h2><a class="toc-backref" href="#id35">Migrating from 1.5.1 to 1.6.0</a></h2> 
     <div class="section" id="update-tracker-config-file"> 
      <h3><a class="toc-backref" href="#id36">Update tracker config file</a></h3> 
      <p>After installing the new version of roundup, you should update the <code class="docutils literal notranslate"><span class="pre">config.ini</span></code> file for your tracker. To do this:</p> 
      <blockquote> 
       <div>
        <ol class="arabic"> 
         <li><p class="first">backup your existing <code class="docutils literal notranslate"><span class="pre">config.ini</span></code> file</p> </li> 
         <li><p class="first">using the newly installed code, run:</p> 
          <div class="highlight-default notranslate">
           <div class="highlight">
            <pre><span></span><span class="n">roundup</span><span class="o">-</span><span class="n">admin</span> <span class="o">-</span><span class="n">i</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">tracker</span> <span class="n">updateconfig</span> <span class="n">config</span><span class="o">.</span><span class="n">ini</span><span class="o">.</span><span class="n">new</span>
</pre>
           </div> 
          </div> <p>to create the file config.ini.new. Replace <code class="docutils literal notranslate"><span class="pre">/path/to/tracker</span></code> with the path to your tracker.</p> </li> 
         <li><p class="first">replace your tracker’s config.ini with config.ini.new</p> </li> 
        </ol> 
       </div>
      </blockquote> 
      <p>Using updateconfig keeps all the settings from your tracker’s config.ini file and adds settings for all the new options.</p> 
      <p>If you have added comments to your original config.ini file, merge the added comments into the config.ini.new file. Then replace your tracker’s config.ini with config.ini.new.</p> 
      <p>Read the new config.ini and configure it to enable new features. Details on using these features can be found in this section.</p> 
     </div> 
     <div class="section" id="make-sure-that-user-can-view-labelprop-on-classes-required"> 
      <h3><a class="toc-backref" href="#id37">Make sure that user can view labelprop on classes (REQUIRED)</a></h3> 
      <p>If you have View permissions that use <code class="docutils literal notranslate"><span class="pre">`properties=...`</span></code>, make sure that the labelprop for the class is listed in the properties list.</p> 
      <p>The first one of these that exists must must be in the list:</p> 
      <blockquote> 
       <div>
        <ol class="arabic simple"> 
         <li>the property set by a call to setlabelprop for the class</li> 
         <li>the key of the class (as set by setkey())</li> 
         <li>the “name” property (if it exists)</li> 
         <li>the “title” property (if it exists)</li> 
        </ol> 
       </div>
      </blockquote> 
      <p>if none of those apply, you must allow</p> 
      <blockquote> 
       <div>
        <ul class="simple"> 
         <li>the “id” property</li> 
        </ul> 
       </div>
      </blockquote> 
      <p>E.G. If your class does a setlabelprop(“foo”) you must include “foo” in the properties list even if the class has name or title properties.</p> 
      <p>See: <a class="reference external" href="https://www.roundup-tracker.org/docs/customizing.html#setlabelprop-property">https://www.roundup-tracker.org/docs/customizing.html#setlabelprop-property</a> for further details on the labelprop.</p> 
      <p>If you don’t do this, you will find that multilinks (and possibly links) may not be displayed properly. E.G. templates that iterate over a mutlilink field (with tal:repeat for example) may not show any content.</p> 
      <p>See: <a class="reference external" href="https://sourceforge.net/p/roundup/mailman/message/35763294/">https://sourceforge.net/p/roundup/mailman/message/35763294/</a> for the initial discussion of the issue.</p> 
     </div> 
     <div class="section" id="cross-site-request-forgery-detection-added"> 
      <h3><a class="toc-backref" href="#id38">Cross Site Request Forgery Detection Added</a></h3> 
      <p>Roundup 1.6. supports a number of defenses against CSRF.</p> 
      <p>Http header verification against the tracker’s <code class="docutils literal notranslate"><span class="pre">web</span></code> setting in the <code class="docutils literal notranslate"><span class="pre">[tracker]</span></code> section of config.ini for the following headers:</p> 
      <blockquote> 
       <div>
        <ol class="arabic simple"> 
         <li>Analyze the <code class="docutils literal notranslate"><span class="pre">Referer</span></code> HTTP header to make sure it includes the web setting.</li> 
         <li>Analyze the <code class="docutils literal notranslate"><span class="pre">Origin</span></code> HTTP header to make sure the schema://host matches the web setting.</li> 
         <li>Analyze the <code class="docutils literal notranslate"><span class="pre">X-Forwarded-Host</span></code> header set by a proxy running in front of roundup to make sure it agrees with the host part of the web setting.</li> 
         <li>Analyze the <code class="docutils literal notranslate"><span class="pre">Host</span></code> header to make sure it agrees with the host part of the web setting. This is not done if <code class="docutils literal notranslate"><span class="pre">X-Forwarded-Host</span></code> is set.</li> 
        </ol> 
       </div>
      </blockquote> 
      <p>By default roundup 1.6 does not require any specific header to be present. However at least one of the headers above <em>must</em> pass validation checks (usually <code class="docutils literal notranslate"><span class="pre">Host</span></code> or <code class="docutils literal notranslate"><span class="pre">Referer</span></code>) or the submission is rejected with an error. If any header fails validation, the submission is rejected. (Note the user’s form keeps all the data they entered if it was rejected.)</p> 
      <p>Also the admin can include unique csrf tokens for all forms submitted using the POST method. (Delete and put methods are also included, but not currently used by roundup.) The csrf token (nonce) is tied to the user’s session. When the user submits the form and nonce, the nonce is checked to make sure it was issued to the user and the same session. If this is not true the post is rejected and the user is notified.</p> 
      <p>The standard context/submit templating item creates CSRF tokens by default. If you have forms using the POST method that are not using the standard submit routine, you should add the following field to all forms:</p> 
      <blockquote> 
       <div>
        <dl class="docutils"> 
         <dt>
          &lt;input name=”@csrf” type=”hidden”
         </dt> 
         <dd>
          tal:attributes=”value python:utils.anti_csrf_nonce()”&gt;
         </dd> 
        </dl> 
       </div>
      </blockquote> 
      <p>A unique random token is generated by every call to utils.anti_csrf_nonce() and is put in a database to be retreived if the token is used. Token lifetimes are 2 weeks by default but can be configured in config.ini. Roundup will automatically prune old tokens. Calling anti_csrf_nonce with an integer lifetime, for example:</p> 
      <blockquote> 
       <div>
        <dl class="docutils"> 
         <dt>
          &lt;input name=”@csrf” type=”hidden”
         </dt> 
         <dd>
          tal:attributes=”value python:utils.anti_csrf_nonce(lifetime=10)”&gt;
         </dd> 
        </dl> 
       </div>
      </blockquote> 
      <p>sets the lifetime of that nonce to 10 minutes.</p> 
      <p>If you want to change the default settings, you have to update the web section in your tracker’s config.ini file. Follow the section above to generate an updated config.ini file. Then look for settings that start with csrf. The updated config.ini file includes detailed descriptions of the settings.</p> 
      <p>In general one of four values can be set for these settings. The default is <code class="docutils literal notranslate"><span class="pre">yes</span></code>, which validates the header or nonce and blocks access if the validation fails. If the field/header is missing it allows access. Setting these fields to <code class="docutils literal notranslate"><span class="pre">required</span></code> blocks access if the header/nonce is missing.</p> 
      <p>It is recommended that you change your templates so every form that is not submitted via GET has an @csrf field. Then change the csrf_enforce_token setting to ‘required’.</p> 
      <div class="section" id="errors-and-troubleshooting-csrf-in-url"> 
       <h4><a class="toc-backref" href="#id39">Errors and Troubleshooting - @csrf in url</a></h4> 
       <p>If you see the @csrf nonce in the URL, you have added the value to a form that uses the GET method. You should remove the @csrf token from these forms as it is not needed.</p> 
      </div> 
      <div class="section" id="errors-and-troubleshooting-attributeerror-list-object-no-attribute-value"> 
       <h4><a class="toc-backref" href="#id40">Errors and Troubleshooting - AttributeError list object no attribute value</a></h4> 
       <p>If you get an error:</p> 
       <blockquote> 
        <div>
         AttributeError: ‘list’ object has no attribute ‘value’
        </div>
       </blockquote> 
       <p>in handle_csrf, you have more than one @csrf token for the form. This usually occurs because the form uses the standard context/submit element but you also added an explicit @csrf statement. Simply remove the @csrf element for that form.</p> 
      </div> 
      <div class="section" id="errors-and-troubleshooting-xmlrpc-required-header-missing"> 
       <h4><a class="toc-backref" href="#id41">Errors and Troubleshooting - xmlrpc Required Header Missing</a></h4> 
       <p>When performing and xmlrpc call, if you see something like:</p> 
       <blockquote> 
        <div>
         <dl class="docutils"> 
          <dt>
           xmlrpclib.Fault: &lt;Fault 1: “&lt;class
          </dt> 
          <dd>
           ‘roundup.exceptions.UsageError’&gt;:Required Header Missing”&gt;
          </dd> 
         </dl> 
        </div>
       </blockquote> 
       <p>change the setting of csrf_enforce_header_x-requested-with in config.ini to no. So it looks like:</p> 
       <blockquote> 
        <div>
         csrf_enforce_header_x-requested-with = no
        </div>
       </blockquote> 
       <p>Alternatively change your xmlrpc client to add appropriate headers to the request including the:</p> 
       <blockquote> 
        <div>
         X-Requested-With:
        </div>
       </blockquote> 
       <p>header as well as any other required csrf headers (e.g. referer, origin) configured in config.ini. See the advanced python client at the end of the <a class="reference external" href="xmlrpc.html">xmlrpc guide</a>.</p> 
      </div> 
     </div> 
     <div class="section" id="support-for-samesite-cookie-option-for-session-cookie"> 
      <h3><a class="toc-backref" href="#id42">Support for SameSite cookie option for session cookie</a></h3> 
      <p>Support for serving the session cookie using the SameSite cookie option has been added. By default it is set to lax to provide a better user experience. But this can be changes to strict or the option can be removed entirely.</p> 
      <p>Using the process for merging config.ini changes described in <a class="reference internal" href="#cross-site-request-forgery-detection-added">Cross Site Request Forgery Detection Added</a> you can add the <code class="docutils literal notranslate"><span class="pre">samesite_cookie_setting</span></code> to the <code class="docutils literal notranslate"><span class="pre">[web]</span></code> section of the config file.</p> 
     </div> 
     <div class="section" id="fix-for-path-traversal-changes-template-resolution"> 
      <h3><a class="toc-backref" href="#id43">Fix for path traversal changes template resolution</a></h3> 
      <p>The templates in the tracker’s html subdirectory must not be symbolic links that lead outside of the html directory.</p> 
      <p>If you don’t use symbolic links for templates in your html subdirectory you don’t have to make any changes. Otherwise you need to replace the symbolic links with hard links to the files or replace the symbolic links with the files.</p> 
      <p>This is a side effect of fixing a path traversal security issue. The security issue required a directory with a specific unusual name. This made it difficult to exploit. However allowing the use of subdirectories to organize the templates required that it be fixed.</p> 
     </div> 
     <div class="section" id="database-back-end-specified-in-config-ini-required"> 
      <h3><a class="toc-backref" href="#id44">Database back end specified in config.ini (REQUIRED)</a></h3> 
      <p>The <code class="docutils literal notranslate"><span class="pre">db/backend_name</span></code> file is no longer used to configure the database backend being used for a tracker. The backend is now configured in the <code class="docutils literal notranslate"><span class="pre">config.ini</span></code> file using the <code class="docutils literal notranslate"><span class="pre">backend</span></code> option located in the <code class="docutils literal notranslate"><span class="pre">[rdbms]</span></code> section. For example if <code class="docutils literal notranslate"><span class="pre">db/backend_name</span></code> file contains <code class="docutils literal notranslate"><span class="pre">sqlite</span></code>, a new entry in the tracker’s <code class="docutils literal notranslate"><span class="pre">config.ini</span></code> will need to be created:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="p">[</span><span class="n">rdbms</span><span class="p">]</span>

<span class="o">...</span>

<span class="c1"># Database backend.</span>
<span class="c1"># Default:</span>
<span class="n">backend</span> <span class="o">=</span> <span class="n">sqlite</span>
</pre>
       </div> 
      </div> 
      <p>Once the <code class="docutils literal notranslate"><span class="pre">config.ini</span></code> file has been updated with the new <code class="docutils literal notranslate"><span class="pre">backend</span></code> option, you can safely delete the <code class="docutils literal notranslate"><span class="pre">db/backend_name</span></code> file.</p> 
      <p>Note: the <code class="docutils literal notranslate"><span class="pre">backend_name</span></code> file may be located in a directory other than <code class="docutils literal notranslate"><span class="pre">db/</span></code> if you have configured the <code class="docutils literal notranslate"><span class="pre">database</span></code> option in the <code class="docutils literal notranslate"><span class="pre">[main]</span></code> section of the <code class="docutils literal notranslate"><span class="pre">config.ini</span></code> file to be something other than <code class="docutils literal notranslate"><span class="pre">db</span></code>.</p> 
      <p>Note 2: if you are using the anydbm back end, you still set it using the backend option in the rdbms section of the config.ini file.</p> 
     </div> 
     <div class="section" id="new-config-file-option-indexer-added"> 
      <h3><a class="toc-backref" href="#id45">New config file option ‘indexer’ added</a></h3> 
      <p>This release added support for the Whoosh indexer, so a new config file option has been added. You can force Roundup to use a particular text indexer by setting this value in the [main] section of the tracker’s <code class="docutils literal notranslate"><span class="pre">config.ini</span></code> file (usually placed right before indexer_stopwords):</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="p">[</span><span class="n">main</span><span class="p">]</span>

<span class="o">...</span>

<span class="c1"># Force Roundup to use a particular text indexer.</span>
<span class="c1"># If no indexer is supplied, the first available indexer</span>
<span class="c1"># will be used in the following order:</span>
<span class="c1"># Possible values: xapian, whoosh, native (internal).</span>
<span class="n">indexer</span> <span class="o">=</span>
</pre>
       </div> 
      </div> 
      <div class="section" id="errors-and-troubleshooting-full-text-searching-not-working"> 
       <h4><a class="toc-backref" href="#id46">Errors and Troubleshooting - Full text searching not working</a></h4> 
       <p>If after the upgrade full text searching is not working try changing the indexer value. If this is failing most likely you need to set ‘’‘indexer = native’‘’ to use the rdbms or db text indexing systems.</p> 
       <p>Alternatively you can do a ‘’‘roundup-admin -i /path/to/tracker reindex’‘’ to generate a new index using roundup’s preferred indexer from the list above.</p> 
       <div class="section" id="xapian-error-with-flint-when-reindexing"> 
        <h5><a class="toc-backref" href="#id47">Xapian error with flint when reindexing</a></h5> 
        <p>If you reindex and are using xapian, you may get the error that “flint” is not supported (looks like flint was removed after xapian 1.2.x). To fix this, you can delete the full text search database located in the tracker home directory in the file ‘’‘db/text-index’‘’ and then perform a reindex.</p> 
       </div> 
      </div> 
     </div> 
     <div class="section" id="stemming-improved-in-xapian-indexer"> 
      <h3><a class="toc-backref" href="#id48">Stemming improved in Xapian Indexer</a></h3> 
      <p>Stemming allows a search for “silent” also match silently. The Porter stemmer in Xapian works with lowercase English text. In this release we lowercase the documents as they are put into the indexer.</p> 
      <p>This means capitalization is not preserved, but produces more hits by using the stemmer.</p> 
      <p>You will need to do a roundup-admin reindex if you are using the Xapian full text indexer on your tracker.</p> 
     </div> 
     <div class="section" id="new-config-file-option-replyto-address-added"> 
      <h3><a class="toc-backref" href="#id49">New config file option ‘replyto_address’ added</a></h3> 
      <p>A new config file option has been added to let you control the Reply-To header on nosy messages.</p> 
      <p>Edit your tracker’s <code class="docutils literal notranslate"><span class="pre">config.ini</span></code> and place the following after the email entry in the tracker section:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="p">[</span><span class="n">tracker</span><span class="p">]</span>
<span class="o">...</span>

<span class="c1"># Controls the reply-to header address used when sending</span>
<span class="c1"># nosy messages.</span>
<span class="c1"># If the value is unset (default) the roundup tracker's</span>
<span class="c1"># email address (above) is used.</span>
<span class="c1"># If set to "AUTHOR" then the primary email address of the</span>
<span class="c1"># author of the change will be used as the reply-to</span>
<span class="c1"># address. This allows email exchanges to occur outside of</span>
<span class="c1"># the view of roundup and exposes the address of the person</span>
<span class="c1"># who updated the issue, but it could be useful in some</span>
<span class="c1"># unusual circumstances.</span>
<span class="c1"># If set to some other value, the value is used as the reply-to</span>
<span class="c1"># address. It must be a valid RFC2822 address or people will not be</span>
<span class="c1"># able to reply.</span>
<span class="c1"># Default:</span>
<span class="n">replyto_address</span> <span class="o">=</span>
</pre>
       </div> 
      </div> 
     </div> 
     <div class="section" id="login-from-a-search-or-after-logout-works-better-required"> 
      <h3><a class="toc-backref" href="#id50">Login from a search or after logout works better (REQUIRED)</a></h3> 
      <p>The login form has been improved to work with some back end code changes. Now when a user logs in they stay on the same page where they started the login. To make this work, you must change the tal that is used to set the <code class="docutils literal notranslate"><span class="pre">__came_from</span></code> form variable. Note that the url assigned to __came_from must be url encoded/quoted and be under the tracker’s base url. If the base_url uses http, you can set the url to https.</p> 
      <p>Replace the existing code in the tracker’s html/page.html page that looks similar to (look for name=”__came_from”):</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"__came_from"</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"value string:${request/base}${request/env/PATH_INFO}"</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
      <p>with the following:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"__came_from"</span>
  <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"exists:request/env/QUERY_STRING"</span>
  <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"value string:${request/base}${request/env/PATH_INFO}?${request/env/QUERY_STRING}"</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"__came_from"</span>
  <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"not:exists:request/env/QUERY_STRING"</span>
  <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"value string:${request/base}${request/env/PATH_INFO}"</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
      <p>Now search backwards for the nearest form statement before the code that sets __came_from. If it looks like:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">"post"</span> <span class="n">action</span><span class="o">=</span><span class="s2">"#"</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
      <p>replace it with:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">"post"</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"action request/base"</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
      <p>or with:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">"post"</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"action string:${request/env/PATH_INFO}"</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
      <p>the important part is that the action field <strong>must not</strong> include any query parameters (‘#’ includes query params).</p> 
      <div class="section" id="errors-and-troubleshooting-unrecognized-scheme-in"> 
       <h4><a class="toc-backref" href="#id51">Errors and Troubleshooting - Unrecognized scheme in …</a></h4> 
       <p>One symptom of failing to do this is getting an error:</p> 
       <blockquote> 
        <div>
         Unrecognized scheme in ….
        </div>
       </blockquote> 
       <p>where the …. changes depending on the url path. You can see this when logging in from any screen other than the main index.</p> 
      </div> 
     </div> 
     <div class="section" id="option-to-make-adding-multiple-keywords-more-convenient"> 
      <h3><a class="toc-backref" href="#id52">Option to make adding multiple keywords more convenient</a></h3> 
      <p>In the classic tracker, after adding a new keyword you are redirected to the page for the new keyword so you can change the keyword’s name. This is usually not desirable as you usually correctly set the keyword’s name when creating the keyword. The new classic tracker has a new checkbox (checked by default) that keeps you on the same page so you can add a new keywords one after the other.</p> 
      <p>To add this to your own tracker, add the following code (prefixed with a +) after the entry box for the new keyword in html/keyword.item.html:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span>   &lt;tr&gt;
    &lt;th i18n:translate=""&gt;Keyword&lt;/th&gt;
    &lt;td tal:content="structure context/name/field"&gt;name&lt;/td&gt;
+   &lt;td tal:condition="not:context/id"&gt;
+     &lt;tal:comment tal:replace="nothing"&gt;
+       If we get here and do not have an id, we are creating a new
+       keyword. It would be nice to provide some mechanism to
+       determine the preferred state of the "Continue adding keywords"
+       checkbox. By default it is enabled.
+     &lt;/tal:comment&gt;
+     &lt;input type="checkbox" id="continue_new_keyword"
+           name="__redirect_to"
+           tal:attributes="value
+                           string:${request/base}${request/env/PATH_INFO}?@template=item;
+                           checked python:True" /&gt;
+     &lt;label for="continue_new_keyword" i18n:translate=""&gt;Continue adding keywords.&lt;/label&gt;
+   &lt;/td&gt;
   &lt;/tr&gt;
</pre>
       </div> 
      </div> 
      <p>Note remove the leading ‘+’ when adding this to the templates.</p> 
      <p>The key component here is support for the ‘__redirect_to’ query property. It is a url which can be used when creating any new item (issue, user, keyword ….). It controls the next page displayed after creating the item. If ‘__redirect_to’ is not set, then you end up on the page for the newly created item. The url value assigned to __redirect_to must start with the tracker’s base url and must be properly url encoded.</p> 
     </div> 
     <div class="section" id="helper-popups-trigger-change-events-on-the-original-page"> 
      <h3><a class="toc-backref" href="#id53">Helper popups trigger change events on the original page</a></h3> 
      <p>The helper popups used to set dates (from a calendar), change lists of users or lists of issues did not notify the browser that the fields had been changed. This release adds code to trigger the change event.</p> 
      <p>To add the change event to the calendar popup, you don’t need to do any changes to the tracker. It is all done in the roundup python code in templating.py.</p> 
      <p>To add the change event when updating users using the help-submit template, copy share/roundup/templates/devel/html/_generic.help-submit.html and replace your tracker’s html/_generic.help-submit.html. If you have done local changes to this file, change your file to include the code that defines the onclick event for the input field with id=”btn_apply”.</p> 
      <p>To add the change event when updating lists of issues copy share/roundup/templates/devel/html/help_controls.js to your tracer’s html directory. If you have made local changes to the javascript file, merge the two if/else blocks labeled:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">/*</span> <span class="n">trigger</span> <span class="n">change</span> <span class="n">event</span> <span class="n">on</span> <span class="n">the</span> <span class="n">field</span> <span class="n">we</span> <span class="n">changed</span> <span class="o">*/</span>
</pre>
       </div> 
      </div> 
      <p>into your help_controls.js</p> 
     </div> 
     <div class="section" id="html-generic-404-html-in-trackers-use-page-template"> 
      <h3><a class="toc-backref" href="#id54">html/_generic.404.html in trackers use page template</a></h3> 
      <p>The original generic 404 error pages for many trackers did not use the standard page layout. This change replaces the html/_generic.404.html page with one that uses the page template.</p> 
      <p>If your deployed tracker is based on: classic, minimal, responsive or devel templates and has not changed the html/_generic.404.html file, you can copy in the new file to get this additional functionality.</p> 
     </div> 
     <div class="section" id="organize-templates-into-subdirectories"> 
      <h3><a class="toc-backref" href="#id55">Organize templates into subdirectories</a></h3> 
      <p>The @template parameter to the web interface allows the use of subdirectories. So a setting of @template=view/view for an issue would use the template in the tracker’s html/view/issue.view.html. Similarly for a caller class, you could put all the templates under the html/caller directory with names like: html/caller/caller.item.html, html/caller/caller.index.html etc. You may want to symbolically link the html/_generic* templates into your subdirectory so that missing templates (e.g. a missing caller.edit.html template) can be satisfied by the _generic.edit.html template.</p> 
     </div> 
     <div class="section" id="properly-quote-query-dispname-displayed-name-in-page-html"> 
      <h3><a class="toc-backref" href="#id56">Properly quote query dispname (displayed name) in page.html</a></h3> 
      <p>A new method has been added to HTMLStringProperty called url_quote. The default templates have been updated to use this in the “Your Query” section of the trackers html/page.html file. You will want to change your template. Lines starting with - are the original line and you want to change it to match the line starting with the + (remove the + from the line):</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span>    <span class="o">&lt;</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span> <span class="n">tal</span><span class="p">:</span><span class="n">repeat</span><span class="o">=</span><span class="s2">"qs request/user/queries"</span><span class="o">&gt;</span>
<span class="o">-</span>    <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">"#"</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"href string:${qs/klass}?${qs/url}&amp;@dispname=${qs/name}"</span>
<span class="o">+</span>    <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">"#"</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"href string:${qs/klass}?${qs/url}&amp;@dispname=${qs/name/url_quote}"</span>
        <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"qs/name"</span><span class="o">&gt;</span><span class="n">link</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;</span><span class="n">br</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
      <p>Find the tal:repeat line that loops over all queries. Then change the value assigned to @dispname in the href attribute from ${qs/name} to ${qs/name/url_quote}. Note that you should <em>not</em> change the value for tal:content.</p> 
     </div> 
     <div class="section" id="allow-show-unassigned-issues-link-to-work-for-anonymous-user"> 
      <h3><a class="toc-backref" href="#id57">Allow “Show Unassigned” issues link to work for Anonymous user</a></h3> 
      <p>In this release the anonymous user is allowed to search the user class. The following was added to the schema for all templates that provide the search option:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Search'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'user'</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span> <span class="p">(</span><span class="s1">'Anonymous'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>If you are running a tracker that <strong>does not</strong> allow read access for anonymous, you should remove this entry as it can be used to perform a username guessing attack against a roundup install.</p> 
      <div class="section" id="errors-and-troubleshooting-unassigned-issues-for-anonymous"> 
       <h4><a class="toc-backref" href="#id58">Errors and Troubleshooting - Unassigned issues for anonymous</a></h4> 
       <p>If you notice that the “Unassigned Issues” search on page.html is displaying assigned issues for users with the Anonymous role, you need to allow search permissions for the user class.</p> 
      </div> 
     </div> 
     <div class="section" id="improvements-in-classic-tracker-query-edit-html-template"> 
      <h3><a class="toc-backref" href="#id59">Improvements in Classic Tracker query.edit.html template</a></h3> 
      <p>There is a new query editing template included in the distribution at:</p> 
      <blockquote> 
       <div>
        <code class="docutils literal notranslate"><span class="pre">share/roundup/templates/classic/html/query.edit.html</span></code>
       </div>
      </blockquote> 
      <p>This template fixes:</p> 
      <blockquote> 
       <div>
        <ul class="simple"> 
         <li>public query could not be removed from “Your Queries” once it was added. Trying to do so would cause a permissions error.</li> 
         <li>private yes/no dropdown always showed “yes” regardless of underlying state</li> 
         <li>query Delete button did not work.</li> 
         <li>same query being displayed multiple times</li> 
        </ul> 
       </div>
      </blockquote> 
      <dl class="docutils"> 
       <dt>
        It also adds:
       </dt> 
       <dd>
        <ul class="first last simple"> 
         <li>the table layout displays queries created by the user first, then available public queries.</li> 
         <li>public query owners are shown</li> 
         <li>better support for deleted queries. When a query is deleted, it is still available for those who added it to their query list. If you are the query owner, you can restore (undelete) the query. If you are not the owner you can remove it from your query list. (If a query is deleted and nobody had it in their query list, it will not show up in the “Active retired queries” section. You will have to use the class editor or roundup_admin command line to restore it.)</li> 
         <li>notifies the user that delete/restore requires javascript. It always did, but that requirement wasn’t displayed.</li> 
        </ul> 
       </dd> 
      </dl> 
      <p>To use the new template, you must add Restore permission on queries to allow the user to restore queries (see below).</p> 
      <p>If you have not modified the query.edit.html template in your tracker, you should be able to copy the new version from the location above. Otherwise you will have to merge the changes into your modified template.</p> 
      <p>Add the query Restore permission for the User role to your tracker’s schema.py file. Place it right after the query retire permission for the user role. After the change it should look like:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Retire'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'query'</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="n">edit_query</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"User is allowed to retire their queries"</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Restore'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'query'</span><span class="p">,</span>
    <span class="n">check</span><span class="o">=</span><span class="n">edit_query</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"User is allowed to restore their queries"</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>where the last four lines are the ones you need to add.</p> 
      <p>Usually you can add this to your User role. If all users have the User role in common then all logged in users should be ok. If you have users who do not include the User role (e.g. they may only have a Provisional role), you should add the search permission to that role (e.g. Provisional) as well if you allow them to edit their list of queries.</p> 
      <p>Also see the <a class="reference internal" href="#new-search-permissions-for-query-in-1-4-17">new search permissions for query in 1.4.17</a> section discussing search permission requirements for editing queries. The fixes in this release require the ability to search the creator of all queries to work correctly.</p> 
      <p>If the test script for the <a class="reference internal" href="#new-search-permissions-for-query-in-1-4-17">new search permissions for query in 1.4.17</a> doesn’t report that a role has the ability to search queries or at least search the creator property for queries, add the following permissions to your schema.py:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Search'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'query'</span><span class="p">,</span>
  <span class="n">properties</span><span class="o">=</span><span class="p">[</span><span class="s1">'creator'</span><span class="p">],</span>
  <span class="n">description</span><span class="o">=</span><span class="s2">"User is allowed to Search queries for creator"</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <div class="section" id="errors-and-troubleshooting-public-queries-listed-twice-when-editing"> 
       <h4><a class="toc-backref" href="#id60">Errors and Troubleshooting - Public queries listed twice when editing</a></h4> 
       <p>If you do not do this, public queries will be listed twice in the edit interface. Once in the “Queries I created” section and again in the “Queries others created” section of the query edit page (<code class="docutils literal notranslate"><span class="pre">http..../query?@template=edit</span></code>).</p> 
      </div> 
     </div> 
     <div class="section" id="fix-security-issues-in-query-item-html-template"> 
      <h3><a class="toc-backref" href="#id61">Fix security issues in query.item.html template</a></h3> 
      <p>The default query.item.html template allows anybody to view all queries.</p> 
      <p>This has been updated in the classic, devel and responsive templates to only allow people to view queries they creates or queries that are publicly viewable.</p> 
      <p>If you haven’t modified you query.item.html template, simply copy the query.item.html template from one of the above default templates to your tracker’s html directory.</p> 
     </div> 
     <div class="section" id="enhancement-to-check-command-for-permissions"> 
      <h3><a class="toc-backref" href="#id62">Enhancement to check command for Permissions</a></h3> 
      <p>A new form of check function is permitted in permission definitions. The three argument form is still supported and will work the same as it always has (although it may be depricated in the future).</p> 
      <p>If the check function is defined as:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">check</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">userid</span><span class="p">,</span> <span class="n">itemid</span><span class="p">,</span> <span class="o">**</span><span class="n">ctx</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>the ctx variable will have the context to use when determining access rights:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">ctx</span><span class="p">[</span><span class="s1">'property'</span><span class="p">]</span> <span class="n">the</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="nb">property</span> <span class="n">being</span> <span class="n">checked</span> <span class="ow">or</span> <span class="kc">None</span> <span class="k">if</span>
       <span class="n">it</span><span class="s1">'s a class check.</span>

<span class="n">ctx</span><span class="p">[</span><span class="s1">'classname'</span><span class="p">]</span> <span class="n">the</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="k">class</span> <span class="nc">that</span> <span class="ow">is</span> <span class="n">being</span> <span class="n">checked</span>
       <span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="n">query</span> <span class="o">....</span><span class="p">)</span><span class="o">.</span>

<span class="n">ctx</span><span class="p">[</span><span class="s1">'permission'</span><span class="p">]</span> <span class="n">the</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">permission</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">View</span><span class="p">,</span> <span class="n">Edit</span><span class="o">...</span><span class="p">)</span><span class="o">.</span>
</pre>
       </div> 
      </div> 
      <p>This should make defining complex permissions much easier. Consider:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="k">def</span> <span class="nf">issue_private_access</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">userid</span><span class="p">,</span> <span class="n">itemid</span><span class="p">,</span> <span class="o">**</span><span class="n">ctx</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">itemid</span><span class="p">,</span> <span class="s1">'private'</span><span class="p">):</span>
       <span class="c1"># allow access to everything if not private</span>
       <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># It is a private issue hide nosy list</span>
    <span class="c1"># Note that the nosy property *must* be listed</span>
    <span class="c1"># in permissions argument to the addPermission</span>
    <span class="c1"># definition otherwise this check command</span>
    <span class="c1"># is not run.</span>
    <span class="k">if</span> <span class="n">ctx</span><span class="p">[</span><span class="s1">'property'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'nosy'</span><span class="p">:</span>
       <span class="k">return</span> <span class="kc">False</span> <span class="c1"># deny access to this property</span>

    <span class="c1"># allow access for editing, viewing etc. of the class</span>
    <span class="k">return</span> <span class="kc">True</span>


<span class="n">e</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Edit'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'issue'</span><span class="p">,</span>
                              <span class="n">check</span><span class="o">=</span><span class="n">issue_private_access</span><span class="p">,</span>
                              <span class="n">properties</span><span class="o">=</span><span class="p">[</span><span class="s1">'nosy'</span><span class="p">],</span>
                              <span class="n">description</span><span class="o">=</span><span class="s2">"Edit issue checks"</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>It is suggested that you change your checks to use the <code class="docutils literal notranslate"><span class="pre">**ctx</span></code> parameter. This is expected to be the preferred form in the future. You do not need to use the <code class="docutils literal notranslate"><span class="pre">ctx</span></code> parameter in the function if you do not need it.</p> 
     </div> 
     <div class="section" id="changes-to-property-permissions"> 
      <h3><a class="toc-backref" href="#id63">Changes to property permissions</a></h3> 
      <p>If you create a permission:</p> 
      <blockquote> 
       <div>
        <dl class="docutils"> 
         <dt>
          db.security.addPermission(name=’View’, klass=’user’,
         </dt> 
         <dd>
          properties=[‘theme’], check=own_record, description=”User is allowed to view their own theme”)
         </dd> 
        </dl> 
       </div>
      </blockquote> 
      <p>that combines checks and properties, the permission also matches a permission check for the View permission on the user class. So this also allows the user to see their user record. It is unexpected that checking for access without a property would match this permission.</p> 
      <p>This release adds support for making a permission like above only be used during property permission tests. See <code class="docutils literal notranslate"><span class="pre">customizing.txt</span></code> and search for props_only and set_props_only_default in the section ‘Adding a new Permission’</p> 
     </div> 
     <div class="section" id="improve-query-editing"> 
      <h3><a class="toc-backref" href="#id64">Improve query editing</a></h3> 
      <p>If a user creates a query with the same name as one of their existing queries, the query editing interface will now report an error. By default the query editing page (issue.search.html) displays the index page when the search is triggered. This is usually correct since the user expects to see the results of the query. But now that the code properly checks for duplicate search names, the user should stay on the search page if there is an error. To add this to your existing issue.search.html page, add the following line after the hidden field @old-queryname:</p> 
      <blockquote> 
       <div>
        &lt;input type=”hidden” name=”@template” value=”index|search”/&gt;
       </div>
      </blockquote> 
      <p>With this addition, the index template is displayed if there is no error, and the user stays on the search template if there is an error.</p> 
     </div> 
     <div class="section" id="new-l-loghttpvialogger-option-to-roundup-server"> 
      <h3><a class="toc-backref" href="#id65">New -L (loghttpvialogger) option to roundup-server</a></h3> 
      <p>Http request logs from roundup-server are sent to stderr or can be recorded in a log file (if -l or the logfile options is used). However there is no way to rotate the logfile without shutting down and restarting the roundup-server.</p> 
      <p>If the -L flag is used, the python logging module is used for logging the http requests. The name for the log (qualname) is ‘roundup.http’. You can direct these messages to a rotating log file by putting the following:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="p">[</span><span class="n">loggers</span><span class="p">]</span>
<span class="n">keys</span><span class="o">=</span><span class="n">roundup</span><span class="o">.</span><span class="n">http</span>

<span class="p">[</span><span class="n">logger_roundup</span><span class="o">.</span><span class="n">http</span><span class="p">]</span>
<span class="n">level</span><span class="o">=</span><span class="n">INFO</span>
<span class="n">handlers</span><span class="o">=</span><span class="n">rotate_weblog</span>
<span class="n">qualname</span><span class="o">=</span><span class="n">roundup</span><span class="o">.</span><span class="n">http</span>
<span class="n">propagate</span><span class="o">=</span><span class="mi">0</span>

<span class="p">[</span><span class="n">handlers</span><span class="p">]</span>
<span class="n">keys</span><span class="o">=</span><span class="n">rotate_weblog</span>

<span class="p">[</span><span class="n">handler_rotate_weblog</span><span class="p">]</span>
<span class="n">class</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">RotatingFileHandler</span>
<span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="s1">'httpd.log'</span><span class="p">,</span><span class="s1">'a'</span><span class="p">,</span> <span class="mi">512000</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">formatter</span><span class="o">=</span><span class="n">plain</span>

<span class="p">[</span><span class="n">formatters</span><span class="p">]</span>
<span class="n">keys</span><span class="o">=</span><span class="n">plain</span>

<span class="p">[</span><span class="n">formatter_plain</span><span class="p">]</span>
<span class="nb">format</span><span class="o">=%</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="n">s</span>
</pre>
       </div> 
      </div> 
      <p>into a file (e.g. logging.ini). Then reference this file in the ‘config’ value of the [logging] section in the trackers config.ini file.</p> 
      <p>Note the log configuration above is an example and can be merged into a more full featured logging config file for your tracker if you wish. It will create a new file in the current working directory called ‘httpd.log’ and will rotate the log file at 500K and keep two old copies of the file.</p> 
     </div> 
    </div> 
    <div class="section" id="migrating-from-1-5-0-to-1-5-1"> <span id="index-5"></span>
     <h2><a class="toc-backref" href="#id66">Migrating from 1.5.0 to 1.5.1</a></h2> 
     <div class="section" id="user-data-visibility"> 
      <h3><a class="toc-backref" href="#id67">User data visibility</a></h3> 
      <p>For security reasons you should change the permissions on the user class. We previously shipped a configuration that allowed users to see too many of other users details, including hashed passwords under certain circumstances. In schema.py in your tracker, replace the line:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="s1">'View'</span><span class="p">,</span> <span class="s1">'user'</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>with:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'View'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'user'</span><span class="p">,</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="s1">'organisation'</span><span class="p">,</span> <span class="s1">'phone'</span><span class="p">,</span> <span class="s1">'realname'</span><span class="p">,</span>
    <span class="s1">'timezone'</span><span class="p">,</span> <span class="s1">'username'</span><span class="p">))</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>Note that this removes visibility of user emails, if you want emails to be visible you can add ‘address’ and ‘alternate_addresses’ to the list above.</p> 
     </div> 
     <div class="section" id="xss-protection-for-custom-actions"> 
      <h3><a class="toc-backref" href="#id68">XSS protection for custom actions</a></h3> 
      <p>If you have defined your own cgi actions in your tracker instance (e.g. in a custom <code class="docutils literal notranslate"><span class="pre">extensions/spambayes.py</span></code> file) you need to modify all cases where client.error_message or client.ok_message are modified directly. Instead of:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ok_message</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>you need to call:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">add_ok_message</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>and the same for:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">error_message</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>vs.:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">add_error_message</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>The new calls escape the passed string by default and avoid XSS security issues.</p> 
     </div> 
    </div> 
    <div class="section" id="migrating-from-1-4-20-to-1-4-21"> <span id="index-6"></span>
     <h2><a class="toc-backref" href="#id69">Migrating from 1.4.20 to 1.4.21</a></h2> 
     <p>The <code class="docutils literal notranslate"><span class="pre">_generic.calendar.html</span></code> page of the instance has been updated to include <code class="docutils literal notranslate"><span class="pre">&lt;meta</span> <span class="pre">name="robots"</span> <span class="pre">content="noindex,</span> <span class="pre">nofollow"</span> <span class="pre">/&gt;</span></code>. This prevents robots to follow all the links in the calendar. If you haven’t modified the page on your local instance, you can simply replace it with the one in <code class="docutils literal notranslate"><span class="pre">share/roundup/templates/classic/html/_generic.calendar.html</span></code>; if you did, you can add the tag manually. See issue2550765 and changeset a099ff2ceff3.</p> 
     <dl class="docutils"> 
      <dt>
       If you are using the xml-rpc interface, there is a change
      </dt> 
      <dd>
       <p class="first">in accessing it. You can not send text/xml data to any roundup url and get a response, you must use the /xmlrpc url. For example, if you used to send your xmlrpc request to:</p> 
       <blockquote> 
        <div>
         <a class="reference external" href="http://myroundup.com/roundup">http://myroundup.com/roundup</a>
        </div>
       </blockquote> 
       <p>you need to change the url to read:</p> 
       <blockquote> 
        <div>
         <a class="reference external" href="http://myroundup.com/roundup/xmlrpc">http://myroundup.com/roundup/xmlrpc</a>
        </div>
       </blockquote> 
       <p class="last">to invoke the xmlrpc handler. This allows us to send xml data to roundup for other handlers (e.g. REST, SOAP …) in the future.</p> 
      </dd> 
     </dl> 
    </div> 
    <div class="section" id="migrating-from-1-4-19-to-1-4-20"> <span id="index-7"></span>
     <h2><a class="toc-backref" href="#id70">Migrating from 1.4.19 to 1.4.20</a></h2> 
     <p>Roundup used to allow certain HTML-Tags in OK- and Error-messages. Since these messages are passed via the URL (due to roundup redirecting after an edit), we did have security-issues (see issue2550724).</p> 
     <p>If you have customized the OK or Error messages in your roundup-installation and you were using features like bold or italic in the message, you will have to do without this highlighting and remove HTML tags from messages.</p> 
     <p>If you were using &lt;br&gt; tags for multi-line messages, you now should use newlines instead, these will be replaced with &lt;br/&gt; during formatting.</p> 
     <p>Note that the previous implementation also allowed links inside messages. Since these links could be set by an attacker, no links in roundup messages are supported anymore. This does <em>not</em> affect the “clear this message” link in OK-messages as it is generated by the template and is not part of the OK-message.</p> 
     <p>If you have not modified any roundup messages, you need not do anything, the templates shipped with roundup did not use HTML tags in messages for highlighting.</p> 
    </div> 
    <div class="section" id="migrating-from-1-4-17-to-1-4-18"> <span id="index-8"></span>
     <h2><a class="toc-backref" href="#id71">Migrating from 1.4.17 to 1.4.18</a></h2> 
     <p>There was a bug in 1.4.17 where files were unlinked from issues if a mail without attachment was received via the mail interface. The following script will list likely issues being affected by the bug. The date in the script is the date of the 1.4.17 release. If you have installed 1.4.17 later than this date, you can change the date appropriately to your installation date. Run the script in the directory of your tracker:</p> 
     <div class="highlight-default notranslate">
      <div class="highlight">
       <pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">roundup</span> <span class="k">import</span> <span class="n">instance</span>
<span class="kn">from</span> <span class="nn">roundup.date</span> <span class="k">import</span> <span class="n">Date</span>
<span class="nb">dir</span>     <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span> <span class="p">()</span>
<span class="n">tracker</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">open</span> <span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
<span class="n">db</span>      <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">open</span> <span class="p">(</span><span class="s1">'admin'</span><span class="p">)</span>
<span class="c1"># you may want to change this to your install date to find less candidates</span>
<span class="n">last_release</span> <span class="o">=</span> <span class="n">Date</span><span class="p">(</span><span class="s1">'2011-05-13'</span><span class="p">)</span>
<span class="n">affected</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">getnodeids</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">history</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">affected</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="n">j</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">last_release</span> <span class="ow">or</span> <span class="n">j</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">'set'</span> <span class="ow">or</span> <span class="s1">'files'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">j</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">op</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">j</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="s1">'files'</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="s1">'-'</span><span class="p">:</span>
                <span class="n">affected</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">break</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">affected</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
</pre>
      </div> 
     </div> 
     <p>To find out which files where attached before you can look in the history of the affected issue. For fixing issues you can re-attach the files in question using the “set” command of roundup-admin, e.g., if the list of files attached to an issue should be files 5, 17, 23 for issue42 you will set this using</p> 
     <p>roundup-admin -i /path/to/your/tracker set issue42 files=5,17,23</p> 
    </div> 
    <div class="section" id="migrating-from-1-4-x-to-1-4-17"> <span id="index-9"></span>
     <h2><a class="toc-backref" href="#id72">Migrating from 1.4.x to 1.4.17</a></h2> 
     <p>There is a new config-option <cite>migrate_passwords</cite> in section <cite>web</cite> to auto-migrate passwords at web-login time to a more secure storage scheme. Default for the new option is “yes” so if you don’t want that passwords are auto-migrated to a more secure password scheme on user login, set this to “no” before running your tracker(s) after the upgrade.</p> 
     <p>The standalone roundup-server now defaults to listening on localhost (no longer on all network interfaces). This will not affect you if you’re already using a configuration file for roundup-server. If you are using an empty setting for the <cite>host</cite> parameter in the config-file you should explicitly put 0.0.0.0 there as the use of an empty string to specify listening to all interfaces is deprecated and will go away in a future version. If you are starting the server without a configuration file and want to explicitly listen to all network interface, you should specify the -n option with the address <cite>0.0.0.0</cite>.</p> 
     <p id="new-search-permissions-for-query-in-1-4-17">Searching now requires either read-permission without a check method, or you will have to add a “Search” permission for a class or a list of properties for a class (if you want to allow searching). For the classic template (or other templates derived from it) you want to add the following lines to your <cite>schema.py</cite> file:</p> 
     <div class="highlight-default notranslate">
      <div class="highlight">
       <pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Search'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'query'</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre>
      </div> 
     </div> 
     <p>This is needed, because for the <cite>query</cite> class users may view only their own queries (or public queries). This is implemented with a <cite>check</cite> method, therefore the default search permissions will not allow searching and you’ll have to add an explicit search permission. If you have modified your schema, you can check if you’re missing any search permissions with the following script, run it in your tracker directory, it will list for each Class and Property the roles that may search for this property:</p> 
     <div class="highlight-default notranslate">
      <div class="highlight">
       <pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">roundup</span> <span class="k">import</span> <span class="n">instance</span>

<span class="n">tracker</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span> <span class="p">())</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'admin'</span><span class="p">)</span>

<span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">getclasses</span><span class="p">()):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Class:"</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">getclass</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span><span class="o">.</span><span class="n">getprops</span><span class="p">(</span><span class="n">protected</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"    Property:"</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">roles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">role</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">role</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">roleHasSearchPermission</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">role</span><span class="p">):</span>
                <span class="n">roles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">role</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"        roles may search:"</span><span class="p">,</span> <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">roles</span><span class="p">))</span>
</pre>
      </div> 
     </div> 
    </div> 
    <div class="section" id="migrating-from-1-4-x-to-1-4-12"> <span id="index-10"></span>
     <h2><a class="toc-backref" href="#id73">Migrating from 1.4.x to 1.4.12</a></h2> 
     <p>Item creation now checks the “Create” permission instead of the “Edit” permission for individual properties. If you have modified your tracker permissions from the default distribution, you should check that “Create” permissions exist for all properties you want users to be able to create.</p> 
     <div class="section" id="fixing-some-potential-security-holes"> 
      <h3><a class="toc-backref" href="#id74">Fixing some potential security holes</a></h3> 
      <p>Enhanced checking was added to the user registration auditor. If you run a public tracker you should update your tracker’s <code class="docutils literal notranslate"><span class="pre">detectors/userauditor.py</span></code> using the new code from <code class="docutils literal notranslate"><span class="pre">share/roundup/templates/classic/detectors/userauditor.py</span></code>. In most cases you may just copy the file over, but if you’ve made changes to the auditor in your tracker then you’ll need to manually integrate the new code.</p> 
      <p>Some HTML templates were found to have formatting security problems:</p> 
      <p><code class="docutils literal notranslate"><span class="pre">html/page.html</span></code>:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">-</span><span class="n">tal</span><span class="p">:</span><span class="n">replace</span><span class="o">=</span><span class="s2">"request/user/username"</span><span class="o">&gt;</span><span class="n">username</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;&lt;/</span><span class="n">b</span><span class="o">&gt;&lt;</span><span class="n">br</span><span class="o">&gt;</span>
<span class="o">+</span><span class="n">tal</span><span class="p">:</span><span class="n">replace</span><span class="o">=</span><span class="s2">"python:request.user.username.plain(escape=1)"</span><span class="o">&gt;</span><span class="n">username</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;&lt;/</span><span class="n">b</span><span class="o">&gt;&lt;</span><span class="n">br</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
      <p><code class="docutils literal notranslate"><span class="pre">html/_generic.help-list.html</span></code>:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">-</span><span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"structure python:item[prop]"</span><span class="o">&gt;&lt;/</span><span class="n">label</span><span class="o">&gt;</span>
<span class="o">+</span><span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"python:item[prop]"</span><span class="o">&gt;&lt;/</span><span class="n">label</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
      <p>The lines marked “+” should be added and lines marked “-” should be deleted (minus the “+”/”-” signs).</p> 
     </div> 
     <div class="section" id="some-html-interface-tweaks"> 
      <h3><a class="toc-backref" href="#id75">Some HTML interface tweaks</a></h3> 
      <p>You may wish to copy the <code class="docutils literal notranslate"><span class="pre">user_utils.js</span></code> and <code class="docutils literal notranslate"><span class="pre">style.css`</span> <span class="pre">files</span> <span class="pre">from</span> <span class="pre">the</span> <span class="pre">source</span> <span class="pre">distribution</span> <span class="pre">``share/roundup/templates/classic/html/</span></code> directory to the <code class="docutils literal notranslate"><span class="pre">html</span></code> directory of your trackers as it includes a small improvement.</p> 
      <p>If you have made local changes to those files you’ll need to manually work the differences in to your versions or ignore the changes.</p> 
     </div> 
    </div> 
    <div class="section" id="migrating-from-1-4-x-to-1-4-11"> <span id="index-11"></span>
     <h2><a class="toc-backref" href="#id76">Migrating from 1.4.x to 1.4.11</a></h2> 
     <div class="section" id="close-potential-security-hole"> 
      <h3><a class="toc-backref" href="#id77">Close potential security hole</a></h3> 
      <p>If your tracker has untrusted users you should examine its <code class="docutils literal notranslate"><span class="pre">schema.py</span></code> file and look for the section granting the “Edit” permission to your users. This should look something like:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Edit'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'user'</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="n">own_record</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"User is allowed to edit their own user details"</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>and should be modified to restrict the list of properties they are allowed to edit by adding the <code class="docutils literal notranslate"><span class="pre">properties=</span></code> section like:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Edit'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'user'</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="n">own_record</span><span class="p">,</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">(</span><span class="s1">'username'</span><span class="p">,</span> <span class="s1">'password'</span><span class="p">,</span> <span class="s1">'address'</span><span class="p">,</span> <span class="s1">'realname'</span><span class="p">,</span> <span class="s1">'phone'</span><span class="p">,</span>
        <span class="s1">'organisation'</span><span class="p">,</span> <span class="s1">'alternate_addresses'</span><span class="p">,</span> <span class="s1">'queries'</span><span class="p">,</span> <span class="s1">'timezone'</span><span class="p">),</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"User is allowed to edit their own user details"</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>Most importantly the “roles” property should not be editable - thus not appear in that list of properties.</p> 
     </div> 
     <div class="section" id="grant-the-register-permission-to-the-anonymous-role"> 
      <h3><a class="toc-backref" href="#id78">Grant the “Register” permission to the Anonymous role</a></h3> 
      <p>A separate “Register” permission has been introduced to allow anonymous users to register. This means you will need to add the following to your tracker’s <code class="docutils literal notranslate"><span class="pre">schema.py</span></code> to add the permission and assign it to the Anonymous role (replacing any previously assigned “Create user” permission for the Anonymous role):</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">+</span><span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Register'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'user'</span><span class="p">,</span>
<span class="o">+</span>     <span class="n">description</span><span class="o">=</span><span class="s1">'User is allowed to register new user'</span><span class="p">)</span>

 <span class="c1"># Assign the appropriate permissions to the anonymous user's Anonymous</span>
 <span class="c1"># Role. Choices here are:</span>
 <span class="c1"># - Allow anonymous users to register</span>
<span class="o">-</span><span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'Anonymous'</span><span class="p">,</span> <span class="s1">'Create'</span><span class="p">,</span> <span class="s1">'user'</span><span class="p">)</span>
<span class="o">+</span><span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'Anonymous'</span><span class="p">,</span> <span class="s1">'Register'</span><span class="p">,</span> <span class="s1">'user'</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>The lines marked “+” should be added and lines marked “-” should be deleted (minus the “+”/”-” signs).</p> 
      <p>You should also modify the <code class="docutils literal notranslate"><span class="pre">html/page.html</span></code> template to change the permission tested there:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">-</span><span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"python:request.user.hasPermission('Create', 'user')"</span>
<span class="o">+</span><span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"python:request.user.hasPermission('Register', 'user')"</span>
</pre>
       </div> 
      </div> 
     </div> 
     <div class="section" id="generic-class-editor-may-now-restore-retired-items"> 
      <h3><a class="toc-backref" href="#id79">Generic class editor may now restore retired items</a></h3> 
      <p>The instructions for doing so won’t be present in your tracker unless you copy the <code class="docutils literal notranslate"><span class="pre">_generic.index.html</span></code> template from the roundup distribution in <code class="docutils literal notranslate"><span class="pre">share/roundup/templates/classic/html</span></code> to your tracker’s <code class="docutils literal notranslate"><span class="pre">html</span></code> directory.</p> 
     </div> 
    </div> 
    <div class="section" id="migrating-from-1-4-x-to-1-4-9"> <span id="index-12"></span>
     <h2><a class="toc-backref" href="#id80">Migrating from 1.4.x to 1.4.9</a></h2> 
     <div class="section" id="customized-mailgw-class"> 
      <h3><a class="toc-backref" href="#id81">Customized MailGW Class</a></h3> 
      <p>If you have customized the MailGW class in your tracker: The new MailGW class opens the database for each message in the method handle_message (instance.open) instead of passing the opened database as a parameter to the MailGW constructor. The old handle_message has been renamed to _handle_message. The new method opens the database and wraps the call to the old method into a try/finally.</p> 
      <p>Your customized MailGW class needs to mirror this behavior.</p> 
     </div> 
     <div class="section" id="fix-the-remove-button-in-issue-files-and-messages-lists"> 
      <h3><a class="toc-backref" href="#id82">Fix the “remove” button in issue files and messages lists</a></h3> 
      <p>The “remove” button(s) in the issue messages list needs to be altered. Find the following in your tracker’s <code class="docutils literal notranslate"><span class="pre">html/issue.item.html</span></code> template:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">form</span> <span class="n">style</span><span class="o">=</span><span class="s2">"padding:0"</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"context/is_edit_ok"</span>
       <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"action string:issue${context/id}"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"@remove@files"</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"value file/id"</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
      <p>and add <code class="docutils literal notranslate"><span class="pre">method="POST"</span></code> as shown below:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">form</span> <span class="n">style</span><span class="o">=</span><span class="s2">"padding:0"</span> <span class="n">method</span><span class="o">=</span><span class="s2">"POST"</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"context/is_edit_ok"</span>
       <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"action string:issue${context/id}"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"@remove@files"</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"value file/id"</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
      <p>Then also find:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">form</span> <span class="n">style</span><span class="o">=</span><span class="s2">"padding:0"</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"context/is_edit_ok"</span>
       <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"action string:issue${context/id}"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"@remove@messages"</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"value msg/id"</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
      <p>and add <code class="docutils literal notranslate"><span class="pre">method="POST"</span></code> as shown below:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">form</span> <span class="n">style</span><span class="o">=</span><span class="s2">"padding:0"</span> <span class="n">method</span><span class="o">=</span><span class="s2">"POST"</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"context/is_edit_ok"</span>
       <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"action string:issue${context/id}"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"@remove@messages"</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"value msg/id"</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
     </div> 
     <div class="section" id="fixing-the-retire-button-in-user-management-list"> 
      <h3><a class="toc-backref" href="#id83">Fixing the “retire” button in user management list</a></h3> 
      <p>Some previous versions of this upgrading document missed <code class="docutils literal notranslate"><span class="pre">method="POST"</span></code> in the change to the “retire” link in the user management list in section <a class="reference internal" href="#migrating-from-1-4-x-to-1-4-7">Migrating from 1.4.x to 1.4.7</a>. Make sure the change is done as listed below in this document.</p> 
     </div> 
    </div> 
    <div class="section" id="migrating-from-1-4-x-to-1-4-7"> <span id="index-13"></span>
     <h2><a class="toc-backref" href="#id84">Migrating from 1.4.x to 1.4.7</a></h2> 
     <p>Several security issues were addressed in this release. Some aspects of your trackers may no longer function depending on your local customisations. Core functionality that will need to be modified:</p> 
     <div class="section" id="grant-the-retire-permission-to-users-for-their-queries"> 
      <h3><a class="toc-backref" href="#id85">Grant the “retire” permission to users for their queries</a></h3> 
      <p>Users will no longer be able to retire their own queries. To remedy this you will need to add the following to your tracker’s <code class="docutils literal notranslate"><span class="pre">schema.py</span></code> just under the line that grants them permission to edit their own queries:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span>  <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Edit'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'query'</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="n">edit_query</span><span class="p">,</span>
     <span class="n">description</span><span class="o">=</span><span class="s2">"User is allowed to edit their queries"</span><span class="p">)</span>
  <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="o">+</span> <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Retire'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'query'</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="n">edit_query</span><span class="p">,</span>
<span class="o">+</span>    <span class="n">description</span><span class="o">=</span><span class="s2">"User is allowed to retire their queries"</span><span class="p">)</span>
<span class="o">+</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
  <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Create'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'query'</span><span class="p">,</span>
     <span class="n">description</span><span class="o">=</span><span class="s2">"User is allowed to create queries"</span><span class="p">)</span>
  <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>The lines marked “+” should be added, minus the “+” sign.</p> 
     </div> 
     <div class="section" id="fix-the-retire-link-in-the-users-list-for-admin-users"> 
      <h3><a class="toc-backref" href="#id86">Fix the “retire” link in the users list for admin users</a></h3> 
      <p>The “retire” link found in the file <code class="docutils literal notranslate"><span class="pre">html/user.index.html</span></code>:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"context/is_edit_ok"</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">a</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"href string:user${user/id}?@action=retire&amp;@template=index"</span>
  <span class="n">i18n</span><span class="p">:</span><span class="n">translate</span><span class="o">=</span><span class="s2">""</span><span class="o">&gt;</span><span class="n">retire</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
      <p>Should be replaced with:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"context/is_retire_ok"</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">form</span> <span class="n">style</span><span class="o">=</span><span class="s2">"padding:0"</span> <span class="n">method</span><span class="o">=</span><span class="s2">"POST"</span>
         <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"action string:user${user/id}"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"@template"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"index"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"@action"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"retire"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"submit"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"retire"</span> <span class="n">i18n</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"value"</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
     </div> 
     <div class="section" id="fix-for-python-2-6-users"> 
      <h3><a class="toc-backref" href="#id87">Fix for Python 2.6+ users</a></h3> 
      <p>If you use Python 2.6 you should edit your tracker’s <code class="docutils literal notranslate"><span class="pre">detectors/nosyreaction.py</span></code> file to change:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="kn">import</span> <span class="nn">sets</span>
</pre>
       </div> 
      </div> 
      <p>at the top to:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="kn">from</span> <span class="nn">roundup.anypy.sets_</span> <span class="k">import</span> <span class="nb">set</span>
</pre>
       </div> 
      </div> 
      <p>and then all instances of <code class="docutils literal notranslate"><span class="pre">sets.Set()</span></code> to <code class="docutils literal notranslate"><span class="pre">set()</span></code> in the later code.</p> 
     </div> 
     <div class="section" id="trackers-currently-allowing-html-file-uploading"> 
      <h3><a class="toc-backref" href="#id88">Trackers currently allowing HTML file uploading</a></h3> 
      <p>Trackers which wish to continue to allow uploading of HTML content against issues will need to set a new configuration variable in the <code class="docutils literal notranslate"><span class="pre">[web]</span></code> section of the tracker’s <code class="docutils literal notranslate"><span class="pre">config.ini</span></code> file:</p> 
      <blockquote> 
       <div>
        # Setting this option enables Roundup to serve uploaded HTML # file content <em>as HTML</em>. This is a potential security risk # and is therefore disabled by default. Set to ‘yes’ if you # trust <em>all</em> users uploading content to your tracker. # Allowed values: yes, no # Default: no allow_html_file = no
       </div>
      </blockquote> 
     </div> 
    </div> 
    <div class="section" id="migrating-from-1-4-2-to-1-4-3"> <span id="index-14"></span>
     <h2><a class="toc-backref" href="#id89">Migrating from 1.4.2 to 1.4.3</a></h2> 
     <p>If you are using the MySQL backend you will need to replace some indexes that may have been created by version 1.4.2.</p> 
     <p>You should to access your MySQL database directly and remove any indexes with a name ending in “_key_retired_idx”. You should then re-add them with the same spec except the key column name needs a size. So an index on “_user (__retired, _name)” should become “_user (__retired, _name(255))”.</p> 
    </div> 
    <div class="section" id="migrating-from-1-4-x-to-1-4-2"> <span id="index-15"></span>
     <h2><a class="toc-backref" href="#id90">Migrating from 1.4.x to 1.4.2</a></h2> 
     <p id="index-16">You should run the “roundup-admin migrate” command for your tracker once you’ve installed the latest codebase.</p> 
     <p>Do this before you use the web, command-line or mail interface and before any users access the tracker.</p> 
     <p>This command will respond with either “Tracker updated” (if you’ve not previously run it on an RDBMS backend) or “No migration action required” (if you have run it, or have used another interface to the tracker, or are using anydbm).</p> 
     <p>It’s safe to run this even if it’s not required, so just get into the habit.</p> 
    </div> 
    <div class="section" id="migrating-from-1-3-3-to-1-4-0"> <span id="index-17"></span>
     <h2><a class="toc-backref" href="#id91">Migrating from 1.3.3 to 1.4.0</a></h2> 
     <p>Value of the “refwd_re” tracker configuration option (section “mailgw”) is treated as UTF-8 string. In previous versions, it was ISO8859-1.</p> 
     <p>If you have running trackers based on the classic template, please update the messagesummary detector as follows:</p> 
     <div class="highlight-default notranslate">
      <div class="highlight">
       <pre><span></span><span class="o">---</span> <span class="n">detectors</span><span class="o">/</span><span class="n">messagesummary</span><span class="o">.</span><span class="n">py</span> <span class="mi">17</span> <span class="n">Apr</span> <span class="mi">2003</span> <span class="mi">03</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">38</span> <span class="o">-</span><span class="mi">0000</span>      <span class="mf">1.1</span>
<span class="o">+++</span> <span class="n">detectors</span><span class="o">/</span><span class="n">messagesummary</span><span class="o">.</span><span class="n">py</span> <span class="mi">3</span> <span class="n">Apr</span> <span class="mi">2007</span> <span class="mi">06</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">21</span> <span class="o">-</span><span class="mi">0000</span>       <span class="mf">1.2</span>
<span class="o">@@</span> <span class="o">-</span><span class="mi">8</span><span class="p">,</span><span class="mi">7</span> <span class="o">+</span><span class="mi">8</span><span class="p">,</span><span class="mi">7</span> <span class="o">@@</span>
 <span class="k">if</span> <span class="n">newvalues</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">'summary'</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">newvalues</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">'content'</span><span class="p">):</span>
     <span class="k">return</span>

<span class="o">-</span>    <span class="n">summary</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">parseContent</span><span class="p">(</span><span class="n">newvalues</span><span class="p">[</span><span class="s1">'content'</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="o">+</span>    <span class="n">summary</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">parseContent</span><span class="p">(</span><span class="n">newvalues</span><span class="p">[</span><span class="s1">'content'</span><span class="p">],</span> <span class="n">config</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
 <span class="n">newvalues</span><span class="p">[</span><span class="s1">'summary'</span><span class="p">]</span> <span class="o">=</span> <span class="n">summary</span>
</pre>
      </div> 
     </div> 
     <p>In the latest version we have added some database indexes to the SQL-backends (mysql, postgresql, sqlite) for speeding up building the roundup-index for full-text search. We recommend that you create the following database indexes on the database by hand:</p> 
     <div class="highlight-default notranslate">
      <div class="highlight">
       <pre><span></span><span class="n">CREATE</span> <span class="n">INDEX</span> <span class="n">words_by_id</span> <span class="n">ON</span> <span class="n">__words</span> <span class="p">(</span><span class="n">_textid</span><span class="p">);</span>
<span class="n">CREATE</span> <span class="n">UNIQUE</span> <span class="n">INDEX</span> <span class="n">__textids_by_props</span> <span class="n">ON</span> <span class="n">__textids</span> <span class="p">(</span><span class="n">_class</span><span class="p">,</span> <span class="n">_itemid</span><span class="p">,</span> <span class="n">_prop</span><span class="p">);</span>
</pre>
      </div> 
     </div> 
    </div> 
    <div class="section" id="migrating-from-1-2-x-to-1-3-0"> <span id="index-18"></span>
     <h2><a class="toc-backref" href="#id92">Migrating from 1.2.x to 1.3.0</a></h2> 
     <div class="section" id="web-interface-changes"> 
      <h3><a class="toc-backref" href="#id93">1.3.0 Web interface changes</a></h3> 
      <p>Some of the HTML files in the “classic” and “minimal” tracker templates were changed to fix some bugs and clean them up. You may wish to compare them to the HTML files in your tracker and apply any changes.</p> 
     </div> 
    </div> 
    <div class="section" id="migrating-from-1-1-2-to-1-2-0"> <span id="index-19"></span>
     <h2><a class="toc-backref" href="#id94">Migrating from 1.1.2 to 1.2.0</a></h2> 
     <div class="section" id="sorting-and-grouping-by-multiple-properties"> 
      <h3><a class="toc-backref" href="#id95">1.2.0 Sorting and grouping by multiple properties</a></h3> 
      <p>Starting with this version, sorting and grouping by multiple properties is possible. This means that request.sort and request.group are now lists. This is reflected in several places:</p> 
      <blockquote> 
       <div>
        <ul> 
         <li><p class="first"><code class="docutils literal notranslate"><span class="pre">renderWith</span></code> now has list attributes for <code class="docutils literal notranslate"><span class="pre">sort</span></code> and <code class="docutils literal notranslate"><span class="pre">group</span></code>, where you previously wrote:</p> 
          <div class="highlight-default notranslate">
           <div class="highlight">
            <pre><span></span><span class="n">renderWith</span><span class="p">(</span><span class="o">...</span> <span class="n">sort</span><span class="o">=</span><span class="p">(</span><span class="s1">'-'</span><span class="p">,</span> <span class="s1">'activity'</span><span class="p">),</span> <span class="n">group</span><span class="o">=</span><span class="p">(</span><span class="s1">'+'</span><span class="p">,</span> <span class="s1">'priority'</span><span class="p">)</span>
</pre>
           </div> 
          </div> <p>you write now:</p> 
          <div class="highlight-default notranslate">
           <div class="highlight">
            <pre><span></span><span class="n">renderWith</span><span class="p">(</span><span class="o">...</span> <span class="n">sort</span><span class="o">=</span><span class="p">[(</span><span class="s1">'-'</span><span class="p">,</span> <span class="s1">'activity'</span><span class="p">)],</span> <span class="n">group</span><span class="o">=</span><span class="p">[(</span><span class="s1">'+'</span><span class="p">,</span> <span class="s1">'priority'</span><span class="p">)]</span>
</pre>
           </div> 
          </div> </li> 
         <li><p class="first">In templates that permit to edit sorting/grouping, request.sort and request.group are (possibly empty) lists. You can now sort and group by multiple attributes. For an example, see the classic template. You may want search for the variable <code class="docutils literal notranslate"><span class="pre">n_sort</span></code> which can be set to the number of sort/group properties.</p> </li> 
         <li><p class="first">Templates that diplay new headlines for each group of items with equal group properties can now use the modified <code class="docutils literal notranslate"><span class="pre">batch.propchanged</span></code> method that can take several properties which are checked for changes. See the example in the classic template which makes use of <code class="docutils literal notranslate"><span class="pre">batch.propchanged</span></code>.</p> </li> 
        </ul> 
       </div>
      </blockquote> 
     </div> 
    </div> 
    <div class="section" id="migrating-from-1-1-0-to-1-1-1"> <span id="index-20"></span>
     <h2><a class="toc-backref" href="#id96">Migrating from 1.1.0 to 1.1.1</a></h2> 
     <div class="section" id="clear-this-message"> 
      <h3><a class="toc-backref" href="#id97">1.1.1 “Clear this message”</a></h3> 
      <p>In 1.1.1, the standard <code class="docutils literal notranslate"><span class="pre">page.html</span></code> template includes a “clear this message” link in the green “ok” message bar that appears after a successful edit (or other) action.</p> 
      <p>To include this in your tracker, change the following in your <code class="docutils literal notranslate"><span class="pre">page.html</span></code> template:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">p</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"options/ok_message | nothing"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"ok-message"</span>
   <span class="n">tal</span><span class="p">:</span><span class="n">repeat</span><span class="o">=</span><span class="s2">"m options/ok_message"</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"structure m"</span><span class="o">&gt;</span><span class="n">error</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
      <p>to be:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">p</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"options/ok_message | nothing"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"ok-message"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">span</span> <span class="n">tal</span><span class="p">:</span><span class="n">repeat</span><span class="o">=</span><span class="s2">"m options/ok_message"</span>
     <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"structure string:$m &lt;br/ &gt; "</span> <span class="o">/&gt;</span>
   <span class="o">&lt;</span><span class="n">a</span> <span class="n">class</span><span class="o">=</span><span class="s2">"form-small"</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"href request/current_url"</span>
      <span class="n">i18n</span><span class="p">:</span><span class="n">translate</span><span class="o">=</span><span class="s2">""</span><span class="o">&gt;</span><span class="n">clear</span> <span class="n">this</span> <span class="n">message</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
      <p>If you implemented the “clear this message” in your 1.1.0 tracker, then you should change it to the above and it will work much better!</p> 
     </div> 
    </div> 
    <div class="section" id="migrating-from-1-0-x-to-1-1-0"> <span id="index-21"></span>
     <h2><a class="toc-backref" href="#id98">Migrating from 1.0.x to 1.1.0</a></h2> 
     <div class="section" id="login-for-session-only"> 
      <h3><a class="toc-backref" href="#id99">1.1 Login “For Session Only”</a></h3> 
      <p>In 1.1, web logins are alive for the length of a session only, <em>unless</em> you add the following to the login form in your tracker’s <code class="docutils literal notranslate"><span class="pre">page.html</span></code>:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span>&lt;input type="checkbox" name="remember" id="remember"&gt;
&lt;label for="remember" i18n:translate=""&gt;Remember me?&lt;/label&gt;&lt;br&gt;
</pre>
       </div> 
      </div> 
      <p>See the classic tracker <code class="docutils literal notranslate"><span class="pre">page.html</span></code> if you’re unsure where this should go.</p> 
     </div> 
     <div class="section" id="query-display-name"> 
      <h3><a class="toc-backref" href="#id100">1.1 Query Display Name</a></h3> 
      <p>The <code class="docutils literal notranslate"><span class="pre">dispname</span></code> web variable has been renamed <code class="docutils literal notranslate"><span class="pre">@dispname</span></code> to avoid clashing with other variables of the same name. If you are using the display name feature, you will need to edit your tracker’s <code class="docutils literal notranslate"><span class="pre">page.html</span></code> and <code class="docutils literal notranslate"><span class="pre">issue.index.html</span></code> pages to change <code class="docutils literal notranslate"><span class="pre">dispname</span></code> to <code class="docutils literal notranslate"><span class="pre">@dispname</span></code>.</p> 
      <p>A side-effect of this change is that the renderWith method used in the <code class="docutils literal notranslate"><span class="pre">home.html</span></code> page may now take a dispname argument.</p> 
     </div> 
     <div class="section" id="id1"> 
      <h3><a class="toc-backref" href="#id101">1.1 “Clear this message”</a></h3> 
      <p>In 1.1, the standard <code class="docutils literal notranslate"><span class="pre">page.html</span></code> template includes a “clear this message” link in the green “ok” message bar that appears after a successful edit (or other) action.</p> 
      <p>To include this in your tracker, change the following in your <code class="docutils literal notranslate"><span class="pre">page.html</span></code> template:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">p</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"options/ok_message | nothing"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"ok-message"</span>
   <span class="n">tal</span><span class="p">:</span><span class="n">repeat</span><span class="o">=</span><span class="s2">"m options/ok_message"</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"structure m"</span><span class="o">&gt;</span><span class="n">error</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
      <p>to be:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">p</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"options/ok_message | nothing"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"ok-message"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">span</span> <span class="n">tal</span><span class="p">:</span><span class="n">repeat</span><span class="o">=</span><span class="s2">"m options/ok_message"</span>
     <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"structure string:$m &lt;br/ &gt; "</span> <span class="o">/&gt;</span>
   <span class="o">&lt;</span><span class="n">a</span> <span class="n">class</span><span class="o">=</span><span class="s2">"form-small"</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"href string:issue${context/id}"</span>
      <span class="n">i18n</span><span class="p">:</span><span class="n">translate</span><span class="o">=</span><span class="s2">""</span><span class="o">&gt;</span><span class="n">clear</span> <span class="n">this</span> <span class="n">message</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
     </div> 
    </div> 
    <div class="section" id="migrating-from-0-8-x-to-1-0"> <span id="index-22"></span>
     <h2><a class="toc-backref" href="#id102">Migrating from 0.8.x to 1.0</a></h2> 
     <div class="section" id="new-query-permissions"> 
      <h3><a class="toc-backref" href="#id103">1.0 New Query Permissions</a></h3> 
      <p>New permissions are defined for query editing and viewing. To include these in your tracker, you need to add these lines to your tracker’s <code class="docutils literal notranslate"><span class="pre">schema.py</span></code>:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="c1"># Users should be able to edit and view their own queries. They should also</span>
<span class="c1"># be able to view any marked as not private. They should not be able to</span>
<span class="c1"># edit others' queries, even if they're not private</span>
<span class="k">def</span> <span class="nf">view_query</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">userid</span><span class="p">,</span> <span class="n">itemid</span><span class="p">):</span>
    <span class="n">private_for</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">itemid</span><span class="p">,</span> <span class="s1">'private_for'</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">private_for</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">userid</span> <span class="o">==</span> <span class="n">private_for</span>
<span class="k">def</span> <span class="nf">edit_query</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">userid</span><span class="p">,</span> <span class="n">itemid</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">userid</span> <span class="o">==</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">itemid</span><span class="p">,</span> <span class="s1">'creator'</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'View'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'query'</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="n">view_query</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"User is allowed to view their own and public queries"</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Edit'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'query'</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="n">edit_query</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"User is allowed to edit their queries"</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Create'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'query'</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"User is allowed to create queries"</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>and then remove ‘query’ from the line:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="c1"># Assign the access and edit Permissions for issue, file and message</span>
<span class="c1"># to regular users now</span>
<span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="s1">'issue'</span><span class="p">,</span> <span class="s1">'file'</span><span class="p">,</span> <span class="s1">'msg'</span><span class="p">,</span> <span class="s1">'query'</span><span class="p">,</span> <span class="s1">'keyword'</span><span class="p">:</span>
</pre>
       </div> 
      </div> 
      <p>so it looks like:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="s1">'issue'</span><span class="p">,</span> <span class="s1">'file'</span><span class="p">,</span> <span class="s1">'msg'</span><span class="p">,</span> <span class="s1">'keyword'</span><span class="p">:</span>
</pre>
       </div> 
      </div> 
     </div> 
    </div> 
    <div class="section" id="migrating-from-0-8-0-to-0-8-3"> <span id="index-23"></span>
     <h2><a class="toc-backref" href="#id104">Migrating from 0.8.0 to 0.8.3</a></h2> 
     <div class="section" id="nosy-handling-changes"> 
      <h3><a class="toc-backref" href="#id105">0.8.3 Nosy Handling Changes</a></h3> 
      <p>A change was made to fix a bug in the <code class="docutils literal notranslate"><span class="pre">nosyreaction.py</span></code> standard detector. To incorporate this fix in your trackers, you will need to copy the <code class="docutils literal notranslate"><span class="pre">nosyreaction.py</span></code> file from the <code class="docutils literal notranslate"><span class="pre">templates/classic/detectors</span></code> directory of the source to your tracker’s <code class="docutils literal notranslate"><span class="pre">templates</span></code> directory.</p> 
      <p>If you have modified the <code class="docutils literal notranslate"><span class="pre">nosyreaction.py</span></code> file from the standard version, you will need to roll your changes into the new file.</p> 
     </div> 
    </div> 
    <div class="section" id="migrating-from-0-7-1-to-0-8-0"> <span id="index-24"></span>
     <h2><a class="toc-backref" href="#id106">Migrating from 0.7.1 to 0.8.0</a></h2> 
     <p>You <em>must</em> fully uninstall previous Roundup version before installing Roundup 0.8.0. If you don’t do that, <code class="docutils literal notranslate"><span class="pre">roundup-admin</span> <span class="pre">install</span></code> command may fail to function properly.</p> 
     <div class="section" id="backend-changes"> 
      <h3><a class="toc-backref" href="#id107">0.8.0 Backend changes</a></h3> 
      <p>Backends ‘bsddb’ and ‘bsddb3’ are removed. If you are using one of these, you <em>must</em> migrate to another backend before upgrading.</p> 
     </div> 
     <div class="section" id="api-changes"> 
      <h3><a class="toc-backref" href="#id108">0.8.0 API changes</a></h3> 
      <p>Class.safeget() was removed from the API. Test your item ids before calling Class.get() instead.</p> 
     </div> 
     <div class="section" id="new-tracker-layout"> 
      <h3><a class="toc-backref" href="#id109">0.8.0 New tracker layout</a></h3> 
      <p>The <code class="docutils literal notranslate"><span class="pre">config.py</span></code> file has been replaced by <code class="docutils literal notranslate"><span class="pre">config.ini</span></code>. You may use the roundup-admin command “genconfig” to generate a new config file:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">roundup</span><span class="o">-</span><span class="n">admin</span> <span class="n">genconfig</span> <span class="o">&lt;</span><span class="n">tracker</span> <span class="n">home</span><span class="o">&gt;/</span><span class="n">config</span><span class="o">.</span><span class="n">ini</span>
</pre>
       </div> 
      </div> 
      <p>and modify the values therein based on the contents of your old config.py. In most cases, the names of the config variables are the same.</p> 
      <p>The <code class="docutils literal notranslate"><span class="pre">select_db.py</span></code> file has been replaced by a file in the <code class="docutils literal notranslate"><span class="pre">db</span></code> directory called <code class="docutils literal notranslate"><span class="pre">backend_name</span></code>. As you might guess, this file contains just the name of the backend. To figure what the contents of yours should be, use the following table:</p> 
      <blockquote> 
       <div>
        <table border="1" class="docutils"> 
         <colgroup> 
          <col width="56%"> 
          <col width="44%"> 
         </colgroup> 
         <thead valign="bottom"> 
          <tr class="row-odd">
           <th class="head"><code class="docutils literal notranslate"><span class="pre">select_db.py</span></code> contents</th> 
           <th class="head"><code class="docutils literal notranslate"><span class="pre">backend_name</span></code> contents</th> 
          </tr> 
         </thead> 
         <tbody valign="top"> 
          <tr class="row-even">
           <td>from back_anydbm import …</td> 
           <td>anydbm</td> 
          </tr> 
          <tr class="row-odd">
           <td>from back_metakit import …</td> 
           <td>metakit</td> 
          </tr> 
          <tr class="row-even">
           <td>from back_sqlite import …</td> 
           <td>sqlite</td> 
          </tr> 
          <tr class="row-odd">
           <td>from back_mysql import …</td> 
           <td>mysql</td> 
          </tr> 
          <tr class="row-even">
           <td>from back_postgresql import …</td> 
           <td>postgresql</td> 
          </tr> 
         </tbody> 
        </table> 
       </div>
      </blockquote> 
      <p>The <code class="docutils literal notranslate"><span class="pre">dbinit.py</span></code> file has been split into two new files, <code class="docutils literal notranslate"><span class="pre">initial_data.py</span></code> and <code class="docutils literal notranslate"><span class="pre">schema.py</span></code>. The contents of this file are:</p> 
      <dl class="docutils"> 
       <dt>
        <code class="docutils literal notranslate"><span class="pre">initial_data.py</span></code>
       </dt> 
       <dd>
        You don’t need one of these as your tracker is already initialised.
       </dd> 
       <dt>
        <code class="docutils literal notranslate"><span class="pre">schema.py</span></code>
       </dt> 
       <dd>
        <p class="first">Copy the body of the <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">open(name=None)</span></code> function from your old tracker’s <code class="docutils literal notranslate"><span class="pre">dbinit.py</span></code> file to this file. As the lines you’re copying aren’t part of a function definition anymore, one level of indentation needs to be removed (remove only the leading four spaces on each line).</p> 
        <p class="last">The first few lines – those starting with <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">roundup.hyperdb</span> <span class="pre">import</span> <span class="pre">...</span></code> and the <code class="docutils literal notranslate"><span class="pre">db</span> <span class="pre">=</span> <span class="pre">Database(config,</span> <span class="pre">name)</span></code> line – don’t need to be copied. Neither do the last few lines – those starting with <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">detectors</span></code>, down to <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">db</span></code> inclusive.</p> 
       </dd> 
      </dl> 
      <p>You may remove the <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> module from the “detectors” directory as it is no longer used.</p> 
      <p>There’s a new way to write extension code for Roundup. If you have code in an <code class="docutils literal notranslate"><span class="pre">interfaces.py</span></code> file you should move it. See the <a class="reference external" href="customizing.html">customisation documentation</a> for information about how extensions are now written. Note that some older trackers may use <code class="docutils literal notranslate"><span class="pre">interfaces.py</span></code> to customise the mail gateway behaviour. You will need to keep your <code class="docutils literal notranslate"><span class="pre">interfaces.py</span></code> file if this is the case.</p> 
     </div> 
     <div class="section" id="permissions-changes"> 
      <h3><a class="toc-backref" href="#id110">0.8.0 Permissions Changes</a></h3> 
      <p>The creation of a new item in the user interfaces is now controlled by the “Create” Permission. You will need to add an assignment of this Permission to your users who are allowed to create items. The most common form of this is the following in your <code class="docutils literal notranslate"><span class="pre">schema.py</span></code> added just under the current assignation of the Edit Permission:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="s1">'issue'</span><span class="p">,</span> <span class="s1">'file'</span><span class="p">,</span> <span class="s1">'msg'</span><span class="p">,</span> <span class="s1">'query'</span><span class="p">,</span> <span class="s1">'keyword'</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">'Create'</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>You will need to explicitly let anonymous users access the web interface so that regular users are able to see the login form. Note that almost all trackers will need this Permission. The only situation where it’s not required is in a tracker that uses an HTTP Basic Authenticated front-end. It’s enabled by adding to your <code class="docutils literal notranslate"><span class="pre">schema.py</span></code>:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">'Web Access'</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'Anonymous'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>Finally, you will need to enable permission for your users to edit their own details by adding the following to <code class="docutils literal notranslate"><span class="pre">schema.py</span></code>:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="c1"># Users should be able to edit their own details. Note that this</span>
<span class="c1"># permission is limited to only the situation where the Viewed or</span>
<span class="c1"># Edited item is their own.</span>
<span class="k">def</span> <span class="nf">own_record</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">userid</span><span class="p">,</span> <span class="n">itemid</span><span class="p">):</span>
    <span class="sd">'''Determine whether the userid matches the item being accessed.'''</span>
    <span class="k">return</span> <span class="n">userid</span> <span class="o">==</span> <span class="n">itemid</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'View'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'user'</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="n">own_record</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"User is allowed to view their own user details"</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Edit'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'user'</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="n">own_record</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"User is allowed to edit their own user details"</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
     </div> 
     <div class="section" id="use-of-templatingutils"> 
      <h3><a class="toc-backref" href="#id111">0.8.0 Use of TemplatingUtils</a></h3> 
      <p>If you used custom python functions in TemplatingUtils, they must be moved from interfaces.py to a new file in the <code class="docutils literal notranslate"><span class="pre">extensions</span></code> directory.</p> 
      <p>Each Function that should be available through TAL needs to be defined as a toplevel function in the newly created file. Furthermore you add an inititialization function, that registers the functions with the tracker.</p> 
      <p>If you find this too tedious, donfu wrote an automatic init function that takes an existing TemplatingUtils class, and registers all class methods that do not start with an underscore. The following hack should be placed in the <code class="docutils literal notranslate"><span class="pre">extensions</span></code> directory alongside other extensions:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="k">class</span> <span class="nc">TemplatingUtils</span><span class="p">:</span>
     <span class="c1"># copy from interfaces.py</span>

<span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="n">tracker</span><span class="p">):</span>
     <span class="n">util</span> <span class="o">=</span> <span class="n">TemplatingUtils</span><span class="p">()</span>

     <span class="k">def</span> <span class="nf">setClient</span><span class="p">(</span><span class="n">tu</span><span class="p">):</span>
         <span class="n">util</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">tu</span><span class="o">.</span><span class="n">client</span>
         <span class="k">return</span> <span class="n">util</span>

     <span class="k">def</span> <span class="nf">execUtil</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
         <span class="k">return</span> <span class="k">lambda</span> <span class="n">tu</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> \
                 <span class="nb">getattr</span><span class="p">(</span><span class="n">setClient</span><span class="p">(</span><span class="n">tu</span><span class="p">),</span> <span class="n">name</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

     <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">util</span><span class="p">):</span>
         <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">util</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'_'</span><span class="p">):</span>
              <span class="n">tracker</span><span class="o">.</span><span class="n">registerUtil</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">execUtil</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
</pre>
       </div> 
      </div> 
     </div> 
     <div class="section" id="logging-configuration"> 
      <h3><a class="toc-backref" href="#id112">0.8.0 Logging Configuration</a></h3> 
      <p>See the <a class="reference external" href="admin_guide.html">administration guide</a> for information about configuring the new logging implemented in 0.8.0.</p> 
     </div> 
    </div> 
    <div class="section" id="migrating-from-0-7-2-to-0-7-3"> <span id="index-25"></span>
     <h2><a class="toc-backref" href="#id113">Migrating from 0.7.2 to 0.7.3</a></h2> 
     <div class="section" id="configuration"> 
      <h3><a class="toc-backref" href="#id114">0.7.3 Configuration</a></h3> 
      <p>If you choose, you may specify the directory from which static files are served (those which use the URL component <code class="docutils literal notranslate"><span class="pre">@@file</span></code>). Currently the directory defaults to the <code class="docutils literal notranslate"><span class="pre">TEMPLATES</span></code> configuration variable. You may define a new variable, <code class="docutils literal notranslate"><span class="pre">STATIC_FILES</span></code> which overrides this value for static files.</p> 
     </div> 
    </div> 
    <div class="section" id="migrating-from-0-7-0-to-0-7-2"> <span id="index-26"></span>
     <h2><a class="toc-backref" href="#id115">Migrating from 0.7.0 to 0.7.2</a></h2> 
     <div class="section" id="default-timezone-is-now-required"> 
      <h3><a class="toc-backref" href="#id116">0.7.2 DEFAULT_TIMEZONE is now required</a></h3> 
      <p>The DEFAULT_TIMEZONE configuration variable is now required. Add the following to your tracker’s <code class="docutils literal notranslate"><span class="pre">config.py</span></code> file:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="c1"># You may specify a different default timezone, for use when users do not</span>
<span class="c1"># choose their own in their settings.</span>
<span class="n">DEFAULT_TIMEZONE</span> <span class="o">=</span> <span class="mi">0</span>            <span class="c1"># specify as numeric hour offest</span>
</pre>
       </div> 
      </div> 
     </div> 
    </div> 
    <div class="section" id="migrating-from-0-7-0-to-0-7-1"> <span id="index-27"></span>
     <h2><a class="toc-backref" href="#id117">Migrating from 0.7.0 to 0.7.1</a></h2> 
     <div class="section" id="permission-assignments"> 
      <h3><a class="toc-backref" href="#id118">0.7.1 Permission assignments</a></h3> 
      <p>If you allow anonymous access to your tracker, you might need to assign some additional View (or Edit if your tracker is that open) permissions to the “anonymous” user. To do so, find the code in your <code class="docutils literal notranslate"><span class="pre">dbinit.py</span></code> that says:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="s1">'issue'</span><span class="p">,</span> <span class="s1">'file'</span><span class="p">,</span> <span class="s1">'msg'</span><span class="p">,</span> <span class="s1">'query'</span><span class="p">,</span> <span class="s1">'keyword'</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">'View'</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">'Edit'</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="s1">'priority'</span><span class="p">,</span> <span class="s1">'status'</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">'View'</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>Add add a line:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'Anonymous'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>next to the existing <code class="docutils literal notranslate"><span class="pre">'User'</span></code> lines for the Permissions you wish to assign to the anonymous user.</p> 
     </div> 
    </div> 
    <div class="section" id="migrating-from-0-6-to-0-7"> <span id="index-28"></span>
     <h2><a class="toc-backref" href="#id119">Migrating from 0.6 to 0.7</a></h2> 
     <div class="section" id="id2"> 
      <h3><a class="toc-backref" href="#id120">0.7.0 Permission assignments</a></h3> 
      <p>Due to a change in the rendering of web widgets, permissions are now checked on Classes where they previously weren’t (this is a good thing).</p> 
      <p>You will need to add some additional Permission assignments for your regular users, or some displays will break. After the following in your tracker’s <code class="docutils literal notranslate"><span class="pre">dbinit.py</span></code>:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="c1"># Assign the access and edit Permissions for issue, file and message</span>
<span class="c1"># to regular users now</span>
<span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="s1">'issue'</span><span class="p">,</span> <span class="s1">'file'</span><span class="p">,</span> <span class="s1">'msg'</span><span class="p">,</span> <span class="s1">'query'</span><span class="p">,</span> <span class="s1">'keyword'</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">'View'</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">'Edit'</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>add:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="s1">'priority'</span><span class="p">,</span> <span class="s1">'status'</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">'View'</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
     </div> 
     <div class="section" id="getting-the-current-user-id"> 
      <h3><a class="toc-backref" href="#id121">0.7.0 Getting the current user id</a></h3> 
      <p>The Database.curuserid attribute has been removed.</p> 
      <p>Any code referencing this attribute should be replaced with a call to Database.getuid().</p> 
     </div> 
     <div class="section" id="zroundup-changes"> 
      <h3><a class="toc-backref" href="#id122">0.7.0 ZRoundup changes</a></h3> 
      <p>The templates in your tracker’s html directory will need updating if you wish to use ZRoundup. If you’ve not modified those files (or some of them), you may just copy the new versions from the Roundup source in the templates/classic/html directory.</p> 
      <p>If you have modified the html files, then you’ll need to manually edit them to change all occurances of special form variables from using the colon “:” special character to the at “@” special character. That is, variables such as:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="p">:</span><span class="n">action</span> <span class="p">:</span><span class="n">required</span> <span class="p">:</span><span class="n">template</span> <span class="p">:</span><span class="n">remove</span><span class="p">:</span><span class="n">messages</span> <span class="o">...</span>
</pre>
       </div> 
      </div> 
      <p>should become:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="nd">@action</span> <span class="nd">@required</span> <span class="nd">@template</span> <span class="nd">@remove@messages</span> <span class="o">...</span>
</pre>
       </div> 
      </div> 
      <p>Note that <code class="docutils literal notranslate"><span class="pre">tal:</span></code> statements are unaffected. So are TAL expression type prefixes such as <code class="docutils literal notranslate"><span class="pre">python:</span></code> and <code class="docutils literal notranslate"><span class="pre">string:</span></code>. Please ask on the roundup-users mailing list for help if you’re unsure.</p> 
     </div> 
     <div class="section" id="edit-collision-detection"> 
      <h3><a class="toc-backref" href="#id123">0.7.0 Edit collision detection</a></h3> 
      <p>Roundup now detects collisions with editing in the web interface (that is, two people editing the same item at the same time).</p> 
      <p>You must copy the <code class="docutils literal notranslate"><span class="pre">_generic.collision.html</span></code> file from Roundup source in the <code class="docutils literal notranslate"><span class="pre">templates/classic/html</span></code> directory. to your tracker’s <code class="docutils literal notranslate"><span class="pre">html</span></code> directory.</p> 
     </div> 
    </div> 
    <div class="section" id="migrating-from-0-6-x-to-0-6-3"> 
     <h2><a class="toc-backref" href="#id124">Migrating from 0.6.x to 0.6.3</a></h2> 
     <div class="section" id="id3"> 
      <h3><a class="toc-backref" href="#id125">0.6.3 Configuration</a></h3> 
      <p>You will need to copy the file:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">templates</span><span class="o">/</span><span class="n">classic</span><span class="o">/</span><span class="n">detectors</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
</pre>
       </div> 
      </div> 
      <p>to your tracker’s <code class="docutils literal notranslate"><span class="pre">detectors</span></code> directory, replacing the one already there. This fixes a couple of bugs in that file.</p> 
     </div> 
    </div> 
    <div class="section" id="migrating-from-0-5-to-0-6"> 
     <h2><a class="toc-backref" href="#id126">Migrating from 0.5 to 0.6</a></h2> 
     <div class="section" id="id4"> 
      <h3><a class="toc-backref" href="#id127">0.6.0 Configuration</a></h3> 
      <p>Introduced EMAIL_FROM_TAG config variable. This value is inserted into the From: line of nosy email. If the sending user is “Foo Bar”, the From: line is usually:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="s2">"Foo Bar"</span> <span class="o">&lt;</span><span class="n">issue_tracker</span><span class="nd">@tracker</span><span class="o">.</span><span class="n">example</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
      <p>the EMAIL_FROM_TAG goes inside the “Foo Bar” quotes like so:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="s2">"Foo Bar EMAIL_FROM_TAG"</span> <span class="o">&lt;</span><span class="n">issue_tracker</span><span class="nd">@tracker</span><span class="o">.</span><span class="n">example</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
      <p>I’ve altered the mechanism in the detectors __init__.py module so that it doesn’t cross-import detectors from other trackers (if you run more than one in a single roundup-server). This change means that you’ll need to copy the __init__.py from roundup/templates/classic/detectors/__init__.py to your &lt;tracker home&gt;/detectors/__init__.py. Don’t worry, the “classic” __init__ is a one-size-fits-all, so it’ll work even if you’ve added/removed detectors.</p> 
     </div> 
     <div class="section" id="templating-changes"> 
      <h3><a class="toc-backref" href="#id128">0.6.0 Templating changes</a></h3> 
      <p>The <code class="docutils literal notranslate"><span class="pre">user.item</span></code> template (in the tracker home “templates” directory) needs to have the following hidden variable added to its form (between the <code class="docutils literal notranslate"><span class="pre">&lt;form...&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;/form&gt;</span></code> tags:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">":template"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"item"</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
     </div> 
     <div class="section" id="form-handling-changes"> 
      <h3><a class="toc-backref" href="#id129">0.6.0 Form handling changes</a></h3> 
      <p>Roundup’s form handling capabilities have been significantly expanded. This should not affect users of 0.5 installations - but if you find you’re getting errors from form submissions, please ask for help on the Roundup users mailing list:</p> 
      <blockquote> 
       <div>
        <a class="reference external" href="https://sourceforge.net/projects/roundup/lists/roundup-users">https://sourceforge.net/projects/roundup/lists/roundup-users</a>
       </div>
      </blockquote> 
      <p>See the customisation doc section on <a class="reference external" href="customizing.html#form-values">Form Values</a> for documentation of the new form variables possible.</p> 
     </div> 
     <div class="section" id="multilingual-character-set-support"> 
      <h3><a class="toc-backref" href="#id130">0.6.0 Multilingual character set support</a></h3> 
      <p>Added internationalization support. This is done via encoding all data stored in roundup database to utf-8 (unicode encoding). To support utf-8 in web interface you should add the folowing line to your tracker’s html/page and html/_generic.help files inside &lt;head&gt; tag:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">meta</span> <span class="n">http</span><span class="o">-</span><span class="n">equiv</span><span class="o">=</span><span class="s2">"Content-Type"</span> <span class="n">content</span><span class="o">=</span><span class="s2">"text/html; charset=utf-8"</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
      <p>Since latin characters in utf-8 have the same codes as in ASCII table, this modification is optional for users who use only plain latin characters.</p> 
      <p>After this modification, you will be able to see and enter any world character via web interface. Data received via mail interface also converted to utf-8, however only new messages will be converted. If your roundup database contains some of non-ASCII characters in one of 8-bit encoding, they will not be visible in new unicode environment. Some of such data (e.g. user names, keywords, etc) can be edited by administrator, the others (e.g. messages’ contents) is not editable via web interface. Currently there is no tool for converting such data, the only solution is to close appropriate old issues and create new ones with the same content.</p> 
     </div> 
     <div class="section" id="user-timezone-support"> 
      <h3><a class="toc-backref" href="#id131">0.6.0 User timezone support</a></h3> 
      <p>From version 0.6.0 roundup supports displaying of Date data in user’ local timezone if he/she has provided timezone information. To make it possible some modification to tracker’s schema and HTML templates are required. First you must add string property ‘timezone’ to user class in dbinit.py like this:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"user"</span><span class="p">,</span>
                <span class="n">username</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>   <span class="n">password</span><span class="o">=</span><span class="n">Password</span><span class="p">(),</span>
                <span class="n">address</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>    <span class="n">realname</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">phone</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>      <span class="n">organisation</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">alternate_addresses</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">queries</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s1">'query'</span><span class="p">),</span> <span class="n">roles</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">timezone</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>
</pre>
       </div> 
      </div> 
      <p>And second - html interface. Add following lines to $TRACKER_HOME/html/user.item template:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Timezone</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"structure context/timezone/field"</span><span class="o">&gt;</span><span class="n">timezone</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
      <p>After that all users should be able to provide their timezone information. Timezone should be a positive or negative integer - offset from GMT.</p> 
      <p>After providing timezone, roundup will show all dates values, found in web and mail interfaces in local time. It will also accept any Date info in local time, convert and store it in GMT.</p> 
     </div> 
     <div class="section" id="search-page-structure"> 
      <h3><a class="toc-backref" href="#id132">0.6.0 Search page structure</a></h3> 
      <p>In order to accomodate query editing the search page has been restructured. If you want to provide your users with query editing, you should update your search page using the macros detailed in the customisation doc section <a class="reference external" href="customizing.html#searching-on-categories">Searching on categories</a>.</p> 
      <p>Also, the url field in the query class no longer starts with a ‘?’. You’ll need to remove this question mark from the url field to support queries. There’s a script in the “tools” directory called <code class="docutils literal notranslate"><span class="pre">migrate-queries.py</span></code> that should automatically change any existing queries for you. As always, make a backup of your database before running such a script.</p> 
     </div> 
     <div class="section" id="notes-for-metakit-backend-users"> 
      <h3><a class="toc-backref" href="#id133">0.6.0 Notes for metakit backend users</a></h3> 
      <p>Roundup 0.6.0 introduced searching on ranges of dates and intervals. To support it, some modifications to interval storing routine were made. So if your tracker uses metakit backend and your db schema contains intervals property, searches on that property will not be accurate for db items that was stored before roundup’ upgrade. However all new records should be searchable on intervals.</p> 
      <p>It is possible to convert your database to new format: you can export and import back all your data (consult “Migrating backends” in “Maintenance” documentation). After this operation all your interval properties should become searchable.</p> 
      <p>Users of backends others than metakit should not worry about this issue.</p> 
     </div> 
    </div> 
    <div class="section" id="migrating-from-0-4-x-to-0-5-0"> 
     <h2><a class="toc-backref" href="#id134">Migrating from 0.4.x to 0.5.0</a></h2> 
     <p>This has been a fairly major revision of Roundup:</p> 
     <ol class="arabic simple"> 
      <li>Brand new, much more powerful, flexible, tasty and nutritious templating. Unfortunately, this means all your current templates are useless. Hopefully the new documentation and examples will be enough to help you make the transition. Please don’t hesitate to ask on roundup-users for help (or complete conversions if you’re completely stuck)!</li> 
      <li>The database backed got a lot more flexible, allowing Metakit and SQL databases! The only decent SQL database implemented at present is sqlite, but others shouldn’t be a whole lot more work.</li> 
      <li>A brand new, highly flexible and much more robust security system including a system of Permissions, Roles and Role assignments to users. You may now define your own Permissions that may be checked in CGI transactions.</li> 
      <li>Journalling has been made less storage-hungry, so has been turned on by default <em>except</em> for author, recipient and nosy link/unlink events. You are advised to turn it off in your trackers too.</li> 
      <li>We’ve changed the terminology from “instance” to “tracker”, to ease the learning curve/impact for new users.</li> 
      <li>Because of the above changes, the tracker configuration has seen some major changes. See below for the details.</li> 
     </ol> 
     <p>Please, <strong>back up your database</strong> before you start the migration process. This is as simple as copying the “db” directory and all its contents from your tracker to somewhere safe.</p> 
     <div class="section" id="id7"> 
      <h3><a class="toc-backref" href="#id135">0.5.0 Configuration</a></h3> 
      <p>First up, rename your <code class="docutils literal notranslate"><span class="pre">instance_config.py</span></code> file to just <code class="docutils literal notranslate"><span class="pre">config.py</span></code>.</p> 
      <p>Then edit your tracker’s <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> module. It’ll currently look like this:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="kn">from</span> <span class="nn">instance_config</span> <span class="k">import</span> <span class="o">*</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">dbinit</span> <span class="k">import</span> <span class="o">*</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span> <span class="c1"># in installdir (probably :)</span>
<span class="kn">from</span> <span class="nn">interfaces</span> <span class="k">import</span> <span class="o">*</span>
</pre>
       </div> 
      </div> 
      <p>and it needs to be:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="kn">import</span> <span class="nn">config</span>
<span class="kn">from</span> <span class="nn">dbinit</span> <span class="k">import</span> <span class="nb">open</span><span class="p">,</span> <span class="n">init</span>
<span class="kn">from</span> <span class="nn">interfaces</span> <span class="k">import</span> <span class="n">Client</span><span class="p">,</span> <span class="n">MailGW</span>
</pre>
       </div> 
      </div> 
      <p>Due to the new templating having a top-level <code class="docutils literal notranslate"><span class="pre">page</span></code> that defines links for searching, indexes, adding items etc, the following variables are no longer used:</p> 
      <ul class="simple"> 
       <li>HEADER_INDEX_LINKS</li> 
       <li>HEADER_ADD_LINKS</li> 
       <li>HEADER_SEARCH_LINKS</li> 
       <li>SEARCH_FILTERS</li> 
       <li>DEFAULT_INDEX</li> 
       <li>UNASSIGNED_INDEX</li> 
       <li>USER_INDEX</li> 
       <li>ISSUE_FILTER</li> 
      </ul> 
      <p>The new security implementation will require additions to the dbinit module, but also removes the need for the following tracker config variables:</p> 
      <ul class="simple"> 
       <li>ANONYMOUS_ACCESS</li> 
       <li>ANONYMOUS_REGISTER</li> 
      </ul> 
      <p>but requires two new variables which define the Roles assigned to users who register through the web and e-mail interfaces:</p> 
      <ul class="simple"> 
       <li>NEW_WEB_USER_ROLES</li> 
       <li>NEW_EMAIL_USER_ROLES</li> 
      </ul> 
      <p>in both cases, ‘User’ is a good initial setting. To emulate <code class="docutils literal notranslate"><span class="pre">ANONYMOUS_ACCESS='deny'</span></code>, remove all “View” Permissions from the “Anonymous” Role. To emulate <code class="docutils literal notranslate"><span class="pre">ANONYMOUS_REGISTER='deny'</span></code>, remove the “Web Registration” and/or the “Email Registration” Permission from the “Anonymous” Role. See the section on customising security in the <a class="reference external" href="customizing.html">customisation documentation</a> for more information.</p> 
      <p>Finally, the following config variables have been renamed to make more sense:</p> 
      <ul class="simple"> 
       <li>INSTANCE_HOME -&gt; TRACKER_HOME</li> 
       <li>INSTANCE_NAME -&gt; TRACKER_NAME</li> 
       <li>ISSUE_TRACKER_WEB -&gt; TRACKER_WEB</li> 
       <li>ISSUE_TRACKER_EMAIL -&gt; TRACKER_EMAIL</li> 
      </ul> 
     </div> 
     <div class="section" id="schema-specification"> 
      <h3><a class="toc-backref" href="#id136">0.5.0 Schema Specification</a></h3> 
      <div class="section" id="database-backend-changes"> 
       <h4><a class="toc-backref" href="#id137">0.5.0 Database backend changes</a></h4> 
       <p>Your select_db module in your tracker has changed a fair bit. Where it used to contain:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="c1"># WARNING: DO NOT EDIT THIS FILE!!!</span>
<span class="kn">from</span> <span class="nn">roundup.backends.back_anydbm</span> <span class="k">import</span> <span class="n">Database</span>
</pre>
        </div> 
       </div> 
       <p>it must now contain:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="c1"># WARNING: DO NOT EDIT THIS FILE!!!</span>
<span class="kn">from</span> <span class="nn">roundup.backends.back_anydbm</span> <span class="k">import</span> <span class="n">Database</span><span class="p">,</span> <span class="n">Class</span><span class="p">,</span> <span class="n">FileClass</span><span class="p">,</span> <span class="n">IssueClass</span>
</pre>
        </div> 
       </div> 
       <p>Yes, I realise the irony of the “DO NOT EDIT THIS FILE” statement :) Note the addition of the Class, FileClass, IssueClass imports. These are very important, as they’re going to make the next change work too. You now need to modify the top of the dbinit module in your tracker from:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="kn">import</span> <span class="nn">instance_config</span>
<span class="kn">from</span> <span class="nn">roundup</span> <span class="k">import</span> <span class="n">roundupdb</span>
<span class="kn">from</span> <span class="nn">select_db</span> <span class="k">import</span> <span class="n">Database</span>

<span class="kn">from</span> <span class="nn">roundup.roundupdb</span> <span class="k">import</span> <span class="n">Class</span><span class="p">,</span> <span class="n">FileClass</span>

<span class="k">class</span> <span class="nc">Database</span><span class="p">(</span><span class="n">roundupdb</span><span class="o">.</span><span class="n">Database</span><span class="p">,</span> <span class="n">select_db</span><span class="o">.</span><span class="n">Database</span><span class="p">):</span>
    <span class="sd">''' Creates a hybrid database from:</span>
<span class="sd">         . the selected database back-end from select_db</span>
<span class="sd">         . the roundup extensions from roundupdb</span>
<span class="sd">    '''</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">IssueClass</span><span class="p">(</span><span class="n">roundupdb</span><span class="o">.</span><span class="n">IssueClass</span><span class="p">):</span>
    <span class="sd">''' issues need the email information</span>
<span class="sd">    '''</span>
    <span class="k">pass</span>
</pre>
        </div> 
       </div> 
       <p>to:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="kn">import</span> <span class="nn">config</span>
<span class="kn">from</span> <span class="nn">select_db</span> <span class="k">import</span> <span class="n">Database</span><span class="p">,</span> <span class="n">Class</span><span class="p">,</span> <span class="n">FileClass</span><span class="p">,</span> <span class="n">IssueClass</span>
</pre>
        </div> 
       </div> 
       <p>Yes, remove the Database and IssueClass definitions and those other imports. They’re not needed any more!</p> 
       <p>Look for places in dbinit.py where <code class="docutils literal notranslate"><span class="pre">instance_config</span></code> is used too, and rename them <code class="docutils literal notranslate"><span class="pre">config</span></code>.</p> 
      </div> 
      <div class="section" id="journalling-changes"> 
       <h4><a class="toc-backref" href="#id138">0.5.0 Journalling changes</a></h4> 
       <p>Journalling has been optimised for storage. Journalling of links has been turned back on by default. If your tracker has a large user base, you may wish to turn off journalling of nosy list, message author and message recipient link and unlink events. You do this by adding <code class="docutils literal notranslate"><span class="pre">do_journal='no'</span></code> to the Class initialisation in your dbinit. For example, your <em>msg</em> class initialisation probably looks like this:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">msg</span> <span class="o">=</span> <span class="n">FileClass</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"msg"</span><span class="p">,</span>
                <span class="n">author</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"user"</span><span class="p">),</span> <span class="n">recipients</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">"user"</span><span class="p">),</span>
                <span class="n">date</span><span class="o">=</span><span class="n">Date</span><span class="p">(),</span>         <span class="n">summary</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">files</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">"file"</span><span class="p">),</span>
                <span class="n">messageid</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>  <span class="n">inreplyto</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>
</pre>
        </div> 
       </div> 
       <p>to turn off journalling of author and recipient link events, add <code class="docutils literal notranslate"><span class="pre">do_journal='no'</span></code> to the <code class="docutils literal notranslate"><span class="pre">author=Link("user")</span></code> part of the statement, like so:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">msg</span> <span class="o">=</span> <span class="n">FileClass</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"msg"</span><span class="p">,</span>
                <span class="n">author</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"user"</span><span class="p">,</span> <span class="n">do_journal</span><span class="o">=</span><span class="s1">'no'</span><span class="p">),</span>
                <span class="n">recipients</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">"user"</span><span class="p">,</span> <span class="n">do_journal</span><span class="o">=</span><span class="s1">'no'</span><span class="p">),</span>
                <span class="n">date</span><span class="o">=</span><span class="n">Date</span><span class="p">(),</span>         <span class="n">summary</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">files</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">"file"</span><span class="p">),</span>
                <span class="n">messageid</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>  <span class="n">inreplyto</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>
</pre>
        </div> 
       </div> 
       <p>Nosy list link event journalling is actually turned off by default now. If you want to turn it on, change to your issue class’ nosy list, change its definition from:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">issue</span> <span class="o">=</span> <span class="n">IssueClass</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"issue"</span><span class="p">,</span>
                <span class="n">assignedto</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"user"</span><span class="p">),</span> <span class="n">topic</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">"keyword"</span><span class="p">),</span>
                <span class="n">priority</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"priority"</span><span class="p">),</span> <span class="n">status</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"status"</span><span class="p">))</span>
</pre>
        </div> 
       </div> 
       <p>to:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">issue</span> <span class="o">=</span> <span class="n">IssueClass</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"issue"</span><span class="p">,</span> <span class="n">nosy</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">"user"</span><span class="p">,</span> <span class="n">do_journal</span><span class="o">=</span><span class="s1">'yes'</span><span class="p">),</span>
                <span class="n">assignedto</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"user"</span><span class="p">),</span> <span class="n">topic</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">"keyword"</span><span class="p">),</span>
                <span class="n">priority</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"priority"</span><span class="p">),</span> <span class="n">status</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"status"</span><span class="p">))</span>
</pre>
        </div> 
       </div> 
       <p>noting that your definition of the nosy Multilink will override the normal one.</p> 
      </div> 
      <div class="section" id="user-schema-changes"> 
       <h4><a class="toc-backref" href="#id139">0.5.0 User schema changes</a></h4> 
       <p>Users have two more properties, “queries” and “roles”. You’ll have something like this in your dbinit module now:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"user"</span><span class="p">,</span>
                <span class="n">username</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>   <span class="n">password</span><span class="o">=</span><span class="n">Password</span><span class="p">(),</span>
                <span class="n">address</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>    <span class="n">realname</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">phone</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>      <span class="n">organisation</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">alternate_addresses</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>
<span class="n">user</span><span class="o">.</span><span class="n">setkey</span><span class="p">(</span><span class="s2">"username"</span><span class="p">)</span>
</pre>
        </div> 
       </div> 
       <p>and you’ll need to add the new properties and the new “query” class to it like so:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"query"</span><span class="p">,</span>
                <span class="n">klass</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>     <span class="n">name</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">url</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>
<span class="n">query</span><span class="o">.</span><span class="n">setkey</span><span class="p">(</span><span class="s2">"name"</span><span class="p">)</span>

<span class="c1"># Note: roles is a comma-separated string of Role names</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"user"</span><span class="p">,</span>
                <span class="n">username</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>   <span class="n">password</span><span class="o">=</span><span class="n">Password</span><span class="p">(),</span>
                <span class="n">address</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>    <span class="n">realname</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">phone</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>      <span class="n">organisation</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">alternate_addresses</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">queries</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s1">'query'</span><span class="p">),</span> <span class="n">roles</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>
<span class="n">user</span><span class="o">.</span><span class="n">setkey</span><span class="p">(</span><span class="s2">"username"</span><span class="p">)</span>
</pre>
        </div> 
       </div> 
       <p>The “queries” property is used to store off the user’s favourite database queries. The “roles” property is explained below in <a class="reference internal" href="#security-settings">0.5.0 Security Settings</a>.</p> 
      </div> 
      <div class="section" id="security-settings"> 
       <h4><a class="toc-backref" href="#id140">0.5.0 Security Settings</a></h4> 
       <p>See the <a class="reference external" href="security.html">security documentation</a> for an explanation of how the new security system works. In a nutshell though, the security is handled as a four step process:</p> 
       <ol class="arabic simple"> 
        <li>Permissions are defined as having a name and optionally a hyperdb class they’re specific to,</li> 
        <li>Roles are defined that have one or more Permissions,</li> 
        <li>Users are assigned Roles in their “roles” property, and finally</li> 
        <li>Roundup checks that users have appropriate Permissions at appropriate times (like editing issues).</li> 
       </ol> 
       <p>Your tracker dbinit module’s <em>open</em> function now has to define any Permissions that are specific to your tracker, and also the assignment of Permissions to Roles. At the moment, your open function ends with:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="kn">import</span> <span class="nn">detectors</span>
<span class="n">detectors</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

<span class="k">return</span> <span class="n">db</span>
</pre>
        </div> 
       </div> 
       <p>and what we need to do is insert some commands that will set up the security parameters. Right above the <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">detectors</span></code> line, you’ll want to insert these lines:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="c1">#</span>
<span class="c1"># SECURITY SETTINGS</span>
<span class="c1">#</span>
<span class="c1"># new permissions for this schema</span>
<span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="s1">'issue'</span><span class="p">,</span> <span class="s1">'file'</span><span class="p">,</span> <span class="s1">'msg'</span><span class="p">,</span> <span class="s1">'user'</span><span class="p">:</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Edit"</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="n">cl</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">"User is allowed to edit "</span><span class="o">+</span><span class="n">cl</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"View"</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="n">cl</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">"User is allowed to access "</span><span class="o">+</span><span class="n">cl</span><span class="p">)</span>

<span class="c1"># Assign the access and edit permissions for issue, file and message</span>
<span class="c1"># to regular users now</span>
<span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="s1">'issue'</span><span class="p">,</span> <span class="s1">'file'</span><span class="p">,</span> <span class="s1">'msg'</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">'View'</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">'Edit'</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="c1"># and give the regular users access to the web and email interface</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">'Web Access'</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">'Email Access'</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

<span class="c1"># May users view other user information? Comment these lines out</span>
<span class="c1"># if you don't want them to</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">'View'</span><span class="p">,</span> <span class="s1">'user'</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

<span class="c1"># Assign the appropriate permissions to the anonymous user's Anonymous</span>
<span class="c1"># Role. Choices here are:</span>
<span class="c1"># - Allow anonymous users to register through the web</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">'Web Registration'</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'Anonymous'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="c1"># - Allow anonymous (new) users to register through the email gateway</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">'Email Registration'</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'Anonymous'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="c1"># - Allow anonymous users access to the "issue" class of data</span>
<span class="c1">#   Note: this also grants access to related information like files,</span>
<span class="c1">#         messages, statuses etc that are linked to issues</span>
<span class="c1">#p = db.security.getPermission('View', 'issue')</span>
<span class="c1">#db.security.addPermissionToRole('Anonymous', p)</span>
<span class="c1"># - Allow anonymous users access to edit the "issue" class of data</span>
<span class="c1">#   Note: this also grants access to create related information like</span>
<span class="c1">#         files and messages etc that are linked to issues</span>
<span class="c1">#p = db.security.getPermission('Edit', 'issue')</span>
<span class="c1">#db.security.addPermissionToRole('Anonymous', p)</span>

<span class="c1"># oh, g'wan, let anonymous access the web interface too</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">'Web Access'</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'Anonymous'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre>
        </div> 
       </div> 
       <p>Note in the comments there the places where you might change the permissions to restrict users or grant users more access. If you’ve created additional classes that users should be able to edit and view, then you should add them to the “new permissions for this schema” section at the start of the security block. Then add them to the “Assign the access and edit permissions” section too, so people actually have the new Permission you’ve created.</p> 
       <p>One final change is needed that finishes off the security system’s initialisation. We need to add a call to <code class="docutils literal notranslate"><span class="pre">db.post_init()</span></code> at the end of the dbinit open() function. Add it like this:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="kn">import</span> <span class="nn">detectors</span>
<span class="n">detectors</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

<span class="c1"># schema is set up - run any post-initialisation</span>
<span class="n">db</span><span class="o">.</span><span class="n">post_init</span><span class="p">()</span>
<span class="k">return</span> <span class="n">db</span>
</pre>
        </div> 
       </div> 
       <p>You may verify the setup of Permissions and Roles using the new “<code class="docutils literal notranslate"><span class="pre">roundup-admin</span> <span class="pre">security</span></code>” command.</p> 
      </div> 
      <div class="section" id="user-changes"> 
       <h4><a class="toc-backref" href="#id141">0.5.0 User changes</a></h4> 
       <p>To support all those schema changes, you’ll need to massage your user database a little too, to:</p> 
       <ol class="arabic simple"> 
        <li>make sure there’s an “anonymous” user - this user is mandatory now and is the one that unknown users are logged in as.</li> 
        <li>make sure all users have at least one Role.</li> 
       </ol> 
       <p>If you don’t have the “anonymous” user, create it now with the command:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">roundup</span><span class="o">-</span><span class="n">admin</span> <span class="n">create</span> <span class="n">user</span> <span class="n">username</span><span class="o">=</span><span class="n">anonymous</span> <span class="n">roles</span><span class="o">=</span><span class="n">Anonymous</span>
</pre>
        </div> 
       </div> 
       <p>making sure the capitalisation is the same as above. Once you’ve done that, you’ll need to set the roles property on all users to a reasonable default. The admin user should get “Admin”, the anonymous user “Anonymous” and all other users “User”. The <code class="docutils literal notranslate"><span class="pre">fixroles.py</span></code> script in the tools directory will do this. Run it like so (where python is your python 2+ binary):</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">python</span> <span class="n">tools</span><span class="o">/</span><span class="n">fixroles</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">tracker</span> <span class="n">home</span><span class="o">&gt;</span> <span class="n">fixroles</span>
</pre>
        </div> 
       </div> 
      </div> 
     </div> 
     <div class="section" id="cgi-interface-changes"> 
      <h3><a class="toc-backref" href="#id142">0.5.0 CGI interface changes</a></h3> 
      <p>The CGI interface code was completely reorganised and largely rewritten. The end result is that this section of your tracker interfaces module will need changing from:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="kn">from</span> <span class="nn">roundup</span> <span class="k">import</span> <span class="n">cgi_client</span><span class="p">,</span> <span class="n">mailgw</span>
<span class="kn">from</span> <span class="nn">roundup.i18n</span> <span class="k">import</span> <span class="n">_</span>

<span class="k">class</span> <span class="nc">Client</span><span class="p">(</span><span class="n">cgi_client</span><span class="o">.</span><span class="n">Client</span><span class="p">):</span>
    <span class="sd">''' derives basic CGI implementation from the standard module,</span>
<span class="sd">        with any specific extensions</span>
<span class="sd">    '''</span>
    <span class="k">pass</span>
</pre>
       </div> 
      </div> 
      <p>to:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="kn">from</span> <span class="nn">roundup</span> <span class="k">import</span> <span class="n">mailgw</span>
<span class="kn">from</span> <span class="nn">roundup.cgi</span> <span class="k">import</span> <span class="n">client</span>

<span class="k">class</span> <span class="nc">Client</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">Client</span><span class="p">):</span>
    <span class="sd">''' derives basic CGI implementation from the standard module,</span>
<span class="sd">        with any specific extensions</span>
<span class="sd">    '''</span>
    <span class="k">pass</span>
</pre>
       </div> 
      </div> 
      <p>You will also need to install the new version of roundup.cgi from the source cgi-bin directory if you’re using it.</p> 
     </div> 
     <div class="section" id="html-templating"> 
      <h3><a class="toc-backref" href="#id143">0.5.0 HTML templating</a></h3> 
      <p>You’ll want to make a backup of your current tracker html directory. You should then copy the html directory from the Roundup source “classic” template and modify it according to your local schema changes.</p> 
      <p>If you need help with the new templating system, please ask questions on the roundup-users mailing list (available through the roundup web page on sourceforge, <a class="reference external" href="https://www.roundup-tracker.org/">https://www.roundup-tracker.org/</a>.</p> 
     </div> 
     <div class="section" id="detectors"> 
      <h3><a class="toc-backref" href="#id144">0.5.0 Detectors</a></h3> 
      <p>The nosy reactor has been updated to handle the tracker not having an “assignedto” property on issues. You may want to copy it into your tracker’s detectors directory. Chances are you’ve already fixed it though :)</p> 
     </div> 
    </div> 
    <div class="section" id="migrating-from-0-4-1-to-0-4-2"> 
     <h2><a class="toc-backref" href="#id145">Migrating from 0.4.1 to 0.4.2</a></h2> 
     <div class="section" id="id8"> 
      <h3><a class="toc-backref" href="#id146">0.4.2 Configuration</a></h3> 
      <p>The USER_INDEX definition introduced in 0.4.1 was too restrictive in its allowing replacement of ‘assignedto’ with the user’s userid. Users must change the None value of ‘assignedto’ to ‘CURRENT USER’ (the string, in quotes) for the replacement behaviour to occur now.</p> 
      <p>The new configuration variables are:</p> 
      <ul class="simple"> 
       <li>EMAIL_KEEP_QUOTED_TEXT</li> 
       <li>EMAIL_LEAVE_BODY_UNCHANGED</li> 
       <li>ADD_RECIPIENTS_TO_NOSY</li> 
      </ul> 
      <p>See the sample configuration files in:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">classic</span><span class="o">/</span><span class="n">instance_config</span><span class="o">.</span><span class="n">py</span>
</pre>
       </div> 
      </div> 
      <p>and:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">extended</span><span class="o">/</span><span class="n">instance_config</span><span class="o">.</span><span class="n">py</span>
</pre>
       </div> 
      </div> 
      <p>and the <a class="reference external" href="customizing.html">customisation documentation</a> for information on how they’re used.</p> 
     </div> 
     <div class="section" id="changes-to-detectors"> 
      <h3><a class="toc-backref" href="#id147">0.4.2 Changes to detectors</a></h3> 
      <p>You will need to copy the detectors from the distribution into your instance home “detectors” directory. If you used the classic schema, the detectors are in:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">classic</span><span class="o">/</span><span class="n">detectors</span><span class="o">/</span>
</pre>
       </div> 
      </div> 
      <p>If you used the extended schema, the detectors are in:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">extended</span><span class="o">/</span><span class="n">detectors</span><span class="o">/</span>
</pre>
       </div> 
      </div> 
      <p>The change means that schema-specific code has been removed from the mail gateway and cgi interface and made into auditors:</p> 
      <ul class="simple"> 
       <li>nosyreactor.py has now got an updatenosy auditor which updates the nosy list with author, recipient and assignedto information.</li> 
       <li>statusauditor.py makes the unread or resolved -&gt; chatting changes and presets the status of an issue to unread.</li> 
      </ul> 
      <p>There’s also a bug or two fixed in the nosyreactor code.</p> 
     </div> 
     <div class="section" id="html-templating-changes"> 
      <h3><a class="toc-backref" href="#id148">0.4.2 HTML templating changes</a></h3> 
      <p>The link() htmltemplate function now has a “showid” option for links and multilinks. When true, it only displays the linked item id as the anchor text. The link value is displayed as a tooltip using the title anchor attribute. To use in eg. the superseder field, have something like this:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">display</span> <span class="n">call</span><span class="o">=</span><span class="s2">"field('superseder', showid=1)"</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">display</span> <span class="n">call</span><span class="o">=</span><span class="s2">"classhelp('issue', 'id,title', label='list', width=500)"</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="nb">property</span> <span class="n">name</span><span class="o">=</span><span class="s2">"superseder"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span><span class="n">View</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">display</span> <span class="n">call</span><span class="o">=</span><span class="s2">"link('superseder', showid=1)"</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="nb">property</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
      <p>The stylesheets have been cleaned up too. You may want to use the newer versions in:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/&lt;</span><span class="n">template</span><span class="o">&gt;/</span><span class="n">html</span><span class="o">/</span><span class="n">default</span><span class="o">.</span><span class="n">css</span>
</pre>
       </div> 
      </div> 
     </div> 
    </div> 
    <div class="section" id="migrating-from-0-4-0-to-0-4-1"> 
     <h2><a class="toc-backref" href="#id149">Migrating from 0.4.0 to 0.4.1</a></h2> 
     <div class="section" id="files-storage"> 
      <h3><a class="toc-backref" href="#id150">0.4.1 Files storage</a></h3> 
      <p>Messages and files from newly created issues will be put into subdierectories in thousands e.g. msg123 will be put into files/msg/0/msg123, file2003 will go into files/file/2/file2003. Previous messages are still found, but could be put into this structure.</p> 
     </div> 
     <div class="section" id="id9"> 
      <h3><a class="toc-backref" href="#id151">0.4.1 Configuration</a></h3> 
      <p>To allow more fine-grained access control, the variable used to check permission to auto-register users in the mail gateway is now called ANONYMOUS_REGISTER_MAIL rather than overloading ANONYMOUS_REGISTER. If the variable doesn’t exist, then ANONYMOUS_REGISTER is tested as before.</p> 
      <p>Configuring the links in the web header is now easier too. The following variables have been added to the classic instance_config.py:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">HEADER_INDEX_LINKS</span>   <span class="o">-</span> <span class="n">defines</span> <span class="n">the</span> <span class="s2">"index"</span> <span class="n">links</span> <span class="n">to</span> <span class="n">be</span> <span class="n">made</span> <span class="n">available</span>
<span class="n">HEADER_ADD_LINKS</span>     <span class="o">-</span> <span class="n">defines</span> <span class="n">the</span> <span class="s2">"add"</span> <span class="n">links</span>
<span class="n">DEFAULT_INDEX</span>        <span class="o">-</span> <span class="n">specifies</span> <span class="n">the</span> <span class="n">index</span> <span class="n">view</span> <span class="k">for</span> <span class="n">DEFAULT</span>
<span class="n">UNASSIGNED_INDEX</span>     <span class="o">-</span> <span class="n">specifies</span> <span class="n">the</span> <span class="n">index</span> <span class="n">view</span> <span class="k">for</span> <span class="n">UNASSIGNED</span>
<span class="n">USER_INDEX</span>           <span class="o">-</span> <span class="n">specifies</span> <span class="n">the</span> <span class="n">index</span> <span class="n">view</span> <span class="k">for</span> <span class="n">USER</span>
</pre>
       </div> 
      </div> 
      <p>See the &lt;roundup source&gt;/roundup/templates/classic/instance_config.py for more information - including how the variables are to be set up. Most users will just be able to copy the variables from the source to their instance home. If you’ve modified the header by changing the source of the interfaces.py file in the instance home, you’ll need to remove that customisation and move it into the appropriate variables in instance_config.py.</p> 
      <p>The extended schema has similar variables added too - see the source for more info.</p> 
     </div> 
     <div class="section" id="alternate-e-mail-addresses"> 
      <h3><a class="toc-backref" href="#id152">0.4.1 Alternate E-Mail Addresses</a></h3> 
      <p>If you add the property “alternate_addresses” to your user class, your users will be able to register alternate email addresses that they may use to communicate with roundup as. All email from roundup will continue to be sent to their primary address.</p> 
      <p>If you have not edited the dbinit.py file in your instance home directory, you may simply copy the new dbinit.py file from the core code. If you used the classic schema, the interfaces file is in:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">classic</span><span class="o">/</span><span class="n">dbinit</span><span class="o">.</span><span class="n">py</span>
</pre>
       </div> 
      </div> 
      <p>If you used the extended schema, the file is in:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">extended</span><span class="o">/</span><span class="n">dbinit</span><span class="o">.</span><span class="n">py</span>
</pre>
       </div> 
      </div> 
      <p>If you have modified your dbinit.py file, you need to edit the dbinit.py file in your instance home directory. Find the lines which define the user class:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"msg"</span><span class="p">,</span>
                <span class="n">username</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>   <span class="n">password</span><span class="o">=</span><span class="n">Password</span><span class="p">(),</span>
                <span class="n">address</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>    <span class="n">realname</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">phone</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>      <span class="n">organisation</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">alternate_addresses</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>
</pre>
       </div> 
      </div> 
      <p>You will also want to add the property to the user’s details page. The template for this is the “user.item” file in your instance home “html” directory. Similar to above, you may copy the file from the roundup source if you haven’t modified it. Otherwise, add the following to the template:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">display</span> <span class="n">call</span><span class="o">=</span><span class="s2">"multiline('alternate_addresses')"</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
      <p>with appropriate labelling etc. See the standard template for an idea.</p> 
     </div> 
    </div> 
    <div class="section" id="migrating-from-0-3-x-to-0-4-0"> 
     <h2><a class="toc-backref" href="#id153">Migrating from 0.3.x to 0.4.0</a></h2> 
     <div class="section" id="message-id-and-in-reply-to-addition"> 
      <h3><a class="toc-backref" href="#id154">0.4.0 Message-ID and In-Reply-To addition</a></h3> 
      <p>0.4.0 adds the tracking of messages by message-id and allows threading using in-reply-to. Most e-mail clients support threading using this feature, and we hope to add support for it to the web gateway. If you have not edited the dbinit.py file in your instance home directory, you may simply copy the new dbinit.py file from the core code. If you used the classic schema, the interfaces file is in:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">classic</span><span class="o">/</span><span class="n">dbinit</span><span class="o">.</span><span class="n">py</span>
</pre>
       </div> 
      </div> 
      <p>If you used the extended schema, the file is in:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">extended</span><span class="o">/</span><span class="n">dbinit</span><span class="o">.</span><span class="n">py</span>
</pre>
       </div> 
      </div> 
      <p>If you have modified your dbinit.py file, you need to edit the dbinit.py file in your instance home directory. Find the lines which define the msg class:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">msg</span> <span class="o">=</span> <span class="n">FileClass</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"msg"</span><span class="p">,</span>
                <span class="n">author</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"user"</span><span class="p">),</span> <span class="n">recipients</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">"user"</span><span class="p">),</span>
                <span class="n">date</span><span class="o">=</span><span class="n">Date</span><span class="p">(),</span>         <span class="n">summary</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">files</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">"file"</span><span class="p">))</span>
</pre>
       </div> 
      </div> 
      <p>and add the messageid and inreplyto properties like so:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">msg</span> <span class="o">=</span> <span class="n">FileClass</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"msg"</span><span class="p">,</span>
                <span class="n">author</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"user"</span><span class="p">),</span> <span class="n">recipients</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">"user"</span><span class="p">),</span>
                <span class="n">date</span><span class="o">=</span><span class="n">Date</span><span class="p">(),</span>         <span class="n">summary</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">files</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">"file"</span><span class="p">),</span>
                <span class="n">messageid</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>  <span class="n">inreplyto</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>
</pre>
       </div> 
      </div> 
      <p>Also, configuration is being cleaned up. This means that your dbinit.py will also need to be changed in the open function. If you haven’t changed your dbinit.py, the above copy will be enough. If you have, you’ll need to change the line (round line 50):</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">db</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span><span class="n">instance_config</span><span class="o">.</span><span class="n">DATABASE</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>to:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">db</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span><span class="n">instance_config</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
     </div> 
     <div class="section" id="id10"> 
      <h3><a class="toc-backref" href="#id155">0.4.0 Configuration</a></h3> 
      <p><code class="docutils literal notranslate"><span class="pre">TRACKER_NAME</span></code> and <code class="docutils literal notranslate"><span class="pre">EMAIL_SIGNATURE_POSITION</span></code> have been added to the instance_config.py. The simplest solution is to copy the default values from template in the core source.</p> 
      <p>The mail gateway now checks <code class="docutils literal notranslate"><span class="pre">ANONYMOUS_REGISTER</span></code> to see if unknown users are to be automatically registered with the tracker. If it is set to “deny” then unknown users will not have access. If it is set to “allow” they will be automatically registered with the tracker.</p> 
     </div> 
     <div class="section" id="cgi-script-roundup-cgi"> 
      <h3><a class="toc-backref" href="#id156">0.4.0 CGI script roundup.cgi</a></h3> 
      <p>The CGI script has been updated with some features and a bugfix, so you should copy it from the roundup cgi-bin source directory again. Make sure you update the ROUNDUP_INSTANCE_HOMES after the copy.</p> 
     </div> 
     <div class="section" id="nosy-reactor"> 
      <h3><a class="toc-backref" href="#id157">0.4.0 Nosy reactor</a></h3> 
      <p>The nosy reactor has also changed - copy the nosyreactor.py file from the core source:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/&lt;</span><span class="n">template</span><span class="o">&gt;/</span><span class="n">detectors</span><span class="o">/</span><span class="n">nosyreactor</span><span class="o">.</span><span class="n">py</span>
</pre>
       </div> 
      </div> 
      <p>to your instance home “detectors” directory.</p> 
     </div> 
     <div class="section" id="id11"> 
      <h3><a class="toc-backref" href="#id158">0.4.0 HTML templating</a></h3> 
      <p>The field() function was incorrectly implemented - links and multilinks now display as text fields when rendered using field(). To display a menu (drop- down or select box) you need to use the menu() function.</p> 
     </div> 
    </div> 
    <div class="section" id="migrating-from-0-2-x-to-0-3-x"> 
     <h2><a class="toc-backref" href="#id159">Migrating from 0.2.x to 0.3.x</a></h2> 
     <div class="section" id="x-cookie-authentication-changes"> 
      <h3><a class="toc-backref" href="#id160">0.3.x Cookie Authentication changes</a></h3> 
      <p>0.3.0 introduces cookie authentication - you will need to copy the interfaces.py file from the roundup source to your instance home to enable authentication. If you used the classic schema, the interfaces file is in:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">classic</span><span class="o">/</span><span class="n">interfaces</span><span class="o">.</span><span class="n">py</span>
</pre>
       </div> 
      </div> 
      <p>If you used the extended schema, the file is in:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">extended</span><span class="o">/</span><span class="n">interfaces</span><span class="o">.</span><span class="n">py</span>
</pre>
       </div> 
      </div> 
      <p>If you have modified your interfaces.Client class, you will need to take note of the login/logout functionality provided in roundup.cgi_client.Client (classic schema) or roundup.cgi_client.ExtendedClient (extended schema) and modify your instance code apropriately.</p> 
     </div> 
     <div class="section" id="x-password-encoding"> 
      <h3><a class="toc-backref" href="#id161">0.3.x Password encoding</a></h3> 
      <p>This release also introduces encoding of passwords in the database. If you have not edited the dbinit.py file in your instance home directory, you may simply copy the new dbinit.py file from the core code. If you used the classic schema, the interfaces file is in:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">classic</span><span class="o">/</span><span class="n">dbinit</span><span class="o">.</span><span class="n">py</span>
</pre>
       </div> 
      </div> 
      <p>If you used the extended schema, the file is in:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">extended</span><span class="o">/</span><span class="n">dbinit</span><span class="o">.</span><span class="n">py</span>
</pre>
       </div> 
      </div> 
      <p>If you have modified your dbinit.py file, you may use encoded passwords:</p> 
      <ol class="arabic"> 
       <li><p class="first">Edit the dbinit.py file in your instance home directory a. At the first code line of the open() function:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span> <span class="kn">from</span> <span class="nn">roundup.hyperdb</span> <span class="k">import</span> <span class="n">String</span><span class="p">,</span> <span class="n">Date</span><span class="p">,</span> <span class="n">Link</span><span class="p">,</span> <span class="n">Multilink</span>

<span class="n">alter</span> <span class="n">to</span> <span class="n">include</span> <span class="n">Password</span><span class="p">,</span> <span class="k">as</span> <span class="n">so</span><span class="p">::</span>

 <span class="kn">from</span> <span class="nn">roundup.hyperdb</span> <span class="k">import</span> <span class="n">String</span><span class="p">,</span> <span class="n">Password</span><span class="p">,</span> <span class="n">Date</span><span class="p">,</span> <span class="n">Link</span><span class="p">,</span> <span class="n">Multilink</span>
</pre>
         </div> 
        </div> 
        <ol class="loweralpha" start="2"> 
         <li><p class="first">Where the password property is defined (around line 66):</p> 
          <div class="highlight-default notranslate">
           <div class="highlight">
            <pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"user"</span><span class="p">,</span>
                <span class="n">username</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>   <span class="n">password</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">address</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>    <span class="n">realname</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">phone</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>      <span class="n">organisation</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>
<span class="n">user</span><span class="o">.</span><span class="n">setkey</span><span class="p">(</span><span class="s2">"username"</span><span class="p">)</span>
</pre>
           </div> 
          </div> <p>alter the “password=String()” to “password=Password()”:</p> 
          <div class="highlight-default notranslate">
           <div class="highlight">
            <pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"user"</span><span class="p">,</span>
                <span class="n">username</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>   <span class="n">password</span><span class="o">=</span><span class="n">Password</span><span class="p">(),</span>
                <span class="n">address</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>    <span class="n">realname</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">phone</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>      <span class="n">organisation</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>
<span class="n">user</span><span class="o">.</span><span class="n">setkey</span><span class="p">(</span><span class="s2">"username"</span><span class="p">)</span>
</pre>
           </div> 
          </div> </li> 
        </ol> </li> 
       <li><p class="first">Any existing passwords in the database will remain cleartext until they are edited. It is recommended that at a minimum the admin password be changed immediately:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="n">roundup</span><span class="o">-</span><span class="n">admin</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">instance</span> <span class="n">home</span><span class="o">&gt;</span> <span class="nb">set</span> <span class="n">user1</span> <span class="n">password</span><span class="o">=&lt;</span><span class="n">new</span> <span class="n">password</span><span class="o">&gt;</span>
</pre>
         </div> 
        </div> </li> 
      </ol> 
     </div> 
     <div class="section" id="x-configuration"> 
      <h3><a class="toc-backref" href="#id162">0.3.x Configuration</a></h3> 
      <p>FILTER_POSITION, ANONYMOUS_ACCESS, ANONYMOUS_REGISTER have been added to the instance_config.py. Simplest solution is to copy the default values from template in the core source.</p> 
      <p>MESSAGES_TO_AUTHOR has been added to the IssueClass in dbinit.py. Set to ‘yes’ to send nosy messages to the author. Default behaviour is to not send nosy messages to the author. You will need to add MESSAGES_TO_AUTHOR to your dbinit.py in your instance home.</p> 
     </div> 
     <div class="section" id="x-cgi-script-roundup-cgi"> 
      <h3><a class="toc-backref" href="#id163">0.3.x CGI script roundup.cgi</a></h3> 
      <p>There have been some structural changes to the roundup.cgi script - you will need to install it again from the cgi-bin directory of the source distribution. Make sure you update the ROUNDUP_INSTANCE_HOMES after the copy.</p> 
     </div> 
    </div> 
   </div> 
  </div> 
  <div class="footer"> 
   <div> <span class="source">[<a href="../_sources/docs/upgrading.txt" rel="nofollow">page source</a>]</span> © Copyright 2009-2021, Richard Jones, Roundup-Team. 
   </div> 
   <div>
     Last updated on May 09, 2022. <span>Hosted by <a href="https://sourceforge.net"><img src="https://sflogo.sourceforge.net/sflogo.php?group_id=31577&amp;type=1" width="88" height="31" border="0" alt="SourceForge.net Logo"></a></span> 
   </div> 
  </div> 
  <script>
      /* locally hosted goatcounter https://www.goatcounter.com/ */
      /* include site info in path url to allow multiple sites to be
      tracked together */
      window.goatcounter = {
      path: function(p) { return location.host + p }
      }
    </script> 
  <script data-goatcounter="https://stats.rouilj.dynamic-dns.net/count" integrity="sha384-QGgNMMRFTi8ul5kHJ+vXysPe8gySvSA/Y3rpXZiRLzKPIw8CWY+a3ObKmQsyDr+a" async src="/_static/goatcounter_count.v3.js">
    </script>  
 </body>
</html>