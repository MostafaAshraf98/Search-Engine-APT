<!doctype html><!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]--><!--[if gt IE 8]><!-->
<html class="no-js" lang="en"> <!--<![endif]--> 
 <head> 
  <meta charset="utf-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>Authentication and security — Tornado 6.1 documentation</title> 
  <link rel="shortcut icon" href="../_static/favicon.ico"> 
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script> 
  <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script> 
  <script type="text/javascript" src="../_static/jquery.js"></script> 
  <script type="text/javascript" src="../_static/underscore.js"></script> 
  <script type="text/javascript" src="../_static/doctools.js"></script> 
  <script type="text/javascript" src="../_static/language_data.js"></script> 
  <script async type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-doc-embed.js"></script> 
  <script type="text/javascript" src="../_static/js/theme.js"></script> 
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css"> 
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css"> 
  <link rel="index" title="Index" href="../genindex.html"> 
  <link rel="search" title="Search" href="../search.html"> 
  <link rel="next" title="Running and deploying" href="running.html"> 
  <link rel="prev" title="Templates and UI" href="templates.html"> <!-- RTD Extra Head --> <!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
--> 
  <link rel="canonical" href="https://www.tornadoweb.org/en/stable/guide/security.html"> 
  <link rel="stylesheet" href="https://assets.readthedocs.org/static/css/readthedocs-doc-embed.css" type="text/css"> 
  <script type="application/json" id="READTHEDOCS_DATA">{"ad_free": true, "api_host": "https://readthedocs.org", "build_date": "2020-10-31T00:02:57Z", "builder": "sphinx", "canonical_url": "https://www.tornadoweb.org/en/stable/", "commit": "2047e7ae", "docroot": "/docs/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "guide/security", "programming_language": "py", "project": "tornado", "proxied_api_host": "/_", "source_suffix": ".rst", "subprojects": {}, "theme": "sphinx_rtd_theme", "user_analytics_code": "UA-39143969-1", "version": "stable"}</script> <!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
--> 
  <script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script> 
  <script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-analytics.js" async></script> <!-- end RTD <extrahead> --> 
 </head> 
 <body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav"> 
   <nav data-toggle="wy-nav-shift" class="wy-nav-side"> 
    <div class="wy-side-scroll"> 
     <div class="wy-side-nav-search"> <a href="../index.html" class="icon icon-home"> Tornado </a> 
      <div class="version">
        stable 
      </div> 
      <div role="search"> 
       <form id="rtd-search-form" class="wy-form" action="../search.html" method="get"> 
        <input type="text" name="q" placeholder="Search docs"> 
        <input type="hidden" name="check_keywords" value="yes"> 
        <input type="hidden" name="area" value="default"> 
       </form> 
      </div> 
     </div> 
     <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation"> 
      <ul class="current"> 
       <li class="toctree-l1 current"><a class="reference internal" href="../guide.html">User’s guide</a>
        <ul class="current"> 
         <li class="toctree-l2"><a class="reference internal" href="intro.html">Introduction</a></li> 
         <li class="toctree-l2"><a class="reference internal" href="async.html">Asynchronous and non-Blocking I/O</a></li> 
         <li class="toctree-l2"><a class="reference internal" href="coroutines.html">Coroutines</a></li> 
         <li class="toctree-l2"><a class="reference internal" href="queues.html"><code class="docutils literal notranslate"><span class="pre">Queue</span></code> example - a concurrent web spider</a></li> 
         <li class="toctree-l2"><a class="reference internal" href="structure.html">Structure of a Tornado web application</a></li> 
         <li class="toctree-l2"><a class="reference internal" href="templates.html">Templates and UI</a></li> 
         <li class="toctree-l2 current"><a class="current reference internal" href="#">Authentication and security</a></li> 
         <li class="toctree-l2"><a class="reference internal" href="running.html">Running and deploying</a></li> 
        </ul> </li> 
       <li class="toctree-l1"><a class="reference internal" href="../webframework.html">Web framework</a></li> 
       <li class="toctree-l1"><a class="reference internal" href="../http.html">HTTP servers and clients</a></li> 
       <li class="toctree-l1"><a class="reference internal" href="../networking.html">Asynchronous networking</a></li> 
       <li class="toctree-l1"><a class="reference internal" href="../coroutine.html">Coroutines and concurrency</a></li> 
       <li class="toctree-l1"><a class="reference internal" href="../integration.html">Integration with other services</a></li> 
       <li class="toctree-l1"><a class="reference internal" href="../utilities.html">Utilities</a></li> 
       <li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li> 
       <li class="toctree-l1"><a class="reference internal" href="../releases.html">Release notes</a></li> 
      </ul> 
     </div> 
    </div> 
   </nav> 
   <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"> 
    <nav class="wy-nav-top" aria-label="top navigation"> <i data-toggle="wy-nav-top" class="fa fa-bars"></i> <a href="../index.html">Tornado</a> 
    </nav> 
    <div class="wy-nav-content"> 
     <div class="rst-content"> 
      <div role="navigation" aria-label="breadcrumbs navigation"> 
       <ul class="wy-breadcrumbs"> 
        <li><a href="../index.html">Docs</a> »</li> 
        <li><a href="../guide.html">User’s guide</a> »</li> 
        <li>Authentication and security</li> 
        <li class="wy-breadcrumbs-aside"> <a href="https://github.com/tornadoweb/tornado/blob/stable/docs/guide/security.rst" class="fa fa-github"> Edit on GitHub</a> </li> 
       </ul> 
       <hr> 
      </div> 
      <div role="main" class="document" itemscope itemtype="http://schema.org/Article"> 
       <div itemprop="articleBody"> 
        <div class="section" id="authentication-and-security"> 
         <h1>Authentication and security<a class="headerlink" href="#authentication-and-security" title="Permalink to this headline">¶</a></h1> 
         <div class="section" id="cookies-and-secure-cookies"> 
          <h2>Cookies and secure cookies<a class="headerlink" href="#cookies-and-secure-cookies" title="Permalink to this headline">¶</a></h2> 
          <p>You can set cookies in the user’s browser with the <code class="docutils literal notranslate"><span class="pre">set_cookie</span></code> method:</p> 
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="k">class</span> <span class="nc">MainHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cookie</span><span class="p">(</span><span class="s2">"mycookie"</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="s2">"mycookie"</span><span class="p">,</span> <span class="s2">"myvalue"</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"Your cookie was not set yet!"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"Your cookie was set!"</span><span class="p">)</span>
</pre>
           </div> 
          </div> 
          <p>Cookies are not secure and can easily be modified by clients. If you need to set cookies to, e.g., identify the currently logged in user, you need to sign your cookies to prevent forgery. Tornado supports signed cookies with the <a class="reference internal" href="../web.html#tornado.web.RequestHandler.set_secure_cookie" title="tornado.web.RequestHandler.set_secure_cookie"><code class="xref py py-obj docutils literal notranslate"><span class="pre">set_secure_cookie</span></code></a> and <a class="reference internal" href="../web.html#tornado.web.RequestHandler.get_secure_cookie" title="tornado.web.RequestHandler.get_secure_cookie"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_secure_cookie</span></code></a> methods. To use these methods, you need to specify a secret key named <code class="docutils literal notranslate"><span class="pre">cookie_secret</span></code> when you create your application. You can pass in application settings as keyword arguments to your application:</p> 
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="n">application</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">([</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">"/"</span><span class="p">,</span> <span class="n">MainHandler</span><span class="p">),</span>
<span class="p">],</span> <span class="n">cookie_secret</span><span class="o">=</span><span class="s2">"__TODO:_GENERATE_YOUR_OWN_RANDOM_VALUE_HERE__"</span><span class="p">)</span>
</pre>
           </div> 
          </div> 
          <p>Signed cookies contain the encoded value of the cookie in addition to a timestamp and an <a class="reference external" href="http://en.wikipedia.org/wiki/HMAC">HMAC</a> signature. If the cookie is old or if the signature doesn’t match, <code class="docutils literal notranslate"><span class="pre">get_secure_cookie</span></code> will return <code class="docutils literal notranslate"><span class="pre">None</span></code> just as if the cookie isn’t set. The secure version of the example above:</p> 
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="k">class</span> <span class="nc">MainHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_secure_cookie</span><span class="p">(</span><span class="s2">"mycookie"</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_secure_cookie</span><span class="p">(</span><span class="s2">"mycookie"</span><span class="p">,</span> <span class="s2">"myvalue"</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"Your cookie was not set yet!"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"Your cookie was set!"</span><span class="p">)</span>
</pre>
           </div> 
          </div> 
          <p>Tornado’s secure cookies guarantee integrity but not confidentiality. That is, the cookie cannot be modified but its contents can be seen by the user. The <code class="docutils literal notranslate"><span class="pre">cookie_secret</span></code> is a symmetric key and must be kept secret – anyone who obtains the value of this key could produce their own signed cookies.</p> 
          <p>By default, Tornado’s secure cookies expire after 30 days. To change this, use the <code class="docutils literal notranslate"><span class="pre">expires_days</span></code> keyword argument to <code class="docutils literal notranslate"><span class="pre">set_secure_cookie</span></code> <em>and</em> the <code class="docutils literal notranslate"><span class="pre">max_age_days</span></code> argument to <code class="docutils literal notranslate"><span class="pre">get_secure_cookie</span></code>. These two values are passed separately so that you may e.g. have a cookie that is valid for 30 days for most purposes, but for certain sensitive actions (such as changing billing information) you use a smaller <code class="docutils literal notranslate"><span class="pre">max_age_days</span></code> when reading the cookie.</p> 
          <p>Tornado also supports multiple signing keys to enable signing key rotation. <code class="docutils literal notranslate"><span class="pre">cookie_secret</span></code> then must be a dict with integer key versions as keys and the corresponding secrets as values. The currently used signing key must then be set as <code class="docutils literal notranslate"><span class="pre">key_version</span></code> application setting but all other keys in the dict are allowed for cookie signature validation, if the correct key version is set in the cookie. To implement cookie updates, the current signing key version can be queried via <a class="reference internal" href="../web.html#tornado.web.RequestHandler.get_secure_cookie_key_version" title="tornado.web.RequestHandler.get_secure_cookie_key_version"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_secure_cookie_key_version</span></code></a>.</p> 
         </div> 
         <div class="section" id="user-authentication"> <span id="id1"></span>
          <h2>User authentication<a class="headerlink" href="#user-authentication" title="Permalink to this headline">¶</a></h2> 
          <p>The currently authenticated user is available in every request handler as <a class="reference internal" href="../web.html#tornado.web.RequestHandler.current_user" title="tornado.web.RequestHandler.current_user"><code class="xref py py-obj docutils literal notranslate"><span class="pre">self.current_user</span></code></a>, and in every template as <code class="docutils literal notranslate"><span class="pre">current_user</span></code>. By default, <code class="docutils literal notranslate"><span class="pre">current_user</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p> 
          <p>To implement user authentication in your application, you need to override the <code class="docutils literal notranslate"><span class="pre">get_current_user()</span></code> method in your request handlers to determine the current user based on, e.g., the value of a cookie. Here is an example that lets users log into the application simply by specifying a nickname, which is then saved in a cookie:</p> 
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="k">class</span> <span class="nc">BaseHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_current_user</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_secure_cookie</span><span class="p">(</span><span class="s2">"user"</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">MainHandler</span><span class="p">(</span><span class="n">BaseHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_user</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="s2">"/login"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">escape</span><span class="o">.</span><span class="n">xhtml_escape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_user</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"Hello, "</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">LoginHandler</span><span class="p">(</span><span class="n">BaseHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'&lt;html&gt;&lt;body&gt;&lt;form action="/login" method="post"&gt;'</span>
                   <span class="s1">'Name: &lt;input type="text" name="name"&gt;'</span>
                   <span class="s1">'&lt;input type="submit" value="Sign in"&gt;'</span>
                   <span class="s1">'&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_secure_cookie</span><span class="p">(</span><span class="s2">"user"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_argument</span><span class="p">(</span><span class="s2">"name"</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>

<span class="n">application</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">([</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">"/"</span><span class="p">,</span> <span class="n">MainHandler</span><span class="p">),</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">"/login"</span><span class="p">,</span> <span class="n">LoginHandler</span><span class="p">),</span>
<span class="p">],</span> <span class="n">cookie_secret</span><span class="o">=</span><span class="s2">"__TODO:_GENERATE_YOUR_OWN_RANDOM_VALUE_HERE__"</span><span class="p">)</span>
</pre>
           </div> 
          </div> 
          <p>You can require that the user be logged in using the <a class="reference external" href="http://www.python.org/dev/peps/pep-0318/">Python decorator</a> <a class="reference internal" href="../web.html#tornado.web.authenticated" title="tornado.web.authenticated"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tornado.web.authenticated</span></code></a>. If a request goes to a method with this decorator, and the user is not logged in, they will be redirected to <code class="docutils literal notranslate"><span class="pre">login_url</span></code> (another application setting). The example above could be rewritten:</p> 
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="k">class</span> <span class="nc">MainHandler</span><span class="p">(</span><span class="n">BaseHandler</span><span class="p">):</span>
    <span class="nd">@tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">authenticated</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">escape</span><span class="o">.</span><span class="n">xhtml_escape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_user</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"Hello, "</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>

<span class="n">settings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"cookie_secret"</span><span class="p">:</span> <span class="s2">"__TODO:_GENERATE_YOUR_OWN_RANDOM_VALUE_HERE__"</span><span class="p">,</span>
    <span class="s2">"login_url"</span><span class="p">:</span> <span class="s2">"/login"</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">application</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">([</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">"/"</span><span class="p">,</span> <span class="n">MainHandler</span><span class="p">),</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">"/login"</span><span class="p">,</span> <span class="n">LoginHandler</span><span class="p">),</span>
<span class="p">],</span> <span class="o">**</span><span class="n">settings</span><span class="p">)</span>
</pre>
           </div> 
          </div> 
          <p>If you decorate <code class="docutils literal notranslate"><span class="pre">post()</span></code> methods with the <code class="docutils literal notranslate"><span class="pre">authenticated</span></code> decorator, and the user is not logged in, the server will send a <code class="docutils literal notranslate"><span class="pre">403</span></code> response. The <code class="docutils literal notranslate"><span class="pre">@authenticated</span></code> decorator is simply shorthand for <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">not</span> <span class="pre">self.current_user:</span> <span class="pre">self.redirect()</span></code> and may not be appropriate for non-browser-based login schemes.</p> 
          <p>Check out the <a class="reference external" href="https://github.com/tornadoweb/tornado/tree/stable/demos/blog">Tornado Blog example application</a> for a complete example that uses authentication (and stores user data in a PostgreSQL database).</p> 
         </div> 
         <div class="section" id="third-party-authentication"> 
          <h2>Third party authentication<a class="headerlink" href="#third-party-authentication" title="Permalink to this headline">¶</a></h2> 
          <p>The <a class="reference internal" href="../auth.html#module-tornado.auth" title="tornado.auth"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tornado.auth</span></code></a> module implements the authentication and authorization protocols for a number of the most popular sites on the web, including Google/Gmail, Facebook, Twitter, and FriendFeed. The module includes methods to log users in via these sites and, where applicable, methods to authorize access to the service so you can, e.g., download a user’s address book or publish a Twitter message on their behalf.</p> 
          <p>Here is an example handler that uses Google for authentication, saving the Google credentials in a cookie for later access:</p> 
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="k">class</span> <span class="nc">GoogleOAuth2LoginHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">,</span>
                               <span class="n">tornado</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">GoogleOAuth2Mixin</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_argument</span><span class="p">(</span><span class="s1">'code'</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">user</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_authenticated_user</span><span class="p">(</span>
                <span class="n">redirect_uri</span><span class="o">=</span><span class="s1">'http://your.site.com/auth/google'</span><span class="p">,</span>
                <span class="n">code</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_argument</span><span class="p">(</span><span class="s1">'code'</span><span class="p">))</span>
            <span class="c1"># Save the user with e.g. set_secure_cookie</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">authorize_redirect</span><span class="p">(</span>
                <span class="n">redirect_uri</span><span class="o">=</span><span class="s1">'http://your.site.com/auth/google'</span><span class="p">,</span>
                <span class="n">client_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'google_oauth'</span><span class="p">][</span><span class="s1">'key'</span><span class="p">],</span>
                <span class="n">scope</span><span class="o">=</span><span class="p">[</span><span class="s1">'profile'</span><span class="p">,</span> <span class="s1">'email'</span><span class="p">],</span>
                <span class="n">response_type</span><span class="o">=</span><span class="s1">'code'</span><span class="p">,</span>
                <span class="n">extra_params</span><span class="o">=</span><span class="p">{</span><span class="s1">'approval_prompt'</span><span class="p">:</span> <span class="s1">'auto'</span><span class="p">})</span>
</pre>
           </div> 
          </div> 
          <p>See the <a class="reference internal" href="../auth.html#module-tornado.auth" title="tornado.auth"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tornado.auth</span></code></a> module documentation for more details.</p> 
         </div> 
         <div class="section" id="cross-site-request-forgery-protection"> <span id="xsrf"></span>
          <h2>Cross-site request forgery protection<a class="headerlink" href="#cross-site-request-forgery-protection" title="Permalink to this headline">¶</a></h2> 
          <p><a class="reference external" href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">Cross-site request forgery</a>, or XSRF, is a common problem for personalized web applications. See the <a class="reference external" href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">Wikipedia article</a> for more information on how XSRF works.</p> 
          <p>The generally accepted solution to prevent XSRF is to cookie every user with an unpredictable value and include that value as an additional argument with every form submission on your site. If the cookie and the value in the form submission do not match, then the request is likely forged.</p> 
          <p>Tornado comes with built-in XSRF protection. To include it in your site, include the application setting <code class="docutils literal notranslate"><span class="pre">xsrf_cookies</span></code>:</p> 
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="n">settings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"cookie_secret"</span><span class="p">:</span> <span class="s2">"__TODO:_GENERATE_YOUR_OWN_RANDOM_VALUE_HERE__"</span><span class="p">,</span>
    <span class="s2">"login_url"</span><span class="p">:</span> <span class="s2">"/login"</span><span class="p">,</span>
    <span class="s2">"xsrf_cookies"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">application</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">([</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">"/"</span><span class="p">,</span> <span class="n">MainHandler</span><span class="p">),</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">"/login"</span><span class="p">,</span> <span class="n">LoginHandler</span><span class="p">),</span>
<span class="p">],</span> <span class="o">**</span><span class="n">settings</span><span class="p">)</span>
</pre>
           </div> 
          </div> 
          <p>If <code class="docutils literal notranslate"><span class="pre">xsrf_cookies</span></code> is set, the Tornado web application will set the <code class="docutils literal notranslate"><span class="pre">_xsrf</span></code> cookie for all users and reject all <code class="docutils literal notranslate"><span class="pre">POST</span></code>, <code class="docutils literal notranslate"><span class="pre">PUT</span></code>, and <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> requests that do not contain a correct <code class="docutils literal notranslate"><span class="pre">_xsrf</span></code> value. If you turn this setting on, you need to instrument all forms that submit via <code class="docutils literal notranslate"><span class="pre">POST</span></code> to contain this field. You can do this with the special <a class="reference internal" href="../web.html#tornado.web.UIModule" title="tornado.web.UIModule"><code class="xref py py-obj docutils literal notranslate"><span class="pre">UIModule</span></code></a> <code class="docutils literal notranslate"><span class="pre">xsrf_form_html()</span></code>, available in all templates:</p> 
          <div class="highlight-default notranslate">
           <div class="highlight">
            <pre><span></span><span class="o">&lt;</span><span class="n">form</span> <span class="n">action</span><span class="o">=</span><span class="s2">"/new_message"</span> <span class="n">method</span><span class="o">=</span><span class="s2">"post"</span><span class="o">&gt;</span>
  <span class="p">{</span><span class="o">%</span> <span class="n">module</span> <span class="n">xsrf_form_html</span><span class="p">()</span> <span class="o">%</span><span class="p">}</span>
  <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"text"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"message"</span><span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"submit"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"Post"</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</pre>
           </div> 
          </div> 
          <p>If you submit AJAX <code class="docutils literal notranslate"><span class="pre">POST</span></code> requests, you will also need to instrument your JavaScript to include the <code class="docutils literal notranslate"><span class="pre">_xsrf</span></code> value with each request. This is the <a class="reference external" href="http://jquery.com/">jQuery</a> function we use at FriendFeed for AJAX <code class="docutils literal notranslate"><span class="pre">POST</span></code> requests that automatically adds the <code class="docutils literal notranslate"><span class="pre">_xsrf</span></code> value to all requests:</p> 
          <div class="highlight-default notranslate">
           <div class="highlight">
            <pre><span></span>function getCookie(name) {
    var r = document.cookie.match("\\b" + name + "=([^;]*)\\b");
    return r ? r[1] : undefined;
}

jQuery.postJSON = function(url, args, callback) {
    args._xsrf = getCookie("_xsrf");
    $.ajax({url: url, data: $.param(args), dataType: "text", type: "POST",
        success: function(response) {
        callback(eval("(" + response + ")"));
    }});
};
</pre>
           </div> 
          </div> 
          <p>For <code class="docutils literal notranslate"><span class="pre">PUT</span></code> and <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> requests (as well as <code class="docutils literal notranslate"><span class="pre">POST</span></code> requests that do not use form-encoded arguments), the XSRF token may also be passed via an HTTP header named <code class="docutils literal notranslate"><span class="pre">X-XSRFToken</span></code>. The XSRF cookie is normally set when <code class="docutils literal notranslate"><span class="pre">xsrf_form_html</span></code> is used, but in a pure-JavaScript application that does not use any regular forms you may need to access <code class="docutils literal notranslate"><span class="pre">self.xsrf_token</span></code> manually (just reading the property is enough to set the cookie as a side effect).</p> 
          <p>If you need to customize XSRF behavior on a per-handler basis, you can override <a class="reference internal" href="../web.html#tornado.web.RequestHandler.check_xsrf_cookie" title="tornado.web.RequestHandler.check_xsrf_cookie"><code class="xref py py-obj docutils literal notranslate"><span class="pre">RequestHandler.check_xsrf_cookie()</span></code></a>. For example, if you have an API whose authentication does not use cookies, you may want to disable XSRF protection by making <code class="docutils literal notranslate"><span class="pre">check_xsrf_cookie()</span></code> do nothing. However, if you support both cookie and non-cookie-based authentication, it is important that XSRF protection be used whenever the current request is authenticated with a cookie.</p> 
         </div> 
         <div class="section" id="dns-rebinding"> <span id="dnsrebinding"></span>
          <h2>DNS Rebinding<a class="headerlink" href="#dns-rebinding" title="Permalink to this headline">¶</a></h2> 
          <p><a class="reference external" href="https://en.wikipedia.org/wiki/DNS_rebinding">DNS rebinding</a> is an attack that can bypass the same-origin policy and allow external sites to access resources on private networks. This attack involves a DNS name (with a short TTL) that alternates between returning an IP address controlled by the attacker and one controlled by the victim (often a guessable private IP address such as <code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code> or <code class="docutils literal notranslate"><span class="pre">192.168.1.1</span></code>).</p> 
          <p>Applications that use TLS are <em>not</em> vulnerable to this attack (because the browser will display certificate mismatch warnings that block automated access to the target site).</p> 
          <p>Applications that cannot use TLS and rely on network-level access controls (for example, assuming that a server on <code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code> can only be accessed by the local machine) should guard against DNS rebinding by validating the <code class="docutils literal notranslate"><span class="pre">Host</span></code> HTTP header. This means passing a restrictive hostname pattern to either a <a class="reference internal" href="../routing.html#tornado.routing.HostMatches" title="tornado.routing.HostMatches"><code class="xref py py-obj docutils literal notranslate"><span class="pre">HostMatches</span></code></a> router or the first argument of <a class="reference internal" href="../web.html#tornado.web.Application.add_handlers" title="tornado.web.Application.add_handlers"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Application.add_handlers</span></code></a>:</p> 
          <div class="highlight-default notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1"># BAD: uses a default host pattern of r'.*'</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Application</span><span class="p">([(</span><span class="s1">'/foo'</span><span class="p">,</span> <span class="n">FooHandler</span><span class="p">)])</span>

<span class="c1"># GOOD: only matches localhost or its ip address.</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Application</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_handlers</span><span class="p">(</span><span class="sa">r</span><span class="s1">'(localhost|127\.0\.0\.1)'</span><span class="p">,</span>
                 <span class="p">[(</span><span class="s1">'/foo'</span><span class="p">,</span> <span class="n">FooHandler</span><span class="p">)])</span>

<span class="c1"># GOOD: same as previous example using tornado.routing.</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Application</span><span class="p">([</span>
    <span class="p">(</span><span class="n">HostMatches</span><span class="p">(</span><span class="sa">r</span><span class="s1">'(localhost|127\.0\.0\.1)'</span><span class="p">),</span>
        <span class="p">[(</span><span class="s1">'/foo'</span><span class="p">,</span> <span class="n">FooHandler</span><span class="p">)]),</span>
    <span class="p">])</span>
</pre>
           </div> 
          </div> 
          <p>In addition, the <code class="docutils literal notranslate"><span class="pre">default_host</span></code> argument to <a class="reference internal" href="../web.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Application</span></code></a> and the <a class="reference internal" href="../routing.html#tornado.routing.DefaultHostMatches" title="tornado.routing.DefaultHostMatches"><code class="xref py py-obj docutils literal notranslate"><span class="pre">DefaultHostMatches</span></code></a> router must not be used in applications that may be vulnerable to DNS rebinding, because it has a similar effect to a wildcard host pattern.</p> 
         </div> 
        </div> 
       </div> 
      </div> 
      <footer> 
       <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation"> <a href="running.html" class="btn btn-neutral float-right" title="Running and deploying" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a> <a href="templates.html" class="btn btn-neutral float-left" title="Templates and UI" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a> 
       </div> 
       <hr> 
       <div role="contentinfo"> 
        <p> © Copyright The Tornado Authors <span class="commit"> Revision <code>2047e7ae</code>. </span> </p> 
       </div> Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 
      </footer> 
     </div> 
    </div> 
   </section> 
  </div> 
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions"> <span class="rst-current-version" data-toggle="rst-current-version"> <span class="fa fa-book"> Read the Docs</span> v: stable <span class="fa fa-caret-down"></span> </span> 
   <div class="rst-other-versions"> 
    <dl> 
     <dt>
      Versions
     </dt> 
     <dd>
      <a href="/en/latest/">latest</a>
     </dd> 
     <dd>
      <a href="/en/stable/">stable</a>
     </dd> 
     <dd>
      <a href="/en/branch6.0/">branch6.0</a>
     </dd> 
     <dd>
      <a href="/en/branch5.1/">branch5.1</a>
     </dd> 
     <dd>
      <a href="/en/branch4.5/">branch4.5</a>
     </dd> 
    </dl> 
    <dl> 
     <dt>
      Downloads
     </dt> 
     <dd>
      <a href="//www.tornadoweb.org/_/downloads/en/stable/pdf/">pdf</a>
     </dd> 
     <dd>
      <a href="//www.tornadoweb.org/_/downloads/en/stable/htmlzip/">html</a>
     </dd> 
     <dd>
      <a href="//www.tornadoweb.org/_/downloads/en/stable/epub/">epub</a>
     </dd> 
    </dl> 
    <dl> 
     <dt>
      On Read the Docs
     </dt> 
     <dd> <a href="//readthedocs.org/projects/tornado/?fromdocs=tornado">Project Home</a> 
     </dd> 
     <dd> <a href="//readthedocs.org/builds/tornado/?fromdocs=tornado">Builds</a> 
     </dd> 
    </dl> 
    <hr> Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>. 
   </div> 
  </div> 
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  
 </body>
</html>