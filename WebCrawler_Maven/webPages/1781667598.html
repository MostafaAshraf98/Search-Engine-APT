<!doctype html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"> 
 <head> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1"> 
  <meta name="Description" content="Documentation on the Roundup issue tracker, version 2.1.0."> 
  <meta content="Documentation on the RESTful interface to the Roundup Issue Tracker." language="en" name="description"> 
  <title>REST API for Roundup - Roundup 2.1.0 documentation</title> 
  <link rel="stylesheet" href="../_static/style.css" type="text/css"> 
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css"> 
  <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '../',
          VERSION:     '2.1.0',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script> 
  <script type="text/javascript" src="../_static/jquery.js"></script> 
  <script type="text/javascript" src="../_static/underscore.js"></script> 
  <script type="text/javascript" src="../_static/doctools.js"></script> 
  <script type="text/javascript" src="../_static/language_data.js"></script> 
  <link rel="canonical" href="https://www.roundup-tracker.org/docs/rest.html"> 
  <link rel="index" title="Index" href="../genindex.html"> 
  <link rel="search" title="Search" href="../search.html"> 
  <link rel="top" title="Roundup 2.1.0 documentation" href="../index.html"> 
  <link rel="up" title="Docs" href="../docs.html"> 
  <link rel="next" title="Roundup Tracker Templates" href="tracker_templates.html"> 
  <link rel="prev" title="XML-RPC access to Roundup" href="xmlrpc.html"> 
 </head> 
 <body> 
  <div class="header">
   <h1>Roundup</h1> 
   <div id="searchbox" style="display: none"> 
    <form class="search" action="../search.html" method="get"> 
     <input type="text" aria-label="Enter search terms" name="q" size="18"> 
     <input type="submit" value="Search"> 
     <input type="hidden" name="check_keywords" value="yes"> 
     <input type="hidden" name="area" value="default"> 
    </form> 
   </div> 
   <script type="text/javascript">$('#searchbox').show(0);</script> 
  </div> 
  <div class="navigation"> 
   <div class="menu"> 
    <ul class="current"> 
     <li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li> 
     <li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/roundup/">Download</a></li> 
     <li class="toctree-l1 current"><a class="reference internal" href="../docs.html">Docs</a>
      <ul class="current"> 
       <li class="toctree-l2"><a class="reference internal" href="features.html">Roundup Features</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="installation.html">Installing Roundup</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="upgrading.html">Upgrading to newer versions of Roundup</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="FAQ.html">Roundup FAQ</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="user_guide.html">User Guide</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="customizing.html">Customising Roundup</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="admin_guide.html">Administration Guide</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="debugging.html">Debugging Aids</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="xmlrpc.html">XML-RPC access to Roundup</a></li> 
       <li class="toctree-l2 current"><a class="current reference internal" href="#">REST API for Roundup</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="tracker_templates.html">Roundup Tracker Templates</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="glossary.html">Roundup Glossary</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="acknowledgements.html">Acknowledgements</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="license.html">License</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="overview.html">Design Overview</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="design.html">Design (original)</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="developers.html">Developing Roundup</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="mysql.html">Notes about the MySQL Database backend</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="postgresql.html">Notes about the PostgreSQL Database backend</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="implementation.html">Richard Jones implementation notes</a></li> 
      </ul> </li> 
     <li class="toctree-l1"><a class="reference external" href="https://issues.roundup-tracker.org">Issues</a></li> 
     <li class="toctree-l1"><a class="reference internal" href="../contact.html">Contact</a></li> 
     <li class="toctree-l1"><a class="reference external" href="https://wiki.roundup-tracker.org">Wiki</a></li> 
     <li class="toctree-l1"><a class="reference internal" href="../code.html">Code</a></li> 
    </ul> 
   </div> 
  </div> 
  <div class="content"> 
   <div id="subnav"> <a title="XML-RPC access to Roundup" href="xmlrpc.html"> Prev</a> <a title="Roundup Tracker Templates" href="tracker_templates.html"> Next</a> <a title="Index" href="../genindex.html"> Index</a> 
   </div> 
   <div class="section" id="rest-api-for-roundup"> <span id="index-0"></span>
    <h1>REST API for Roundup</h1> 
    <div class="contents local topic" id="contents"> 
     <ul class="simple"> 
      <li><a class="reference internal" href="#introduction" id="id6">Introduction</a></li> 
      <li><a class="reference internal" href="#enabling-the-rest-api" id="id7">Enabling the REST API</a>
       <ul> 
        <li><a class="reference internal" href="#preventing-csrf-attacks" id="id8">Preventing CSRF Attacks</a></li> 
        <li><a class="reference internal" href="#rate-limiting-the-api" id="id9">Rate Limiting the API</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#client-api" id="id10">Client API</a>
       <ul> 
        <li><a class="reference internal" href="#headers" id="id11">Headers</a></li> 
        <li><a class="reference internal" href="#hyperdb-stats" id="id12">Hyperdb Stats</a></li> 
        <li><a class="reference internal" href="#versioning" id="id13">Versioning</a></li> 
        <li><a class="reference internal" href="#input-formats" id="id14">Input Formats</a></li> 
        <li><a class="reference internal" href="#response-formats" id="id15">Response Formats</a></li> 
        <li><a class="reference internal" href="#general-guidelines" id="id16">General Guidelines</a></li> 
        <li><a class="reference internal" href="#special-endpoints" id="id17">Special Endpoints</a>
         <ul> 
          <li><a class="reference internal" href="#summary" id="id18">/summary</a></li> 
          <li><a class="reference internal" href="#data" id="id19">/data</a></li> 
         </ul> </li> 
        <li><a class="reference internal" href="#data-class-collection" id="id20">/data/<em>class</em> Collection</a>
         <ul> 
          <li><a class="reference internal" href="#searching" id="id21">Searching</a></li> 
          <li><a class="reference internal" href="#sorting" id="id22">Sorting</a></li> 
          <li><a class="reference internal" href="#pagination" id="id23">Pagination</a></li> 
          <li><a class="reference internal" href="#field-embedding-and-verbose-output" id="id24">Field embedding and verbose output</a></li> 
          <li><a class="reference internal" href="#getting-message-and-files-content" id="id25">Getting Message and Files Content</a></li> 
          <li><a class="reference internal" href="#other-query-params" id="id26">Other query params</a></li> 
          <li><a class="reference internal" href="#using-the-post-method" id="id27">Using the POST method</a></li> 
          <li><a class="reference internal" href="#safely-re-sending-post" id="id28">Safely Re-sending POST</a></li> 
          <li><a class="reference internal" href="#other-supported-methods-for-collections" id="id29">Other Supported Methods for Collections</a></li> 
         </ul> </li> 
        <li><a class="reference internal" href="#data-class-id-item" id="id30">/data/<em>class</em>/<em>id</em> item</a>
         <ul> 
          <li><a class="reference internal" href="#retrieve-item-using-key-value" id="id31">Retrieve item using key value</a></li> 
          <li><a class="reference internal" href="#dealing-with-messages-and-files" id="id32">Dealing with Messages and Files</a></li> 
          <li><a class="reference internal" href="#other-supported-methods-for-items" id="id33">Other Supported Methods for Items</a></li> 
         </ul> </li> 
        <li><a class="reference internal" href="#data-class-id-property-field" id="id34">/data/<em>class</em>/<em>id</em>/<em>property</em> field</a>
         <ul> 
          <li><a class="reference internal" href="#message-and-file-content" id="id35">Message and File Content</a></li> 
          <li><a class="reference internal" href="#other-supported-methods-for-fields" id="id36">Other Supported Methods for fields</a></li> 
         </ul> </li> 
        <li><a class="reference internal" href="#tunneling-methods-via-post" id="id37">Tunneling Methods via POST</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#examples-and-use-cases" id="id38">Examples and Use Cases</a>
       <ul> 
        <li><a class="reference internal" href="#sample-python-client" id="id39">sample python client</a></li> 
        <li><a class="reference internal" href="#searches-and-selection" id="id40">Searches and selection</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#programming-the-rest-api" id="id41">Programming the REST API</a>
       <ul> 
        <li><a class="reference internal" href="#adding-new-rest-endpoints" id="id42">Adding new rest endpoints</a></li> 
        <li><a class="reference internal" href="#redefine-move-rest-endpoints" id="id43">Redefine/move rest endpoints</a></li> 
        <li><a class="reference internal" href="#controlling-access-to-backend-data" id="id44">Controlling Access to Backend Data</a>
         <ul> 
          <li><a class="reference internal" href="#changing-access-roles-with-json-web-tokens" id="id45">Changing Access Roles with JSON Web Tokens</a></li> 
          <li><a class="reference internal" href="#final-steps" id="id46">Final steps</a></li> 
         </ul> </li> 
        <li><a class="reference internal" href="#creating-custom-rate-limits" id="id47">Creating Custom Rate Limits</a>
         <ul> 
          <li><a class="reference internal" href="#test-examples" id="id48">Test Examples</a></li> 
         </ul> </li> 
       </ul> </li> 
     </ul> 
    </div> 
    <div class="section" id="introduction"> 
     <h2><a class="toc-backref" href="#id6">Introduction</a></h2> 
     <p>After the last 1.6.0 Release, a REST-API developed in 2015 during a Google Summer of Code (GSOC) by Chau Nguyen, supervised by Ezio Melotti was integrated. The code was updated by Ralf Schlatterbeck and John Rouillard to fix some shortcomings and provide the necessary functions for a single page web application, e.g. etag support, pagination, field embedding among others.</p> 
    </div> 
    <div class="section" id="enabling-the-rest-api"> 
     <h2><a class="toc-backref" href="#id7">Enabling the REST API</a></h2> 
     <p>The REST API can be disabled in the <code class="docutils literal notranslate"><span class="pre">[web]</span></code> section of <code class="docutils literal notranslate"><span class="pre">config.ini</span></code> via the variable <code class="docutils literal notranslate"><span class="pre">enable_rest</span></code> which is <code class="docutils literal notranslate"><span class="pre">yes</span></code> by default.</p> 
     <p>Users have to be authorized to use the rest api. The user must have “Rest Access” permission. To add this to the “User” role change schema.py to add:</p> 
     <div class="highlight-default notranslate">
      <div class="highlight">
       <pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="s1">'Rest Access'</span><span class="p">)</span>
</pre>
      </div> 
     </div> 
     <p>This is usually included near where other permissions like “Web Access” or “Email Access” are assigned.</p> 
     <p>You could also create a new role “rest” and assign the “Rest Access” permission to that role and then just add the “rest” role to those users who should have access.</p> 
     <p>The REST api is reached via the <code class="docutils literal notranslate"><span class="pre">/rest/</span></code> endpoint of the tracker URL. Partial URLs paths below (not starting with https) will have /rest removed for brevity.</p> 
     <p>Make sure that the <code class="docutils literal notranslate"><span class="pre">secret_key</span></code> option is defined in the <code class="docutils literal notranslate"><span class="pre">[web]</span></code> section of your tracker’s <code class="docutils literal notranslate"><span class="pre">config.ini</span></code>. Following the <a class="reference external" href="upgrading.html">upgrading directions</a> using <code class="docutils literal notranslate"><span class="pre">roundup-admin</span> <span class="pre">...</span> <span class="pre">updateconfig</span> <span class="pre">...</span></code> will generate the <code class="docutils literal notranslate"><span class="pre">secret_key</span></code> comments and setting. Then you can merge this into your <code class="docutils literal notranslate"><span class="pre">config.ini</span></code>. If you are installing a new tracker with <code class="docutils literal notranslate"><span class="pre">roundup-admin</span> <span class="pre">...</span> <span class="pre">install</span></code> the <code class="docutils literal notranslate"><span class="pre">secret_key</span></code> value is automatically set to some random value.</p> 
     <p>If <code class="docutils literal notranslate"><span class="pre">secret_key</span></code> is not set, the etag value returned by a REST call will changed on every call even though the item has not changed. This means users will be unable to submit changes using the rest interface. (Note, if you run roundup in a persistent mode: server, wsgi, mod_python, the etag will change on every restart if not explicitly set.)</p> 
     <div class="section" id="preventing-csrf-attacks"> 
      <h3><a class="toc-backref" href="#id8">Preventing CSRF Attacks</a></h3> 
      <p>Clients should set the header X-REQUESTED-WITH to any value and the tracker’s config.ini should have <code class="docutils literal notranslate"><span class="pre">csrf_enforce_header_x-requested-with</span> <span class="pre">=</span> <span class="pre">yes</span></code> or <code class="docutils literal notranslate"><span class="pre">required</span></code>.</p> 
     </div> 
     <div class="section" id="rate-limiting-the-api"> 
      <h3><a class="toc-backref" href="#id9">Rate Limiting the API</a></h3> 
      <p>This is a work in progress. This version of roundup includes Rate Limiting for the API (which is different from rate limiting login attempts on the web interface).</p> 
      <p>It is enabled by setting the <code class="docutils literal notranslate"><span class="pre">api_calls_per_interval</span></code> and <code class="docutils literal notranslate"><span class="pre">api_interval_in_sec</span></code> configuration parameters in the <code class="docutils literal notranslate"><span class="pre">[web]</span></code> section of <code class="docutils literal notranslate"><span class="pre">config.ini</span></code>. The settings are documented in the config.ini file.</p> 
      <p>If <code class="docutils literal notranslate"><span class="pre">api_calls_per_interval</span> <span class="pre">=</span> <span class="pre">60</span></code> and <code class="docutils literal notranslate"><span class="pre">api_interval_in_sec</span> <span class="pre">=</span> <span class="pre">60</span></code> the user can make 60 calls in a minute. They can use them all up in the first second and then get one call back every second. With <code class="docutils literal notranslate"><span class="pre">api_calls_per_interval</span> <span class="pre">=</span> <span class="pre">60</span></code> and <code class="docutils literal notranslate"><span class="pre">api_interval_in_sec</span> <span class="pre">=</span> <span class="pre">3600</span></code> (1 hour) they can use all 60 calls in the first second and they get one additional call every 10 seconds. <code class="docutils literal notranslate"><span class="pre">api_calls_per_interval</span></code> is the burst rate that you are willing to allow within <code class="docutils literal notranslate"><span class="pre">api_interval_in_sec</span></code> seconds. The average rate of use is the ratio of <code class="docutils literal notranslate"><span class="pre">api_calls_per_interval/api_interval_in_sec</span></code>. So you can have many values that permit one call per second on average: 1/1, 60/60, 3600/3600, but they all have a different maximum burst rates: 1/sec, 60/sec and 3600/sec.</p> 
      <p>A single page app may make 20 or 30 calls to populate the page (e.g. a list of open issues). Then wait a few seconds for the user to select an issue. When displaying the issue, it needs another 20 or calls to populate status dropdowns, pull the first 10 messages in the issue etc. Controlling the burst rate as well as the average rate is a tuning exercise left for the tracker admin.</p> 
      <p>Also the rate limit is a little lossy. Under heavy load, it is possible for it to miscount allowing more than burst count. Errors of up to 10% have been seen on slower hardware.</p> 
     </div> 
    </div> 
    <div class="section" id="client-api"> 
     <h2><a class="toc-backref" href="#id10">Client API</a></h2> 
     <p>The top-level REST url <code class="docutils literal notranslate"><span class="pre">/rest/</span></code> will display the current version of the REST API (Version 1 as of this writing) and some links to relevant endpoints of the API. In the following the <code class="docutils literal notranslate"><span class="pre">/rest</span></code> prefix is omitted from relative REST-API links for brevity.</p> 
     <div class="section" id="headers"> 
      <h3><a class="toc-backref" href="#id11">Headers</a></h3> 
      <p>If rate limiting is enabled there are 3 “standard” headers:</p> 
      <blockquote> 
       <div>
        <p><strong>X-RateLimit-Limit</strong>: Calls allowed per period.</p> 
        <p><strong>X-RateLimit-Remaining</strong>: Calls available to be completed in this window.</p> 
        <p><strong>X-RateLimit-Reset</strong>: window ends in this many seconds. (Note, not an epoch timestamp). After this time, all X-RateLimit-Limit calls are available again.</p> 
       </div>
      </blockquote> 
      <p>and one helpful header to report the period that is missing from other lists of rate limit headers:</p> 
      <blockquote> 
       <div>
        <strong>X-RateLimit-Limit-Period</strong>: Defines period in seconds for X-RateLimit-Limit.
       </div>
      </blockquote> 
      <p>Also if the user has exceeded the rate limit, this header is added:</p> 
      <blockquote> 
       <div>
        <strong>Retry-After</strong>: The number of second to wait until 1 api call will succeed.
       </div>
      </blockquote> 
      <p>If the client has requested a deprecated API endpoint, the header:</p> 
      <blockquote> 
       <div>
        <strong>Sunset</strong>: an http date after which the end point will not be available. This is not returned by current code, but can be used when <a class="reference internal" href="#programming-the-rest-api">Programming the REST API</a>. It should be used as a hint that the REST endpoint will be going away. See <a class="reference external" href="https://tools.ietf.org/html/rfc8594">https://tools.ietf.org/html/rfc8594</a> for details on this header and the sunset link type.
       </div>
      </blockquote> 
     </div> 
     <div class="section" id="hyperdb-stats"> 
      <h3><a class="toc-backref" href="#id12">Hyperdb Stats</a></h3> 
      <p>Adding <code class="docutils literal notranslate"><span class="pre">@stats=true</span></code> as a GET query parameter or POST data item will augment the response with an <code class="docutils literal notranslate"><span class="pre">@stats</span></code> dictionary. Any value other than <code class="docutils literal notranslate"><span class="pre">true</span></code> (any case) will disable the <code class="docutils literal notranslate"><span class="pre">@stats</span></code> dictionary. When stats are enabled the response includes an <code class="docutils literal notranslate"><span class="pre">@stats</span></code> member and looks like:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="p">{</span> <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
    <span class="o">...</span>
    <span class="s2">"@stats"</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">"cache_hits"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
          <span class="s2">"cache_misses"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="s2">"get_items"</span><span class="p">:</span> <span class="mf">0.0009722709655761719</span><span class="p">,</span>
          <span class="s2">"filtering"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="s2">"elapsed"</span><span class="p">:</span> <span class="mf">0.04731464385986328</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre>
       </div> 
      </div> 
      <p>These are the same values returned in the html interface by setting the <code class="docutils literal notranslate"><span class="pre">CGI_SHOW_TIMING</span></code> environment variable. By default performance stats are not shown. The fields are subject to change. An understanding of the code is recommended if you are going to use this info.</p> 
     </div> 
     <div class="section" id="versioning"> 
      <h3><a class="toc-backref" href="#id13">Versioning</a></h3> 
      <p>Currently there is only one version of the API. Versions are simple integers. The current version is <code class="docutils literal notranslate"><span class="pre">1</span></code>. Version selection is implemented in the server using one of three methods:</p> 
      <blockquote> 
       <div>
        <ol class="arabic simple"> 
         <li>Explicit version param in accept header: <code class="docutils literal notranslate"><span class="pre">application/json;</span> <span class="pre">version=1</span></code></li> 
         <li>Version suffix in vendor accept header: <code class="docutils literal notranslate"><span class="pre">application/vnd.json.test-v1+json</span></code></li> 
         <li>Adding version specifier in query string: <code class="docutils literal notranslate"><span class="pre">@apiver=1</span></code></li> 
        </ol> 
       </div>
      </blockquote> 
      <p>If an explicit version is not provided, the server default is used. The server default is reported by querying the <code class="docutils literal notranslate"><span class="pre">/rest/</span></code> endpoint as described above.</p> 
     </div> 
     <div class="section" id="input-formats"> 
      <h3><a class="toc-backref" href="#id14">Input Formats</a></h3> 
      <p>For a GET or OPTIONS request, the Content-Type header should not be sent.</p> 
      <p>Otherwise Content-Type is allowed to be <code class="docutils literal notranslate"><span class="pre">application/json</span></code> or <code class="docutils literal notranslate"><span class="pre">application/x-www-form-urlencoded</span></code>. Any other value returns error code 415.</p> 
     </div> 
     <div class="section" id="response-formats"> 
      <h3><a class="toc-backref" href="#id15">Response Formats</a></h3> 
      <p>The default response format is json.</p> 
      <p>If you add the <code class="docutils literal notranslate"><span class="pre">dicttoxml.py</span></code> module you can request XML formatted data using the header <code class="docutils literal notranslate"><span class="pre">Accept:</span> <span class="pre">application/xml</span></code> in your request. Both output formats are similar in structure.</p> 
      <p>The rest interface accepts the http accept header and can include <code class="docutils literal notranslate"><span class="pre">q</span></code> values to specify the preferred mechanism. This is the preferred way to specify alternate acceptable response formats.</p> 
      <p>To make testing from the browser easier, you can also append the extension <cite>.json</cite> or <cite>.xml</cite> to the path component of the url. This will force json or xml (if supported) output. If you use an extension it takes priority over any accept headers.</p> 
      <p>The rest interface returns status 406 if you use an unrecognized extension. You will also get a 406 status if none of the entries in the accept header are available or if the accept header is invalid.</p> 
     </div> 
     <div class="section" id="general-guidelines"> 
      <h3><a class="toc-backref" href="#id16">General Guidelines</a></h3> 
      <p>Performing a <code class="docutils literal notranslate"><span class="pre">GET</span></code> on an item or property of an item will return an ETag header or an @etag property. This needs to be submitted with <code class="docutils literal notranslate"><span class="pre">DELETE</span></code>, <code class="docutils literal notranslate"><span class="pre">PUT</span></code> and <code class="docutils literal notranslate"><span class="pre">PATCH</span></code> operations on the item using an <code class="docutils literal notranslate"><span class="pre">If-Match</span></code> header or an <code class="docutils literal notranslate"><span class="pre">"@etag</span></code> property in the data payload if the method supports a payload.</p> 
      <p>The exact details of returned data is determined by the value of the <code class="docutils literal notranslate"><span class="pre">@verbose</span></code> query parameter. The various supported values and their effects are described in the following sections.</p> 
      <p>All output is wrapped in an envelope called <code class="docutils literal notranslate"><span class="pre">data</span></code>. The output format is described in <a class="reference internal" href="#response-formats">Response Formats</a> above.</p> 
      <p>When using collection endpoints (think list of issues, users …), the <code class="docutils literal notranslate"><span class="pre">data</span></code> envelope contains metadata (e.g. total number of items) as well as a <code class="docutils literal notranslate"><span class="pre">collections</span></code> list of objects:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="p">{</span> <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"meta data field1"</span><span class="p">:</span> <span class="s2">"value"</span><span class="p">,</span>
    <span class="s2">"meta data field2"</span><span class="p">:</span> <span class="s2">"value"</span><span class="p">,</span>
    <span class="s2">"collection"</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span> <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"url to item"</span><span class="p">,</span>
            <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"internal identifier for item"</span> <span class="p">},</span>
          <span class="p">{</span> <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"url to second item"</span><span class="p">,</span>
            <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"id item 2"</span> <span class="p">},</span>
    <span class="o">...</span> <span class="p">]</span>
    <span class="s2">"@links"</span><span class="p">:</span> <span class="p">{</span>
       <span class="s2">"relation"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span> <span class="s2">"rel"</span><span class="p">:</span> <span class="s2">"relation/subrelation"</span><span class="p">,</span>
                  <span class="s2">"uri"</span><span class="p">:</span> <span class="s2">"uri to use to implement relation"</span> <span class="p">},</span>
                <span class="o">...</span>
                <span class="p">],</span>
       <span class="s2">"relation2"</span><span class="p">:</span> <span class="p">[</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span> <span class="p">],</span> <span class="o">...</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre>
       </div> 
      </div> 
      <p>available meta data is described in the documentation for the collections endpoint.</p> 
      <p>The <code class="docutils literal notranslate"><span class="pre">link</span></code> fields implement <a class="reference external" href="https://en.wikipedia.org/wiki/HATEOAS">HATEOS</a> by supplying a url for the resource represented by that object. The “link” parameter with the value of a url is a special case of the @links parameter.</p> 
      <p>In the @links object, each relationship is a list of full link json objects. These include rel (relationship) and uri properties. In the future this may be extended to include other data like content-type. However including a full @links object for every item includes a lot of overhead since in most cases only the self relationship needs to be represented.</p> 
      <p>Because every object, link and multilink ends up getting a url, the shorter ‘link’ representation is used for this special case. The <code class="docutils literal notranslate"><span class="pre">link</span></code> property expresses the <code class="docutils literal notranslate"><span class="pre">self</span></code> relationship and its value is the uri property of the full link object. In collections, properties from each item can be embedded in the returned data (see <code class="docutils literal notranslate"><span class="pre">@fields</span></code> below). This can not be done if the property is called link as that conflicts with the self url.</p> 
      <p>When using an item endpoint (think an individual issue), metadata is included in the <code class="docutils literal notranslate"><span class="pre">data</span></code> envelope. Inside of the envelope, the <code class="docutils literal notranslate"><span class="pre">attributes</span></code> object contains the data for the field/properties of the issue. Example:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="p">{</span> <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"meta data field1"</span><span class="p">:</span> <span class="s2">"value"</span><span class="p">,</span>
    <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"type of item, issue, user ..."</span>
    <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"link to retrieve item"</span><span class="p">,</span>
    <span class="s2">"attributes"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"title"</span><span class="p">:</span> <span class="s2">"title of issue"</span><span class="p">,</span>
        <span class="s2">"nosy"</span><span class="p">:</span> <span class="p">[</span>
                  <span class="p">{</span> <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"url for user4"</span><span class="p">,</span>
                    <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"4"</span> <span class="p">}</span>
        <span class="p">],</span>

    <span class="o">...</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre>
       </div> 
      </div> 
      <p>Using a property endpoint (e.g. title or nosy list for an issue) the <code class="docutils literal notranslate"><span class="pre">data</span></code> wrapper has a <code class="docutils literal notranslate"><span class="pre">data</span></code> subfield that represents the value of the property. This <code class="docutils literal notranslate"><span class="pre">data</span></code> subfield may be a simple string (all types except multilink) or a list of strings (multilink properties). Example:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="p">{</span> <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"description of class"</span><span class="p">,</span>
      <span class="s2">"@etag"</span><span class="p">:</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">f15e6942f00a41960de45f9413684591</span><span class="se">\"</span><span class="s2">"</span><span class="p">,</span>
      <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"link to retrieve property"</span><span class="p">,</span>
      <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"id for object with this property"</span><span class="p">,</span>
      <span class="s2">"data"</span><span class="p">:</span> <span class="s2">"value of property"</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre>
       </div> 
      </div> 
     </div> 
     <div class="section" id="special-endpoints"> 
      <h3><a class="toc-backref" href="#id17">Special Endpoints</a></h3> 
      <p>There are a few special endpoints that provide some additional data. Tracker administrators can add new endpoints. See “Programming the REST API”_ below.</p> 
      <div class="section" id="summary"> 
       <h4><a class="toc-backref" href="#id18">/summary</a></h4> 
       <p>A Summary page can be reached via <code class="docutils literal notranslate"><span class="pre">/summary</span></code> via the <code class="docutils literal notranslate"><span class="pre">GET</span></code> method. This is currently hard-coded for the standard tracker schema shipped with roundup and will display a summary of open issues.</p> 
      </div> 
      <div class="section" id="data"> 
       <h4><a class="toc-backref" href="#id19">/data</a></h4> 
       <p>This is the primary entry point for data from the tracker.</p> 
       <p>The <code class="docutils literal notranslate"><span class="pre">/data</span></code> link will display a set of classes of the tracker. All classes can be reached via <code class="docutils literal notranslate"><span class="pre">/data/&lt;classname&gt;</span></code> where <code class="docutils literal notranslate"><span class="pre">&lt;classname&gt;</span></code> is replace with the name of the class to query, e.g. <code class="docutils literal notranslate"><span class="pre">/data/issue</span></code>. Individual items of a class (e.g. a single issue) can be queried by giving the issue-id, e.g., <code class="docutils literal notranslate"><span class="pre">/data/issue/42</span></code>. Individual properties of an item can be queried by appending the property, e.g., <code class="docutils literal notranslate"><span class="pre">/data/issue/42/title</span></code>.</p> 
       <p>All the links mentioned in the following support the http method <code class="docutils literal notranslate"><span class="pre">GET</span></code>. Results of a <code class="docutils literal notranslate"><span class="pre">GET</span></code> request will always return the results as a dictionary with the entry <code class="docutils literal notranslate"><span class="pre">data</span></code> referring to the returned data.</p> 
       <p>Details are in the sections below.</p> 
      </div> 
     </div> 
     <div class="section" id="data-class-collection"> 
      <h3><a class="toc-backref" href="#id20">/data/<em>class</em> Collection</a></h3> 
      <p>When performing the <code class="docutils literal notranslate"><span class="pre">GET</span></code> method on a class (e.g. <code class="docutils literal notranslate"><span class="pre">/data/issue</span></code>), the <code class="docutils literal notranslate"><span class="pre">data</span></code> object includes the number of items available in <code class="docutils literal notranslate"><span class="pre">@total_size</span></code>. A a <code class="docutils literal notranslate"><span class="pre">collection</span></code> list follows which contains the id and link to the respective item. For example a get on <a class="reference external" href="https://.../rest/data/issue">https://…/rest/data/issue</a> returns:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="p">{</span>
    <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"collection"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"1"</span><span class="p">,</span>
                <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../rest/data/issue/1"</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"100"</span><span class="p">,</span>
                <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../rest/data/issue/100"</span>
            <span class="p">}</span>
    <span class="o">...</span>
        <span class="p">],</span>
        <span class="s2">"@total_size"</span><span class="p">:</span> <span class="mi">171</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
       </div> 
      </div> 
      <p>Collection endpoints support a number of features as seen in the next sections.</p> 
      <p>A server may implement a default maximum number of items in the collection. This can be used to prevent denial of service (DOS). As a result all clients must be programmed to expect pagination decorations in the response. See the section on pagination below for details.</p> 
      <div class="section" id="searching"> 
       <h4><a class="toc-backref" href="#id21">Searching</a></h4> 
       <p>Searching is done by adding roundup field names and values as query parameters. Using: <a class="reference external" href="https://.../rest/data/issue">https://…/rest/data/issue</a> you can search using:</p> 
       <table border="1" class="colwidths-given docutils" id="id2"> 
        <caption>
         <span class="caption-text">Query Parameters Examples</span>
        </caption> 
        <colgroup> 
         <col width="17%"> 
         <col width="17%"> 
         <col width="67%"> 
        </colgroup> 
        <thead valign="bottom"> 
         <tr class="row-odd">
          <th class="head">Query parameter</th> 
          <th class="head">Field type</th> 
          <th class="head">Explanation</th> 
         </tr> 
        </thead> 
        <tbody valign="top"> 
         <tr class="row-even">
          <td><code class="docutils literal notranslate"><span class="pre">title=foo</span></code></td> 
          <td>String</td> 
          <td>perform a substring search and find any issue with the word foo in the title.</td> 
         </tr> 
         <tr class="row-odd">
          <td><code class="docutils literal notranslate"><span class="pre">status=2</span></code></td> 
          <td>Link</td> 
          <td>find any issue whose status link is set to the id 2.</td> 
         </tr> 
         <tr class="row-even">
          <td><code class="docutils literal notranslate"><span class="pre">status=open</span></code></td> 
          <td>Link</td> 
          <td>find any issue where the name of the status is open. Note this is not a string match so using nosy=ope will fail.</td> 
         </tr> 
         <tr class="row-odd">
          <td><code class="docutils literal notranslate"><span class="pre">nosy=1</span></code></td> 
          <td>MultiLink</td> 
          <td>find any issue where the multilink nosy includes the id 1.</td> 
         </tr> 
         <tr class="row-even">
          <td><code class="docutils literal notranslate"><span class="pre">nosy=admin</span></code></td> 
          <td>MultiLink</td> 
          <td>find any issue where the multilink nosy includes the user admin. Note this is not a string match so using nosy=admi will fail.</td> 
         </tr> 
         <tr class="row-odd">
          <td><code class="docutils literal notranslate"><span class="pre">booleanfield=1</span></code> - also values: true, TRUE, yes, YES etc. Other values match false.</td> 
          <td>Boolean</td> 
          <td>find an issue with the boolean field set to true.</td> 
         </tr> 
        </tbody> 
       </table> 
       <p>As seen above, Links and Multilinks can be specified numerically or symbolically, e.g., searching for issues in status <code class="docutils literal notranslate"><span class="pre">closed</span></code> can be achieved by searching for <code class="docutils literal notranslate"><span class="pre">status=closed</span></code> or <code class="docutils literal notranslate"><span class="pre">status=3</span></code> (provided the <code class="docutils literal notranslate"><span class="pre">closed</span></code> status has ID 3). Note that even though the symbolic name is a string, in this case it is also a key value. As a result it only does an exact match.</p> 
       <p>Searching for strings (e.g. the issue title, or a keyword name) performs a case-insensitive substring search. Searching for <code class="docutils literal notranslate"><span class="pre">title=Something</span></code> (or in long form title~=Something) will find all issues with “Something” or “someThing”, etc. in the title.</p> 
       <p>Changing the search to <code class="docutils literal notranslate"><span class="pre">title:=Something</span></code> (note the <cite>:</cite>) performs an exact case-sensitive string match for exactly one word <code class="docutils literal notranslate"><span class="pre">Something</span></code> with a capital <code class="docutils literal notranslate"><span class="pre">S</span></code>. Another example is: <code class="docutils literal notranslate"><span class="pre">title:=test+that+nosy+actually+works.</span></code> where the + signs are spaces in the string. Replacing <code class="docutils literal notranslate"><span class="pre">+</span></code> with the <a class="reference external" href="https://en.wikipedia.org/wiki/Percent-encoding">URL encoding</a> for space <code class="docutils literal notranslate"><span class="pre">%20</span></code> will also work. Note that you must match the spaces when performing exact matches. So <cite>title:=test++that+nosy+actually+works.`</cite> matches the word <code class="docutils literal notranslate"><span class="pre">test</span></code> with two spaces bewteen <code class="docutils literal notranslate"><span class="pre">test</span></code> and <code class="docutils literal notranslate"><span class="pre">that</span></code> in the title.</p> 
       <p>To make this clear, searching <code class="docutils literal notranslate"><span class="pre">https://.../rest/data/issue?keyword=Foo</span></code> will not work unless there is a keyword with a (case sensitive) name field of <code class="docutils literal notranslate"><span class="pre">Foo</span></code> which is the key field of the keyword. However searching the text property <code class="docutils literal notranslate"><span class="pre">name</span></code> using <code class="docutils literal notranslate"><span class="pre">https://.../rest/data/keyword?name=Foo</span></code> (note searching keyword class not issue class) will return matches for <code class="docutils literal notranslate"><span class="pre">Foo</span></code>, <code class="docutils literal notranslate"><span class="pre">foobar</span></code>, <code class="docutils literal notranslate"><span class="pre">foo</span> <span class="pre">taz</span></code> etc.</p> 
       <p>In all cases the field <code class="docutils literal notranslate"><span class="pre">@total_size</span></code> is reported which is the total number of items available if you were to retrieve all of them.</p> 
       <p>Other data types: Date, Interval, Integer, Number need examples and may need work to allow range searches. Full text search (e.g. over the body of a msg) is a work in progress.</p> 
       <div class="section" id="transitive-searching"> 
        <h5>Transitive Searching</h5> 
        <p>In addition to searching an issue by its properties, you can search for issues where linked items have a certain property. For example using <code class="docutils literal notranslate"><span class="pre">/issues?messages.author=1</span></code> will find all issues that include (link to) a message created by the admin user. This can also be done using: <code class="docutils literal notranslate"><span class="pre">/issues?messages.author=admin</span></code>. Note that this requires search permission for messages.author, user.id, and users.username (to perform search with <code class="docutils literal notranslate"><span class="pre">admin</span></code>. If these search permissions are not present, the search will silently drop the attribute.</p> 
        <p>Similarly you can find all issues where the nosy list includes James Bond with: <code class="docutils literal notranslate"><span class="pre">issue?nosy.realname=james+bond</span></code>. The alternate way to perform this is to query the user class for the realname: <code class="docutils literal notranslate"><span class="pre">user?realname=james+bond</span></code> and retrieve the id. Then you can execute a second rest call <code class="docutils literal notranslate"><span class="pre">issue?nosy=7</span></code> to retrieve issues with id 7.</p> 
        <p>Make sure that search access to the class/properties are granted to the user. Note that users can search a field even if they can’t view it. However they may be able to use searches to discover the value of the field even if they can’t view it.</p> 
       </div> 
      </div> 
      <div class="section" id="sorting"> 
       <h4><a class="toc-backref" href="#id22">Sorting</a></h4> 
       <p>Collection endpoints support sorting. This is controlled by specifying a <code class="docutils literal notranslate"><span class="pre">@sort</span></code> parameter with a list of properties of the searched class. Optionally properties can include a sign (‘+’ or ‘-‘) to specify ascending or descending sort, respectively. If no sign is given, ascending sort is selected for this property. The following example would sort by status (in ascending order of the status.order property) and then by id of an issue:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="nd">@sort</span><span class="o">=</span><span class="n">status</span><span class="p">,</span><span class="o">-</span><span class="nb">id</span>
</pre>
        </div> 
       </div> 
      </div> 
      <div class="section" id="pagination"> 
       <h4><a class="toc-backref" href="#id23">Pagination</a></h4> 
       <p>Collection endpoints support pagination. This is controlled by query parameters <code class="docutils literal notranslate"><span class="pre">@page_size</span></code> and <code class="docutils literal notranslate"><span class="pre">@page_index</span></code> (Note the use of the leading <cite>@</cite> to make the parameters distinguishable from field names.)</p> 
       <table border="1" class="colwidths-given docutils" id="id3"> 
        <caption>
         <span class="caption-text">Query Parameters Examples</span>
        </caption> 
        <colgroup> 
         <col width="20%"> 
         <col width="80%"> 
        </colgroup> 
        <thead valign="bottom"> 
         <tr class="row-odd">
          <th class="head">Query parameter</th> 
          <th class="head">Explanation</th> 
         </tr> 
        </thead> 
        <tbody valign="top"> 
         <tr class="row-even">
          <td><code class="docutils literal notranslate"><span class="pre">@page_size</span></code></td> 
          <td>specifies how many items are displayed at once. If no <code class="docutils literal notranslate"><span class="pre">@page_size</span></code> is specified, all matching items are returned.</td> 
         </tr> 
         <tr class="row-odd">
          <td><code class="docutils literal notranslate"><span class="pre">@page_index</span></code></td> 
          <td>(which defaults to 1 if not given) specifies which page number of <code class="docutils literal notranslate"><span class="pre">@page_size</span></code> items is displayed.</td> 
         </tr> 
        </tbody> 
       </table> 
       <p>Also when pagination is enabled the returned data include pagination links along side the collection data. This looks like:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="p">{</span> <span class="s2">"data"</span><span class="p">:</span>
  <span class="p">{</span>
     <span class="s2">"collection"</span><span class="p">:</span> <span class="p">{</span> <span class="o">...</span> <span class="p">},</span>
     <span class="s2">"@total_size"</span><span class="p">:</span> <span class="mi">222</span><span class="p">,</span>
     <span class="s2">"@links"</span><span class="p">:</span> <span class="p">{</span>
         <span class="s2">"self"</span><span class="p">:</span> <span class="p">[</span>
             <span class="p">{</span>
                 <span class="s2">"uri"</span><span class="p">:</span>
         <span class="s2">"https://.../rest/data/issue?@page_index=1&amp;@fields=status&amp;@page_size=5"</span><span class="p">,</span>
                 <span class="s2">"rel"</span><span class="p">:</span> <span class="s2">"self"</span>
             <span class="p">}</span>
         <span class="p">],</span>
         <span class="s2">"next"</span><span class="p">:</span> <span class="p">[</span>
             <span class="p">{</span>
                 <span class="s2">"uri"</span><span class="p">:</span>
         <span class="s2">"https://.../rest/data/issue?@page_index=2&amp;@fields=status&amp;@page_size=5"</span><span class="p">,</span>
                 <span class="s2">"rel"</span><span class="p">:</span> <span class="s2">"next"</span>
             <span class="p">}</span>
         <span class="p">]</span>
       <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
        </div> 
       </div> 
       <p>The <code class="docutils literal notranslate"><span class="pre">@links</span></code> parameter is a dictionary indexed by relationships. Each relationship is a list of one or more full link json objects. Above we have link relations to move to the next page. If we weren’t at the first page, there would be a <code class="docutils literal notranslate"><span class="pre">prev</span></code> relation to move to the previous page. Also we have a self relation (which is missing the @page_index, hence we are at page 1) that can be used to get the same page again.</p> 
       <p>Note that the server may choose to limit the number of returned entries in the collection as a DOS prevention measure. As a result clients must be prepared to handle the incomplete response and request the next URL to retrieve all of the entries.</p> 
      </div> 
      <div class="section" id="field-embedding-and-verbose-output"> 
       <h4><a class="toc-backref" href="#id24">Field embedding and verbose output</a></h4> 
       <p>In collections, you can specify what fields should be embedded in the returned data. There are some shortcuts provided using the <code class="docutils literal notranslate"><span class="pre">@verbose</span></code> parameter. All the examples in this section are for a GET operation on <code class="docutils literal notranslate"><span class="pre">https://.../rest/data/issue</span></code>.</p> 
       <table border="1" class="colwidths-given docutils" id="id4"> 
        <caption>
         <span class="caption-text">Query Parameters Examples</span>
        </caption> 
        <colgroup> 
         <col width="20%"> 
         <col width="80%"> 
        </colgroup> 
        <thead valign="bottom"> 
         <tr class="row-odd">
          <th class="head">Query parameter</th> 
          <th class="head">Explanation</th> 
         </tr> 
        </thead> 
        <tbody valign="top"> 
         <tr class="row-even">
          <td><code class="docutils literal notranslate"><span class="pre">@verbose=0</span></code></td> 
          <td>each item in the collection has its “id” property displayed and a link with the URL to retrieve the item.</td> 
         </tr> 
         <tr class="row-odd">
          <td><code class="docutils literal notranslate"><span class="pre">@verbose=1</span></code></td> 
          <td>for collections this output is the same as <code class="docutils literal notranslate"><span class="pre">@verbose=0</span></code>. This is the default.</td> 
         </tr> 
         <tr class="row-even">
          <td><code class="docutils literal notranslate"><span class="pre">@verbose=2</span></code></td> 
          <td>each item in the collection includes the “label” property in addition to “id” property and a link for the item. This is useful as documented below in “Searches and selection”_.</td> 
         </tr> 
         <tr class="row-odd">
          <td><code class="docutils literal notranslate"><span class="pre">@verbose=3</span></code></td> 
          <td>will display the content property of messages and files. Note warnings about this below. Using this for collections is discouraged as it is slow and produces a lot of data.</td> 
         </tr> 
         <tr class="row-even">
          <td><code class="docutils literal notranslate"><span class="pre">@fields=status,title</span></code></td> 
          <td>will return the <code class="docutils literal notranslate"><span class="pre">status</span></code> and <code class="docutils literal notranslate"><span class="pre">title</span></code> fields for the displayed issues. It is added to the fields returned by the @verbose parameter. Protected properties can be included in the list and will be returned.</td> 
         </tr> 
        </tbody> 
       </table> 
       <p>In addition collections support the <code class="docutils literal notranslate"><span class="pre">@fields</span></code> parameter which is a colon or comma separated list of fields to embed in the response. For example <code class="docutils literal notranslate"><span class="pre">https://.../rest/data/issue?@verbose=2</span></code> is the same as: <code class="docutils literal notranslate"><span class="pre">https://.../rest/data/issue?@fields=title</span></code> since the label property for an issue is its title. The @fields option supports transitive properties, e.g. <code class="docutils literal notranslate"><span class="pre">status.name</span></code>. The transitive property may not include multilinks in the path except for the last component. So <code class="docutils literal notranslate"><span class="pre">messages.author</span></code> is not allowed because <code class="docutils literal notranslate"><span class="pre">messages</span></code> is a multilink while <code class="docutils literal notranslate"><span class="pre">messages</span></code> alone would be allowed. You can use both <code class="docutils literal notranslate"><span class="pre">@verbose</span></code> and <code class="docutils literal notranslate"><span class="pre">@fields</span></code> to get additional info. For example <code class="docutils literal notranslate"><span class="pre">https://.../rest/data/issue?@verbose=2&amp;@fields=status</span></code> returns:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="p">{</span>
    <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"collection"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../rest/data/issue/1"</span><span class="p">,</span>
                <span class="s2">"title"</span><span class="p">:</span> <span class="s2">"Welcome to the tracker START HERE"</span><span class="p">,</span>
                <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"1"</span><span class="p">,</span>
                <span class="s2">"status"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../rest/data/status/1"</span><span class="p">,</span>
                    <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"1"</span><span class="p">,</span>
                    <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"new"</span>
                <span class="p">}</span>
            <span class="p">},</span>
  <span class="o">...</span>
<span class="p">}</span>
</pre>
        </div> 
       </div> 
       <p>the format of the status field (included because of <code class="docutils literal notranslate"><span class="pre">@fields=status</span></code>) includes the label for the status. This is due to inclusion of <code class="docutils literal notranslate"><span class="pre">@verbose=2</span></code>. Without verbose you would see:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="p">{</span>
    <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"collection"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">"link"</span><span class="p">:</span>
    <span class="s2">"https://.../rest/data/issue/1"</span><span class="p">,</span>
                <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"1"</span><span class="p">,</span>
                <span class="s2">"status"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">"link"</span><span class="p">:</span>
    <span class="s2">"https://.../rest/data/status/1"</span><span class="p">,</span>
                    <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"1"</span>
                <span class="p">}</span>
            <span class="p">},</span>
   <span class="o">...</span>
<span class="p">}</span>
</pre>
        </div> 
       </div> 
       <p>Note that the <code class="docutils literal notranslate"><span class="pre">link</span></code> field that is returned doesn’t exist in the database. It is a construct of the rest interface. This means that you can not set <code class="docutils literal notranslate"><span class="pre">@fields=link</span></code> and get the link property included in the output.</p> 
       <p>Also using <code class="docutils literal notranslate"><span class="pre">@fields=@etag</span></code> will not work to retrieve the etag for items in the collection.</p> 
       <p>See the <a class="reference internal" href="#searches-and-selection">Searches and selection</a> section for the use cases supported by these features.</p> 
      </div> 
      <div class="section" id="getting-message-and-files-content"> 
       <h4><a class="toc-backref" href="#id25">Getting Message and Files Content</a></h4> 
       <p>You can retreive a message with a url like <code class="docutils literal notranslate"><span class="pre">https://.../demo/rest/data/msg/11</span></code>. This returns something like:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="p">{</span>
   <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"11"</span><span class="p">,</span>
      <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"msg"</span><span class="p">,</span>
      <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../demo/rest/data/msg/11"</span><span class="p">,</span>
      <span class="s2">"attributes"</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">"author"</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"5"</span><span class="p">,</span>
              <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../demo/rest/data/user/5"</span>
          <span class="p">},</span>
          <span class="s2">"content"</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../demo/msg11/"</span>
          <span class="p">},</span>
          <span class="s2">"date"</span><span class="p">:</span> <span class="s2">"2017-10-30.00:53:15"</span><span class="p">,</span>
          <span class="s2">"files"</span><span class="p">:</span> <span class="p">[],</span>
          <span class="s2">"inreplyto"</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
          <span class="s2">"messageid"</span><span class="p">:</span> <span class="s2">"&lt;1509324807.14.0.296813919751.issue3@localhost&gt;"</span><span class="p">,</span>
          <span class="s2">"messagetype"</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"1"</span><span class="p">,</span>
              <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../demo/rest/data/msgtype/1"</span>
          <span class="p">},</span>
          <span class="s2">"recipients"</span><span class="p">:</span> <span class="p">[</span>
              <span class="p">{</span>
                  <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"1"</span><span class="p">,</span>
                  <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../demo/rest/data/user/1"</span>
              <span class="p">},</span>
              <span class="p">{</span>
                  <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"3"</span><span class="p">,</span>
                  <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../demo/rest/data/user/3"</span>
              <span class="p">},</span>
              <span class="p">{</span>
                  <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"4"</span><span class="p">,</span>
                  <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../demo/rest/data/user/4"</span>
              <span class="p">}</span>
          <span class="p">],</span>
          <span class="s2">"subject"</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
          <span class="s2">"summary"</span><span class="p">:</span> <span class="s2">"of has to who. or of account give because the"</span><span class="p">,</span>
      <span class="p">},</span>
      <span class="s2">"@etag"</span><span class="p">:</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">584f82231079e349031bbb853747df1c</span><span class="se">\"</span><span class="s2">"</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre>
        </div> 
       </div> 
       <p>To retreive the content, you can use the content link property: <code class="docutils literal notranslate"><span class="pre">https://.../demo/msg11/</span></code>. The trailing / is required. Without the /, you get a web page that includes metadata about the message. With the slash you get a text/plain (in most cases) data stream.</p> 
       <p>Also you can use the url:</p> 
       <p>and the content property (if the data is utf-8 compatible) now looks like:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="o">...</span>
<span class="s2">"author"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"5"</span><span class="p">,</span>
            <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../demo/rest/data/user/5"</span>
          <span class="p">},</span>
<span class="s2">"content"</span><span class="p">:</span> <span class="s2">"of has to who pleasure. or of account give because the</span>
    <span class="n">reprehenderit</span>\<span class="n">neu</span> <span class="n">to</span> <span class="n">quisquam</span> <span class="n">velit</span><span class="p">,</span> <span class="n">passage</span><span class="p">,</span>
    <span class="n">was</span> <span class="ow">or</span> <span class="n">toil</span> <span class="n">BC</span> <span class="n">quis</span> <span class="n">denouncing</span> <span class="n">quia</span>\<span class="n">nexercise</span><span class="p">,</span>
    <span class="n">veritatis</span> <span class="n">et</span> <span class="n">used</span> <span class="n">voluptas</span> <span class="n">I</span> <span class="n">elit</span><span class="p">,</span> <span class="n">a</span> <span class="n">The</span><span class="o">...</span><span class="s2">",</span>
<span class="s2">"date"</span><span class="p">:</span> <span class="s2">"2017-10-30.00:53:15"</span><span class="p">,</span>
<span class="o">...</span>
</pre>
        </div> 
       </div> 
       <p>Lines are wrapped for display, content value is one really long line. If the data is not utf-8 compatible, you will get a link.</p> 
       <p>Retrieving the contents of a file is similar. Performing a get on <code class="docutils literal notranslate"><span class="pre">https://.../demo/rest/data/file/11</span></code> returns:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="p">{</span>
   <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"11"</span><span class="p">,</span>
      <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"file"</span><span class="p">,</span>
      <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../demo/rest/data/file/11"</span><span class="p">,</span>
      <span class="s2">"attributes"</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">"acl"</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
          <span class="s2">"content"</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../demo/file11/"</span>
          <span class="p">},</span>
          <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"afile"</span><span class="p">,</span>
          <span class="s2">"status"</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"1"</span><span class="p">,</span>
              <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../demo/rest/data/filestatus/1"</span>
          <span class="p">},</span>
          <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"image/vnd.microsoft.icon"</span>
      <span class="p">},</span>
      <span class="s2">"@etag"</span><span class="p">:</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">74276f75ef71a30a0cce62dc6a8aa1bb</span><span class="se">\"</span><span class="s2">"</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre>
        </div> 
       </div> 
       <p>To download the file contents for this example you would perform an http GET using: <code class="docutils literal notranslate"><span class="pre">https://.../demo/file11/</span></code>. The trailing / is required. You will receive a response of type application/octet-stream.</p> 
       <p>If you perform a get on <code class="docutils literal notranslate"><span class="pre">https://.../demo/rest/data/file/11?@verbose=3</span></code> the content field above is displayed as (wrapped for display):</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="s2">"content"</span><span class="p">:</span> <span class="s2">"file11 is not text, retrieve using binary_content</span>
            <span class="nb">property</span><span class="o">.</span> <span class="n">mdsum</span><span class="p">:</span> <span class="n">bd990c0f8833dd991daf610b81b62316</span><span class="s2">",</span>
</pre>
        </div> 
       </div> 
       <p>You can use the <a class="reference internal" href="#binary-content-property">binary_content property</a> described below to retrieve an encoded copy of the data.</p> 
      </div> 
      <div class="section" id="other-query-params"> 
       <h4><a class="toc-backref" href="#id26">Other query params</a></h4> 
       <p>This table lists other supported parameters:</p> 
       <table border="1" class="colwidths-given docutils" id="id5"> 
        <caption>
         <span class="caption-text">Query Parameters Examples</span>
        </caption> 
        <colgroup> 
         <col width="20%"> 
         <col width="80%"> 
        </colgroup> 
        <thead valign="bottom"> 
         <tr class="row-odd">
          <th class="head">Query parameter</th> 
          <th class="head">Explanation</th> 
         </tr> 
        </thead> 
        <tbody valign="top"> 
         <tr class="row-even">
          <td><code class="docutils literal notranslate"><span class="pre">@pretty=false</span></code></td> 
          <td>by default json data is pretty printed to make it readable to humans. This eases testing and with compression enabled the extra whitespace doesn’t bloat the returned payload excessively. You can disable pretty printing by using this query parameter. Note the default is true, so @pretty=true is not supported at this time.</td> 
         </tr> 
        </tbody> 
       </table> 
      </div> 
      <div class="section" id="using-the-post-method"> 
       <h4><a class="toc-backref" href="#id27">Using the POST method</a></h4> 
       <p>Only class links support the <code class="docutils literal notranslate"><span class="pre">POST</span></code> method for creation of new items of a class, e.g., a new issue via the <code class="docutils literal notranslate"><span class="pre">/data/issue</span></code> link. The post gets a dictionary of keys/values for the new item. It returns the same parameters as the GET method after successful creation.</p> 
       <p>If you perform a get on an item with <code class="docutils literal notranslate"><span class="pre">@verbose=0</span></code>, it is in the correct form to use as a the payload of a post.</p> 
      </div> 
      <div class="section" id="safely-re-sending-post"> 
       <h4><a class="toc-backref" href="#id28">Safely Re-sending POST</a></h4> 
       <p>POST is used to create new object in a class. E.G. a new issue. One problem is that a POST may time out. Because it is not idempotent like a PUT or DELETE, retrying the interrupted POST may result in the creation of a duplicate issue.</p> 
       <p>To solve this problem, a two step process inspired by the POE - Post Once Exactly spec: <a class="reference external" href="https://tools.ietf.org/html/draft-nottingham-http-poe-00">https://tools.ietf.org/html/draft-nottingham-http-poe-00</a> is provided.</p> 
       <p>This mechanism returns a single use URL. POSTing to the URL creates a new object in the class.</p> 
       <p>First we get the URL. Here is an example using curl:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">u</span> <span class="n">demo</span><span class="p">:</span><span class="n">demo</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">-</span><span class="n">H</span> <span class="s2">"Referer: https://.../demo/"</span> \
    <span class="o">-</span><span class="n">H</span> <span class="s2">"X-requested-with: rest"</span> \
    <span class="o">-</span><span class="n">H</span> <span class="s2">"Content-Type: application/json"</span> \
    <span class="o">--</span><span class="n">data</span> <span class="s1">''</span> \
    <span class="n">https</span><span class="p">:</span><span class="o">//.../</span><span class="n">demo</span><span class="o">/</span><span class="n">rest</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">issue</span><span class="o">/</span><span class="nd">@poe</span>
</pre>
        </div> 
       </div> 
       <p>This will return a json payload like:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="p">{</span>
  <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"expires"</span><span class="p">:</span> <span class="mf">1555266310.4457426</span><span class="p">,</span>
      <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../demo/rest/data/issue/@poe/vizl713xHtIzANRW9jPb3bWXePRzmehdmSXzEta1"</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre>
        </div> 
       </div> 
       <p>The value of expires is a Unix timestamp in seconds. In this case it has the default lifetime of 30 minutes after the current time. Using the link more than 30 minutes into the future will cause a 400 error.</p> 
       <p>Within 30 minutes, the link can be used to post an issue with the same payload that would normally be sent to: <code class="docutils literal notranslate"><span class="pre">https://.../demo/rest/data/issue</span></code>.</p> 
       <p>For example:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">u</span> <span class="n">demo</span><span class="p">:</span><span class="n">demo</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s2">"Referer: https://.../demo/"</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s2">"X-requested-with: rest"</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s2">"Content-Type: application/json"</span>  \
  <span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="n">binary</span> <span class="s1">'{ "title": "a problem" }'</span> \
  <span class="n">https</span><span class="p">:</span><span class="o">//.../</span><span class="n">demo</span><span class="o">/</span><span class="n">rest</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">issue</span><span class="o">/</span><span class="nd">@poe</span><span class="o">/</span><span class="n">vizl713xHtIzANRW9jPb3bWXePRzmehdmSXzEta1</span>
</pre>
        </div> 
       </div> 
       <p>returns:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="p">{</span>
  <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../demo/rest/data/issue/2280"</span><span class="p">,</span>
      <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"2280"</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre>
        </div> 
       </div> 
       <p>Once the @poe link is used and creates an issue, it becomes invalid and can’t be used again. Posting to it after the issue, or other object, is created, results in a 400 error <a class="footnote-reference" href="#poe-retry" id="id1">[1]</a>.</p> 
       <p>Note that POE links are restricted to the class that was used to get the link. So you can only create an issue using the link returned from <code class="docutils literal notranslate"><span class="pre">rest/data/issue/@poe</span></code>. You can create a generic POE link by adding the “generic” field to the post payload:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">u</span> <span class="n">demo</span><span class="p">:</span><span class="n">demo</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">-</span><span class="n">H</span> <span class="s2">"Referer: https://.../demo/"</span> \
    <span class="o">-</span><span class="n">H</span> <span class="s2">"X-requested-with: rest"</span> \
    <span class="o">--</span><span class="n">data</span> <span class="s1">'lifetime=900&amp;generic=1'</span> \
    <span class="n">https</span><span class="p">:</span><span class="o">//.../</span><span class="n">demo</span><span class="o">/</span><span class="n">rest</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">issue</span><span class="o">/</span><span class="nd">@poe</span>
</pre>
        </div> 
       </div> 
       <p>This will return a link under: <code class="docutils literal notranslate"><span class="pre">https://.../demo/rest/data/issue/@poe</span></code>:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="p">{</span>
  <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"expires"</span><span class="p">:</span> <span class="mf">1555268640.9606116</span><span class="p">,</span>
      <span class="s2">"link"</span><span class="p">:</span>
  <span class="s2">"https://.../demo/rest/data/issue/@poe/slPrzmEq6Q9BTjvcKhfxMNZL4uHXjbHCidY1ludZ"</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre>
        </div> 
       </div> 
       <p>You could use the link and change ‘issue’ to ‘user’ and it would work to create a user. Creating generic POE tokens is <em>not</em> recommended, but is available if a use case requires it.</p> 
       <p>This example also changes the lifetime of the POE url. This link has a lifetime of 15 minutes (900 seconds). Using it after 16 minutes will result in a 400 error. A lifetime up to 1 hour can be specified.</p> 
       <p>POE url’s are an optional mechanism. If:</p> 
       <ul class="simple"> 
        <li>you do not expect your client to retry a failed post,</li> 
        <li>a failed post is unlikely (e.g. you are running over a local lan),</li> 
        <li>there is a human using the client and who can intervene if a post fails</li> 
       </ul> 
       <p>you can use the url <code class="docutils literal notranslate"><span class="pre">https://.../demo/data/&lt;class&gt;</span></code>. However if you are using this mechanism to automate creation of objects and will automatically retry a post until it succeeds, please use the POE mechanism.</p> 
       <table class="docutils footnote" frame="void" id="poe-retry" rules="none"> 
        <colgroup>
         <col class="label">
         <col>
        </colgroup> 
        <tbody valign="top"> 
         <tr>
          <td class="label"><a class="fn-backref" href="#id1">[1]</a></td>
          <td>As a future enhancement, performing a POST to the POE link soon after it has been used to create an object will change. It will not return a 400 error. It will will trigger a 301 redirect to the url for the created object. After some period of time (maybe a week) the POE link will be removed and return a 400 error. This is meant to allow the client (a time limited way) to retrieve the created resource if the response was lost.</td>
         </tr> 
        </tbody> 
       </table> 
      </div> 
      <div class="section" id="other-supported-methods-for-collections"> 
       <h4><a class="toc-backref" href="#id29">Other Supported Methods for Collections</a></h4> 
       <p>Supports the <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> method for determining which methods are allowed on a given endpoint.</p> 
       <p>Does not support PUT, DELETE or PATCH.</p> 
      </div> 
     </div> 
     <div class="section" id="data-class-id-item"> 
      <h3><a class="toc-backref" href="#id30">/data/<em>class</em>/<em>id</em> item</a></h3> 
      <p>When performing the <code class="docutils literal notranslate"><span class="pre">GET</span></code> method on an item (e.g. <code class="docutils literal notranslate"><span class="pre">/data/issue/42</span></code>), a <code class="docutils literal notranslate"><span class="pre">link</span></code> attribute contains the link to the item, <code class="docutils literal notranslate"><span class="pre">id</span></code> contains the id, <code class="docutils literal notranslate"><span class="pre">type</span></code> contains the class name (e.g. <code class="docutils literal notranslate"><span class="pre">issue</span></code> in the example) and an <code class="docutils literal notranslate"><span class="pre">etag</span></code> property can be used to detect modifications since the last query.</p> 
      <p>Individual properties of the item are returned in an <code class="docutils literal notranslate"><span class="pre">attributes</span></code> dictionary. The properties returned depend on the permissions of the account used for the query.</p> 
      <p>By default all (visible to the current user) attributes/properties are returned. You can limit this by using the <code class="docutils literal notranslate"><span class="pre">@fields</span></code> query parameter similar to how it is used in collections. This way you can only return the fields you are interested in reducing network load as well as memory and parsing time on the client side. Or you can add additional transitive properties. By default protected properties (read only in the database) are not listed. This makes it easier to submit the attributes from a <code class="docutils literal notranslate"><span class="pre">@verbose=0</span></code> query using PUT. To include protected properties in the output of a GET add the query parameter <code class="docutils literal notranslate"><span class="pre">@protected=true</span></code> to the query and attributes like: actor, created, creator and activity will be include in the result.</p> 
      <p>Link and Multilink properties are displayed as a dictionary with a <code class="docutils literal notranslate"><span class="pre">link</span></code> and an <code class="docutils literal notranslate"><span class="pre">id</span></code> property by default. This is controlled by the <code class="docutils literal notranslate"><span class="pre">@verbose</span></code> attribute which is set to 1 by default. If set to 0, only the id is shown for Link and Multilink attributes. In this form, the data can be modified and sent back using <code class="docutils literal notranslate"><span class="pre">PUT</span></code> to change the item. If set to 2, the label property (usually <code class="docutils literal notranslate"><span class="pre">name</span></code> e.g. for status) is also put into the dictionary. Content properties of message and file object are by default also shown as a dictionary with a sole link attribute. The link is the download link for the file or message. If @verbose is &gt;= 3, the content property is shown in json as a (possibly very long) string. Currently the json serializer cannot handle files not properly utf-8 encoded, so specifying @verbose=3 for files is currently discouraged.</p> 
      <p>An example of returned values:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="p">{</span>
    <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"issue"</span><span class="p">,</span>
        <span class="s2">"@etag"</span><span class="p">:</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">f15e6942f00a41960de45f9413684591</span><span class="se">\"</span><span class="s2">"</span><span class="p">,</span>
        <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../rest/data/issue/23"</span><span class="p">,</span>
        <span class="s2">"attributes"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"keyword"</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">"messages"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../rest/data/msg/375"</span><span class="p">,</span>
                    <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"375"</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../rest/data/msg/376"</span><span class="p">,</span>
                    <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"376"</span>
                <span class="p">},</span>
                <span class="o">...</span>
            <span class="p">],</span>
            <span class="s2">"files"</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">"status"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../rest/data/status/2"</span><span class="p">,</span>
                <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"2"</span>
            <span class="p">},</span>
            <span class="s2">"title"</span><span class="p">:</span> <span class="s2">"This is a title title"</span><span class="p">,</span>
            <span class="s2">"superseder"</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">"nosy"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../rest/data/user/4"</span><span class="p">,</span>
                    <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"4"</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../rest/data/user/5"</span><span class="p">,</span>
                    <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"5"</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">"assignedto"</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"23"</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
       </div> 
      </div> 
      <div class="section" id="retrieve-item-using-key-value"> 
       <h4><a class="toc-backref" href="#id31">Retrieve item using key value</a></h4> 
       <p>If the class has a key attribute, e.g. the ‘status’ class in the classic tracker, it can be used to retrieve the item.</p> 
       <p>You can get an individual status by specifying the key-attribute value e.g. <code class="docutils literal notranslate"><span class="pre">/data/status/name=closed</span></code>. Note that <code class="docutils literal notranslate"><span class="pre">name</span></code> in this example must be the key-attribute of the class. A short-form (which might not be supported in future version of the API) is to specify only the value, e.g. <code class="docutils literal notranslate"><span class="pre">/data/status/closed</span></code>. This short-form only works when you’re sure that the key of the class is not numeric. E.G. if the name was “7”, /data/status/7 would return the status with id 7 not the status with name “7”. To get the status with name 7, you must use the long form /data/status/name=7</p> 
       <p>The long-form (with <code class="docutils literal notranslate"><span class="pre">=</span></code>) is different from a query-parameter like <code class="docutils literal notranslate"><span class="pre">/data/status?name=closed</span></code> which would find all stati (statuses) that have <code class="docutils literal notranslate"><span class="pre">closed</span></code> as a substring.</p> 
      </div> 
      <div class="section" id="dealing-with-messages-and-files"> 
       <h4><a class="toc-backref" href="#id32">Dealing with Messages and Files</a></h4> 
       <p>Using the requests library you can upload a file using:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span> <span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">filename</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">content_type</span><span class="p">)</span>
<span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span> <span class="p">(</span><span class="s1">'file'</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">d</span><span class="p">)</span>
</pre>
        </div> 
       </div> 
       <p>Instead of specifying json = dictionary we specify data = dictionary as shown above. (We believe) this encodes the contents using application/x-www-form-urlencoded which is not optimal for large files due to the encoding overhead.</p> 
       <p>The requests library can use multipart/form-data which is more efficient for large files. To do this specify both, files= <em>and</em> data= parameters, e.g.:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="c1"># A binary string that can't be decoded as unicode</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">'https://.../demo/rest/data/'</span>
<span class="n">content</span> <span class="o">=</span> <span class="nb">open</span> <span class="p">(</span><span class="s1">'random-junk'</span><span class="p">,</span> <span class="s1">'rb'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span> <span class="p">()</span>
<span class="n">fname</span>   <span class="o">=</span> <span class="s1">'a-bigger-testfile'</span>
<span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">fname</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">'application/octet-stream'</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="nb">dict</span> <span class="p">(</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span> <span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="s1">'file'</span><span class="p">,</span> <span class="n">files</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">d</span><span class="p">)</span>
</pre>
        </div> 
       </div> 
       <p>Curl can be used to post a file using multipart/form-data with:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">u</span> <span class="n">demo</span><span class="p">:</span><span class="n">demo</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">-</span><span class="n">H</span> <span class="s2">"Referer: https://.../demo/"</span> \
   <span class="o">-</span><span class="n">H</span> <span class="s2">"X-requested-with: rest"</span> \
   <span class="o">-</span><span class="n">F</span> <span class="s2">"name=afile"</span> <span class="o">-</span><span class="n">F</span> <span class="s2">"type=image/vnd.microsoft.icon"</span> \
   <span class="o">-</span><span class="n">F</span> <span class="s2">"content=@doc/roundup-favicon.ico"</span> \
   <span class="n">https</span><span class="p">:</span><span class="o">//.../</span><span class="n">demo</span><span class="o">/</span><span class="n">rest</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">file</span>
</pre>
        </div> 
       </div> 
       <p>the file is located at doc/roundup-favicon.ico. These calls will return something like:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="p">{</span>
    <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"12"</span><span class="p">,</span>
        <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../demo/rest/data/file/12"</span>
     <span class="p">}</span>
<span class="p">}</span>
</pre>
        </div> 
       </div> 
      </div> 
      <div class="section" id="other-supported-methods-for-items"> 
       <h4><a class="toc-backref" href="#id33">Other Supported Methods for Items</a></h4> 
       <p>The method <code class="docutils literal notranslate"><span class="pre">PUT</span></code> is allowed on individual items, e.g. <code class="docutils literal notranslate"><span class="pre">/data/issue/42</span></code> On success it returns the same parameters as the respective <code class="docutils literal notranslate"><span class="pre">GET</span></code> method. Note that for <code class="docutils literal notranslate"><span class="pre">PUT</span></code> an Etag has to be supplied, either in the request header or as an @etag parameter. An example:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">u</span> <span class="n">admin</span><span class="p">:</span><span class="n">admin</span> <span class="o">-</span><span class="n">X</span> <span class="n">PUT</span> \
   <span class="o">--</span><span class="n">header</span> <span class="s1">'Referer: https://example.com/demo/'</span> \
   <span class="o">--</span><span class="n">header</span> <span class="s1">'X-Requested-With: rest'</span> \
   <span class="o">--</span><span class="n">header</span> <span class="s2">"Content-Type: application/json"</span> \
   <span class="o">--</span><span class="n">header</span> <span class="s2">"Accept: application/json"</span> \
   <span class="o">--</span><span class="n">header</span> <span class="s1">'If-Match: "dd41f02d6f8b4c34b439fc712b522fb3"'</span> \
   <span class="o">--</span><span class="n">data</span> <span class="s1">'{ "nosy": [ "1", "5" ] }'</span> \
   <span class="s2">"https://example.com/demo/rest/data/issue/23"</span>

<span class="p">{</span>
    <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"attribute"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"nosy"</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">"1"</span><span class="p">,</span>
                <span class="s2">"5"</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"issue"</span><span class="p">,</span>
        <span class="s2">"link"</span><span class="p">:</span>
        <span class="s2">"https://example.com/demo/rest/data/issue/23"</span><span class="p">,</span>
        <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"23"</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
        </div> 
       </div> 
       <p>If the above command is repeated with the data attribute:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="o">--</span><span class="n">data</span> <span class="s1">'{ "nosy": [ "1", "5" ], "title": "This is now my title" }'</span>
</pre>
        </div> 
       </div> 
       <p>this is returned:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="p">{</span>
    <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"attribute"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"title"</span><span class="p">:</span> <span class="s2">"This is now my title"</span>
        <span class="p">},</span>
        <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"issue"</span><span class="p">,</span>
        <span class="s2">"link"</span><span class="p">:</span>
    <span class="s2">"https://.../demo/rest/data/issue/23"</span><span class="p">,</span>
        <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"23"</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
        </div> 
       </div> 
       <p>Note that nosy is not in the attributes returned. It is the same as before, so no change has happened and it is not reported. Changing both nosy and title:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">u</span> <span class="n">admin</span><span class="p">:</span><span class="n">admin</span> <span class="o">-</span><span class="n">X</span> <span class="n">PUT</span> \
  <span class="o">--</span><span class="n">header</span> <span class="s1">'Referer: https://.../'</span> \
  <span class="o">--</span><span class="n">header</span> <span class="s1">'X-Requested-With: rest'</span> \
  <span class="o">--</span><span class="n">header</span> <span class="s2">"Content-Type: application/json"</span> \
  <span class="o">--</span><span class="n">header</span> <span class="s2">"Accept: application/json"</span> \
  <span class="o">--</span><span class="n">header</span> <span class="s1">'If-Match: "8209add59a79713d64f4d1a072aef740"'</span> \
  <span class="o">--</span><span class="n">data</span> <span class="s1">'{ "nosy": [ "4", "5" ], "title": "This is now my new title"  }'</span> \
 <span class="s2">"https://.../demo/rest/data/issue/23"</span>
</pre>
        </div> 
       </div> 
       <p>which returns both title and nosy attributes:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="p">{</span>
    <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"attribute"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"title"</span><span class="p">:</span> <span class="s2">"This is now my new title"</span><span class="p">,</span>
            <span class="s2">"nosy"</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">"4"</span><span class="p">,</span>
                <span class="s2">"5"</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"issue"</span><span class="p">,</span>
        <span class="s2">"link"</span><span class="p">:</span>
        <span class="s2">"https://.../demo/rest/data/issue/23"</span><span class="p">,</span>
        <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"23"</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
        </div> 
       </div> 
       <p>Note that mixing url query parameters with payload submission doesn’t work. So using:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span>https://.../rest/data/issue/23?@pretty=false
</pre>
        </div> 
       </div> 
       <p>doesn’t have the desired effect. However it can be put in the data payload:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">u</span> <span class="n">admin</span><span class="p">:</span><span class="n">admin</span> <span class="o">...</span>
  <span class="o">--</span><span class="n">data</span> <span class="s1">'{ "nosy": [ "4", "5" ], "title": "...", "@pretty": "false"  }'</span>
</pre>
        </div> 
       </div> 
       <p>produces:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="p">{</span><span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"attribute"</span><span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">},</span> <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"issue"</span><span class="p">,</span>
  <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://..."</span><span class="p">,</span> <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"23"</span><span class="p">}}</span>
</pre>
        </div> 
       </div> 
       <p>the lines are wrapped for display purposes, in real life it’s one long line.</p> 
       <p>The method <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> is allowed on items, e.g., <code class="docutils literal notranslate"><span class="pre">/data/issue/42</span></code> and will retire (mark as deleted) the respective item. On success it will only return a status code. The item is still available if accessed directly by its item url. The item will not show up in searches where it would have been matched if not retired.</p> 
       <p>Finally the <code class="docutils literal notranslate"><span class="pre">PATCH</span></code> method can be applied to individual items, e.g., <code class="docutils literal notranslate"><span class="pre">/data/issue/42</span></code>. This method gets an operator <code class="docutils literal notranslate"><span class="pre">@op=&lt;method&gt;</span></code> where <code class="docutils literal notranslate"><span class="pre">&lt;method&gt;</span></code> is one of <code class="docutils literal notranslate"><span class="pre">add</span></code>, <code class="docutils literal notranslate"><span class="pre">replace</span></code>, <code class="docutils literal notranslate"><span class="pre">remove</span></code>. For items, an additional operator <code class="docutils literal notranslate"><span class="pre">action</span></code> is supported. If no operator is specified, the default is <code class="docutils literal notranslate"><span class="pre">replace</span></code>. The first three operators are self explanatory. For an <code class="docutils literal notranslate"><span class="pre">action</span></code> operator an <code class="docutils literal notranslate"><span class="pre">@action_name</span></code> and optional <code class="docutils literal notranslate"><span class="pre">@action_argsXXX</span></code> parameters have to be supplied. Currently there are only two actions, neither has args, namely <code class="docutils literal notranslate"><span class="pre">retire</span></code> and <code class="docutils literal notranslate"><span class="pre">restore</span></code>. The <code class="docutils literal notranslate"><span class="pre">retire</span></code> action on an item is the same as a <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> method, it retires the item. The <code class="docutils literal notranslate"><span class="pre">restore</span></code> action is the inverse of <code class="docutils literal notranslate"><span class="pre">retire</span></code>, the item is again visible. On success the returned value is the same as the respective <code class="docutils literal notranslate"><span class="pre">GET</span></code> method. An example to add a user to the nosy list of an item is:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">u</span> <span class="n">admin</span><span class="p">:</span><span class="n">admin</span> <span class="o">-</span><span class="n">p</span> <span class="o">-</span><span class="n">X</span> <span class="n">PATCH</span> \
   <span class="o">--</span><span class="n">header</span> <span class="s2">"Content-Type: application/x-www-form-urlencoded"</span> \
   <span class="o">--</span><span class="n">header</span> <span class="s2">"Accept: application/json"</span> \
   <span class="o">--</span><span class="n">header</span> <span class="s1">'If-Match: "c6e2d81019acff1da7a2da45f93939bd"'</span> \
   <span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="n">urlencode</span> <span class="s1">'@op=add'</span> \
   <span class="o">--</span><span class="n">data</span> <span class="s1">'nosy=3'</span> \
   <span class="s2">"https://.../rest/data/issue/23"</span>
</pre>
        </div> 
       </div> 
       <p>which returns:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="p">{</span>
    <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"attribute"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"nosy"</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">"3"</span><span class="p">,</span>
                <span class="s2">"4"</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"issue"</span><span class="p">,</span>
        <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../rest/data/issue/23"</span><span class="p">,</span>
        <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"23"</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
        </div> 
       </div> 
       <p>Note that the changed values are returned so you can update internal state in your app with the new data.</p> 
       <p>The <code class="docutils literal notranslate"><span class="pre">GET</span></code> method on an item (e.g. <code class="docutils literal notranslate"><span class="pre">/data/issue/43</span></code>) returns an ETag in the http header <em>and</em> the <code class="docutils literal notranslate"><span class="pre">@etag</span></code> value in the json payload. When modifying a property via <code class="docutils literal notranslate"><span class="pre">PUT</span></code> or <code class="docutils literal notranslate"><span class="pre">PATCH</span></code> or <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> the etag value for the item must be supplied using an <code class="docutils literal notranslate"><span class="pre">If-Match</span></code> header. If you are using <code class="docutils literal notranslate"><span class="pre">PUT</span></code> or <code class="docutils literal notranslate"><span class="pre">PATCH</span></code> an <code class="docutils literal notranslate"><span class="pre">@etag</span></code> value can be supplied in the payload in place of the <code class="docutils literal notranslate"><span class="pre">If-Match</span></code> header.</p> 
      </div> 
     </div> 
     <div class="section" id="data-class-id-property-field"> 
      <h3><a class="toc-backref" href="#id34">/data/<em>class</em>/<em>id</em>/<em>property</em> field</a></h3> 
      <p>A <code class="docutils literal notranslate"><span class="pre">GET</span></code> method on a property (e.g. <code class="docutils literal notranslate"><span class="pre">/data/issue/42/title</span></code>) returns the link, an <code class="docutils literal notranslate"><span class="pre">@etag</span></code>, the type of the property (e.g. “&lt;type str&gt;”) the id of the item and the content of the property in <code class="docutils literal notranslate"><span class="pre">data</span></code>.</p> 
      <p>For example:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="p">{</span>
    <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../rest/data/issue/22/title"</span><span class="p">,</span>
        <span class="s2">"data"</span><span class="p">:</span> <span class="s2">"I need Broken PC"</span><span class="p">,</span>
        <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"&lt;class 'str'&gt;"</span><span class="p">,</span>
        <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"22"</span><span class="p">,</span>
        <span class="s2">"@etag"</span><span class="p">:</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">370510512b2d8fc3f98aac3d762cc7b1</span><span class="se">\"</span><span class="s2">"</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
       </div> 
      </div> 
      <p>All endpoints support an <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> method for determining which methods are allowed on a given endpoint.</p> 
      <div class="section" id="message-and-file-content"> 
       <h4><a class="toc-backref" href="#id35">Message and File Content</a></h4> 
       <p>Messages and files have content properties. If the data is utf-8 compatible (e.g. an email message) you can retrieve it with rest/data/msg/11/content to obtain:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="p">{</span>
  <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
  <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"11"</span><span class="p">,</span>
  <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"&lt;class 'str'&gt;"</span><span class="p">,</span>
  <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../demo/rest/data/msg/11/content"</span><span class="p">,</span>
  <span class="s2">"data"</span><span class="p">:</span> <span class="s2">"of has to who pleasure. or of account give because the reprehenderit</span><span class="se">\n</span><span class="s2">eu to quisquam velit, passage, was or..."</span><span class="p">,</span>
          <span class="s2">"@etag"</span><span class="p">:</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">584f82231079e349031bbb853747df1c</span><span class="se">\"</span><span class="s2">"</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre>
        </div> 
       </div> 
       <p>(the content property is wrapped for display, it is one long line.)</p> 
       <p id="binary-content-property">If the data is not representable in utf-8, you need to use the binary_content property. E.G. <code class="docutils literal notranslate"><span class="pre">https://.../demo/rest/data/file/11/binary_content</span></code> returns:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="p">{</span>
   <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"11"</span><span class="p">,</span>
      <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"&lt;class 'bytes'&gt;"</span><span class="p">,</span>
      <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../demo/rest/data/file/11/binary_content"</span><span class="p">,</span>
      <span class="s2">"data"</span><span class="p">:</span> <span class="s2">"b'</span><span class="se">\\</span><span class="s2">x00</span><span class="se">\\</span><span class="s2">x00</span><span class="se">\\</span><span class="s2">x01</span><span class="se">\\</span><span class="s2">x00</span><span class="se">\\</span><span class="s2">x01...</span><span class="se">\\</span><span class="s2">xec?</span><span class="se">\\</span><span class="s2">x00</span><span class="se">\\</span><span class="s2">x00'"</span><span class="p">,</span>
      <span class="s2">"@etag"</span><span class="p">:</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">74276f75ef71a30a0cce62dc6a8aa1bb</span><span class="se">\"</span><span class="s2">"</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre>
        </div> 
       </div> 
       <p>(data field elided for display). You can also receive the file content as a data stream rather than encoded. See <a class="reference internal" href="#getting-message-and-files-content">Getting Message and Files Content</a>.</p> 
       <p>The data is a json encoded hexidecimal representation of the data.</p> 
      </div> 
      <div class="section" id="other-supported-methods-for-fields"> 
       <h4><a class="toc-backref" href="#id36">Other Supported Methods for fields</a></h4> 
       <p>The method <code class="docutils literal notranslate"><span class="pre">PUT</span></code> is allowed on a property e.g., <code class="docutils literal notranslate"><span class="pre">/data/issue/42/title</span></code>. On success it returns the same parameters as the respective <code class="docutils literal notranslate"><span class="pre">GET</span></code> method. Note that for <code class="docutils literal notranslate"><span class="pre">PUT</span></code> an Etag has to be supplied, either in the request header or as an @etag parameter. Example using multipart/form-data rather than json:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">vs</span> <span class="o">-</span><span class="n">u</span> <span class="n">provisional</span><span class="p">:</span><span class="n">provisional</span> <span class="o">-</span><span class="n">X</span> <span class="n">PUT</span> \
 <span class="o">--</span><span class="n">header</span> <span class="s2">"Accept: application/json"</span> \
 <span class="o">--</span><span class="n">data</span> <span class="s2">"data=Provisional"</span> \
 <span class="o">--</span><span class="n">header</span> <span class="s2">"If-Match: 079eba599152f3eed00567e23258fecf"</span> \
 <span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="n">urlencode</span> <span class="s2">"@etag=079eba599152f3eed00567e23258fecf"</span> \
  <span class="s2">"https://.../rest/data/user/5/realname"</span>
</pre>
        </div> 
       </div> 
       <p>This example updates a leadtime field that is declared as an interval type:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">vs</span> <span class="o">-</span><span class="n">u</span> <span class="n">demo</span><span class="p">:</span><span class="n">demo</span> <span class="o">-</span><span class="n">X</span> <span class="n">PUT</span> \
  <span class="o">--</span><span class="n">header</span> <span class="s2">"Accept: application/json"</span> \
  <span class="o">--</span><span class="n">header</span> <span class="s1">'Content-Type: application/json'</span> \
  <span class="o">--</span><span class="n">header</span> <span class="s2">"Referer: https://.../"</span> \
  <span class="o">--</span><span class="n">header</span> <span class="s2">"x-requested-with: rest"</span> \
  <span class="o">--</span><span class="n">header</span> <span class="s1">'If-Match: "e2e6cc43c3475a4a3d9e5343617c11c3"'</span> \
  <span class="o">--</span><span class="n">data</span> <span class="s1">'{"leadtime": "2d" }'</span>  \
  <span class="s2">"https://.../rest/data/issue/10"</span>
</pre>
        </div> 
       </div> 
       <p>It is also possible to call <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> on a property of an item, e.g., <code class="docutils literal notranslate"><span class="pre">/data/issue/42/nosy</span></code> to delete the nosy list. The same effect can be achieved with a <code class="docutils literal notranslate"><span class="pre">PUT</span></code> request and an empty new value. This may fail if the property is required.</p> 
       <p>The <code class="docutils literal notranslate"><span class="pre">PATCH</span></code> method can be applied to properties, e.g., <code class="docutils literal notranslate"><span class="pre">/data/issue/42/title</span></code>. This method gets an operator <code class="docutils literal notranslate"><span class="pre">@op=&lt;method&gt;</span></code> where <code class="docutils literal notranslate"><span class="pre">&lt;method&gt;</span></code> is one of <code class="docutils literal notranslate"><span class="pre">add</span></code>, <code class="docutils literal notranslate"><span class="pre">replace</span></code>, <code class="docutils literal notranslate"><span class="pre">remove</span></code>. If no operator is specified, the default is <code class="docutils literal notranslate"><span class="pre">replace</span></code> which is the same as performing a PUT on the field url. <code class="docutils literal notranslate"><span class="pre">add</span></code> and <code class="docutils literal notranslate"><span class="pre">remove</span></code> allow adding and removing values from MultiLink properties. This is easier than having to rewrite the entire value for the field using the <code class="docutils literal notranslate"><span class="pre">replace</span></code> operator or doing a PUT to the field. On success the returned value is the same as the respective <code class="docutils literal notranslate"><span class="pre">GET</span></code> method.</p> 
       <p>The <code class="docutils literal notranslate"><span class="pre">GET</span></code> method on an item (e.g. <code class="docutils literal notranslate"><span class="pre">/data/issue/43</span></code>) returns an ETag in the http header <em>and</em> the <code class="docutils literal notranslate"><span class="pre">@etag</span></code> value in the json payload. When modifying a property via <code class="docutils literal notranslate"><span class="pre">PUT</span></code> or <code class="docutils literal notranslate"><span class="pre">PATCH</span></code> or <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> the etag value for the item must be supplied using an <code class="docutils literal notranslate"><span class="pre">If-Match</span></code> header. If you are using <code class="docutils literal notranslate"><span class="pre">PUT</span></code> or <code class="docutils literal notranslate"><span class="pre">PATCH</span></code> an <code class="docutils literal notranslate"><span class="pre">@etag</span></code> value can be supplied in the payload in place of the <code class="docutils literal notranslate"><span class="pre">If-Match</span></code> header.</p> 
      </div> 
     </div> 
     <div class="section" id="tunneling-methods-via-post"> 
      <h3><a class="toc-backref" href="#id37">Tunneling Methods via POST</a></h3> 
      <p>If you are working through a proxy and unable to use http method like PUT, PATCH or DELETE you can use POST to perform the action. To tunnel an action through POST, send the <code class="docutils literal notranslate"><span class="pre">X-HTTP-METHOD-OVERRIDE</span></code> header with a value of DELETE or other capitalized HTTP verb. The body of the POST should be what you would send if you were using the method without tunneling.</p> 
     </div> 
    </div> 
    <div class="section" id="examples-and-use-cases"> 
     <h2><a class="toc-backref" href="#id38">Examples and Use Cases</a></h2> 
     <div class="section" id="sample-python-client"> 
      <h3><a class="toc-backref" href="#id39">sample python client</a></h3> 
      <p>The client uses the python <code class="docutils literal notranslate"><span class="pre">requests</span></code> library for easier interaction with a REST API supporting JSON encoding:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">requests</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span> <span class="o">=</span> <span class="s1">'http://user:password@tracker.example.com/demo/rest/data/'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">session</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">auth</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'admin'</span><span class="p">,</span> <span class="s1">'admin'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">u</span> <span class="o">+</span> <span class="s1">'issue/42/title'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Failed: </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">reason</span><span class="p">))</span>
<span class="gp">... </span>    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="p">[</span><span class="s1">'data'</span><span class="p">][</span><span class="s1">'data'</span><span class="p">]</span>
<span class="go">TEST Title</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'X-Requested-With'</span><span class="p">:</span> <span class="s1">'rest'</span><span class="p">,</span> <span class="s1">'Referer'</span><span class="p">:</span> <span class="s1">'http://tracker.example.com/demo/'</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">post</span> <span class="p">(</span><span class="n">u</span> <span class="o">+</span> <span class="s1">'issue'</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span> <span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s1">'TEST Issue'</span><span class="p">),</span> <span class="n">headers</span><span class="o">=</span><span class="n">h</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="ow">not</span> <span class="mi">200</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&lt;=</span> <span class="mi">201</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Failed: </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">reason</span><span class="p">))</span>
<span class="gp">... </span>    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</pre>
       </div> 
      </div> 
      <dl class="docutils"> 
       <dt>
        Retire/Restore::
       </dt> 
       <dd>
        <div class="first last highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">delete</span> <span class="p">(</span><span class="n">u</span> <span class="o">+</span> <span class="s1">'issue/42'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span> <span class="p">(</span><span class="n">u</span> <span class="o">+</span> <span class="s1">'issue/42'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">etag</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">'ETag'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s2">"ETag: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">etag</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">etag</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">'data'</span><span class="p">][</span><span class="s1">'@etag'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s2">"@etag: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">etag</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'If-Match'</span><span class="p">:</span> <span class="n">etag</span><span class="p">,</span>
<span class="gp">... </span>  <span class="s1">'X-Requested-With'</span><span class="p">:</span> <span class="s1">'rest'</span><span class="p">,</span>
<span class="gp">... </span>  <span class="s1">'Referer'</span><span class="p">:</span> <span class="s1">'http://tracker.example.com/demo/'</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'@op:'</span><span class="n">action</span><span class="s1">', '</span><span class="nd">@action_name</span><span class="s1">':'</span><span class="n">retire</span><span class="s1">'}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">u</span> <span class="o">+</span> <span class="s1">'issue/42'</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">d</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">h</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'@op:'</span><span class="n">action</span><span class="s1">', '</span><span class="nd">@action_name</span><span class="s1">':'</span><span class="n">restore</span><span class="s1">'}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">u</span> <span class="o">+</span> <span class="s1">'issue/42'</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">d</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">h</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</pre>
         </div> 
        </div> 
       </dd> 
      </dl> 
      <p>Note the addition of headers for: x-requested-with and referer. This allows the request to pass the CSRF protection mechanism. You may need to add an Origin header if this check is enabled in your tracker’s config.ini (look for csrf_enforce_header_origin).</p> 
      <p>A similar curl based retire example is to use:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">u</span> <span class="n">admin</span><span class="p">:</span><span class="n">admin</span> \
 <span class="o">-</span><span class="n">H</span> <span class="s2">"Referer: https://tracker.example.com/demo/"</span> \
 <span class="o">-</span><span class="n">H</span> <span class="s2">"X-requested-with: rest"</span>  \
 <span class="o">-</span><span class="n">H</span> <span class="s2">"Content-Type: application/json"</span> \
 <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">tracker</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">demo</span><span class="o">/</span><span class="n">rest</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">status</span><span class="o">/</span><span class="mi">1</span>
</pre>
       </div> 
      </div> 
      <p>to get the etag manually. Then insert the etag in the If-Match header for this retire example:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">u</span> <span class="n">admin</span><span class="p">:</span><span class="n">admin</span> \
   <span class="o">-</span><span class="n">H</span> <span class="s2">"Referer: https://tracker.example.com/demo/"</span> \
   <span class="o">-</span><span class="n">H</span> <span class="s2">"X-requested-with: rest"</span>  \
   <span class="o">-</span><span class="n">H</span> <span class="s2">"Content-Type: application/json"</span> \
   <span class="o">-</span><span class="n">H</span> <span class="s1">'If-Match: "a502faf4d6b8e3897c4ecd66b5597571"'</span> \
   <span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="n">raw</span> <span class="s1">'{ "@op":"action", "@action_name": "retire" }'</span>\
   <span class="o">-</span><span class="n">X</span> <span class="n">PATCH</span> \
   <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">tracker</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">demo</span><span class="o">/</span><span class="n">rest</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">status</span><span class="o">/</span><span class="mi">1</span>
</pre>
       </div> 
      </div> 
      <p>and restore:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">u</span> <span class="n">admin</span><span class="p">:</span><span class="n">admin</span> \
   <span class="o">-</span><span class="n">H</span> <span class="s2">"Referer: https://tracker.example.com/demo/"</span> \
   <span class="o">-</span><span class="n">H</span> <span class="s2">"X-requested-with: rest"</span>  \
   <span class="o">-</span><span class="n">H</span> <span class="s2">"Content-Type: application/json"</span> \
   <span class="o">-</span><span class="n">H</span> <span class="s1">'If-Match: "a502faf4d6b8e3897c4ecd66b5597571"'</span> \
   <span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="n">raw</span> <span class="s1">'{ "@op":"action", "@action_name": "restore" }'</span>\
   <span class="o">-</span><span class="n">X</span> <span class="n">PATCH</span> \
   <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">tracker</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">demo</span><span class="o">/</span><span class="n">rest</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">status</span><span class="o">/</span><span class="mi">1</span>
</pre>
       </div> 
      </div> 
     </div> 
     <div class="section" id="searches-and-selection"> 
      <h3><a class="toc-backref" href="#id40">Searches and selection</a></h3> 
      <p>One difficult interface issue is selection of items from a long list. Using multi-item selects requires loading a lot of data (e.g. consider a selection tool to select one or more issues as in the classic superseder field).</p> 
      <p>This can be made easier using javascript selection tools like select2, selectize.js, chosen etc. These tools can query a remote data provider to get a list of items for the user to select from.</p> 
      <p>Consider a multi-select box for the superseder property. Using selectize.js (and jquery) code similar to:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span>$('#superseder').selectize({
    valueField: 'id',
    labelField: 'title',
    searchField: 'title', ...
    load: function(query, callback) {
            if (!query.length) return callback();
            $.ajax({
                    url: '.../rest/data/issue?@verbose=2&amp;title='
                        + encodeURIComponent(query),
                    type: 'GET',
                    error: function() {callback();},
                    success: function(res) {
                      callback(res.data.collection);}
</pre>
       </div> 
      </div> 
      <p>Sets up a box that a user can type the word “request” into. Then selectize.js will use that word to generate an ajax request with the url: <code class="docutils literal notranslate"><span class="pre">.../rest/data/issue?@verbose=2&amp;title=request</span></code></p> 
      <p>This will return data like:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="p">{</span>
  <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
  <span class="s2">"@total_size"</span><span class="p">:</span> <span class="mi">440</span><span class="p">,</span>
  <span class="s2">"collection"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">"link"</span><span class="p">:</span> <span class="s2">".../rest/data/issue/8"</span><span class="p">,</span>
        <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"8"</span><span class="p">,</span>
        <span class="s2">"title"</span><span class="p">:</span> <span class="s2">"Request for Power plugs"</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">"link"</span><span class="p">:</span> <span class="s2">".../rest/data/issue/27"</span><span class="p">,</span>
        <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"27"</span><span class="p">,</span>
        <span class="s2">"title"</span><span class="p">:</span> <span class="s2">"Request for foo"</span>
    <span class="p">},</span>
<span class="o">...</span>
</pre>
       </div> 
      </div> 
      <p>selectize.js will look at these objects (as passed to callback(res.data.collection)) and create a select list from the each object showing the user the labelField (title) for each object and associating each title with the corresponding valueField (id). The example above has 440 issues returned from a total of 2000 issues. Only 440 had the word “request” somewhere in the title greatly reducing the amount of data that needed to be transferred.</p> 
      <p>Similar code can be set up to search a large list of keywords using:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span>.../rest/data/keyword?@verbose=2&amp;name=some
</pre>
       </div> 
      </div> 
      <p>which would return: “some keyword” “awesome” “somebody” making selections for links and multilinks much easier.</p> 
      <p>A get on a collection endpoint can include other properties. Why do we want this? Selectize.js can set up option groups (optgroups) in the select pulldown. So by including status in the returned data using a url like <code class="docutils literal notranslate"><span class="pre">https://.../rest/data/issue?@verbose=2&amp;@fields=status</span></code> we get:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="p">{</span>
  <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../rest/data/issue/1001"</span><span class="p">,</span>
  <span class="s2">"title"</span><span class="p">:</span> <span class="s2">"Request for Broken PC"</span><span class="p">,</span>
  <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"1001"</span><span class="p">,</span>
  <span class="s2">"status"</span><span class="p">:</span> <span class="p">{</span>
     <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"https://.../rest/data/status/6"</span><span class="p">,</span>
     <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"6"</span><span class="p">,</span>
     <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"resolved"</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre>
       </div> 
      </div> 
      <p>a select widget like:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">===</span> <span class="n">New</span> <span class="o">===</span>
<span class="n">A</span> <span class="n">request</span>
<span class="o">===</span> <span class="n">Open</span> <span class="o">===</span>
<span class="n">Request</span> <span class="k">for</span> <span class="n">bar</span>
<span class="n">Request</span> <span class="k">for</span> <span class="n">foo</span>
</pre>
       </div> 
      </div> 
      <p>etc. can be generated. Also depending on the javascript library, other fields can be used for subsearch and sorting.</p> 
     </div> 
    </div> 
    <div class="section" id="programming-the-rest-api"> 
     <h2><a class="toc-backref" href="#id41">Programming the REST API</a></h2> 
     <p>You can extend the rest api for a tracker. This describes how to add new rest end points. At some point it will also describe the rest.py structure and implementation.</p> 
     <div class="section" id="adding-new-rest-endpoints"> 
      <h3><a class="toc-backref" href="#id42">Adding new rest endpoints</a></h3> 
      <p>Add or edit the file interfaces.py at the root of the tracker directory.</p> 
      <p>In that file add:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="kn">from</span> <span class="nn">roundup.rest</span> <span class="k">import</span> <span class="n">Routing</span><span class="p">,</span> <span class="n">RestfulInstance</span><span class="p">,</span> <span class="n">_data_decorator</span>
<span class="kn">from</span> <span class="nn">roundup.exceptions</span> <span class="k">import</span> <span class="n">Unauthorised</span>

<span class="k">class</span> <span class="nc">RestfulInstance</span><span class="p">:</span>

    <span class="nd">@Routing</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">"/summary2"</span><span class="p">)</span>
    <span class="nd">@_data_decorator</span>
    <span class="k">def</span> <span class="nf">summary2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">"hello"</span><span class="p">:</span> <span class="s2">"world"</span> <span class="p">}</span>
        <span class="k">return</span> <span class="mi">200</span><span class="p">,</span> <span class="n">result</span>
</pre>
       </div> 
      </div> 
      <p>will make a new endpoint …/rest/summary2 that you can test with:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span>$ curl -X GET .../rest/summary2
{
    "data": {
        "hello": "world"
    }
}
</pre>
       </div> 
      </div> 
      <p>Similarly appending this to interfaces.py after summary2:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="c1"># handle more endpoints</span>
    <span class="nd">@Routing</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">"/data/&lt;:class_name&gt;/@schema"</span><span class="p">,</span> <span class="s1">'GET'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_element_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_name</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">"schema"</span><span class="p">:</span> <span class="p">{}</span> <span class="p">}</span>
        <span class="n">uid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">getuid</span> <span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">hasPermission</span><span class="p">(</span><span class="s1">'View'</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">class_name</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">Unauthorised</span><span class="p">(</span><span class="s1">'Permission to view </span><span class="si">%s</span><span class="s1"> denied'</span> <span class="o">%</span> <span class="n">class_name</span><span class="p">)</span>

        <span class="n">class_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">getclass</span><span class="p">(</span><span class="n">class_name</span><span class="p">)</span>
        <span class="n">props</span> <span class="o">=</span> <span class="n">class_obj</span><span class="o">.</span><span class="n">getprops</span><span class="p">(</span><span class="n">protected</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">'schema'</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">props</span><span class="p">:</span>
            <span class="n">schema</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">"type"</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="n">class_obj</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="n">prop</span><span class="p">])</span> <span class="p">}</span>

        <span class="k">return</span> <span class="n">result</span>
</pre>
       </div> 
      </div> 
      <p>returns some data about the class:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span>$ curl -X GET .../rest/data/issue/@schema
{
    "schema": {
        "keyword": {
            "type": "&lt;roundup.hyperdb.Multilink to \"keyword\"&gt;"
        },
        "title": {
            "type": "&lt;roundup.hyperdb.String&gt;"
        },
        "files": {
            "type": "&lt;roundup.hyperdb.Multilink to \"file\"&gt;"
        },
        "status": {
            "type": "&lt;roundup.hyperdb.Link to \"status\"&gt;"
        }, ...
    }
}
</pre>
       </div> 
      </div> 
      <p>Adding other endpoints (e.g. to allow an OPTIONS query against <code class="docutils literal notranslate"><span class="pre">/data/issue/@schema</span></code>) is left as an exercise for the reader.</p> 
     </div> 
     <div class="section" id="redefine-move-rest-endpoints"> 
      <h3><a class="toc-backref" href="#id43">Redefine/move rest endpoints</a></h3> 
      <p>In addition to adding new endpoints, you can redefine existing endpoints. Adding this as described above:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="nd">@Routing</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">"/summary"</span><span class="p">)</span>
<span class="nd">@_data_decorator</span>
<span class="k">def</span> <span class="nf">summary2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">"hello"</span><span class="p">:</span> <span class="s2">"world"</span> <span class="p">}</span>
    <span class="k">return</span> <span class="mi">200</span><span class="p">,</span> <span class="n">result</span>
</pre>
       </div> 
      </div> 
      <p>will return:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="p">{</span>
  <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">"hello"</span><span class="p">:</span> <span class="s2">"world"</span>
          <span class="p">}</span>
<span class="p">}</span>
</pre>
       </div> 
      </div> 
      <p>In addition to overriding existing endpoints, you can move existing endpoints to new locations. Adding:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="nd">@Routing</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">"/data2/&lt;:classname&gt;"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_collection2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classname</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
    <span class="sd">""" Remap existing function in rest.py to a new endpoint</span>

<span class="sd">        Existing function is decorated with:</span>

<span class="sd">              @Routing.route("/data/&lt;:classname&gt;")</span>
<span class="sd">              @_data_decorator</span>

<span class="sd">        so we need to drop @_data_decorator from this function since</span>
<span class="sd">        we can't apply @_data_decorator twice.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">classname</span><span class="p">,</span> <span class="nb">input</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>will make the response at /rest/data2/&lt;class&gt; be the same as what is normally at /rest/data/&lt;class&gt;.</p> 
     </div> 
     <div class="section" id="controlling-access-to-backend-data"> 
      <h3><a class="toc-backref" href="#id44">Controlling Access to Backend Data</a></h3> 
      <p>Roundup’s schema is the primary access control mechanism. Roles and Permissions provide the ability to carefully control what data can be seen.</p> 
      <p>However the templating system can access the hyperdb directly which allows filtering to happen with admin privs escaping the standard permissions scheme. For example access to a user’s roles should be limited to the user (read only) and an admin. If you have customized your schema to implement <a class="reference external" href="customizing.html#restricting-the-list-of-users-that-are-assignable-to-a-task">Restricting the list of users that are assignable to a task</a> so that only users with a Developer role are allowed to be assigned to an issue, a rest end point must be added to provide a view that exposes users with this permission.</p> 
      <p>Using the normal <code class="docutils literal notranslate"><span class="pre">/data/user?roles=Developer</span></code> will return all the users in the system unless you are an admin user because most users can’t see the roles. Building on the <a class="reference internal" href="#adding-new-rest-endpoints">Adding new rest endpoints</a> section this code adds a new endpoint <cite>/data/@permission/Developer</cite> that returns a list of users with the developer role:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="kn">from</span> <span class="nn">roundup.rest</span> <span class="k">import</span> <span class="n">Routing</span><span class="p">,</span> <span class="n">RestfulInstance</span>
<span class="kn">from</span> <span class="nn">cgi</span> <span class="k">import</span> <span class="n">MiniFieldStorage</span>

<span class="k">class</span> <span class="nc">RestfulInstance</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="nd">@Routing</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">"/data/@permission/Developer"</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_role_Developer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
        <span class="sd">'''An endpoint to return a list of users with Developer</span>
<span class="sd">           role who can be assigned to an issue.</span>

<span class="sd">           It ignores attempt to search by any property except</span>
<span class="sd">           username and realname. It also ignores the whole @fields</span>
<span class="sd">           specification if it specifies a property the user</span>
<span class="sd">           can't view. Other @ query params (e.g. @page... and</span>
<span class="sd">           @verbose) are supported.</span>

<span class="sd">           It assumes admin access rights so that the roles property</span>
<span class="sd">           of the user can be searched. This is needed if the roles</span>
<span class="sd">           property is not searchable/viewable by normal users. A user</span>
<span class="sd">           who can search roles can identify users with the admin</span>
<span class="sd">           role. So it does not respond the same as a rest/data/users</span>
<span class="sd">           search by a non-admin user.</span>
<span class="sd">        '''</span>
        <span class="c1"># get real user id</span>
        <span class="n">realuid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">getuid</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">allowed_field</span><span class="p">(</span><span class="n">fs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">fs</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'username'</span><span class="p">,</span> <span class="s1">'realname'</span> <span class="p">]:</span>
                <span class="c1"># only allow search matches for these fields</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">fs</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">[</span> <span class="s1">'@fields'</span> <span class="p">]:</span>
                <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">fs</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">','</span><span class="p">):</span>
                    <span class="c1"># if any property is unviewable to user, remove</span>
                    <span class="c1"># @field entry. If they can't see it for the admin</span>
                    <span class="c1"># user, don't let them see it for any user.</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">hasPermission</span><span class="p">(</span>
                            <span class="s1">'View'</span><span class="p">,</span> <span class="n">realuid</span><span class="p">,</span> <span class="s1">'user'</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="n">prop</span><span class="p">,</span>
                            <span class="n">itemid</span><span class="o">=</span><span class="s1">'1'</span><span class="p">):</span>
                        <span class="k">return</span> <span class="kc">False</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">fs</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"@"</span><span class="p">):</span>
                <span class="c1"># allow @page..., @verbose etc.</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="c1"># deny all other url parmeters</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Cleanup input.list to prevent user from probing roles</span>
        <span class="c1"># or viewing things the user should not be able to view.</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">list</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">fs</span> <span class="k">for</span> <span class="n">fs</span> <span class="ow">in</span> <span class="nb">input</span><span class="o">.</span><span class="n">list</span>
                          <span class="k">if</span> <span class="n">allowed_field</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span> <span class="p">]</span>

        <span class="c1"># Add the role filter required to implement the permission</span>
        <span class="c1"># search</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MiniFieldStorage</span><span class="p">(</span><span class="s2">"roles"</span><span class="p">,</span> <span class="s2">"Developer"</span><span class="p">))</span>

        <span class="c1"># change user to acquire permission to search roles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">setCurrentUser</span><span class="p">(</span><span class="s1">'admin'</span><span class="p">)</span>

        <span class="c1"># Once we have cleaned up the request, pass it to</span>
        <span class="c1"># get_collection as though /rest/data/users?... has been called</span>
        <span class="c1"># to get @verbose and other args supported.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="s1">'user'</span><span class="p">,</span> <span class="nb">input</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>Calling this with:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">curl</span> <span class="s1">'http://example.com/demo/rest/data/@permission/Developer?@fields=realname&amp;roles=Users&amp;@verbose=2'</span>
</pre>
       </div> 
      </div> 
      <p>produces output similar to:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="p">{</span>
    <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"collection"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">"username"</span><span class="p">:</span> <span class="s2">"agent"</span><span class="p">,</span>
                <span class="s2">"link"</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">demo</span><span class="o">/</span><span class="n">rest</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="mi">4</span><span class="s2">",</span>
                <span class="s2">"realname"</span><span class="p">:</span> <span class="s2">"James Bond"</span><span class="p">,</span>
                <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"4"</span>
            <span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">"@total_size"</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
       </div> 
      </div> 
      <p>assuming user 4 is the only user with the Developer role. Note that the url passes the <code class="docutils literal notranslate"><span class="pre">roles=User</span></code> filter option which is silently ignored.</p> 
      <div class="section" id="changing-access-roles-with-json-web-tokens"> 
       <h4><a class="toc-backref" href="#id45">Changing Access Roles with JSON Web Tokens</a></h4> 
       <p>As discussed above Roundup’s schema is the access control mechanism. However you may want to integrate a third party system with roundup. E.G. suppose you use a time tracking service that takes an issue id and keeps a running count of how much time was spent on it. Then with a single button push it can add the recorded time to the roundup issue.</p> 
       <p>You probably don’t want to give this third party service your roundup username and credentials. Especially if your roundup instance is under your company’s single sign on infrastructure.</p> 
       <p>So what we need is a way for this third party service to impersonate you and have access to create a roundup timelog entry (see <a class="reference external" href="customizing.html#adding-a-time-log-to-your-issues">customizing.html#adding-a-time-log-to-your-issues</a> ). Then add it to the associated issue. This should happen without sharing passwords and without allowing the third party service to see the issue (except the <code class="docutils literal notranslate"><span class="pre">times</span></code> property), user, or other information in the tracker.</p> 
       <p>Enter the use of a JSON web token. Roundup has rudimentary ability to manage JWTs and use them for authentication and authorization.</p> 
       <p>There are 5 steps to set this up:</p> 
       <ol class="arabic simple"> 
        <li>install pyjwt library using pip or pip3. If roundup can’t find the jwt module you will see the error <code class="docutils literal notranslate"><span class="pre">Support</span> <span class="pre">for</span> <span class="pre">jwt</span> <span class="pre">disabled.</span></code></li> 
        <li>create a new role that allows Create access to timelog and edit/view access to an issues’ <code class="docutils literal notranslate"><span class="pre">times</span></code> property.</li> 
        <li>add support for issuing (and validating) jwts to the rest interface. This uses the <a class="reference internal" href="#adding-new-rest-endpoints">Adding new rest endpoints</a> mechanism.</li> 
        <li>configure roundup’s config.ini [web] jwt_secret with at least 32 random characters of data. (You will get a message <code class="docutils literal notranslate"><span class="pre">Support</span> <span class="pre">for</span> <span class="pre">jwt</span> <span class="pre">disabled</span> <span class="pre">by</span> <span class="pre">admin.</span></code> if it’s not long enough.)</li> 
        <li>add an auditor to make sure that users with this role are appending timelog links to the <code class="docutils literal notranslate"><span class="pre">times</span></code> property of the issue.</li> 
       </ol> 
       <div class="section" id="create-role"> 
        <h5>Create role</h5> 
        <p>Adding this snippet of code to the tracker’s <code class="docutils literal notranslate"><span class="pre">schema.py</span></code> should create a role with the proper authorization:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addRole</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"User:timelog"</span><span class="p">,</span>
      <span class="n">description</span><span class="o">=</span><span class="s2">"allow a user to create and append timelogs"</span><span class="p">)</span>

<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User:timelog'</span><span class="p">,</span> <span class="s1">'Rest Access'</span><span class="p">)</span>

<span class="n">perm</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Create'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'timelog'</span><span class="p">,</span>
         <span class="n">description</span><span class="o">=</span><span class="s2">"Allow timelog creation"</span><span class="p">,</span> <span class="n">props_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s2">"User:timelog"</span><span class="p">,</span> <span class="n">perm</span><span class="p">)</span>

<span class="n">perm</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'View'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'issue'</span><span class="p">,</span>
         <span class="n">properties</span><span class="o">=</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="s1">'times'</span><span class="p">),</span>
         <span class="n">description</span><span class="o">=</span><span class="s2">"Allow retrieving issue etag or timelog issue"</span><span class="p">,</span>
         <span class="n">props_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s2">"User:timelog"</span><span class="p">,</span> <span class="n">perm</span><span class="p">)</span>

<span class="n">perm</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Edit'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'issue'</span><span class="p">,</span>
         <span class="n">properties</span><span class="o">=</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="s1">'times'</span><span class="p">),</span>
         <span class="n">description</span><span class="o">=</span><span class="s2">"Allow editing timelog for issue"</span><span class="p">,</span>
         <span class="n">props_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s2">"User:timelog"</span><span class="p">,</span> <span class="n">perm</span><span class="p">)</span>
</pre>
         </div> 
        </div> 
        <p>The role is named to work with the /rest/jwt/issue rest endpoint defined below. Starting the role name with <code class="docutils literal notranslate"><span class="pre">User:</span></code> allows the jwt issue code to create a token with this role if the user requesting the role has the User role.</p> 
        <p>The role <em>must</em> have access to the issue <code class="docutils literal notranslate"><span class="pre">id</span></code> to retrieve the etag for the issue. The etag is passed in the <code class="docutils literal notranslate"><span class="pre">If-Match</span></code> HTTP header when you make a call to patch or update the <code class="docutils literal notranslate"><span class="pre">times</span></code> property of the issue.</p> 
        <p>If you use a PATCH rest call with “@op=add” to append the new timelog, you don’t need View access to the <code class="docutils literal notranslate"><span class="pre">times</span></code> property. If you replace the <code class="docutils literal notranslate"><span class="pre">times</span></code> value, you need to read the current value of <code class="docutils literal notranslate"><span class="pre">times</span></code> (using View permission), append the newly created timelog id to the (array) value, and replace the <code class="docutils literal notranslate"><span class="pre">times</span></code> value.</p> 
        <p>Note that the json returned after the operation will include the new value of the <code class="docutils literal notranslate"><span class="pre">times</span></code> value so your code can verify that it worked. This does potentially leak info about the previous id’s in the field.</p> 
       </div> 
       <div class="section" id="create-rest-endpoints"> 
        <h5>Create rest endpoints</h5> 
        <p>Here is code to add to your tracker’s <code class="docutils literal notranslate"><span class="pre">interfaces.py</span></code> (note code has only been tested with python3):</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="kn">from</span> <span class="nn">roundup.rest</span> <span class="k">import</span> <span class="n">Routing</span><span class="p">,</span> <span class="n">RestfulInstance</span><span class="p">,</span> <span class="n">_data_decorator</span>

<span class="k">class</span> <span class="nc">RestfulInstance</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@Routing</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">"/jwt/issue"</span><span class="p">,</span> <span class="s1">'POST'</span><span class="p">)</span>
    <span class="nd">@_data_decorator</span>
    <span class="k">def</span> <span class="nf">generate_jwt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">jwt</span>
        <span class="kn">import</span> <span class="nn">datetime</span>
        <span class="kn">from</span> <span class="nn">roundup.anypy.strings</span> <span class="k">import</span> <span class="n">b2s</span>

        <span class="c1"># require basic auth to generate a token</span>
        <span class="c1"># At some point we can support a refresh token.</span>
        <span class="c1"># maybe a jwt with the "refresh": True claim generated</span>
        <span class="c1"># using: "refresh": True in the json request payload.</span>

        <span class="n">denialmsg</span><span class="o">=</span><span class="s1">'Token creation requires login with basic auth.'</span>
        <span class="k">if</span> <span class="s1">'HTTP_AUTHORIZATION'</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">env</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">auth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">'HTTP_AUTHORIZATION'</span><span class="p">]</span>
                <span class="n">scheme</span><span class="p">,</span> <span class="n">challenge</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">' '</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
                <span class="c1"># bad format for header</span>
                <span class="k">raise</span> <span class="n">Unauthorised</span><span class="p">(</span><span class="n">denialmsg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">scheme</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">'basic'</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">Unauthorised</span><span class="p">(</span><span class="n">denialmsg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Unauthorised</span><span class="p">(</span><span class="n">denialmsg</span><span class="p">)</span>

        <span class="c1"># If we reach this point we have validated that the user has</span>
        <span class="c1"># logged in with a password using basic auth.</span>
        <span class="n">all_roles</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">role</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">rolenames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">role</span> <span class="ow">in</span> <span class="n">all_roles</span><span class="p">:</span>
            <span class="n">rolenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">role</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">user_roles</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">get_roles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">getuid</span><span class="p">()))</span>

        <span class="n">claim</span><span class="o">=</span> <span class="p">{</span> <span class="s1">'sub'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">getuid</span><span class="p">(),</span>
                 <span class="s1">'iss'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">TRACKER_WEB</span><span class="p">,</span>
                 <span class="s1">'aud'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">TRACKER_WEB</span><span class="p">,</span>
                 <span class="s1">'iat'</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">(),</span>
               <span class="p">}</span>

        <span class="n">lifetime</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="s1">'lifetime'</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">input</span><span class="p">[</span><span class="s1">'lifetime'</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="s1">'unlimited'</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">lifetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">[</span><span class="s1">'lifetime'</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">UsageError</span><span class="p">(</span><span class="s2">"Value 'lifetime' must be 'unlimited' or an integer to specify"</span> <span class="o">+</span>
                                     <span class="s2">" lifetime in seconds. Got </span><span class="si">%s</span><span class="s2">."</span><span class="o">%</span><span class="nb">input</span><span class="p">[</span><span class="s1">'lifetime'</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lifetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">86400</span><span class="p">)</span> <span class="c1"># 1 day by default</span>

        <span class="k">if</span> <span class="n">lifetime</span><span class="p">:</span> <span class="c1"># if lifetime = 0 make unlimited by omitting exp claim</span>
            <span class="n">claim</span><span class="p">[</span><span class="s1">'exp'</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">+</span> <span class="n">lifetime</span>

        <span class="n">newroles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="s1">'roles'</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">role</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">[</span><span class="s1">'roles'</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">role</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rolenames</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">UsageError</span><span class="p">(</span><span class="s2">"Role </span><span class="si">%s</span><span class="s2"> is not valid."</span><span class="o">%</span><span class="n">role</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">role</span> <span class="ow">in</span> <span class="n">user_roles</span><span class="p">:</span>
                    <span class="n">newroles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">role</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">parentrole</span> <span class="o">=</span> <span class="n">role</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">':'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">parentrole</span> <span class="ow">in</span> <span class="n">user_roles</span><span class="p">:</span>
                    <span class="n">newroles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">role</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="k">raise</span> <span class="n">UsageError</span><span class="p">(</span><span class="s2">"Role </span><span class="si">%s</span><span class="s2"> is not permitted."</span><span class="o">%</span><span class="n">role</span><span class="p">)</span>

            <span class="n">claim</span><span class="p">[</span><span class="s1">'roles'</span><span class="p">]</span> <span class="o">=</span> <span class="n">newroles</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">claim</span><span class="p">[</span><span class="s1">'roles'</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_roles</span>
        <span class="n">secret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">WEB_JWT_SECRET</span>
        <span class="n">myjwt</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">claim</span><span class="p">,</span> <span class="n">secret</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s1">'HS256'</span><span class="p">)</span>

        <span class="c1"># if jwt.__version__ &gt;= 2.0.0 jwt.encode() returns string</span>
        <span class="c1"># not byte. So do not use b2s() with newer versions of pyjwt.</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"jwt"</span><span class="p">:</span> <span class="n">b2s</span><span class="p">(</span><span class="n">myjwt</span><span class="p">),</span>
                 <span class="p">}</span>

        <span class="k">return</span> <span class="mi">200</span><span class="p">,</span> <span class="n">result</span>

    <span class="nd">@Routing</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">"/jwt/validate"</span><span class="p">,</span> <span class="s1">'GET'</span><span class="p">)</span>
    <span class="nd">@_data_decorator</span>
    <span class="k">def</span> <span class="nf">validate_jwt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">input</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">jwt</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">'jwt'</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UsageError</span><span class="p">(</span><span class="s2">"jwt key must be specified"</span><span class="p">)</span>

        <span class="n">myjwt</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s1">'jwt'</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

        <span class="n">secret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">WEB_JWT_SECRET</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">myjwt</span><span class="p">,</span> <span class="n">secret</span><span class="p">,</span>
                                <span class="n">algorithms</span><span class="o">=</span><span class="p">[</span><span class="s1">'HS256'</span><span class="p">],</span>
                                <span class="n">audience</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">TRACKER_WEB</span><span class="p">,</span>
                                <span class="n">issuer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">TRACKER_WEB</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">jwt</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidTokenError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">401</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

        <span class="k">return</span> <span class="mi">200</span><span class="p">,</span> <span class="n">result</span>
</pre>
         </div> 
        </div> 
        <p><strong>Note this is sample code. Use at your own risk.</strong> It breaks a few rules about jwts (e.g. it allows you to make unlimited lifetime jwts). If you subscribe to the concept of jwt refresh tokens, this code will have to be changed as it will only generate jwts with username/password authentication.</p> 
        <p>Currently use of jwts an experiment. If this appeals to you consider providing patches to existing code to:</p> 
        <ol class="arabic simple"> 
         <li>record all jwts created by a user</li> 
         <li>using the record to allow jwts to be revoked and ignored by the roundup core</li> 
         <li>provide a UI page for managing/revoking jwts</li> 
         <li>provide a rest api for revoking jwts</li> 
        </ol> 
        <p>These end points can be used like:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">u</span> <span class="n">demo</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">-</span><span class="n">H</span> <span class="s2">"Referer: https://.../demo/"</span> \
   <span class="o">-</span><span class="n">H</span> <span class="s2">"X-requested-with: rest"</span> \
   <span class="o">-</span><span class="n">H</span> <span class="s2">"Content-Type: application/json"</span> \
   <span class="o">--</span><span class="n">data</span> <span class="s1">'{"lifetime": "3600", "roles": [ "user:timelog" ] }'</span> \
<span class="n">https</span><span class="p">:</span><span class="o">//.../</span><span class="n">demo</span><span class="o">/</span><span class="n">rest</span><span class="o">/</span><span class="n">jwt</span><span class="o">/</span><span class="n">issue</span>
</pre>
         </div> 
        </div> 
        <p>(note roles is a json array/list of strings not a string) to get:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="p">{</span>
  <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">"jwt"</span><span class="p">:</span>  <span class="s2">"eyJ0eXAiOiJK......XxMDb-Q3oCnMpyhxPXMAk"</span>
      <span class="p">}</span>
<span class="p">}</span>
</pre>
         </div> 
        </div> 
        <p>The jwt is shortened in the example since it’s large. You can validate a jwt to see if it’s still valid using:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span>curl -s -H "Referer: https://.../demo/" \
-H "X-requested-with: rest" \
    https://.../demo/rest/jwt/validate?jwt=eyJ0eXAiOiJK...XxMDb-Q3oCnMpyhxPXMAk
</pre>
         </div> 
        </div> 
        <p>(note no login is required) which returns:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="p">{</span>
  <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
     <span class="s2">"user"</span><span class="p">:</span> <span class="s2">"3"</span><span class="p">,</span>
     <span class="s2">"roles"</span><span class="p">:</span> <span class="p">[</span>
          <span class="s2">"user:timelog"</span>
      <span class="p">],</span>
     <span class="s2">"iss"</span><span class="p">:</span> <span class="s2">"https://.../demo/"</span><span class="p">,</span>
     <span class="s2">"aud"</span><span class="p">:</span> <span class="s2">"https://.../demo/"</span><span class="p">,</span>
     <span class="s2">"iat"</span><span class="p">:</span> <span class="mi">1569542404</span><span class="p">,</span>
     <span class="s2">"exp"</span><span class="p">:</span> <span class="mi">1569546004</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre>
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="section" id="final-steps"> 
       <h4><a class="toc-backref" href="#id46">Final steps</a></h4> 
       <p>See the <a class="reference external" href="upgrading.html">upgrading directions</a> on how to use the <code class="docutils literal notranslate"><span class="pre">updateconfig</span></code> command to generate an updated copy of config.ini using roundup-admin. Then set the <code class="docutils literal notranslate"><span class="pre">jwt_secret</span></code> to at least 32 characters (more is better up to 512 bits).</p> 
       <p>Writing an auditor that uses “db.user.get_roles” to see if the user making the change has the <code class="docutils literal notranslate"><span class="pre">user:timelog</span></code> role, and then comparing the original <code class="docutils literal notranslate"><span class="pre">times</span></code> list to the new list to verify that it is being added to and not changed otherwise is left as an exercise for the reader. (If you develop one, please contribute via the tracker: <a class="reference external" href="https://issues.roundup-tracker.org/">https://issues.roundup-tracker.org/</a>.)</p> 
       <p>Lastly you can create a JWT using the end point above and make a rest call to create a new timelog entry and another call to update the issues times property. If you have other ideas on how jwts can be used, please share on the roundup mailing lists. See: <a class="reference external" href="https://sourceforge.net/p/roundup/mailman/">https://sourceforge.net/p/roundup/mailman/</a> for directions on subscribing and for archives of the lists.</p> 
      </div> 
     </div> 
     <div class="section" id="creating-custom-rate-limits"> 
      <h3><a class="toc-backref" href="#id47">Creating Custom Rate Limits</a></h3> 
      <p>You can replace the default rate limiter that is configured using the tracker’s <code class="docutils literal notranslate"><span class="pre">config.ini</span></code>. You can return different rate limits based on the user, time of day, phase of moon etc.</p> 
      <p>Assume you add two integer valued properties to the user object. Let’s call them <code class="docutils literal notranslate"><span class="pre">rate_limit_interval</span></code> and <code class="docutils literal notranslate"><span class="pre">rate_limit_calls</span></code>. Add code similar to this to interfaces.py to override the default rate limiter code:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="kn">from</span> <span class="nn">roundup.rest</span> <span class="k">import</span> <span class="n">RestfulInstance</span><span class="p">,</span> <span class="n">RateLimit</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">timedelta</span>

<span class="k">def</span> <span class="nf">grl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">calls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">WEB_API_CALLS_PER_INTERVAL</span>
    <span class="n">interval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">WEB_API_INTERVAL_IN_SEC</span>

    <span class="k">if</span> <span class="n">calls</span> <span class="ow">and</span> <span class="n">interval</span><span class="p">:</span> <span class="c1"># use to disable all rate limits</span>

        <span class="n">uid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">getuid</span><span class="p">()</span>
        <span class="n">class_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">getclass</span><span class="p">(</span><span class="s1">'user'</span><span class="p">)</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">class_obj</span><span class="o">.</span><span class="n">getnode</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>

        <span class="c1"># set value to 0 to use WEB_API_CALLS_PER_INTERVAL</span>
        <span class="n">user_calls</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="s1">'rate_limit_calls'</span><span class="p">)</span>
        <span class="c1"># set to 0 to use WEB_API_INTERVAL_IN_SEC</span>
        <span class="n">user_interval</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="s1">'rate_limit_interval'</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">RateLimit</span><span class="p">(</span><span class="n">user_calls</span> <span class="ow">or</span> <span class="n">calls</span><span class="p">,</span>
               <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="p">(</span><span class="n">user_interval</span> <span class="ow">or</span> <span class="n">interval</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># disable rate limiting if either parameter is 0</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="n">RestfulInstance</span><span class="o">.</span><span class="n">getRateLimit</span> <span class="o">=</span> <span class="n">grl</span>
</pre>
       </div> 
      </div> 
      <p>this should replace the default getRateLimit with the new grl function. This new function uses values for the number of calls and period that are specific to a user. If either is set to 0, the defaults from <code class="docutils literal notranslate"><span class="pre">config.ini</span></code> file are used.</p> 
      <div class="section" id="test-examples"> 
       <h4><a class="toc-backref" href="#id48">Test Examples</a></h4> 
       <p>Rate limit tests:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">seq</span> <span class="mi">1</span> <span class="mi">300</span> <span class="o">|</span> <span class="n">xargs</span> <span class="o">-</span><span class="n">P</span> <span class="mi">20</span> <span class="o">-</span><span class="n">n</span> <span class="mi">1</span> <span class="n">curl</span> <span class="o">--</span><span class="n">head</span> <span class="o">-</span><span class="n">si</span> \
     <span class="n">https</span><span class="p">:</span><span class="o">//.../</span><span class="n">rest</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">status</span><span class="o">/</span><span class="n">new</span> \<span class="c1"># | grep Remaining</span>
</pre>
        </div> 
       </div> 
      </div> 
     </div> 
    </div> 
   </div> 
  </div> 
  <div class="footer"> 
   <div> <span class="source">[<a href="../_sources/docs/rest.txt" rel="nofollow">page source</a>]</span> © Copyright 2009-2021, Richard Jones, Roundup-Team. 
   </div> 
   <div>
     Last updated on May 09, 2022. <span>Hosted by <a href="https://sourceforge.net"><img src="https://sflogo.sourceforge.net/sflogo.php?group_id=31577&amp;type=1" width="88" height="31" border="0" alt="SourceForge.net Logo"></a></span> 
   </div> 
  </div> 
  <script>
      /* locally hosted goatcounter https://www.goatcounter.com/ */
      /* include site info in path url to allow multiple sites to be
      tracked together */
      window.goatcounter = {
      path: function(p) { return location.host + p }
      }
    </script> 
  <script data-goatcounter="https://stats.rouilj.dynamic-dns.net/count" integrity="sha384-QGgNMMRFTi8ul5kHJ+vXysPe8gySvSA/Y3rpXZiRLzKPIw8CWY+a3ObKmQsyDr+a" async src="/_static/goatcounter_count.v3.js">
    </script>  
 </body>
</html>