<!doctype html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"> 
 <head> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1"> 
  <meta name="Description" content="Documentation on the Roundup issue tracker, version 2.1.0."> 
  <meta content="How to customize and extend the Roundup Issue Tracker. Includes many cookbook and how-to examples. Reference for the design and internals needed to understand and extend the examples to meet new needs." language="en" name="description"> 
  <title>Customising Roundup - Roundup 2.1.0 documentation</title> 
  <link rel="stylesheet" href="../_static/style.css" type="text/css"> 
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css"> 
  <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '../',
          VERSION:     '2.1.0',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script> 
  <script type="text/javascript" src="../_static/jquery.js"></script> 
  <script type="text/javascript" src="../_static/underscore.js"></script> 
  <script type="text/javascript" src="../_static/doctools.js"></script> 
  <script type="text/javascript" src="../_static/language_data.js"></script> 
  <link rel="canonical" href="https://www.roundup-tracker.org/docs/customizing.html"> 
  <link rel="index" title="Index" href="../genindex.html"> 
  <link rel="search" title="Search" href="../search.html"> 
  <link rel="top" title="Roundup 2.1.0 documentation" href="../index.html"> 
  <link rel="up" title="Docs" href="../docs.html"> 
  <link rel="next" title="Administration Guide" href="admin_guide.html"> 
  <link rel="prev" title="User Guide" href="user_guide.html"> 
 </head> 
 <body> 
  <div class="header">
   <h1>Roundup</h1> 
   <div id="searchbox" style="display: none"> 
    <form class="search" action="../search.html" method="get"> 
     <input type="text" aria-label="Enter search terms" name="q" size="18"> 
     <input type="submit" value="Search"> 
     <input type="hidden" name="check_keywords" value="yes"> 
     <input type="hidden" name="area" value="default"> 
    </form> 
   </div> 
   <script type="text/javascript">$('#searchbox').show(0);</script> 
  </div> 
  <div class="navigation"> 
   <div class="menu"> 
    <ul class="current"> 
     <li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li> 
     <li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/roundup/">Download</a></li> 
     <li class="toctree-l1 current"><a class="reference internal" href="../docs.html">Docs</a>
      <ul class="current"> 
       <li class="toctree-l2"><a class="reference internal" href="features.html">Roundup Features</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="installation.html">Installing Roundup</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="upgrading.html">Upgrading to newer versions of Roundup</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="FAQ.html">Roundup FAQ</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="user_guide.html">User Guide</a></li> 
       <li class="toctree-l2 current"><a class="current reference internal" href="#">Customising Roundup</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="admin_guide.html">Administration Guide</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="debugging.html">Debugging Aids</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="xmlrpc.html">XML-RPC access to Roundup</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="rest.html">REST API for Roundup</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="tracker_templates.html">Roundup Tracker Templates</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="glossary.html">Roundup Glossary</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="acknowledgements.html">Acknowledgements</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="license.html">License</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="overview.html">Design Overview</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="design.html">Design (original)</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="developers.html">Developing Roundup</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="mysql.html">Notes about the MySQL Database backend</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="postgresql.html">Notes about the PostgreSQL Database backend</a></li> 
       <li class="toctree-l2"><a class="reference internal" href="implementation.html">Richard Jones implementation notes</a></li> 
      </ul> </li> 
     <li class="toctree-l1"><a class="reference external" href="https://issues.roundup-tracker.org">Issues</a></li> 
     <li class="toctree-l1"><a class="reference internal" href="../contact.html">Contact</a></li> 
     <li class="toctree-l1"><a class="reference external" href="https://wiki.roundup-tracker.org">Wiki</a></li> 
     <li class="toctree-l1"><a class="reference internal" href="../code.html">Code</a></li> 
    </ul> 
   </div> 
  </div> 
  <div class="content"> 
   <div id="subnav"> <a title="User Guide" href="user_guide.html"> Prev</a> <a title="Administration Guide" href="admin_guide.html"> Next</a> <a title="Index" href="../genindex.html"> Index</a> 
   </div> 
   <div class="section" id="customising-roundup"> 
    <h1>Customising Roundup</h1> 
    <div class="contents local topic" id="contents"> 
     <ul class="simple"> 
      <li><a class="reference internal" href="#what-you-can-do" id="id7">What You Can Do</a></li> 
      <li><a class="reference internal" href="#trackers-in-a-nutshell" id="id8">Trackers in a Nutshell</a></li> 
      <li><a class="reference internal" href="#tracker-configuration" id="id9">Tracker Configuration</a>
       <ul> 
        <li><a class="reference internal" href="#extending-the-configuration-file" id="id10">Extending the configuration file</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#tracker-schema" id="id11">Tracker Schema</a>
       <ul> 
        <li><a class="reference internal" href="#the-schema-py-and-initial-data-py-modules" id="id12">The <code class="docutils literal notranslate"><span class="pre">schema.py</span></code> and <code class="docutils literal notranslate"><span class="pre">initial_data.py</span></code> modules</a></li> 
        <li><a class="reference internal" href="#the-classic-schema" id="id13">The “classic” schema</a></li> 
        <li><a class="reference internal" href="#what-you-can-t-do-to-the-schema" id="id14">What you can’t do to the schema</a></li> 
        <li><a class="reference internal" href="#what-you-can-do-to-the-schema" id="id15">What you can do to the schema</a></li> 
        <li><a class="reference internal" href="#classes-and-properties-creating-a-new-information-store" id="id16">Classes and Properties - creating a new information store</a></li> 
        <li><a class="reference internal" href="#examples-of-adding-to-your-schema" id="id17">Examples of adding to your schema</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#detectors-adding-behaviour-to-your-tracker" id="id18">Detectors - adding behaviour to your tracker</a>
       <ul> 
        <li><a class="reference internal" href="#detector-api" id="id19">Detector API</a></li> 
        <li><a class="reference internal" href="#additional-detectors-ready-for-use" id="id20">Additional Detectors Ready For Use</a></li> 
        <li><a class="reference internal" href="#auditor-or-reactor" id="id21">Auditor or Reactor?</a></li> 
        <li><a class="reference internal" href="#vetoing-creation-of-or-changes-to-items" id="id22">Vetoing creation of or changes to items</a></li> 
        <li><a class="reference internal" href="#generating-email-from-roundup" id="id23">Generating email from Roundup</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#extensions-adding-capabilities-to-your-tracker" id="id24">Extensions - adding capabilities to your tracker</a></li> 
      <li><a class="reference internal" href="#interfaces-py-hooking-into-the-core-of-roundup" id="id25">interfaces.py - hooking into the core of roundup</a>
       <ul> 
        <li><a class="reference internal" href="#example-changing-cache-control-headers" id="id26">Example: Changing Cache-Control headers</a></li> 
        <li><a class="reference internal" href="#example-implement-password-complexity-checking" id="id27">Example: Implement password complexity checking</a></li> 
        <li><a class="reference internal" href="#example-enhance-time-intervals" id="id28">Example: Enhance time intervals</a></li> 
        <li><a class="reference internal" href="#example-modifying-the-mail-gateway" id="id29">Example: Modifying the mail gateway</a></li> 
        <li><a class="reference internal" href="#other-examples" id="id30">Other Examples</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#database-content" id="id31">Database Content</a></li> 
      <li><a class="reference internal" href="#security-access-controls" id="id32">Security / Access Controls</a>
       <ul> 
        <li><a class="reference internal" href="#automatic-permission-checks" id="id33">Automatic Permission Checks</a></li> 
        <li><a class="reference internal" href="#new-user-roles" id="id34">New User Roles</a></li> 
        <li><a class="reference internal" href="#changing-access-controls" id="id35">Changing Access Controls</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#web-interface" id="id36">Web Interface</a>
       <ul> 
        <li><a class="reference internal" href="#repercussions-of-changing-the-tracker-schema" id="id37">Repercussions of changing the tracker schema</a></li> 
        <li><a class="reference internal" href="#how-requests-are-processed" id="id38">How requests are processed</a></li> 
        <li><a class="reference internal" href="#roundup-url-design" id="id39">Roundup URL design</a></li> 
        <li><a class="reference internal" href="#determining-web-context" id="id40">Determining web context</a></li> 
        <li><a class="reference internal" href="#the-home-context" id="id41">The “home” Context</a></li> 
        <li><a class="reference internal" href="#serving-static-content" id="id42">Serving static content</a></li> 
        <li><a class="reference internal" href="#performing-actions-in-web-requests" id="id43">Performing actions in web requests</a></li> 
        <li><a class="reference internal" href="#protecting-users-from-web-application-attacks" id="id44">Protecting users from web application attacks</a></li> 
        <li><a class="reference internal" href="#special-form-variables" id="id45">Special form variables</a></li> 
        <li><a class="reference internal" href="#default-templates" id="id46">Default templates</a></li> 
        <li><a class="reference internal" href="#implementing-modal-editing-using-template" id="id47">Implementing Modal Editing Using @template</a></li> 
        <li><a class="reference internal" href="#how-the-templates-work" id="id48">How the templates work</a></li> 
        <li><a class="reference internal" href="#information-available-to-templates" id="id49">Information available to templates</a></li> 
        <li><a class="reference internal" href="#displaying-properties" id="id50">Displaying Properties</a></li> 
        <li><a class="reference internal" href="#index-views" id="id51">Index Views</a></li> 
        <li><a class="reference internal" href="#searching-views" id="id52">Searching Views</a></li> 
        <li><a class="reference internal" href="#item-views" id="id53">Item Views</a></li> 
        <li><a class="reference internal" href="#defining-new-web-actions" id="id54">Defining new web actions</a></li> 
        <li><a class="reference internal" href="#bit-character-set-support-in-web-interface" id="id55">8-bit character set support in Web interface</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#examples" id="id56">Examples</a>
       <ul> 
        <li><a class="reference internal" href="#changing-what-s-stored-in-the-database" id="id57">Changing what’s stored in the database</a></li> 
        <li><a class="reference internal" href="#using-external-user-databases" id="id58">Using External User Databases</a></li> 
        <li><a class="reference internal" href="#changes-to-tracker-behaviour" id="id59">Changes to Tracker Behaviour</a></li> 
        <li><a class="reference internal" href="#changes-to-security-and-permissions" id="id60">Changes to Security and Permissions</a></li> 
        <li><a class="reference internal" href="#changes-to-the-web-user-interface" id="id61">Changes to the Web User Interface</a></li> 
       </ul> </li> 
      <li><a class="reference internal" href="#debugging-trackers" id="id62">Debugging Trackers</a></li> 
     </ul> 
    </div> 
    <div class="section" id="what-you-can-do"> 
     <h2><a class="toc-backref" href="#id7">What You Can Do</a></h2> 
     <p>Before you get too far, it’s probably worth having a quick read of the Roundup <a class="reference external" href="design.html">design documentation</a>.</p> 
     <p>Customisation of Roundup can take one of six forms:</p> 
     <ol class="arabic simple"> 
      <li><a class="reference internal" href="#tracker-configuration">tracker configuration</a> changes</li> 
      <li>database, or <a class="reference internal" href="#tracker-schema">tracker schema</a> changes</li> 
      <li>“definition” class <a class="reference internal" href="#database-content">database content</a> changes</li> 
      <li>behavioural changes through <a class="reference internal" href="#detectors">detectors</a>, <a class="reference internal" href="#extensions">extensions</a> and <a class="reference internal" href="#interfaces-py">interfaces.py</a></li> 
      <li><a class="reference internal" href="#security-access-controls">security / access controls</a></li> 
      <li>change the <a class="reference internal" href="#web-interface">web interface</a></li> 
     </ol> 
     <p>The third case is special because it takes two distinctly different forms depending upon whether the tracker has been initialised or not. The other two may be done at any time, before or after tracker initialisation. Yes, this includes adding or removing properties from classes.</p> 
    </div> 
    <div class="section" id="trackers-in-a-nutshell"> 
     <h2><a class="toc-backref" href="#id8">Trackers in a Nutshell</a></h2> 
     <p>Trackers have the following structure:</p> 
     <table border="1" class="docutils" id="index-0"> 
      <colgroup> 
       <col width="25%"> 
       <col width="75%"> 
      </colgroup> 
      <thead valign="bottom"> 
       <tr class="row-odd">
        <th class="head">Tracker File</th> 
        <th class="head">Description</th> 
       </tr> 
      </thead> 
      <tbody valign="top"> 
       <tr class="row-even">
        <td>config.ini</td> 
        <td>Holds the basic <a class="reference internal" href="#tracker-configuration">tracker configuration</a></td> 
       </tr> 
       <tr class="row-odd">
        <td>schema.py</td> 
        <td>Holds the <a class="reference internal" href="#tracker-schema">tracker schema</a></td> 
       </tr> 
       <tr class="row-even">
        <td>initial_data.py</td> 
        <td>Holds any data to be entered into the database when the tracker is initialised.</td> 
       </tr> 
       <tr class="row-odd">
        <td>db/</td> 
        <td>Holds the tracker’s database</td> 
       </tr> 
       <tr class="row-even">
        <td>db/files/</td> 
        <td>Holds the tracker’s upload files and messages</td> 
       </tr> 
       <tr class="row-odd">
        <td>db/backend_name</td> 
        <td>Names the database back-end for the tracker (obsolete). Current way uses the <code class="docutils literal notranslate"><span class="pre">backend</span></code> setting in the rdbms section of config.ini.</td> 
       </tr> 
       <tr class="row-even">
        <td>detectors/</td> 
        <td>Auditors and reactors for this tracker</td> 
       </tr> 
       <tr class="row-odd">
        <td>extensions/</td> 
        <td>Additional actions and <a class="reference internal" href="#templating-utilities">templating utilities</a></td> 
       </tr> 
       <tr class="row-even">
        <td>html/</td> 
        <td>Web interface templates, images and style sheets</td> 
       </tr> 
       <tr class="row-odd">
        <td>lib/</td> 
        <td>optional common imports for detectors and extensions</td> 
       </tr> 
      </tbody> 
     </table> <span class="target" id="index-1"></span>
    </div> 
    <div class="section" id="tracker-configuration"> <span id="index-2"></span>
     <h2><a class="toc-backref" href="#id9">Tracker Configuration</a></h2> 
     <p>The <code class="docutils literal notranslate"><span class="pre">config.ini</span></code> located in your tracker home contains the basic configuration for the web and e-mail components of roundup’s interfaces.</p> 
     <p>Changes to the data captured by your tracker is controlled by the <a class="reference internal" href="#tracker-schema">tracker schema</a>. Some configuration is also performed using permissions - see the <a class="reference internal" href="#security-access-controls">security / access controls</a> section. For example, to allow users to automatically register through the email interface, you must grant the “Anonymous” Role the “Email Access” Permission.</p> 
     <p id="index-3">The following is taken from the <a class="reference external" href="https://docs.python.org/2/library/configparser.html">Python Library Reference</a> (July 18, 2018) section “ConfigParser – Configuration file parser”:</p> 
     <blockquote> 
      <div>
       <p>The configuration file consists of sections, led by a [section] header and followed by name: value entries, with continuations in the style of RFC 822 (see section 3.1.1, “LONG HEADER FIELDS”); name=value is also accepted. Note that leading whitespace is removed from values. The optional values can contain format strings which refer to other values in the same section, or values in a special DEFAULT section. Additional defaults can be provided on initialization and retrieval. Lines beginning with ‘#’ or ‘;’ are ignored and may be used to provide comments.</p> 
       <p>For example:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="p">[</span><span class="n">My</span> <span class="n">Section</span><span class="p">]</span>
<span class="n">foodir</span> <span class="o">=</span> <span class="o">%</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span><span class="n">s</span><span class="o">/</span><span class="n">whatever</span>
<span class="nb">dir</span> <span class="o">=</span> <span class="n">frob</span>
</pre>
        </div> 
       </div> 
       <p>would resolve the “%(dir)s” to the value of “dir” (“frob” in this case) resulting in “foodir” being “frob/whatever”.</p> 
      </div>
     </blockquote> 
     <p>Example configuration settings are below. This is a partial list. Documentation on all the settings is included in the <code class="docutils literal notranslate"><span class="pre">config.ini</span></code> file.</p> 
     <dl class="docutils" id="index-4"> 
      <dt>
       Section <strong>main</strong>
      </dt> 
      <dd>
       <dl class="first last docutils"> 
        <dt>
         database – <code class="docutils literal notranslate"><span class="pre">db</span></code>
        </dt> 
        <dd>
         Database directory path. The path may be either absolute or relative to the directory containig this config file.
        </dd> 
        <dt>
         templates – <code class="docutils literal notranslate"><span class="pre">html</span></code>
        </dt> 
        <dd>
         Path to the HTML templates directory. The path may be either absolute or relative to the directory containing this config file.
        </dd> 
        <dt>
         static_files – default <em>blank</em>
        </dt> 
        <dd>
         A list of space separated directory paths (or a single directory). These directories hold additional static files available via Web UI. These directories may contain sitewide images, CSS stylesheets etc. If a ‘-‘ is included, the list processing ends and the TEMPLATES directory is not searched after the specified directories. If this option is not set, all static files are taken from the TEMPLATES directory.
        </dd> 
        <dt>
         admin_email – <code class="docutils literal notranslate"><span class="pre">roundup-admin</span></code>
        </dt> 
        <dd>
         Email address that roundup will complain to if it runs into trouble. If the email address doesn’t contain an <code class="docutils literal notranslate"><span class="pre">@</span></code> part, the MAIL_DOMAIN defined below is used.
        </dd> 
        <dt>
         dispatcher_email – <code class="docutils literal notranslate"><span class="pre">roundup-admin</span></code>
        </dt> 
        <dd>
         The ‘dispatcher’ is a role that can get notified of new items to the database. It is used by the ERROR_MESSAGES_TO config setting. If the email address doesn’t contain an <code class="docutils literal notranslate"><span class="pre">@</span></code> part, the MAIL_DOMAIN defined below is used.
        </dd> 
        <dt>
         email_from_tag – default <em>blank</em>
        </dt> 
        <dd>
         Additional text to include in the “name” part of the From: address used in nosy messages. If the sending user is “Foo Bar”, the From: line is usually: <code class="docutils literal notranslate"><span class="pre">"Foo</span> <span class="pre">Bar"</span> <span class="pre">&lt;issue_tracker@tracker.example&gt;</span></code> the EMAIL_FROM_TAG goes inside the “Foo Bar” quotes like so: <code class="docutils literal notranslate"><span class="pre">"Foo</span> <span class="pre">Bar</span> <span class="pre">EMAIL_FROM_TAG"</span> <span class="pre">&lt;issue_tracker@tracker.example&gt;</span></code>
        </dd> 
        <dt>
         new_web_user_roles – <code class="docutils literal notranslate"><span class="pre">User</span></code>
        </dt> 
        <dd>
         Roles that a user gets when they register with Web User Interface. This is a comma-separated list of role names (e.g. <code class="docutils literal notranslate"><span class="pre">Admin,User</span></code>).
        </dd> 
        <dt>
         new_email_user_roles – <code class="docutils literal notranslate"><span class="pre">User</span></code>
        </dt> 
        <dd>
         Roles that a user gets when they register with Email Gateway. This is a comma-separated string of role names (e.g. <code class="docutils literal notranslate"><span class="pre">Admin,User</span></code>).
        </dd> 
        <dt>
         error_messages_to – <code class="docutils literal notranslate"><span class="pre">user</span></code>
        </dt> 
        <dd>
         Send error message emails to the <code class="docutils literal notranslate"><span class="pre">dispatcher</span></code>, <code class="docutils literal notranslate"><span class="pre">user</span></code>, or <code class="docutils literal notranslate"><span class="pre">both</span></code>? The dispatcher is configured using the DISPATCHER_EMAIL setting. Allowed values: <code class="docutils literal notranslate"><span class="pre">dispatcher</span></code>, <code class="docutils literal notranslate"><span class="pre">user</span></code>, or <code class="docutils literal notranslate"><span class="pre">both</span></code>
        </dd> 
        <dt>
         html_version – <code class="docutils literal notranslate"><span class="pre">html4</span></code>
        </dt> 
        <dd>
         HTML version to generate. The templates are <code class="docutils literal notranslate"><span class="pre">html4</span></code> by default. If you wish to make them xhtml, then you’ll need to change this var to <code class="docutils literal notranslate"><span class="pre">xhtml</span></code> too so all auto-generated HTML is compliant. Allowed values: <code class="docutils literal notranslate"><span class="pre">html4</span></code>, <code class="docutils literal notranslate"><span class="pre">xhtml</span></code>
        </dd> 
        <dt>
         timezone – <code class="docutils literal notranslate"><span class="pre">0</span></code>
        </dt> 
        <dd>
         Numeric timezone offset used when users do not choose their own in their settings.
        </dd> 
        <dt>
         instant_registration – <code class="docutils literal notranslate"><span class="pre">yes</span></code>
        </dt> 
        <dd>
         Register new users instantly, or require confirmation via email? Allowed values: <code class="docutils literal notranslate"><span class="pre">yes</span></code>, <code class="docutils literal notranslate"><span class="pre">no</span></code>
        </dd> 
        <dt>
         email_registration_confirmation – <code class="docutils literal notranslate"><span class="pre">yes</span></code>
        </dt> 
        <dd>
         Offer registration confirmation by email or only through the web? Allowed values: <code class="docutils literal notranslate"><span class="pre">yes</span></code>, <code class="docutils literal notranslate"><span class="pre">no</span></code>
        </dd> 
        <dt>
         indexer_stopwords – default <em>blank</em>
        </dt> 
        <dd>
         Additional stop-words for the full-text indexer specific to your tracker. See the indexer source for the default list of stop-words (e.g. <code class="docutils literal notranslate"><span class="pre">A,AND,ARE,AS,AT,BE,BUT,BY,</span> <span class="pre">...</span></code>).
        </dd> 
        <dt>
         umask – <code class="docutils literal notranslate"><span class="pre">02</span></code>
        </dt> 
        <dd>
         Defines the file creation mode mask.
        </dd> 
        <dt>
         csv_field_size – <code class="docutils literal notranslate"><span class="pre">131072</span></code>
        </dt> 
        <dd>
         Maximum size of a csv-field during import. Roundups export format is a csv (comma separated values) variant. The csv reader has a limit on the size of individual fields starting with python 2.5. Set this to a higher value if you get the error ‘Error: field larger than field limit’ during import.
        </dd> 
       </dl> 
      </dd> 
     </dl> 
     <dl class="docutils" id="index-5"> 
      <dt>
       Section <strong>tracker</strong>
      </dt> 
      <dd>
       <dl class="first last docutils"> 
        <dt>
         name – <code class="docutils literal notranslate"><span class="pre">Roundup</span> <span class="pre">issue</span> <span class="pre">tracker</span></code>
        </dt> 
        <dd>
         A descriptive name for your roundup instance.
        </dd> 
        <dt>
         web – <code class="docutils literal notranslate"><span class="pre">http://host.example/demo/</span></code>
        </dt> 
        <dd>
         The web address that the tracker is viewable at. This will be included in information sent to users of the tracker. The URL MUST include the cgi-bin part or anything else that is required to get to the home page of the tracker. You MUST include a trailing ‘/’ in the URL.
        </dd> 
        <dt>
         email – <code class="docutils literal notranslate"><span class="pre">issue_tracker</span></code>
        </dt> 
        <dd>
         Email address that mail to roundup should go to.
        </dd> 
        <dt>
         language – default <em>blank</em>
        </dt> 
        <dd>
         Default locale name for this tracker. If this option is not set, the language is determined by the environment variable LANGUAGE, LC_ALL, LC_MESSAGES, or LANG, in that order of preference.
        </dd> 
       </dl> 
      </dd> 
     </dl> 
     <dl class="docutils" id="index-6"> 
      <dt>
       Section <strong>web</strong>
      </dt> 
      <dd>
       <dl class="first last docutils"> 
        <dt>
         allow_html_file – <code class="docutils literal notranslate"><span class="pre">no</span></code>
        </dt> 
        <dd>
         Setting this option enables Roundup to serve uploaded HTML file content <em>as HTML</em>. This is a potential security risk and is therefore disabled by default. Set to ‘yes’ if you trust <em>all</em> users uploading content to your tracker.
        </dd> 
        <dt>
         http_auth – <code class="docutils literal notranslate"><span class="pre">yes</span></code>
        </dt> 
        <dd>
         Whether to use HTTP Basic Authentication, if present. Roundup will use either the REMOTE_USER or HTTP_AUTHORIZATION variables supplied by your web server (in that order). Set this option to ‘no’ if you do not wish to use HTTP Basic Authentication in your web interface.
        </dd> 
        <dt>
         use_browser_language – <code class="docutils literal notranslate"><span class="pre">yes</span></code>
        </dt> 
        <dd>
         Whether to use HTTP Accept-Language, if present. Browsers send a language-region preference list. It’s usually set in the client’s browser or in their Operating System. Set this option to ‘no’ if you want to ignore it.
        </dd> 
        <dt>
         debug – <code class="docutils literal notranslate"><span class="pre">no</span></code>
        </dt> 
        <dd>
         Setting this option makes Roundup display error tracebacks in the user’s browser rather than emailing them to the tracker admin.”),
        </dd> 
       </dl> 
      </dd> 
     </dl> 
     <dl class="docutils" id="index-7"> 
      <dt>
       Section <strong>rdbms</strong>
      </dt> 
      <dd>
       <p class="first">Settings in this section are used to set the backend and configure addition settings needed by RDBMs like SQLite, Postgresql and MySQL backends.</p> 
       <dl class="docutils" id="index-8"> 
        <dt>
         backend – set to value by init
        </dt> 
        <dd>
         The database backend such as anydbm, sqlite, mysql or postgres.
        </dd> 
        <dt>
         name – <code class="docutils literal notranslate"><span class="pre">roundup</span></code>
        </dt> 
        <dd>
         Name of the database to use.
        </dd> 
        <dt>
         host – <code class="docutils literal notranslate"><span class="pre">localhost</span></code>
        </dt> 
        <dd>
         Database server host.
        </dd> 
        <dt>
         port – default <em>blank</em>
        </dt> 
        <dd>
         TCP port number of the database server. Postgresql usually resides on port 5432 (if any), for MySQL default port number is 3306. Leave this option empty to use backend default.
        </dd> 
        <dt>
         user – <code class="docutils literal notranslate"><span class="pre">roundup</span></code>
        </dt> 
        <dd>
         Database user name that Roundup should use.
        </dd> 
        <dt>
         password – <code class="docutils literal notranslate"><span class="pre">roundup</span></code>
        </dt> 
        <dd>
         Database user password.
        </dd> 
        <dt>
         read_default_file – <code class="docutils literal notranslate"><span class="pre">~/.my.cnf</span></code>
        </dt> 
        <dd>
         Name of the MySQL defaults file. Only used in MySQL connections.
        </dd> 
        <dt>
         read_default_group – <code class="docutils literal notranslate"><span class="pre">roundup</span></code>
        </dt> 
        <dd>
         Name of the group to use in the MySQL defaults file. Only used in MySQL connections.
        </dd> 
       </dl> 
       <dl class="last docutils" id="index-9"> 
        <dt>
         sqlite_timeout – <code class="docutils literal notranslate"><span class="pre">30</span></code>
        </dt> 
        <dd>
         Number of seconds to wait when the SQLite database is locked. Used only for SQLite.
        </dd> 
        <dt>
         cache_size – <cite>100</cite>
        </dt> 
        <dd>
         Size of the node cache (in elements) used to keep most recently used data in memory.
        </dd> 
       </dl> 
      </dd> 
     </dl> 
     <dl class="docutils" id="index-10"> 
      <dt>
       Section <strong>logging</strong>
      </dt> 
      <dd>
       <dl class="first last docutils"> 
        <dt>
         config – default <em>blank</em>
        </dt> 
        <dd>
         Path to configuration file for standard Python logging module. If this option is set, logging configuration is loaded from specified file; options ‘filename’ and ‘level’ in this section are ignored. The path may be either absolute or relative to the directory containig this config file.
        </dd> 
        <dt>
         filename – default <em>blank</em>
        </dt> 
        <dd>
         Log file name for minimal logging facility built into Roundup. If no file name specified, log messages are written on stderr. If above ‘config’ option is set, this option has no effect. The path may be either absolute or relative to the directory containig this config file.
        </dd> 
        <dt>
         level – <code class="docutils literal notranslate"><span class="pre">ERROR</span></code>
        </dt> 
        <dd>
         Minimal severity level of messages written to log file. If above ‘config’ option is set, this option has no effect. Allowed values: <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code>, <code class="docutils literal notranslate"><span class="pre">INFO</span></code>, <code class="docutils literal notranslate"><span class="pre">WARNING</span></code>, <code class="docutils literal notranslate"><span class="pre">ERROR</span></code>
        </dd> 
       </dl> 
      </dd> 
     </dl> 
     <dl class="docutils" id="index-11"> 
      <dt>
       Section <strong>mail</strong>
      </dt> 
      <dd>
       <p class="first">Outgoing email options. Used for nosy messages, password reset and registration approval requests.</p> 
       <dl class="last docutils"> 
        <dt>
         domain – <code class="docutils literal notranslate"><span class="pre">localhost</span></code>
        </dt> 
        <dd>
         Domain name used for email addresses.
        </dd> 
        <dt>
         host – default <em>blank</em>
        </dt> 
        <dd>
         SMTP mail host that roundup will use to send mail
        </dd> 
        <dt>
         username – default <em>blank</em>
        </dt> 
        <dd>
         SMTP login name. Set this if your mail host requires authenticated access. If username is not empty, password (below) MUST be set!
        </dd> 
        <dt>
         password – default <em>blank</em>
        </dt> 
        <dd>
         SMTP login password. Set this if your mail host requires authenticated access.
        </dd> 
        <dt>
         port – default <em>25</em>
        </dt> 
        <dd>
         SMTP port on mail host. Set this if your mail host runs on a different port.
        </dd> 
        <dt>
         local_hostname – default <em>blank</em>
        </dt> 
        <dd>
         The fully qualified domain name (FQDN) to use during SMTP sessions. If left blank, the underlying SMTP library will attempt to detect your FQDN. If your mail host requires something specific, specify the FQDN to use.
        </dd> 
        <dt>
         tls – <code class="docutils literal notranslate"><span class="pre">no</span></code>
        </dt> 
        <dd>
         If your SMTP mail host provides or requires TLS (Transport Layer Security) then you may set this option to ‘yes’. Allowed values: <code class="docutils literal notranslate"><span class="pre">yes</span></code>, <code class="docutils literal notranslate"><span class="pre">no</span></code>
        </dd> 
        <dt>
         tls_keyfile – default <em>blank</em>
        </dt> 
        <dd>
         If TLS is used, you may set this option to the name of a PEM formatted file that contains your private key. The path may be either absolute or relative to the directory containig this config file.
        </dd> 
        <dt>
         tls_certfile – default <em>blank</em>
        </dt> 
        <dd>
         If TLS is used, you may set this option to the name of a PEM formatted certificate chain file. The path may be either absolute or relative to the directory containig this config file.
        </dd> 
        <dt>
         charset – utf-8
        </dt> 
        <dd>
         Character set to encode email headers with. We use utf-8 by default, as it’s the most flexible. Some mail readers (eg. Eudora) can’t cope with that, so you might need to specify a more limited character set (eg. iso-8859-1).
        </dd> 
        <dt>
         debug – default <em>blank</em>
        </dt> 
        <dd>
         Setting this option makes Roundup to write all outgoing email messages to this file <em>instead</em> of sending them. This option has the same effect as environment variable SENDMAILDEBUG. Environment variable takes precedence. The path may be either absolute or relative to the directory containig this config file.
        </dd> 
        <dt>
         add_authorinfo – <code class="docutils literal notranslate"><span class="pre">yes</span></code>
        </dt> 
        <dd>
         Add a line with author information at top of all messages send by roundup.
        </dd> 
        <dt>
         add_authoremail – <code class="docutils literal notranslate"><span class="pre">yes</span></code>
        </dt> 
        <dd>
         Add the mail address of the author to the author information at the top of all messages. If this is false but add_authorinfo is true, only the name of the actor is added which protects the mail address of the actor from being exposed at mail archives, etc.
        </dd> 
       </dl> 
      </dd> 
     </dl> 
     <dl class="docutils" id="index-12"> 
      <dt>
       Section <strong>mailgw</strong>
      </dt> 
      <dd>
       <p class="first">Roundup Mail Gateway options</p> 
       <dl class="last docutils"> 
        <dt>
         keep_quoted_text – <code class="docutils literal notranslate"><span class="pre">yes</span></code>
        </dt> 
        <dd>
         Keep email citations when accepting messages. Setting this to <code class="docutils literal notranslate"><span class="pre">no</span></code> strips out “quoted” text from the message. Signatures are also stripped. Allowed values: <code class="docutils literal notranslate"><span class="pre">yes</span></code>, <code class="docutils literal notranslate"><span class="pre">no</span></code>
        </dd> 
        <dt>
         leave_body_unchanged – <code class="docutils literal notranslate"><span class="pre">no</span></code>
        </dt> 
        <dd>
         Preserve the email body as is - that is, keep the citations <em>and</em> signatures. Allowed values: <code class="docutils literal notranslate"><span class="pre">yes</span></code>, <code class="docutils literal notranslate"><span class="pre">no</span></code>
        </dd> 
        <dt>
         default_class – <code class="docutils literal notranslate"><span class="pre">issue</span></code>
        </dt> 
        <dd>
         Default class to use in the mailgw if one isn’t supplied in email subjects. To disable, leave the value blank.
        </dd> 
        <dt>
         language – default <em>blank</em>
        </dt> 
        <dd>
         Default locale name for the tracker mail gateway. If this option is not set, mail gateway will use the language of the tracker instance.
        </dd> 
        <dt>
         subject_prefix_parsing – <code class="docutils literal notranslate"><span class="pre">strict</span></code>
        </dt> 
        <dd>
         Controls the parsing of the [prefix] on subject lines in incoming emails. <code class="docutils literal notranslate"><span class="pre">strict</span></code> will return an error to the sender if the [prefix] is not recognised. <code class="docutils literal notranslate"><span class="pre">loose</span></code> will attempt to parse the [prefix] but just pass it through as part of the issue title if not recognised. <code class="docutils literal notranslate"><span class="pre">none</span></code> will always pass any [prefix] through as part of the issue title.
        </dd> 
        <dt>
         subject_suffix_parsing – <code class="docutils literal notranslate"><span class="pre">strict</span></code>
        </dt> 
        <dd>
         Controls the parsing of the [suffix] on subject lines in incoming emails. <code class="docutils literal notranslate"><span class="pre">strict</span></code> will return an error to the sender if the [suffix] is not recognised. <code class="docutils literal notranslate"><span class="pre">loose</span></code> will attempt to parse the [suffix] but just pass it through as part of the issue title if not recognised. <code class="docutils literal notranslate"><span class="pre">none</span></code> will always pass any [suffix] through as part of the issue title.
        </dd> 
        <dt>
         subject_suffix_delimiters – <code class="docutils literal notranslate"><span class="pre">[]</span></code>
        </dt> 
        <dd>
         Defines the brackets used for delimiting the commands suffix in a subject line.
        </dd> 
        <dt>
         subject_content_match – <code class="docutils literal notranslate"><span class="pre">always</span></code>
        </dt> 
        <dd>
         Controls matching of the incoming email subject line against issue titles in the case where there is no designator [prefix]. <code class="docutils literal notranslate"><span class="pre">never</span></code> turns off matching. <code class="docutils literal notranslate"><span class="pre">creation</span> <span class="pre">+</span> <span class="pre">interval</span></code> or <code class="docutils literal notranslate"><span class="pre">activity</span> <span class="pre">+</span> <span class="pre">interval</span></code> will match an issue for the interval after the issue’s creation or last activity. The interval is a standard Roundup interval.
        </dd> 
        <dt>
         subject_updates_title – <code class="docutils literal notranslate"><span class="pre">yes</span></code>
        </dt> 
        <dd>
         Update issue title if incoming subject of email is different. Setting this to <code class="docutils literal notranslate"><span class="pre">no</span></code> will ignore the title part of the subject of incoming email messages.
        </dd> 
        <dt>
         refwd_re – <code class="docutils literal notranslate"><span class="pre">(\s*\W?\s*(fw|fwd|re|aw|sv|ang)\W)+</span></code>
        </dt> 
        <dd>
         Regular expression matching a single reply or forward prefix prepended by the mailer. This is explicitly stripped from the subject during parsing. Value is Python Regular Expression (UTF8-encoded).
        </dd> 
        <dt>
         origmsg_re – `` ^[&gt;|s]*—–s?Original Messages?—–$``
        </dt> 
        <dd>
         Regular expression matching start of an original message if quoted in the body. Value is Python Regular Expression (UTF8-encoded).
        </dd> 
        <dt>
         sign_re – <code class="docutils literal notranslate"><span class="pre">^[&gt;|\s]*--</span> <span class="pre">?$</span></code>
        </dt> 
        <dd>
         Regular expression matching the start of a signature in the message body. Value is Python Regular Expression (UTF8-encoded).
        </dd> 
        <dt>
         eol_re – <code class="docutils literal notranslate"><span class="pre">[\r\n]+</span></code>
        </dt> 
        <dd>
         Regular expression matching end of line. Value is Python Regular Expression (UTF8-encoded).
        </dd> 
        <dt>
         blankline_re – <code class="docutils literal notranslate"><span class="pre">[\r\n]+\s*[\r\n]+</span></code>
        </dt> 
        <dd>
         Regular expression matching a blank line. Value is Python Regular Expression (UTF8-encoded).
        </dd> 
        <dt>
         ignore_alternatives – <code class="docutils literal notranslate"><span class="pre">no</span></code>
        </dt> 
        <dd>
         When parsing incoming mails, roundup uses the first text/plain part it finds. If this part is inside a multipart/alternative, and this option is set, all other parts of the multipart/alternative are ignored. The default is to keep all parts and attach them to the issue.
        </dd> 
       </dl> 
      </dd> 
     </dl> 
     <dl class="docutils" id="index-13"> 
      <dt>
       Section <strong>pgp</strong>
      </dt> 
      <dd>
       <p class="first">OpenPGP mail processing options</p> 
       <dl class="last docutils"> 
        <dt>
         enable – <code class="docutils literal notranslate"><span class="pre">no</span></code>
        </dt> 
        <dd>
         Enable PGP processing. Requires gpg.
        </dd> 
        <dt>
         roles – default <em>blank</em>
        </dt> 
        <dd>
         If specified, a comma-separated list of roles to perform PGP processing on. If not specified, it happens for all users.
        </dd> 
        <dt>
         homedir – default <em>blank</em>
        </dt> 
        <dd>
         Location of PGP directory. Defaults to $HOME/.gnupg if not specified.
        </dd> 
       </dl> 
      </dd> 
     </dl> 
     <dl class="docutils" id="index-14"> 
      <dt>
       Section <strong>nosy</strong>
      </dt> 
      <dd>
       <p class="first">Nosy messages sending</p> 
       <dl class="last docutils"> 
        <dt>
         messages_to_author – <code class="docutils literal notranslate"><span class="pre">no</span></code>
        </dt> 
        <dd>
         Send nosy messages to the author of the message. If <code class="docutils literal notranslate"><span class="pre">yes</span></code> is used, then messages are sent to the author even if not on the nosy list, same for <code class="docutils literal notranslate"><span class="pre">new</span></code> (but only for new messages). When set to <code class="docutils literal notranslate"><span class="pre">nosy</span></code>, the nosy list controls sending messages to the author. Allowed values: <code class="docutils literal notranslate"><span class="pre">yes</span></code>, <code class="docutils literal notranslate"><span class="pre">no</span></code>, <code class="docutils literal notranslate"><span class="pre">new</span></code>, <code class="docutils literal notranslate"><span class="pre">nosy</span></code>
        </dd> 
        <dt>
         signature_position – <code class="docutils literal notranslate"><span class="pre">bottom</span></code>
        </dt> 
        <dd>
         Where to place the email signature. Allowed values: <code class="docutils literal notranslate"><span class="pre">top</span></code>, <code class="docutils literal notranslate"><span class="pre">bottom</span></code>, <code class="docutils literal notranslate"><span class="pre">none</span></code>
        </dd> 
        <dt>
         add_author – <code class="docutils literal notranslate"><span class="pre">new</span></code>
        </dt> 
        <dd>
         Does the author of a message get placed on the nosy list automatically? If <code class="docutils literal notranslate"><span class="pre">new</span></code> is used, then the author will only be added when a message creates a new issue. If <code class="docutils literal notranslate"><span class="pre">yes</span></code>, then the author will be added on followups too. If <code class="docutils literal notranslate"><span class="pre">no</span></code>, they’re never added to the nosy. Allowed values: <code class="docutils literal notranslate"><span class="pre">yes</span></code>, <code class="docutils literal notranslate"><span class="pre">no</span></code>, <code class="docutils literal notranslate"><span class="pre">new</span></code>
        </dd> 
        <dt>
         add_recipients – <code class="docutils literal notranslate"><span class="pre">new</span></code>
        </dt> 
        <dd>
         Do the recipients (<code class="docutils literal notranslate"><span class="pre">To:</span></code>, <code class="docutils literal notranslate"><span class="pre">Cc:</span></code>) of a message get placed on the nosy list? If <code class="docutils literal notranslate"><span class="pre">new</span></code> is used, then the recipients will only be added when a message creates a new issue. If <code class="docutils literal notranslate"><span class="pre">yes</span></code>, then the recipients will be added on followups too. If <code class="docutils literal notranslate"><span class="pre">no</span></code>, they’re never added to the nosy. Allowed values: <code class="docutils literal notranslate"><span class="pre">yes</span></code>, <code class="docutils literal notranslate"><span class="pre">no</span></code>, <code class="docutils literal notranslate"><span class="pre">new</span></code>
        </dd> 
        <dt>
         email_sending – <code class="docutils literal notranslate"><span class="pre">single</span></code>
        </dt> 
        <dd>
         Controls the email sending from the nosy reactor. If <code class="docutils literal notranslate"><span class="pre">multiple</span></code> then a separate email is sent to each recipient. If <code class="docutils literal notranslate"><span class="pre">single</span></code> then a single email is sent with each recipient as a CC address.
        </dd> 
        <dt>
         max_attachment_size – <code class="docutils literal notranslate"><span class="pre">2147483647</span></code>
        </dt> 
        <dd>
         Attachments larger than the given number of bytes won’t be attached to nosy mails. They will be replaced by a link to the tracker’s download page for the file.
        </dd> 
       </dl> 
      </dd> 
     </dl> 
     <p id="index-15">You may generate a new default config file using the <code class="docutils literal notranslate"><span class="pre">roundup-admin</span> <span class="pre">genconfig</span></code> command. You can generate a new config file merging in existing settings using the <code class="docutils literal notranslate"><span class="pre">roundup-admin</span> <span class="pre">updateconfig</span></code> command.</p> 
     <p>Configuration variables may be referred to in lower or upper case. In code, variables not in the “main” section are referred to using their section and name, so “domain” in the section “mail” becomes MAIL_DOMAIN.</p> 
     <div class="section" id="extending-the-configuration-file"> <span id="index-16"></span>
      <h3><a class="toc-backref" href="#id10">Extending the configuration file</a></h3> 
      <p>You can’t add new variables to the config.ini file in the tracker home but you can add two new config.ini files:</p> 
      <ul class="simple"> 
       <li>a config.ini in the <code class="docutils literal notranslate"><span class="pre">extensions</span></code> directory will be loaded and attached to the config variable as “ext”.</li> 
       <li>a config.ini in the <code class="docutils literal notranslate"><span class="pre">detectors</span></code> directory will be loaded and attached to the config variable as “detectors”.</li> 
      </ul> 
      <p>For example, the following in <code class="docutils literal notranslate"><span class="pre">detectors/config.ini</span></code>:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="p">[</span><span class="n">main</span><span class="p">]</span>
<span class="n">qa_recipients</span> <span class="o">=</span> <span class="n">email</span><span class="nd">@example</span><span class="o">.</span><span class="n">com</span>
</pre>
       </div> 
      </div> 
      <p>is accessible as:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">detectors</span><span class="p">[</span><span class="s1">'QA_RECIPIENTS'</span><span class="p">]</span>
</pre>
       </div> 
      </div> 
      <p>Note that the name grouping applied to the main configuration file is applied to the extension config files, so if you instead have:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="p">[</span><span class="n">qa</span><span class="p">]</span>
<span class="n">recipients</span> <span class="o">=</span> <span class="n">email</span><span class="nd">@example</span><span class="o">.</span><span class="n">com</span>
</pre>
       </div> 
      </div> 
      <p>then the above <code class="docutils literal notranslate"><span class="pre">db.config.detectors['QA_RECIPIENTS']</span></code> will still work.</p> 
      <p>Unlike values in the tracker’s main <code class="docutils literal notranslate"><span class="pre">config.ini</span></code>, the values defined in these config files are not validated. For example: a setting that is supposed to be an integer value (e.g. 4) could be the word “foo”. If you are writing Python code that uses these settings, you should expect to handle invalid values.</p> 
      <p>Also, incorrect values aren’t discovered until the config setting is used. This can be long after the tracker is started and the error may not be seen in the logs.</p> 
      <p>It is possible to validate these settings. Validation involves calling the <code class="docutils literal notranslate"><span class="pre">update_options</span></code> method on the configuration option. This can be done from the <code class="docutils literal notranslate"><span class="pre">init()</span></code> function in the Python files implementing <a class="reference internal" href="#extensions">extensions</a> or <a class="reference internal" href="#detectors">detectors</a>.</p> 
      <p>As an example, adding the following to an extension:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="kn">from</span> <span class="nn">roundup.configuration</span> <span class="k">import</span> <span class="n">SecretMandatoryOption</span>

<span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="n">instance</span><span class="p">):</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ext</span><span class="o">.</span><span class="n">update_option</span><span class="p">(</span><span class="s1">'RECAPTCHA_SECRET'</span><span class="p">,</span>
        <span class="n">SecretMandatoryOption</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s2">"Secret securing reCaptcha."</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>similarly for a detector:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="kn">from</span> <span class="nn">roundup.configuration</span> <span class="k">import</span> <span class="n">MailAddressOption</span>

<span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">db</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">detectors</span><span class="o">.</span><span class="n">update_option</span><span class="p">(</span><span class="s1">'QA_RECIPIENTS'</span><span class="p">,</span>
            <span class="n">MailAddressOption</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Email used for QA comment followup."</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="c1"># COMMENT_EMAIL setting is not found, but it's optional</span>
        <span class="c1"># so continue</span>
        <span class="k">pass</span>
</pre>
       </div> 
      </div> 
      <p>will allow reading the secret from a file or append the tracker domain to an email address if it does not have a domain.</p> 
      <p>Running <code class="docutils literal notranslate"><span class="pre">roundup-admin</span> <span class="pre">-i</span> <span class="pre">tracker_home</span> <span class="pre">display</span> <span class="pre">user1</span></code> will validate the settings for both config.ini`s. Otherwise detector options are not validated until the first request to the web interface (or email gateway).</p> 
      <p>There are 4 arguments for <code class="docutils literal notranslate"><span class="pre">update_option</span></code>:</p> 
      <ol class="arabic simple"> 
       <li>config setting name - string (positional, mandatory)</li> 
       <li>option type - Option derived class from configuration.py (positional, mandatory)</li> 
       <li>default value - string (optional, named default)</li> 
       <li>description - string (optional, named description)</li> 
      </ol> 
      <p>The first argument is the config setting name as described at the beginning of this section.</p> 
      <p>The second argument is a class in the roundup.configuration module. There are a number of these classes: BooleanOption, IntegerNumberOption, RegExpOption…. Please see the configuration module for all Option validators and their descriptions. You can also define your own custom validator in <a class="reference internal" href="#interfaces-py">interfaces.py</a>.</p> 
      <p>The third and fourth arguments are strings and are optional. They are printed if there is an error and may help the user correct the problem.</p> 
     </div> 
    </div> 
    <div class="section" id="tracker-schema"> <span id="index-17"></span>
     <h2><a class="toc-backref" href="#id11">Tracker Schema</a></h2> 
     <div class="admonition note"> 
      <p class="first admonition-title">Note</p> 
      <p class="last">if you modify the schema, you’ll most likely need to edit the <a class="reference internal" href="#web-interface">web interface</a> HTML template files and <a class="reference internal" href="#detectors">detectors</a> to reflect your changes.</p> 
     </div> 
     <p>A tracker schema defines what data is stored in the tracker’s database. Schemas are defined using Python code in the <code class="docutils literal notranslate"><span class="pre">schema.py</span></code> module of your tracker.</p> 
     <div class="section" id="the-schema-py-and-initial-data-py-modules"> 
      <h3><a class="toc-backref" href="#id12">The <code class="docutils literal notranslate"><span class="pre">schema.py</span></code> and <code class="docutils literal notranslate"><span class="pre">initial_data.py</span></code> modules</a></h3> 
      <p>The schema.py module is used to define what your tracker looks like on the inside, the schema of the tracker. It defines the Classes and properties on each class. It also defines the security for those Classes. The next few sections describe how schemas work and what you can do with them.</p> 
      <p>The initial_data.py module sets up the initial state of your tracker. It’s called exactly once - by the <code class="docutils literal notranslate"><span class="pre">roundup-admin</span> <span class="pre">initialise</span></code> command. See the start of the section on database content for more info about how this works.</p> 
     </div> 
     <div class="section" id="the-classic-schema"> <span id="index-18"></span>
      <h3><a class="toc-backref" href="#id13">The “classic” schema</a></h3> 
      <p>The “classic” schema looks like this (see section <a class="reference internal" href="#setkey-property">setkey(property)</a> below for the meaning of <code class="docutils literal notranslate"><span class="pre">'setkey'</span></code> – you may also want to look into the sections <a class="reference internal" href="#setlabelprop-property">setlabelprop(property)</a> and <a class="reference internal" href="#setorderprop-property">setorderprop(property)</a> for specifying (default) labelling and ordering of classes.):</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">pri</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"priority"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span> <span class="n">order</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>
<span class="n">pri</span><span class="o">.</span><span class="n">setkey</span><span class="p">(</span><span class="s2">"name"</span><span class="p">)</span>

<span class="n">stat</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"status"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span> <span class="n">order</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>
<span class="n">stat</span><span class="o">.</span><span class="n">setkey</span><span class="p">(</span><span class="s2">"name"</span><span class="p">)</span>

<span class="n">keyword</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"keyword"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>
<span class="n">keyword</span><span class="o">.</span><span class="n">setkey</span><span class="p">(</span><span class="s2">"name"</span><span class="p">)</span>

<span class="n">user</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"user"</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span> <span class="n">organisation</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
    <span class="n">password</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span> <span class="n">address</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span> <span class="n">realname</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
    <span class="n">phone</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span> <span class="n">alternate_addresses</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
    <span class="n">queries</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s1">'query'</span><span class="p">),</span> <span class="n">roles</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span> <span class="n">timezone</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>
<span class="n">user</span><span class="o">.</span><span class="n">setkey</span><span class="p">(</span><span class="s2">"username"</span><span class="p">)</span>

<span class="n">msg</span> <span class="o">=</span> <span class="n">FileClass</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"msg"</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"user"</span><span class="p">),</span> <span class="n">summary</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
    <span class="n">date</span><span class="o">=</span><span class="n">Date</span><span class="p">(),</span> <span class="n">recipients</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">"user"</span><span class="p">),</span>
    <span class="n">files</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">"file"</span><span class="p">),</span> <span class="n">messageid</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span> <span class="n">inreplyto</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>

<span class="n">file</span> <span class="o">=</span> <span class="n">FileClass</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"file"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>

<span class="n">issue</span> <span class="o">=</span> <span class="n">IssueClass</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"issue"</span><span class="p">,</span> <span class="n">keyword</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">"keyword"</span><span class="p">),</span>
    <span class="n">status</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"status"</span><span class="p">),</span> <span class="n">assignedto</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"user"</span><span class="p">),</span>
    <span class="n">priority</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"priority"</span><span class="p">))</span>
<span class="n">issue</span><span class="o">.</span><span class="n">setkey</span><span class="p">(</span><span class="s1">'title'</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
     </div> 
     <div class="section" id="what-you-can-t-do-to-the-schema"> <span id="index-19"></span>
      <h3><a class="toc-backref" href="#id14">What you can’t do to the schema</a></h3> 
      <p>You must never:</p> 
      <dl class="docutils"> 
       <dt>
        <strong>Remove the users class</strong>
       </dt> 
       <dd>
        This class is the only <em>required</em> class in Roundup.
       </dd> 
       <dt>
        <strong>Remove the “username”, “address”, “password” or “realname” user properties</strong>
       </dt> 
       <dd>
        Various parts of Roundup require these properties. Don’t remove them.
       </dd> 
       <dt>
        <strong>Change the type of a property</strong>
       </dt> 
       <dd>
        Property types must <em>never</em> be changed - the database simply doesn’t take this kind of action into account. Note that you can’t just remove a property and re-add it as a new type either. If you wanted to make the assignedto property a Multilink, you’d need to create a new property assignedto_list and remove the old assignedto property.
       </dd> 
      </dl> 
     </div> 
     <div class="section" id="what-you-can-do-to-the-schema"> 
      <h3><a class="toc-backref" href="#id15">What you can do to the schema</a></h3> 
      <p>Your schema may be changed at any time before or after the tracker has been initialised (or used). You may:</p> 
      <dl class="docutils"> 
       <dt>
        <strong>Add new properties to classes, or add whole new classes</strong>
       </dt> 
       <dd>
        This is painless and easy to do - there are generally no repercussions from adding new information to a tracker’s schema.
       </dd> 
       <dt>
        <strong>Remove properties</strong>
       </dt> 
       <dd>
        Removing properties is a little more tricky - you need to make sure that the property is no longer used in the <a class="reference internal" href="#web-interface">web interface</a> <em>or</em> by the <a class="reference internal" href="#detectors">detectors</a>.
       </dd> 
      </dl> 
     </div> 
     <div class="section" id="classes-and-properties-creating-a-new-information-store"> 
      <h3><a class="toc-backref" href="#id16">Classes and Properties - creating a new information store</a></h3> 
      <p>In the tracker above, we’ve defined 7 classes of information:</p> 
      <blockquote> 
       <div>
        <dl class="docutils"> 
         <dt>
          priority
         </dt> 
         <dd>
          Defines the possible levels of urgency for issues.
         </dd> 
         <dt>
          status
         </dt> 
         <dd>
          Defines the possible states of processing the issue may be in.
         </dd> 
         <dt>
          keyword
         </dt> 
         <dd>
          Initially empty, will hold keywords useful for searching issues.
         </dd> 
         <dt>
          user
         </dt> 
         <dd>
          Initially holding the “admin” user, will eventually have an entry for all users using roundup.
         </dd> 
         <dt>
          msg
         </dt> 
         <dd>
          Initially empty, will hold all e-mail messages sent to or generated by roundup.
         </dd> 
         <dt>
          file
         </dt> 
         <dd>
          Initially empty, will hold all files attached to issues.
         </dd> 
         <dt>
          issue
         </dt> 
         <dd>
          Initially empty, this is where the issue information is stored.
         </dd> 
        </dl> 
       </div>
      </blockquote> 
      <p>We define the “priority” and “status” classes to allow two things:</p> 
      <blockquote> 
       <div>
        <ol class="arabic simple"> 
         <li>reduction in the amount of information stored on the issue</li> 
         <li>more powerful, accurate searching of issues by priority and status</li> 
        </ol> 
       </div>
      </blockquote> 
      <p>By only requiring a link on the issue (which is stored as a single number) we reduce the chance that someone mis-types a priority or status - or simply makes a new one up.</p> 
      <div class="section" id="class-and-items"> 
       <h4>Class and Items</h4> 
       <p>A Class defines a particular class (or type) of data that will be stored in the database. A class comprises one or more properties, which gives the information about the class items.</p> 
       <p>The actual data entered into the database, using <code class="docutils literal notranslate"><span class="pre">class.create()</span></code>, are called items. They have a special immutable property called <code class="docutils literal notranslate"><span class="pre">'id'</span></code>. We sometimes refer to this as the <em>itemid</em>.</p> 
      </div> 
      <div class="section" id="properties"> <span id="index-20"></span>
       <h4>Properties</h4> 
       <p>A Class is comprised of one or more properties of the following types:</p> 
       <blockquote> 
        <div>
         <dl class="docutils"> 
          <dt>
           String
          </dt> 
          <dd>
           properties are for storing arbitrary-length strings.
          </dd> 
          <dt>
           Password
          </dt> 
          <dd>
           properties are for storing encoded arbitrary-length strings. The default encoding is defined on the <code class="docutils literal notranslate"><span class="pre">roundup.password.Password</span></code> class.
          </dd> 
          <dt>
           Date
          </dt> 
          <dd>
           properties store date-and-time stamps. Their values are Timestamp objects.
          </dd> 
          <dt>
           Interval
          </dt> 
          <dd>
           properties store time periods rather than absolute dates. For example 2 hours.
          </dd> 
          <dt>
           Integer
          </dt> 
          <dd>
           properties store integer values. (Number can store real/float values.)
          </dd> 
          <dt>
           Number
          </dt> 
          <dd>
           properties store numeric values. There is an option to use double-precision floating point numbers.
          </dd> 
          <dt>
           Boolean
          </dt> 
          <dd>
           properties store on/off, yes/no, true/false values.
          </dd> 
          <dt>
           Link
          </dt> 
          <dd>
           properties refers to a single other item selected from a specified class. The class is part of the property; the value is an integer, the id of the chosen item.
          </dd> 
          <dt>
           Multilink
          </dt> 
          <dd>
           properties refer to possibly many items in a specified class. The value is a list of integers.
          </dd> 
         </dl> 
        </div>
       </blockquote> 
       <p>Properties can have additional attributes to change the default behaviour:</p> 
       <ul id="index-21"> 
        <li><p class="first">All properties support the following attributes:</p> 
         <blockquote> 
          <div>
           <ul> 
            <li><p class="first"><code class="docutils literal notranslate"><span class="pre">required</span></code>: see <a class="reference external" href="design.html">design documentation</a>. Adds the property to the list returned by calling get_required_props for the class.</p> </li> 
            <li><p class="first"><code class="docutils literal notranslate"><span class="pre">default_value</span></code>: see <a class="reference external" href="design.html">design documentation</a> Sets the default value if the property is not set.</p> </li> 
            <li><p class="first"><code class="docutils literal notranslate"><span class="pre">quiet</span></code>: see <a class="reference external" href="design.html">design documentation</a>. Suppresses user visible to changes to this property. The property change is not reported:</p> 
             <blockquote> 
              <div>
               <ul class="simple"> 
                <li>in the change feedback/confirmation message in the web interface</li> 
                <li>the property change section of the nosy email</li> 
                <li>the web history at the bottom of an item’s page</li> 
               </ul> 
              </div>
             </blockquote> </li> 
           </ul> 
           <blockquote> 
            <div>
             <p>This can be used to store state of the user interface (e.g. the names of elements that are collapsed or hidden from the user). Making properties that are updated as an indirect result of a user’s change (e.g. updating a blockers property, counting number of times an issue was reopened or reassigned etc.) should not be displayed to the user as they can be confusing.</p> 
            </div>
           </blockquote> 
          </div>
         </blockquote> </li> 
       </ul> 
       <ul class="simple" id="index-22"> 
        <li>String properties can have an <code class="docutils literal notranslate"><span class="pre">indexme</span></code> attribute that defines if the property should be part of the full text index. The default is ‘no’ but this can be set to ‘yes’ to allow a property’s contents to be in the full text index.</li> 
       </ul> 
       <ul id="index-23"> 
        <li><p class="first">Number properties can have a <code class="docutils literal notranslate"><span class="pre">use_double</span></code> attribute that, when set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, will use double precision floating point in the database.</p> </li> 
        <li><p class="first">Link and Multilink properties can have several attributes:</p> 
         <ul class="simple" id="index-24"> 
          <li><code class="docutils literal notranslate"><span class="pre">do_journal</span></code>: By default, every change of a link property is recorded in the item being linked to (or being unlinked). A typical use-case for setting <code class="docutils literal notranslate"><span class="pre">do_journal='no'</span></code> would be to turn off journalling of nosy list, message author and message recipient link and unlink events to prevent the journal from clogged with these events.</li> 
         </ul> 
         <ul class="simple" id="index-25"> 
          <li><code class="docutils literal notranslate"><span class="pre">try_id_parsing</span></code> is turned on by default. If entering a number into a Link or Multilink field, roundup interprets this number as an ID of the item to link to. Sometimes items can have numeric names (like, e.g., product codes). For these roundup needs to match the numeric name and should never match an ID. In this case you can set <code class="docutils literal notranslate"><span class="pre">try_id_parsing='no'</span></code>.</li> 
         </ul> 
         <ul id="index-26"> 
          <li><p class="first">The <code class="docutils literal notranslate"><span class="pre">rev_multilink</span></code> option takes a property name to be inserted into the linked-to class. This property is a Multilink property that links back to the current class. The new Multilink is read-only (it is automatically modified if the Link or Multilink property defining it is modified). The new property can be used in normal searches using the “filter” method of the Class. This means it can be used like other Multilink properties when searching (in an index template) or via the REST and XMLRPC APIs.</p> <p>As a example, suppose you want to group multiple issues into a super issue. Each issue can be part of only one super issue. It is inefficient to find all of the issues that are part of the super issue by searching through all issues in the system looking at the part_of link property. To make this more efficient, you can declare an issue’s part_of property as:</p> 
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="n">issue</span> <span class="o">=</span> <span class="n">IssueClass</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"issue"</span><span class="p">,</span>
          <span class="o">...</span>
          <span class="n">part_of</span> <span class="o">=</span> <span class="n">Link</span><span class="p">(</span><span class="s2">"issue"</span><span class="p">,</span> <span class="n">rev_multilink</span><span class="o">=</span><span class="s2">"components"</span><span class="p">),</span>
          <span class="o">...</span> <span class="p">)</span>
</pre>
            </div> 
           </div> <p>This automatically creates the <code class="docutils literal notranslate"><span class="pre">components</span></code> multilink on the issue class. The <code class="docutils literal notranslate"><span class="pre">components</span></code> multilink is never explicitly declared in the issue class, but it has the same effect as though you had declared the class as:</p> 
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="n">issue</span> <span class="o">=</span> <span class="n">IssueClass</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"issue"</span><span class="p">,</span>
          <span class="o">...</span>
          <span class="n">part_of</span> <span class="o">=</span> <span class="n">Link</span><span class="p">(</span><span class="s2">"issue"</span><span class="p">),</span>
          <span class="n">components</span> <span class="o">=</span> <span class="n">Multilink</span><span class="p">(</span><span class="s2">"issue"</span><span class="p">),</span>
          <span class="o">...</span> <span class="p">)</span>
</pre>
            </div> 
           </div> <p>Then wrote a detector to update the components property on the corresponding issue. Writing this detector can be tricky. There is one other difference, you can not explicitly set/modify the <code class="docutils literal notranslate"><span class="pre">components</span></code> multilink.</p> <p>The effect of setting <code class="docutils literal notranslate"><span class="pre">part_of</span> <span class="pre">=</span> <span class="pre">3456</span></code> on issue1234 automatically adds “1234” to the <code class="docutils literal notranslate"><span class="pre">components</span></code> property on issue3456. You can search the <code class="docutils literal notranslate"><span class="pre">components</span></code> multilink just like a regular multilink, but you can’t explicitly assign to it. Another difference of reverse multilinks to normal multilinks is that when a linked node is retired, the node vanishes from the multilink, e.g. in the example above, if an issue with <code class="docutils literal notranslate"><span class="pre">part_of</span></code> set to another issue is retired this issue vanishes from the <code class="docutils literal notranslate"><span class="pre">components</span></code> multilink of the other issue.</p> <p>You can also link between different classes. So you can modify the issue definition to include:</p> 
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="n">issue</span> <span class="o">=</span> <span class="n">IssueClass</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"issue"</span><span class="p">,</span>
          <span class="o">...</span>
          <span class="n">assigned_to</span> <span class="o">=</span> <span class="n">Link</span><span class="p">(</span><span class="s2">"user"</span><span class="p">,</span> <span class="n">rev_multilink</span><span class="o">=</span><span class="s2">"responsibleFor"</span><span class="p">),</span>
          <span class="o">...</span> <span class="p">)</span>
</pre>
            </div> 
           </div> <p>This makes it easy to list all issues that the user is responsible for (aka assigned_to).</p> </li> 
         </ul> 
         <ul id="index-27"> 
          <li><p class="first">The <code class="docutils literal notranslate"><span class="pre">msg_header_property</span></code> is used by the mail gateway when sending out messages. When a link or multilink property of an issue changes, roundup creates email headers of the form:</p> 
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="n">X</span><span class="o">-</span><span class="n">Roundup</span><span class="o">-</span><span class="n">issue</span><span class="o">-</span><span class="n">prop</span><span class="p">:</span> <span class="n">value</span>
</pre>
            </div> 
           </div> <p>where <code class="docutils literal notranslate"><span class="pre">value</span></code> is the <code class="docutils literal notranslate"><span class="pre">name</span></code> property for the linked item(s). For example, if you have a multilink for attached_files in your issue, you will see a header:</p> 
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="n">X</span><span class="o">-</span><span class="n">Roundup</span><span class="o">-</span><span class="n">issue</span><span class="o">-</span><span class="n">attached_files</span><span class="p">:</span> <span class="n">MySpecialFile</span><span class="o">.</span><span class="n">doc</span><span class="p">,</span> <span class="n">HisResume</span><span class="o">.</span><span class="n">txt</span>
</pre>
            </div> 
           </div> <p>when the class for attached files is defined as:</p> 
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="n">file</span> <span class="o">=</span> <span class="n">FileClass</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"file"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>
</pre>
            </div> 
           </div> <p><code class="docutils literal notranslate"><span class="pre">MySpecialFile.doc</span></code> is the name for the file object.</p> <p>If you have an <code class="docutils literal notranslate"><span class="pre">assigned_to</span></code> property in your issue class that links to the user class and you want to add a header:</p> 
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="n">X</span><span class="o">-</span><span class="n">Roundup</span><span class="o">-</span><span class="n">issue</span><span class="o">-</span><span class="n">assigned_to</span><span class="p">:</span> <span class="o">...</span>
</pre>
            </div> 
           </div> <p>so that the mail recipients can filter emails where <code class="docutils literal notranslate"><span class="pre">X-Roundup-issue-assigned_to:</span> <span class="pre">name</span></code> that contains their username. The user class is defined as:</p> 
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"user"</span><span class="p">,</span>
         <span class="n">username</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
         <span class="n">password</span><span class="o">=</span><span class="n">Password</span><span class="p">(),</span>
         <span class="n">address</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
         <span class="n">realname</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
         <span class="n">phone</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
         <span class="n">organisation</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
         <span class="n">alternate_addresses</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
         <span class="n">queries</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s1">'query'</span><span class="p">),</span>
         <span class="n">roles</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>     <span class="c1"># comma-separated string of Role names</span>
         <span class="n">timezone</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>
</pre>
            </div> 
           </div> <p>Because there is no <code class="docutils literal notranslate"><span class="pre">name</span></code> parameter for the user class, there will be no header. However setting:</p> 
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="n">assigned_to</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"user"</span><span class="p">,</span> <span class="n">msg_header_property</span><span class="o">=</span><span class="s2">"username"</span><span class="p">)</span>
</pre>
            </div> 
           </div> <p>will make the mail gateway generate an <code class="docutils literal notranslate"><span class="pre">X-Roundup-issue-assigned_to</span></code> using the username property of the linked user.</p> <p>Assume assigned_to for an issue is linked to the user with username=joe_user, setting:</p> 
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="n">msg_header_property</span><span class="o">=</span><span class="s2">"username"</span>
</pre>
            </div> 
           </div> <p>for the assigned_to property will generated message headers of the form:</p> 
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="n">X</span><span class="o">-</span><span class="n">Roundup</span><span class="o">-</span><span class="n">issue</span><span class="o">-</span><span class="n">assigned_to</span><span class="p">:</span> <span class="n">joe_user</span>
</pre>
            </div> 
           </div> <p>for emails sent on issues where joe_user has been assigned to the issue.</p> <p>If this property is set to the empty string “”, it will prevent the header from being generated on outgoing mail.</p> </li> 
         </ul> </li> 
       </ul> 
       <p id="index-28">All Classes automatically have a number of properties by default:</p> 
       <dl class="docutils"> 
        <dt>
         <em>creator</em>
        </dt> 
        <dd>
         Link to the user that created the item.
        </dd> 
        <dt>
         <em>creation</em>
        </dt> 
        <dd>
         Date the item was created.
        </dd> 
        <dt>
         <em>actor</em>
        </dt> 
        <dd>
         Link to the user that last modified the item.
        </dd> 
        <dt>
         <em>activity</em>
        </dt> 
        <dd>
         Date the item was last modified.
        </dd> 
       </dl> 
      </div> 
      <div class="section" id="fileclass"> <span id="index-29"></span>
       <h4>FileClass</h4> 
       <p>FileClasses save their “content” attribute off in a separate file from the rest of the database. This reduces the number of large entries in the database, which generally makes databases more efficient, and also allows us to use command-line tools to operate on the files. They are stored in the files sub-directory of the <code class="docutils literal notranslate"><span class="pre">'db'</span></code> directory in your tracker. FileClasses also have a “type” attribute to store the MIME type of the file.</p> 
       <p>Roundup by default considers the contents of the file immutable. This is to assist in maintaining an accurate record of correspondence. The distributed tracker templates do not enforce this. So if you have access to the roundup tracker directory, you can edit the files (make sure to preserve mode, owner and group) to remove information (e.g. if somebody includes a password or you need to redact proprietary information). Obviously the journal for the message/file will not report that the file has changed.</p> 
       <p>Best practice is to remove offending material and leave a placeholder. E.G. replace a password with the text:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="p">[</span><span class="n">password</span> <span class="n">has</span> <span class="n">been</span> <span class="n">deleted</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">02</span> <span class="o">--</span><span class="n">myname</span><span class="p">]</span>
</pre>
        </div> 
       </div> 
       <p>If you need to delete an entire file, replace the file contents with:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="p">[</span><span class="n">file</span> <span class="n">contents</span> <span class="n">deleted</span> <span class="n">due</span> <span class="n">to</span> <span class="n">spam</span> <span class="mi">202</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">21</span> <span class="o">--</span><span class="n">myname</span><span class="p">]</span>
</pre>
        </div> 
       </div> 
       <p>rather than deleting the file. If you actually delete the file roundup will report an error to the user and email the administrator. If you empty the file, a user downloading the file using the direct URL (e.g. <code class="docutils literal notranslate"><span class="pre">tracker/msg22</span></code>) may be confused and think something is broken when they receive an empty file. Retiring a file/msg does not prevent access to the file using the direct URL. Retiring an item only removes it when requesting a list of all items in the class. If you are replacing the contents, you probably want to change the content type of the file. E.G. from <code class="docutils literal notranslate"><span class="pre">image/jpeg</span></code> to <code class="docutils literal notranslate"><span class="pre">text/plain</span></code>. You can do this easily through the web interface, or using the <code class="docutils literal notranslate"><span class="pre">roundup-admin</span></code> command line interface.</p> 
       <p>You can also change the contents of a file or message using the REST interface. Note that this will NOT result in an entry in the journal, so again it allows a silent change. To do this you need to make two rest requests. An example using curl is:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span>   $ curl -u demo:demo -s
          -H "X-requested-with: rest" \
          -H "Referer:  https://tracker.example.com/demo/" \
          -X GET \
          https://tracker.example.com/demo/rest/data/file/30/content
   {
      "data": {
          "id": "30",
          "type": "&lt;class 'str'&gt;",
          "link": "https://tracker.example.com/demo/rest/data/file/30/conten
t",
          "data": "hello3",
          "@etag": "\"3f2f8063dbce5b6bd43567e6f4f3c671\""
      }
   }
</pre>
        </div> 
       </div> 
       <p>using the etag, overwrite the content with:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span>$ curl -u demo:demo -s
      -H "X-requested-with: rest" \
      -H "Referer:  https://tracker.example.com/demo/" \
      -H 'If-Match: "3f2f8063dbce5b6bd43567e6f4f3c671"' \
      -X PUT \
      -F "data=@hello" \
      https://tracker.example.com/demo/rest/data/file/30/content
</pre>
        </div> 
       </div> 
       <p>where <code class="docutils literal notranslate"><span class="pre">hello</span></code> is a file on local disk.</p> 
       <p>You can enforce immutability in your tracker by adding an auditor (see <a class="reference internal" href="#detectors">detectors</a>) for the file/msg class that rejects changes to the content property. The auditor could also add a journal entry so that a change via the roundup mechanism is reported. Using a mixin (see: <a class="reference external" href="https://wiki.roundup-tracker.org/MixinClassFileClass">https://wiki.roundup-tracker.org/MixinClassFileClass</a>) to augment the file class allows for other possibilities including signing the file, or recording a checksum in the database and validating the file contents at the time it gets read. This allows detection of changes done on the filesystem outside of the roundup mechanism.</p> 
      </div> 
      <div class="section" id="issueclass"> <span id="index-30"></span>
       <h4>IssueClass</h4> 
       <p>IssueClasses automatically include the “messages”, “files”, “nosy”, and “superseder” properties.</p> 
       <p>The messages and files properties list the links to the messages and files related to the issue. The nosy property is a list of links to users who wish to be informed of changes to the issue - they get “CC’ed” e-mails when messages are sent to or generated by the issue. The nosy reactor (in the <code class="docutils literal notranslate"><span class="pre">'detectors'</span></code> directory) handles this action. The superseder link indicates an issue which has superseded this one.</p> 
       <p>They also have the dynamically generated “creation”, “activity” and “creator” properties.</p> 
       <p>The value of the “creation” property is the date when an item was created, and the value of the “activity” property is the date when any property on the item was last edited (equivalently, these are the dates on the first and last records in the item’s journal). The “creator” property holds a link to the user that created the issue.</p> 
      </div> 
      <div class="section" id="setkey-property"> 
       <h4>setkey(property)</h4> 
       <p id="index-31">Select a String property of the class to be the key property. The key property must be unique, and allows references to the items in the class by the content of the key property. That is, we can refer to users by their username: for example, let’s say that there’s an issue in roundup, issue 23. There’s also a user, richard, who happens to be user 2. To assign an issue to him, we could do either of:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">roundup</span><span class="o">-</span><span class="n">admin</span> <span class="nb">set</span> <span class="n">issue23</span> <span class="n">assignedto</span><span class="o">=</span><span class="mi">2</span>
</pre>
        </div> 
       </div> 
       <p>or:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">roundup</span><span class="o">-</span><span class="n">admin</span> <span class="nb">set</span> <span class="n">issue23</span> <span class="n">assignedto</span><span class="o">=</span><span class="n">richard</span>
</pre>
        </div> 
       </div> 
       <p>Note, the same thing can be done in the web and e-mail interfaces.</p> 
      </div> 
      <div class="section" id="setlabelprop-property"> 
       <h4>setlabelprop(property)</h4> 
       <p>Select a property of the class to be the label property. The label property is used whereever an item should be uniquely identified, e.g., when displaying a link to an item. If setlabelprop is not specified for a class, the following values are tried for the label:</p> 
       <blockquote> 
        <div>
         <ul class="simple"> 
          <li>the key of the class (see the <a class="reference internal" href="#setkey-property">setkey(property)</a> section above)</li> 
          <li>the “name” property</li> 
          <li>the “title” property</li> 
          <li>the first property from the sorted property name list</li> 
         </ul> 
        </div>
       </blockquote> 
       <p>So in most cases you can get away without specifying setlabelprop explicitly.</p> 
       <p>You should make sure that users have View access to this property or the id property for a class. If the property can not be viewed by a user, looping over items in the class (e.g. messages attached to an issue) will not work.</p> 
      </div> 
      <div class="section" id="setorderprop-property"> 
       <h4>setorderprop(property)</h4> 
       <p>Select a property of the class to be the order property. The order property is used whenever using a default sort order for the class, e.g., when grouping or sorting class A by a link to class B in the user interface, the order property of class B is used for sorting. If setorderprop is not specified for a class, the following values are tried for the order property:</p> 
       <blockquote> 
        <div>
         <ul class="simple"> 
          <li>the property named “order”</li> 
          <li>the label property (see <a class="reference internal" href="#setlabelprop-property">setlabelprop(property)</a> above)</li> 
         </ul> 
        </div>
       </blockquote> 
       <p>So in most cases you can get away without specifying setorderprop explicitly.</p> 
      </div> 
      <div class="section" id="create-information"> 
       <h4>create(information)</h4> 
       <p>Create an item in the database. This is generally used to create items in the “definitional” classes like “priority” and “status”.</p> 
      </div> 
      <div class="section" id="a-note-about-ordering"> 
       <h4>A note about ordering</h4> 
       <p>When we sort items in the hyperdb, we use one of a number of methods, depending on the properties being sorted on:</p> 
       <ol class="arabic simple"> 
        <li>If it’s a String, Integer, Number, Date or Interval property, we just sort the scalar value of the property. Strings are sorted case-sensitively.</li> 
        <li>If it’s a Link property, we sort by either the linked item’s “order” property (if it has one) or the linked item’s “id”.</li> 
        <li>Mulitlinks sort similar to #2, but we start with the first Multilink list item, and if they’re the same, we sort by the second item, and so on.</li> 
       </ol> 
       <p>Note that if an “order” property is defined on a Class that is used for sorting, all items of that Class <em>must</em> have a value against the “order” property, or sorting will result in random ordering.</p> 
      </div> 
     </div> 
     <div class="section" id="examples-of-adding-to-your-schema"> 
      <h3><a class="toc-backref" href="#id17">Examples of adding to your schema</a></h3> 
      <p>Some examples are in the <a class="reference internal" href="#customexamples"><span class="std std-ref">Examples</span></a> section below.</p> 
      <p>Also the <a class="reference external" href="https://wiki.roundup-tracker.org/">Roundup wiki</a> has additional examples of how schemas can be customised to add new functionality.</p> 
     </div> 
    </div> 
    <div class="section" id="detectors-adding-behaviour-to-your-tracker"> <span id="index-32"></span>
     <h2><a class="toc-backref" href="#id18">Detectors - adding behaviour to your tracker</a></h2> 
     <p id="detectors">Detectors are initialised every time you open your tracker database, so you’re free to add and remove them any time, even after the database is initialised via the <code class="docutils literal notranslate"><span class="pre">roundup-admin</span> <span class="pre">initialise</span></code> command.</p> 
     <p>The detectors in your tracker fire <em>before</em> (<strong>auditors</strong>) and <em>after</em> (<strong>reactors</strong>) changes to the contents of your database. They are Python modules that sit in your tracker’s <code class="docutils literal notranslate"><span class="pre">detectors</span></code> directory. You will have some installed by default - have a look. You can write new detectors or modify the existing ones. The existing detectors installed for you are:</p> 
     <dl class="docutils" id="index-33"> 
      <dt>
       <strong>nosyreaction.py</strong>
      </dt> 
      <dd>
       This provides the automatic nosy list maintenance and email sending. The nosy reactor (<code class="docutils literal notranslate"><span class="pre">nosyreaction</span></code>) fires when new messages are added to issues. The nosy auditor (<code class="docutils literal notranslate"><span class="pre">updatenosy</span></code>) fires when issues are changed, and figures out what changes need to be made to the nosy list (such as adding new authors, etc.)
      </dd> 
      <dt>
       <strong>statusauditor.py</strong>
      </dt> 
      <dd>
       This provides the <code class="docutils literal notranslate"><span class="pre">chatty</span></code> auditor which changes the issue status from <code class="docutils literal notranslate"><span class="pre">unread</span></code> or <code class="docutils literal notranslate"><span class="pre">closed</span></code> to <code class="docutils literal notranslate"><span class="pre">chatting</span></code> if new messages appear. It also provides the <code class="docutils literal notranslate"><span class="pre">presetunread</span></code> auditor which pre-sets the status to <code class="docutils literal notranslate"><span class="pre">unread</span></code> on new items if the status isn’t explicitly defined.
      </dd> 
      <dt>
       <strong>messagesummary.py</strong>
      </dt> 
      <dd>
       Generates the <code class="docutils literal notranslate"><span class="pre">summary</span></code> property for new messages based on the message content.
      </dd> 
      <dt>
       <strong>userauditor.py</strong>
      </dt> 
      <dd>
       Verifies the content of some of the user fields (email addresses and roles lists).
      </dd> 
     </dl> 
     <p>If you don’t want this default behaviour, you’re completely free to change or remove these detectors.</p> 
     <p>See the detectors section in the <a class="reference external" href="design.html">design document</a> for details of the interface for detectors.</p> 
     <div class="section" id="detector-api"> <span id="index-34"></span>
      <h3><a class="toc-backref" href="#id19">Detector API</a></h3> 
      <p id="index-35">Auditors are called with the arguments:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">audit</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">cl</span><span class="p">,</span> <span class="n">itemid</span><span class="p">,</span> <span class="n">newdata</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>where <code class="docutils literal notranslate"><span class="pre">db</span></code> is the database, <code class="docutils literal notranslate"><span class="pre">cl</span></code> is an instance of Class or IssueClass within the database, and <code class="docutils literal notranslate"><span class="pre">newdata</span></code> is a dictionary mapping property names to values.</p> 
      <p>For a <code class="docutils literal notranslate"><span class="pre">create()</span></code> operation, the <code class="docutils literal notranslate"><span class="pre">itemid</span></code> argument is None and newdata contains all of the initial property values with which the item is about to be created.</p> 
      <p>For a <code class="docutils literal notranslate"><span class="pre">set()</span></code> operation, newdata contains only the names and values of properties that are about to be changed.</p> 
      <p>For a <code class="docutils literal notranslate"><span class="pre">retire()</span></code> or <code class="docutils literal notranslate"><span class="pre">restore()</span></code> operation, newdata is None.</p> 
      <p id="index-36">Reactors are called with the arguments:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">react</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">cl</span><span class="p">,</span> <span class="n">itemid</span><span class="p">,</span> <span class="n">olddata</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>where <code class="docutils literal notranslate"><span class="pre">db</span></code> is the database, <code class="docutils literal notranslate"><span class="pre">cl</span></code> is an instance of Class or IssueClass within the database, and <code class="docutils literal notranslate"><span class="pre">olddata</span></code> is a dictionary mapping property names to values.</p> 
      <p>For a <code class="docutils literal notranslate"><span class="pre">create()</span></code> operation, the <code class="docutils literal notranslate"><span class="pre">itemid</span></code> argument is the id of the newly-created item and <code class="docutils literal notranslate"><span class="pre">olddata</span></code> is None.</p> 
      <p>For a <code class="docutils literal notranslate"><span class="pre">set()</span></code> operation, <code class="docutils literal notranslate"><span class="pre">olddata</span></code> contains the names and previous values of properties that were changed.</p> 
      <p>For a <code class="docutils literal notranslate"><span class="pre">retire()</span></code> or <code class="docutils literal notranslate"><span class="pre">restore()</span></code> operation, <code class="docutils literal notranslate"><span class="pre">itemid</span></code> is the id of the retired or restored item and <code class="docutils literal notranslate"><span class="pre">olddata</span></code> is None.</p> 
     </div> 
     <div class="section" id="additional-detectors-ready-for-use"> <span id="index-37"></span>
      <h3><a class="toc-backref" href="#id20">Additional Detectors Ready For Use</a></h3> 
      <p>Sample additional detectors that have been found useful will appear in the <code class="docutils literal notranslate"><span class="pre">'detectors'</span></code> directory of the Roundup distribution. If you want to use one, copy it to the <code class="docutils literal notranslate"><span class="pre">'detectors'</span></code> of your tracker instance:</p> 
      <dl class="docutils"> 
       <dt>
        <strong>irker.py</strong>
       </dt> 
       <dd>
        This detector sends notification on IRC through an irker daemon (<a class="reference external" href="http://www.catb.org/esr/irker/">http://www.catb.org/esr/irker/</a>) when issues are created or messages are added. In order to use it you need to install irker, start the irkerd daemon, and add an <code class="docutils literal notranslate"><span class="pre">[irker]</span></code> section in <code class="docutils literal notranslate"><span class="pre">detectors/config.ini</span></code> that contains a comma-separated list of channels where the messages should be sent, e.g. <code class="docutils literal notranslate"><span class="pre">channels</span> <span class="pre">=</span> <span class="pre">irc://chat.freenode.net/channelname</span></code>.
       </dd> 
       <dt>
        <strong>newissuecopy.py</strong>
       </dt> 
       <dd>
        This detector sends an email to a team address whenever a new issue is created. The address is hard-coded into the detector, so edit it before you use it (look for the text <a class="reference external" href="mailto:'team%40team.host">‘team<span>@</span>team<span>.</span>host</a>’) or you’ll get email errors!
       </dd> 
       <dt>
        <strong>creator_resolution.py</strong>
       </dt> 
       <dd>
        Catch attempts to set the status to “resolved” - if the assignedto user isn’t the creator, then set the status to “confirm-done”. Note that “classic” Roundup doesn’t have that status, so you’ll have to add it. If you don’t want to though, it’ll just use “in-progress” instead.
       </dd> 
       <dt>
        <strong>email_auditor.py</strong>
       </dt> 
       <dd>
        If a file added to an issue is of type message/rfc822, we tack on the extension .eml. The reason for this is that Microsoft Internet Explorer will not open things with a .eml attachment, as they deem it ‘unsafe’. Worse yet, they’ll just give you an incomprehensible error message. For more information, see the detector code - it has a length explanation.
       </dd> 
      </dl> 
     </div> 
     <div class="section" id="auditor-or-reactor"> <span id="index-38"></span>
      <h3><a class="toc-backref" href="#id21">Auditor or Reactor?</a></h3> 
      <p>Generally speaking, the following rules should be observed:</p> 
      <dl class="docutils"> 
       <dt>
        <strong>Auditors</strong>
       </dt> 
       <dd>
        Are used for <a class="reference internal" href="#vetoing-creation-of-or-changes-to-items">vetoing creation of or changes to items</a>. They might also make automatic changes to item properties.
       </dd> 
       <dt>
        <strong>Reactors</strong>
       </dt> 
       <dd>
        Detect changes in the database and react accordingly. They should avoid making changes to the database where possible, as this could create detector loops.
       </dd> 
      </dl> 
     </div> 
     <div class="section" id="vetoing-creation-of-or-changes-to-items"> 
      <h3><a class="toc-backref" href="#id22">Vetoing creation of or changes to items</a></h3> 
      <p>Auditors may raise the <code class="docutils literal notranslate"><span class="pre">Reject</span></code> exception to prevent the creation of or changes to items in the database. The mail gateway, for example, will not attach files or messages to issues when the creation of those files or messages are prevented through the <code class="docutils literal notranslate"><span class="pre">Reject</span></code> exception. It’ll also not create users if that creation is <code class="docutils literal notranslate"><span class="pre">Reject</span></code>’ed too.</p> 
      <p>To use, simply add at the top of your auditor:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="kn">from</span> <span class="nn">roundup.exceptions</span> <span class="k">import</span> <span class="n">Reject</span>
</pre>
       </div> 
      </div> 
      <p>And then when your rejection criteria have been detected, simply:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="k">raise</span> <span class="n">Reject</span><span class="p">(</span><span class="s1">'Description of error'</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>Error messages raised with <code class="docutils literal notranslate"><span class="pre">Reject</span></code> automatically have any HTML content escaped before being displayed to the user. To display an error message to the user without performing any HTML escaping the <code class="docutils literal notranslate"><span class="pre">RejectRaw</span></code> should be used. All security implications should be carefully considering before using <code class="docutils literal notranslate"><span class="pre">RejectRaw</span></code>.</p> 
     </div> 
     <div class="section" id="generating-email-from-roundup"> 
      <h3><a class="toc-backref" href="#id23">Generating email from Roundup</a></h3> 
      <p>The module <code class="docutils literal notranslate"><span class="pre">roundup.mailer</span></code> contains most of the nuts-n-bolts required to generate email messages from Roundup.</p> 
      <p>In addition, the <code class="docutils literal notranslate"><span class="pre">IssueClass</span></code> methods <code class="docutils literal notranslate"><span class="pre">nosymessage()</span></code> and <code class="docutils literal notranslate"><span class="pre">send_message()</span></code> are used to generate nosy messages, and may generate messages which only consist of a change note (ie. the message id parameter is not required - this is referred to as a “System Message” because it comes from “the system” and not a user).</p> <span class="target" id="index-39"></span>
     </div> 
    </div> 
    <div class="section" id="extensions-adding-capabilities-to-your-tracker"> <span id="index-40"></span>
     <h2><a class="toc-backref" href="#id24">Extensions - adding capabilities to your tracker</a></h2> 
     <p id="extensions">While <a class="reference internal" href="#detectors">detectors</a> add new behavior by reacting to changes in tracked objects, <cite>extensions</cite> add new actions and utilities to Roundup, which are mostly used to enhance web interface.</p> 
     <p>You can create an extension by creating Python file in your tracker <code class="docutils literal notranslate"><span class="pre">extensions</span></code> directory. All files from this dir are loaded when tracker instance is created, at which point it calls <code class="docutils literal notranslate"><span class="pre">init(instance)</span></code> from each file supplying itself as a first argument.</p> 
     <p>Note that at this point web interface is not loaded, but extensions still can register actions for in tracker instance. This may be fixed in Roundup 1.6 by introducing <code class="docutils literal notranslate"><span class="pre">init_web(client)</span></code> callback or a more flexible extension point mechanism.</p> 
     <blockquote> 
      <div>
       <ul class="simple"> 
        <li><code class="docutils literal notranslate"><span class="pre">instance.registerUtil</span></code> is used for adding <a class="reference internal" href="#templating-utilities">templating utilities</a> (see <a class="reference internal" href="#adding-a-time-log-to-your-issues">adding a time log to your issues</a> for an example)</li> 
        <li><code class="docutils literal notranslate"><span class="pre">instance.registerAction</span></code> is used to add more actions to instance and to web interface. See <a class="reference internal" href="#defining-new-web-actions">Defining new web actions</a> for details. Generic action can be added by inheriting from <code class="docutils literal notranslate"><span class="pre">action.Action</span></code> instead of <code class="docutils literal notranslate"><span class="pre">cgi.action.Action</span></code>.</li> 
       </ul> 
      </div>
     </blockquote> 
    </div> 
    <div class="section" id="interfaces-py-hooking-into-the-core-of-roundup"> 
     <h2><a class="toc-backref" href="#id25">interfaces.py - hooking into the core of roundup</a></h2> 
     <p id="interfaces-py">There is a magic trick for hooking into the core of roundup. Using this you can:</p> 
     <blockquote> 
      <div>
       <ul class="simple"> 
        <li>modify class data structures</li> 
        <li>monkey patch core code to add new functionality</li> 
        <li>modify the email gateway</li> 
        <li>add new rest endpoints</li> 
       </ul> 
      </div>
     </blockquote> 
     <p>but with great power comes great responsibility.</p> 
     <p>Interfaces.py has been around since the earliest releases of roundup and used to be the main way to get a lot of customization done. In modern roundup, the <a class="reference internal" href="#extensions">extensions</a> mechanism is used, but there are places where interfaces.py is still useful. Note that the tracker directories are not on the Python system path when interfaces.py is evaluated. You need to add library directories explicty by modifying sys.path.</p> 
     <div class="section" id="example-changing-cache-control-headers"> 
      <h3><a class="toc-backref" href="#id26">Example: Changing Cache-Control headers</a></h3> 
      <p>The Client class in cgi/client.py has a lookup table that is used to set the Cache-Control headers for static files. The entries in this table are set from interfaces.py using:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="kn">from</span> <span class="nn">roundup.cgi.client</span> <span class="k">import</span> <span class="n">Client</span>

<span class="n">Client</span><span class="o">.</span><span class="n">Cache_Control</span><span class="p">[</span><span class="s1">'text/css'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"public, max-age=3600"</span>
<span class="n">Client</span><span class="o">.</span><span class="n">Cache_Control</span><span class="p">[</span><span class="s1">'application/javascript'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"public, max-age=30"</span>
<span class="n">Client</span><span class="o">.</span><span class="n">Cache_Control</span><span class="p">[</span><span class="s1">'rss.xml'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"public, max-age=900"</span>
<span class="n">Client</span><span class="o">.</span><span class="n">Cache_Control</span><span class="p">[</span><span class="s1">'local.js'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"public, max-age=7200"</span>
</pre>
       </div> 
      </div> 
      <p>In this case static files delivered using @@file will have cache headers set. These files are searched for along the <cite>static_files</cite> path in the tracker’s <cite>config.ini</cite>. In the example above:</p> 
      <blockquote> 
       <div>
        <ul class="simple"> 
         <li>a css file (e.g. @@file/style.css) will be cached for an hour</li> 
         <li>javascript files (e.g. @@file/libraries/jquery.js) will be cached for 30 seconds</li> 
         <li>a file named rss.xml will be cached for 15 minutes</li> 
         <li>a file named local.js will be cached for 2 hours</li> 
        </ul> 
       </div>
      </blockquote> 
      <p>Note that a file name match overrides the mime type settings.</p> 
     </div> 
     <div class="section" id="example-implement-password-complexity-checking"> 
      <h3><a class="toc-backref" href="#id27">Example: Implement password complexity checking</a></h3> 
      <p id="index-41">This example uses the <a class="reference external" href="https://github.com/dwolfhub/zxcvbn-python">zxcvbn</a> module that you can place in the zxcvbn subdirectory of your tracker’s lib directory.</p> 
      <p>If you add this to the interfaces.py file in the root directory of your tracker (same place as schema.py):</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="kn">import</span> <span class="nn">roundup.password</span> <span class="k">as</span> <span class="nn">password</span>
<span class="kn">from</span> <span class="nn">roundup.exceptions</span> <span class="k">import</span> <span class="n">Reject</span>
<span class="kn">from</span> <span class="nn">zxcvbn</span> <span class="k">import</span> <span class="n">zxcvbn</span>

<span class="c1"># monkey patch the setPassword method with this method</span>
<span class="c1"># that checks password strength.</span>
<span class="n">origPasswordFunc</span> <span class="o">=</span> <span class="n">password</span><span class="o">.</span><span class="n">Password</span><span class="o">.</span><span class="n">setPassword</span>
<span class="k">def</span> <span class="nf">mpPasswordFunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plaintext</span><span class="p">,</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">""" Replace the password set function with one that</span>
<span class="sd">        verifies that the password is complex enough. It</span>
<span class="sd">        has to be done at this point and not in an auditor</span>
<span class="sd">        as the auditor only sees the encrypted password.</span>
<span class="sd">    """</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">zxcvbn</span><span class="p">(</span><span class="n">plaintext</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s1">'score'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">map</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">extend</span><span class="p">,</span> <span class="p">[[</span><span class="n">results</span><span class="p">[</span><span class="s1">'feedback'</span><span class="p">][</span><span class="s1">'warning'</span><span class="p">]],</span> <span class="n">results</span><span class="p">[</span><span class="s1">'feedback'</span><span class="p">][</span><span class="s1">'suggestions'</span><span class="p">]])</span>
        <span class="n">errormsg</span> <span class="o">=</span> <span class="s2">" "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">Reject</span> <span class="p">(</span><span class="s2">"Password is too easy to guess. "</span> <span class="o">+</span> <span class="n">errormsg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">origPasswordFunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plaintext</span><span class="p">,</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>

<span class="n">password</span><span class="o">.</span><span class="n">Password</span><span class="o">.</span><span class="n">setPassword</span> <span class="o">=</span> <span class="n">mpPasswordFunc</span>
</pre>
       </div> 
      </div> 
      <p>it replaces the setPassword method in the Password class. The new version validates that the password is sufficiently complex. Then it passes off the setting of password to the original method.</p> 
     </div> 
     <div class="section" id="example-enhance-time-intervals"> 
      <h3><a class="toc-backref" href="#id28">Example: Enhance time intervals</a></h3> 
      <p>To make the user interface easier to use, you may want to support other forms for intervals. For example you can support an interval like 1.5 by interpreting it the same as 1:30 (1 hour 30 minutes). Also you can allow a bare integer (e.g. 45) as a number of minutes.</p> 
      <p>To do this we intercept the from_raw method of the Interval class in hyperdb.py with:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="kn">import</span> <span class="nn">roundup.hyperdb</span> <span class="k">as</span> <span class="nn">hyperdb</span>
<span class="n">origFrom_Raw</span> <span class="o">=</span> <span class="n">hyperdb</span><span class="o">.</span><span class="n">Interval</span><span class="o">.</span><span class="n">from_raw</span>

<span class="k">def</span> <span class="nf">normalizeperiod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">''' Convert alternate time forms into standard interval format</span>

<span class="sd">        [+-] [#y] [#m] [#w] [#d] [[[H]H:MM]:SS]</span>

<span class="sd">        if value is float, it's hour and fractional hours</span>
<span class="sd">        if value is integer, it's number of minutes</span>
<span class="sd">    '''</span>
    <span class="k">if</span> <span class="s2">":"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
        <span class="c1"># Not a specified interval</span>
        <span class="c1"># if int consider number of minutes</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">isMinutes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">minutes</span> <span class="o">=</span> <span class="n">isMinutes</span><span class="o">%</span><span class="mi">60</span>
            <span class="n">hours</span> <span class="o">=</span> <span class="p">(</span><span class="n">isMinutes</span> <span class="o">-</span> <span class="n">minutes</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span>
            <span class="n">value</span> <span class="o">=</span> <span class="s2">"</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">"</span><span class="o">%</span><span class="p">(</span><span class="n">hours</span><span class="p">,</span><span class="n">minutes</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c1"># if float, consider it number of hours and fractional hours.</span>
        <span class="kn">import</span> <span class="nn">math</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">afterdecimal</span><span class="p">,</span> <span class="n">beforedecimal</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">modf</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="n">value</span> <span class="o">=</span> <span class="s2">"</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">"</span><span class="o">%</span><span class="p">(</span><span class="n">beforedecimal</span><span class="p">,</span><span class="mi">60</span><span class="o">*</span><span class="n">afterdecimal</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">return</span> <span class="n">origFrom_Raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="n">hyperdb</span><span class="o">.</span><span class="n">Interval</span><span class="o">.</span><span class="n">from_raw</span> <span class="o">=</span> <span class="n">normalizeperiod</span>
</pre>
       </div> 
      </div> 
      <p>any call to convert an interval from raw form now has two simpler (and more friendly) ways to specify common time intervals.</p> 
     </div> 
     <div class="section" id="example-modifying-the-mail-gateway"> 
      <h3><a class="toc-backref" href="#id29">Example: Modifying the mail gateway</a></h3> 
      <p>One site receives email on a main gateway. The virtual alias delivery table on the postfix server is configured with:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">test</span><span class="o">-</span><span class="n">issues</span><span class="nd">@example</span><span class="o">.</span><span class="n">com</span>  <span class="n">roundup</span><span class="o">-</span><span class="n">test</span><span class="nd">@roundup</span><span class="o">-</span><span class="n">vm</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">test</span><span class="o">-</span><span class="n">support</span><span class="nd">@example</span><span class="o">.</span><span class="n">com</span> <span class="n">roundup</span><span class="o">-</span><span class="n">test</span><span class="o">+</span><span class="n">support</span><span class="o">-</span><span class="n">a</span><span class="nd">@roundup</span><span class="o">-</span><span class="n">vm</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">test</span><span class="nd">@support</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span> <span class="n">roundup</span><span class="o">-</span><span class="n">test</span><span class="o">+</span><span class="n">support</span><span class="o">-</span><span class="n">b</span><span class="nd">@roundup</span><span class="o">-</span><span class="n">vm</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
</pre>
       </div> 
      </div> 
      <p>These modifications to the mail gateway for roundup allows anonymous submissions. It hides all of the requesters under the “support” user. It also makes some other modifications to the mail parser allowing keywords to be set and prefixes to be defined based on the delivery alias.</p> 
      <p>This is the entry in interfaces.py:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="kn">import</span> <span class="nn">roundup.mailgw</span>
<span class="kn">import</span> <span class="nn">email.utils</span>

<span class="k">class</span> <span class="nc">SupportTracker</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keyword</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyword</span> <span class="o">=</span> <span class="n">keyword</span>

<span class="c1"># Define new prefixes and keywords based on local address.</span>
<span class="n">support_trackers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">### production instances ###</span>

    <span class="c1">### test instances ###</span>
    <span class="s1">'roundup-test+support-a'</span><span class="p">:</span>
        <span class="n">SupportTracker</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">'Support 1'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">=</span><span class="s1">'support1'</span><span class="p">),</span>
    <span class="s1">'roundup-test+support-b'</span><span class="p">:</span>
        <span class="n">SupportTracker</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">'Support 2'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">=</span><span class="s1">'support2'</span><span class="p">),</span>
    <span class="s1">'roundup-test2+support-a'</span><span class="p">:</span>
        <span class="n">SupportTracker</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">'Support 1'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">=</span><span class="s1">'support1'</span><span class="p">),</span>
    <span class="s1">'roundup-test2+support-b'</span><span class="p">:</span>
        <span class="n">SupportTracker</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">'Support 2'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">=</span><span class="s1">'support2'</span><span class="p">),</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">parsedMessage</span><span class="p">(</span><span class="n">roundup</span><span class="o">.</span><span class="n">mailgw</span><span class="o">.</span><span class="n">parsedMessage</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mailgw</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">support_tracker</span><span class="p">):</span>
        <span class="n">roundup</span><span class="o">.</span><span class="n">mailgw</span><span class="o">.</span><span class="n">parsedMessage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mailgw</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">support_tracker</span><span class="o">.</span><span class="n">prefix</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="s1">'</span><span class="si">%s</span><span class="s1">: '</span> <span class="o">%</span> <span class="n">support_tracker</span><span class="o">.</span><span class="n">prefix</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="s1">''</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keywords</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">support_tracker</span><span class="o">.</span><span class="n">keyword</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">keywords</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">keyword</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">support_tracker</span><span class="o">.</span><span class="n">keyword</span><span class="p">)]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ADD_AUTHOR_TO_NOSY</span> <span class="o">=</span> <span class="s1">'no'</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ADD_RECIPIENTS_TO_NOSY</span> <span class="o">=</span> <span class="s1">'no'</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">MAILGW_KEEP_QUOTED_TEXT</span> <span class="o">=</span> <span class="s1">'yes'</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">MAILGW_LEAVE_BODY_UNCHANGED</span> <span class="o">=</span> <span class="s1">'yes'</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classname</span> <span class="o">=</span> <span class="s1">'issue'</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pfxmode</span> <span class="o">=</span> <span class="s1">'loose'</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sfxmode</span> <span class="o">=</span> <span class="s1">'none'</span>
        <span class="c1"># set the support user id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixed_author</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s1">'support'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixed_props</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">'nosy'</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fixed_author</span><span class="p">],</span>
            <span class="s1">'keyword'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">keywords</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">handle_help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">check_subject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="s1">'no subject'</span>

    <span class="k">def</span> <span class="nf">rego_confirm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">get_author_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># force the support user to be the author</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_author</span>

    <span class="k">def</span> <span class="nf">get_props</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixed_props</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"</span><span class="si">%s%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'['</span><span class="p">,</span> <span class="s1">'('</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">']'</span><span class="p">,</span> <span class="s1">')'</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">get_content_and_attachments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">roundup</span><span class="o">.</span><span class="n">mailgw</span><span class="o">.</span><span class="n">parsedMessage</span><span class="o">.</span><span class="n">get_content_and_attachments</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="s1">'no text'</span>
        <span class="n">intro</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'From'</span><span class="p">,</span> <span class="s1">'To'</span><span class="p">,</span> <span class="s1">'Cc'</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">getaddrlist</span><span class="p">(</span><span class="n">header</span><span class="p">):</span>
                <span class="n">intro</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">email</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">formataddr</span><span class="p">(</span><span class="n">addr</span><span class="p">)))</span>
        <span class="n">intro</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'Subject: </span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">)</span>
        <span class="n">intro</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">intro</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span>

<span class="k">class</span> <span class="nc">MailGW</span><span class="p">(</span><span class="n">roundup</span><span class="o">.</span><span class="n">mailgw</span><span class="o">.</span><span class="n">MailGW</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">parsed_message_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mailgw</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="n">support_tracker</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># The delivered-to header is unique to postfix</span>
        <span class="c1"># it is the target address:</span>
        <span class="c1">#   roundup-test+support-a@roundup-vm.example.com</span>
        <span class="c1"># rather than</span>
        <span class="c1">#   test-support@example.com</span>
        <span class="n">recipients</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">getaddrlist</span><span class="p">(</span><span class="s1">'delivered-to'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">recipients</span><span class="p">:</span>
            <span class="n">localpart</span> <span class="o">=</span> <span class="n">recipients</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rpartition</span><span class="p">(</span><span class="s1">'@'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">support_tracker</span> <span class="o">=</span> <span class="n">support_trackers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">localpart</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">support_tracker</span><span class="p">:</span>
            <span class="c1"># parse the mesage using the parsedMessage class</span>
            <span class="c1"># defined above.</span>
            <span class="k">return</span> <span class="n">parsedMessage</span><span class="p">(</span><span class="n">mailgw</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">support_tracker</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># parse the message normally</span>
            <span class="k">return</span> <span class="n">roundup</span><span class="o">.</span><span class="n">mailgw</span><span class="o">.</span><span class="n">parsedMessage</span><span class="p">(</span><span class="n">mailgw</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
</pre>
       </div> 
      </div> 
      <p>This is the most complex example section. The mail gateway is also one of the more complex subsystems in roundup, and modifying it is not trivial.</p> 
     </div> 
     <div class="section" id="other-examples"> 
      <h3><a class="toc-backref" href="#id30">Other Examples</a></h3> 
      <p>See the <a class="reference external" href="rest.html#programming-the-rest-api">rest interface documentation</a> for instructions on how to add new rest endpoints using interfaces.py.</p> 
     </div> 
    </div> 
    <div class="section" id="database-content"> 
     <h2><a class="toc-backref" href="#id31">Database Content</a></h2> 
     <div class="admonition note"> 
      <p class="first admonition-title">Note</p> 
      <p class="last">If you modify the content of definitional classes, you’ll most likely need to edit the tracker <a class="reference internal" href="#detectors">detectors</a> to reflect your changes.</p> 
     </div> 
     <p>Customisation of the special “definitional” classes (eg. status, priority, resolution, …) may be done either before or after the tracker is initialised. The actual method of doing so is completely different in each case though, so be careful to use the right one.</p> 
     <dl class="docutils"> 
      <dt>
       <strong>Changing content before tracker initialisation</strong>
      </dt> 
      <dd>
       Edit the initial_data.py module in your tracker to alter the items created using the <code class="docutils literal notranslate"><span class="pre">create(</span> <span class="pre">...</span> <span class="pre">)</span></code> methods.
      </dd> 
      <dt>
       <strong>Changing content after tracker initialisation</strong>
      </dt> 
      <dd>
       <p class="first">As the “admin” user, click on the “class list” link in the web interface to bring up a list of all database classes. Click on the name of the class you wish to change the content of.</p> 
       <p class="last">You may also use the <code class="docutils literal notranslate"><span class="pre">roundup-admin</span></code> interface’s create, set and retire methods to add, alter or remove items from the classes in question.</p> 
      </dd> 
     </dl> 
     <p>See “<a class="reference internal" href="#adding-a-new-field-to-the-classic-schema">adding a new field to the classic schema</a>” for an example that requires database content changes.</p> 
    </div> 
    <div class="section" id="security-access-controls"> 
     <h2><a class="toc-backref" href="#id32">Security / Access Controls</a></h2> 
     <p>A set of Permissions is built into the security module by default:</p> 
     <ul class="simple"> 
      <li>Create (everything)</li> 
      <li>Edit (everything)</li> 
      <li>Search (everything) (used if View does not permit access)</li> 
      <li>View (everything)</li> 
      <li>Register (User class only)</li> 
     </ul> 
     <p>These are assigned to the “Admin” Role by default, and allow a user to do anything. Every Class you define in your <a class="reference internal" href="#tracker-schema">tracker schema</a> also gets an Create, Edit and View Permission of its own. The web and email interfaces also define:</p> 
     <dl class="docutils"> 
      <dt>
       <em>Email Access</em>
      </dt> 
      <dd>
       If defined, the user may use the email interface. Used by default to deny Anonymous users access to the email interface. When granted to the Anonymous user, they will be automatically registered by the email interface (see also the <code class="docutils literal notranslate"><span class="pre">new_email_user_roles</span></code> configuration option).
      </dd> 
      <dt>
       <em>Web Access</em>
      </dt> 
      <dd>
       If defined, the user may use the web interface. All users are able to see the login form, regardless of this setting (thus enabling logging in).
      </dd> 
      <dt>
       <em>Web Roles</em>
      </dt> 
      <dd>
       Controls user access to editing the “roles” property of the “user” class. TODO: deprecate in favour of a property-based control.
      </dd> 
      <dt>
       <em>Rest Access</em> and <em>Xmlrpc Access</em>
      </dt> 
      <dd>
       These control access to the Rest and Xmlrpc endpoints. The Admin and User roles have these by default in the classic tracker. See the <a class="reference external" href="rest.html#enabling-the-rest-api">directions in the rest interface documentation</a> and the <a class="reference external" href="xmlrpc.html#through-roundup">xmlrpc interface documentation</a>.
      </dd> 
     </dl> 
     <p>These are hooked into the default Roles:</p> 
     <ul class="simple"> 
      <li>Admin (Create, Edit, Search, View and everything; Web Roles)</li> 
      <li>User (Web Access; Email Access)</li> 
      <li>Anonymous (Web Access)</li> 
     </ul> 
     <p>And finally, the “admin” user gets the “Admin” Role, and the “anonymous” user gets “Anonymous” assigned when the tracker is installed.</p> 
     <p>For the “User” Role, the “classic” tracker defines:</p> 
     <ul class="simple"> 
      <li>Create, Edit and View issue, file, msg, query, keyword</li> 
      <li>View priority, status</li> 
      <li>View user</li> 
      <li>Edit their own user record</li> 
     </ul> 
     <p>And the “Anonymous” Role is defined as:</p> 
     <ul class="simple"> 
      <li>Web interface access</li> 
      <li>Register user (for registration)</li> 
      <li>View issue, file, msg, query, keyword, priority, status</li> 
     </ul> 
     <p>Put together, these settings appear in the tracker’s <code class="docutils literal notranslate"><span class="pre">schema.py</span></code> file:</p> 
     <div class="highlight-default notranslate">
      <div class="highlight">
       <pre><span></span><span class="c1">#</span>
<span class="c1"># TRACKER SECURITY SETTINGS</span>
<span class="c1">#</span>
<span class="c1"># See the configuration and customisation document for information</span>
<span class="c1"># about security setup.</span>

<span class="c1">#</span>
<span class="c1"># REGULAR USERS</span>
<span class="c1">#</span>
<span class="c1"># Give the regular users access to the web and email interface</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="s1">'Web Access'</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="s1">'Email Access'</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="s1">'Rest Access'</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="s1">'Xmlrpc Access'</span><span class="p">)</span>

<span class="c1"># Assign the access and edit Permissions for issue, file and message</span>
<span class="c1"># to regular users now</span>
<span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="s1">'issue'</span><span class="p">,</span> <span class="s1">'file'</span><span class="p">,</span> <span class="s1">'msg'</span><span class="p">,</span> <span class="s1">'keyword'</span><span class="p">:</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="s1">'View'</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="s1">'Edit'</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="s1">'Create'</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
<span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="s1">'priority'</span><span class="p">,</span> <span class="s1">'status'</span><span class="p">:</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="s1">'View'</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>

<span class="c1"># May users view other user information? Comment these lines out</span>
<span class="c1"># if you don't want them to</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'View'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'user'</span><span class="p">,</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="s1">'organisation'</span><span class="p">,</span> <span class="s1">'phone'</span><span class="p">,</span> <span class="s1">'realname'</span><span class="p">,</span> <span class="s1">'timezone'</span><span class="p">,</span>
    <span class="s1">'username'</span><span class="p">))</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

<span class="c1"># Users should be able to edit their own details -- this permission is</span>
<span class="c1"># limited to only the situation where the Viewed or Edited item is their own.</span>
<span class="k">def</span> <span class="nf">own_record</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">userid</span><span class="p">,</span> <span class="n">itemid</span><span class="p">,</span> <span class="o">**</span><span class="n">ctx</span><span class="p">):</span>
    <span class="sd">'''Determine whether the userid matches the item being accessed.'''</span>
    <span class="k">return</span> <span class="n">userid</span> <span class="o">==</span> <span class="n">itemid</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'View'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'user'</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="n">own_record</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"User is allowed to view their own user details"</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Edit'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'user'</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="n">own_record</span><span class="p">,</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">(</span><span class="s1">'username'</span><span class="p">,</span> <span class="s1">'password'</span><span class="p">,</span> <span class="s1">'address'</span><span class="p">,</span> <span class="s1">'realname'</span><span class="p">,</span> <span class="s1">'phone'</span><span class="p">,</span>
        <span class="s1">'organisation'</span><span class="p">,</span> <span class="s1">'alternate_addresses'</span><span class="p">,</span> <span class="s1">'queries'</span><span class="p">,</span> <span class="s1">'timezone'</span><span class="p">),</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"User is allowed to edit their own user details"</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

<span class="c1"># Users should be able to edit and view their own queries. They should also</span>
<span class="c1"># be able to view any marked as not private. They should not be able to</span>
<span class="c1"># edit others' queries, even if they're not private</span>
<span class="k">def</span> <span class="nf">view_query</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">userid</span><span class="p">,</span> <span class="n">itemid</span><span class="p">):</span>
    <span class="n">private_for</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">itemid</span><span class="p">,</span> <span class="s1">'private_for'</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">private_for</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">userid</span> <span class="o">==</span> <span class="n">private_for</span>
<span class="k">def</span> <span class="nf">edit_query</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">userid</span><span class="p">,</span> <span class="n">itemid</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">userid</span> <span class="o">==</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">itemid</span><span class="p">,</span> <span class="s1">'creator'</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'View'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'query'</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="n">view_query</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"User is allowed to view their own and public queries"</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Search'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'query'</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Edit'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'query'</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="n">edit_query</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"User is allowed to edit their queries"</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Retire'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'query'</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="n">edit_query</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"User is allowed to retire their queries"</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Restore'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'query'</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="n">edit_query</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"User is allowed to restore their queries"</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Create'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'query'</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"User is allowed to create queries"</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

<span class="c1">#</span>
<span class="c1"># ANONYMOUS USER PERMISSIONS</span>
<span class="c1">#</span>
<span class="c1"># Let anonymous users access the web interface. Note that almost all</span>
<span class="c1"># trackers will need this Permission. The only situation where it's not</span>
<span class="c1"># required is in a tracker that uses an HTTP Basic Authenticated front-end.</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'Anonymous'</span><span class="p">,</span> <span class="s1">'Web Access'</span><span class="p">)</span>

<span class="c1"># Let anonymous users access the email interface (note that this implies</span>
<span class="c1"># that they will be registered automatically, hence they will need the</span>
<span class="c1"># "Create" user Permission below)</span>
<span class="c1"># This is disabled by default to stop spam from auto-registering users on</span>
<span class="c1"># public trackers.</span>
<span class="c1">#db.security.addPermissionToRole('Anonymous', 'Email Access')</span>

<span class="c1"># Assign the appropriate permissions to the anonymous user's Anonymous</span>
<span class="c1"># Role. Choices here are:</span>
<span class="c1"># - Allow anonymous users to register</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'Anonymous'</span><span class="p">,</span> <span class="s1">'Register'</span><span class="p">,</span> <span class="s1">'user'</span><span class="p">)</span>

<span class="c1"># Allow anonymous users access to view issues (and the related, linked</span>
<span class="c1"># information)</span>
<span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="s1">'issue'</span><span class="p">,</span> <span class="s1">'file'</span><span class="p">,</span> <span class="s1">'msg'</span><span class="p">,</span> <span class="s1">'keyword'</span><span class="p">,</span> <span class="s1">'priority'</span><span class="p">,</span> <span class="s1">'status'</span><span class="p">:</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'Anonymous'</span><span class="p">,</span> <span class="s1">'View'</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>

<span class="c1"># Allow the anonymous user to use the "Show Unassigned" search.</span>
<span class="c1"># It acts like "Show Open" if this permission is not available.</span>
<span class="c1"># If you are running a tracker that does not allow read access for</span>
<span class="c1"># anonymous, you should remove this entry as it can be used to perform</span>
<span class="c1"># a username guessing attack against a roundup install.</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Search'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'user'</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span> <span class="p">(</span><span class="s1">'Anonymous'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

<span class="c1"># [OPTIONAL]</span>
<span class="c1"># Allow anonymous users access to create or edit "issue" items (and the</span>
<span class="c1"># related file and message items)</span>
<span class="c1">#for cl in 'issue', 'file', 'msg':</span>
<span class="c1">#   db.security.addPermissionToRole('Anonymous', 'Create', cl)</span>
<span class="c1">#   db.security.addPermissionToRole('Anonymous', 'Edit', cl)</span>
</pre>
      </div> 
     </div> 
     <p id="index-42">You can use <code class="docutils literal notranslate"><span class="pre">roundup-admin</span> <span class="pre">security</span></code> to verify the permissions defined in the schema. It also verifies that properties specified in permissions are valid for the class. This helps detect typos that can cause baffling permission issues.</p> 
     <div class="section" id="automatic-permission-checks"> 
      <h3><a class="toc-backref" href="#id33">Automatic Permission Checks</a></h3> 
      <p>Permissions are automatically checked when information is rendered through the web. This includes:</p> 
      <ol class="arabic simple"> 
       <li>View checks for properties when being rendered via the <code class="docutils literal notranslate"><span class="pre">plain()</span></code> or similar methods. If the check fails, the text “[hidden]” will be displayed.</li> 
       <li>Edit checks for properties when the edit field is being rendered via the <code class="docutils literal notranslate"><span class="pre">field()</span></code> or similar methods. If the check fails, the property will be rendered via the <code class="docutils literal notranslate"><span class="pre">plain()</span></code> method (see point 1. for subsequent checking performed)</li> 
       <li>View checks are performed in index pages for each item being displayed such that if the user does not have permission, the row is not rendered.</li> 
       <li>View checks are performed at the top of item pages for the Item being displayed. If the user does not have permission, the text “You are not allowed to view this page.” will be displayed.</li> 
       <li>View checks are performed at the top of index pages for the Class being displayed. If the user does not have permission, the text “You are not allowed to view this page.” will be displayed.</li> 
      </ol> 
     </div> 
     <div class="section" id="new-user-roles"> 
      <h3><a class="toc-backref" href="#id34">New User Roles</a></h3> 
      <p>New users are assigned the Roles defined in the config file as:</p> 
      <ul class="simple"> 
       <li>NEW_WEB_USER_ROLES</li> 
       <li>NEW_EMAIL_USER_ROLES</li> 
      </ul> 
      <p>The <a class="reference internal" href="#users-may-only-edit-their-issues">users may only edit their issues</a> example shows customisation of these parameters.</p> 
     </div> 
     <div class="section" id="changing-access-controls"> 
      <h3><a class="toc-backref" href="#id35">Changing Access Controls</a></h3> 
      <p>You may alter the configuration variables to change the Role that new web or email users get, for example to not give them access to the web interface if they register through email.</p> 
      <p>You may use the <code class="docutils literal notranslate"><span class="pre">roundup-admin</span></code> “<code class="docutils literal notranslate"><span class="pre">security</span></code>” command to display the current Role and Permission configuration in your tracker.</p> 
      <div class="section" id="adding-a-new-permission"> 
       <h4>Adding a new Permission</h4> 
       <p>When adding a new Permission, you will need to:</p> 
       <ol class="arabic"> 
        <li><p class="first">add it to your tracker’s <code class="docutils literal notranslate"><span class="pre">schema.py</span></code> so it is created, using <code class="docutils literal notranslate"><span class="pre">security.addPermission</span></code>, for example:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"View"</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'frozzle'</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"User is allowed to access frozzles"</span><span class="p">)</span>
</pre>
          </div> 
         </div> <p>will set up a new “View” permission on the Class “frozzle”.</p> </li> 
        <li><p class="first">enable it for the Roles that should have it (verify with “<code class="docutils literal notranslate"><span class="pre">roundup-admin</span> <span class="pre">security</span></code>”)</p> </li> 
        <li><p class="first">add it to the relevant HTML interface templates</p> </li> 
        <li><p class="first">add it to the appropriate xxxPermission methods on in your tracker interfaces module</p> </li> 
       </ol> 
       <p>The <code class="docutils literal notranslate"><span class="pre">addPermission</span></code> method takes a few optional parameters:</p> 
       <dl class="docutils"> 
        <dt>
         <strong>properties</strong>
        </dt> 
        <dd>
         A sequence of property names that are the only properties to apply the new Permission to (eg. <code class="docutils literal notranslate"><span class="pre">...</span> <span class="pre">klass='user',</span> <span class="pre">properties=('name',</span> <span class="pre">'email')</span> <span class="pre">...</span></code>)
        </dd> 
        <dt>
         <strong>props_only</strong>
        </dt> 
        <dd>
         <p class="first">A boolean value (set to false by default) that is a new feature in roundup 1.6. A permission defined using:</p> 
         <blockquote> 
          <div>
           <code class="docutils literal notranslate"><span class="pre">properties=('list',</span> <span class="pre">'of',</span> <span class="pre">'property',</span> <span class="pre">'names')</span></code>
          </div>
         </blockquote> 
         <p>is used to determine access for things other than just those properties. For example a check for View permission on the issue class or an issue item can use any View permission for the issue class even if that permission has a property list. This can be confusing and surprising as you would think that a permission including properties would be used only for determining the access permission for those properties.</p> 
         <p><code class="docutils literal notranslate"><span class="pre">roundup-admin</span> <span class="pre">security</span></code> will report invalid properties for the class. For example a permission with an invalid summary property is presented as:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">Allowed</span> <span class="n">to</span> <span class="n">see</span> <span class="n">content</span> <span class="n">of</span> <span class="nb">object</span> <span class="n">regardless</span> <span class="n">of</span> <span class="n">spam</span> <span class="n">status</span>
   <span class="p">(</span><span class="n">View</span> <span class="k">for</span> <span class="s2">"file"</span><span class="p">:</span> <span class="p">(</span><span class="s1">'content'</span><span class="p">,</span> <span class="s1">'summary'</span><span class="p">)</span> <span class="n">only</span><span class="p">)</span>

<span class="o">**</span><span class="n">Invalid</span> <span class="n">properties</span> <span class="k">for</span> <span class="n">file</span><span class="p">:</span> <span class="p">[</span><span class="s1">'summary'</span><span class="p">]</span>
</pre>
          </div> 
         </div> 
         <p>Setting <code class="docutils literal notranslate"><span class="pre">props_only=True</span></code> will make the permission valid only for those properties.</p> 
         <p>If you use a lot of permissions with property checks, it can be difficult to change all of them. Calling the function:</p> 
         <blockquote> 
          <div>
           db.security.set_props_only_default(True)
          </div>
         </blockquote> 
         <p class="last">at the top of <code class="docutils literal notranslate"><span class="pre">schema.py</span></code> will make every permission creation behave as though props_only was set to True. It is expected that the default of True will become the default in a future Roundup release.</p> 
        </dd> 
        <dt>
         <strong>check</strong>
        </dt> 
        <dd>
         <p class="first">A function to be executed which returns boolean determining whether the Permission is allowed. If it returns True, the permission is allowed, if it returns False the permission is denied. The function can have one of two signatures:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">check</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">userid</span><span class="p">,</span> <span class="n">itemid</span><span class="p">)</span>
</pre>
          </div> 
         </div> 
         <p>or:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">check</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">userid</span><span class="p">,</span> <span class="n">itemid</span><span class="p">,</span> <span class="o">**</span><span class="n">ctx</span><span class="p">)</span>
</pre>
          </div> 
         </div> 
         <p>where <code class="docutils literal notranslate"><span class="pre">db</span></code> is a handle on the open database, <code class="docutils literal notranslate"><span class="pre">userid</span></code> is the user attempting access and <code class="docutils literal notranslate"><span class="pre">itemid</span></code> is the specific item being accessed. If the second form is used the <code class="docutils literal notranslate"><span class="pre">ctx</span></code> dictionary is defined with the following values:</p> 
         <div class="last highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">ctx</span><span class="p">[</span><span class="s1">'property'</span><span class="p">]</span> <span class="n">the</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="nb">property</span> <span class="n">being</span> <span class="n">checked</span> <span class="ow">or</span> <span class="kc">None</span> <span class="k">if</span>
       <span class="n">it</span><span class="s1">'s a class check.</span>

<span class="n">ctx</span><span class="p">[</span><span class="s1">'classname'</span><span class="p">]</span> <span class="n">the</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="k">class</span> <span class="nc">that</span> <span class="ow">is</span> <span class="n">being</span> <span class="n">checked</span>
       <span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="n">query</span> <span class="o">....</span><span class="p">)</span><span class="o">.</span>

<span class="n">ctx</span><span class="p">[</span><span class="s1">'permission'</span><span class="p">]</span> <span class="n">the</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">permission</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">View</span><span class="p">,</span> <span class="n">Edit</span><span class="o">...</span><span class="p">)</span><span class="o">.</span>
</pre>
          </div> 
         </div> 
        </dd> 
       </dl> 
       <p>The second form is preferred as it makes it easier to implement more complex permission schemes. An example of the use of <code class="docutils literal notranslate"><span class="pre">ctx</span></code> can be found in the <code class="docutils literal notranslate"><span class="pre">upgrading.txt</span></code> or <a class="reference external" href="upgrading.html">upgrading.html</a> document.</p> 
      </div> 
      <div class="section" id="example-scenarios"> 
       <h4>Example Scenarios</h4> 
       <p>See the <a class="reference internal" href="#examples">examples</a> section for longer examples of customisation.</p> 
       <dl class="docutils"> 
        <dt>
         <strong>anonymous access through the e-mail gateway</strong>
        </dt> 
        <dd>
         Give the “anonymous” user the “Email Access”, (“Edit”, “issue”) and (“Create”, “msg”) Permissions but do not not give them the (“Create”, “user”) Permission. This means that when an unknown user sends email into the tracker, they’re automatically logged in as “anonymous”. Since they don’t have the (“Create”, “user”) Permission, they won’t be automatically registered, but since “anonymous” has permission to use the gateway, they’ll still be able to submit issues. Note that the Sender information - their email address - will not be available - they’re <em>anonymous</em>.
        </dd> 
        <dt>
         <strong>automatic registration of users in the e-mail gateway</strong>
        </dt> 
        <dd>
         By giving the “anonymous” user the (“Register”, “user”) Permission, any unidentified user will automatically be registered with the tracker (with no password, so they won’t be able to log in through the web until an admin sets their password). By default new Roundup trackers don’t allow this as it opens them up to spam. It may be enabled by uncommenting the appropriate addPermissionToRole in your tracker’s <code class="docutils literal notranslate"><span class="pre">schema.py</span></code> file. The new user is given the Roles list defined in the “new_email_user_roles” config variable.
        </dd> 
        <dt>
         <strong>only developers may be assigned issues</strong>
        </dt> 
        <dd>
         Create a new Permission called “Fixer” for the “issue” class. Create a new Role “Developer” which has that Permission, and assign that to the appropriate users. Filter the list of users available in the assignedto list to include only those users. Enforce the Permission with an auditor. See the example <a class="reference internal" href="#restricting-the-list-of-users-that-are-assignable-to-a-task">restricting the list of users that are assignable to a task</a>.
        </dd> 
        <dt>
         <strong>only managers may sign off issues as complete</strong>
        </dt> 
        <dd>
         <p class="first">Create a new Permission called “Closer” for the “issue” class. Create a new Role “Manager” which has that Permission, and assign that to the appropriate users. In your web interface, only display the “resolved” issue state option when the user has the “Closer” Permissions. Enforce the Permission with an auditor. This is very similar to the previous example, except that the web interface check would look like:</p> 
         <div class="last highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">option</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"python:request.user.hasPermission('Closer')"</span>
        <span class="n">value</span><span class="o">=</span><span class="s2">"resolved"</span><span class="o">&gt;</span><span class="n">Resolved</span><span class="o">&lt;/</span><span class="n">option</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> 
        </dd> 
        <dt>
         <strong>don’t give web access to users who register through email</strong>
        </dt> 
        <dd>
         Create a new Role called “Email User” which has all the Permissions of the normal “User” Role minus the “Web Access” Permission. This will allow users to send in emails to the tracker, but not access the web interface.
        </dd> 
        <dt>
         <strong>let some users edit the details of all users</strong>
        </dt> 
        <dd>
         <p class="first">Create a new Role called “User Admin” which has the Permission for editing users:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addRole</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'User Admin'</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">'Managing users'</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">'Edit'</span><span class="p">,</span> <span class="s1">'user'</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User Admin'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre>
          </div> 
         </div> 
         <p class="last">and assign the Role to the users who need the permission.</p> 
        </dd> 
       </dl> 
      </div> 
     </div> 
    </div> 
    <div class="section" id="web-interface"> 
     <h2><a class="toc-backref" href="#id36">Web Interface</a></h2> 
     <div class="contents local topic" id="id3"> 
      <ul class="simple"> 
       <li><a class="reference internal" href="#repercussions-of-changing-the-tracker-schema" id="id63">Repercussions of changing the tracker schema</a></li> 
       <li><a class="reference internal" href="#how-requests-are-processed" id="id64">How requests are processed</a></li> 
       <li><a class="reference internal" href="#roundup-url-design" id="id65">Roundup URL design</a></li> 
       <li><a class="reference internal" href="#determining-web-context" id="id66">Determining web context</a></li> 
       <li><a class="reference internal" href="#the-home-context" id="id67">The “home” Context</a></li> 
       <li><a class="reference internal" href="#serving-static-content" id="id68">Serving static content</a></li> 
       <li><a class="reference internal" href="#performing-actions-in-web-requests" id="id69">Performing actions in web requests</a></li> 
       <li><a class="reference internal" href="#protecting-users-from-web-application-attacks" id="id70">Protecting users from web application attacks</a></li> 
       <li><a class="reference internal" href="#special-form-variables" id="id71">Special form variables</a></li> 
       <li><a class="reference internal" href="#default-templates" id="id72">Default templates</a></li> 
       <li><a class="reference internal" href="#implementing-modal-editing-using-template" id="id73">Implementing Modal Editing Using @template</a></li> 
       <li><a class="reference internal" href="#how-the-templates-work" id="id74">How the templates work</a>
        <ul> 
         <li><a class="reference internal" href="#templating-engines" id="id75">Templating engines</a></li> 
         <li><a class="reference internal" href="#basic-templating-actions" id="id76">Basic Templating Actions</a></li> 
         <li><a class="reference internal" href="#templating-expressions" id="id77">Templating Expressions</a></li> 
         <li><a class="reference internal" href="#template-macros" id="id78">Template Macros</a></li> 
        </ul> </li> 
       <li><a class="reference internal" href="#information-available-to-templates" id="id79">Information available to templates</a>
        <ul> 
         <li><a class="reference internal" href="#the-context-variable" id="id80">The context variable</a>
          <ul> 
           <li><a class="reference internal" href="#hyperdb-class-wrapper" id="id81">Hyperdb class wrapper</a></li> 
           <li><a class="reference internal" href="#hyperdb-item-wrapper" id="id82">Hyperdb item wrapper</a></li> 
           <li><a class="reference internal" href="#hyperdb-property-wrapper" id="id83">Hyperdb property wrapper</a></li> 
          </ul> </li> 
         <li><a class="reference internal" href="#the-request-variable" id="id84">The request variable</a>
          <ul> 
           <li><a class="reference internal" href="#the-form-variable" id="id85">The form variable</a></li> 
          </ul> </li> 
         <li><a class="reference internal" href="#the-db-variable" id="id86">The db variable</a></li> 
         <li><a class="reference internal" href="#the-templates-variable" id="id87">The templates variable</a></li> 
         <li><a class="reference internal" href="#the-repeat-variable" id="id88">The repeat variable</a></li> 
         <li><a class="reference internal" href="#the-utils-variable" id="id89">The utils variable</a>
          <ul> 
           <li><a class="reference internal" href="#batching" id="id90">Batching</a></li> 
          </ul> </li> 
         <li><a class="reference internal" href="#translations" id="id91">Translations</a></li> 
        </ul> </li> 
       <li><a class="reference internal" href="#displaying-properties" id="id92">Displaying Properties</a></li> 
       <li><a class="reference internal" href="#index-views" id="id93">Index Views</a>
        <ul> 
         <li><a class="reference internal" href="#index-view-specifiers" id="id94">Index View Specifiers</a></li> 
        </ul> </li> 
       <li><a class="reference internal" href="#searching-views" id="id95">Searching Views</a></li> 
       <li><a class="reference internal" href="#item-views" id="id96">Item Views</a>
        <ul> 
         <li><a class="reference internal" href="#editor-section" id="id97">Editor Section</a>
          <ul> 
           <li><a class="reference internal" href="#form-values" id="id98">Form values</a></li> 
          </ul> </li> 
         <li><a class="reference internal" href="#spool-section" id="id99">Spool Section</a></li> 
         <li><a class="reference internal" href="#history-section" id="id100">History Section</a></li> 
        </ul> </li> 
       <li><a class="reference internal" href="#defining-new-web-actions" id="id101">Defining new web actions</a>
        <ul> 
         <li><a class="reference internal" href="#define-the-new-action-class" id="id102">Define the new action class</a></li> 
         <li><a class="reference internal" href="#register-the-action-class" id="id103">Register the action class</a></li> 
         <li><a class="reference internal" href="#use-the-new-action" id="id104">Use the new action</a></li> 
         <li><a class="reference internal" href="#actions-may-return-content-to-the-user" id="id105">Actions may return content to the user</a></li> 
        </ul> </li> 
       <li><a class="reference internal" href="#bit-character-set-support-in-web-interface" id="id106">8-bit character set support in Web interface</a></li> 
      </ul> 
     </div> 
     <p>The web interface is provided by the <code class="docutils literal notranslate"><span class="pre">roundup.cgi.client</span></code> module and is used by <code class="docutils literal notranslate"><span class="pre">roundup.cgi</span></code>, <code class="docutils literal notranslate"><span class="pre">roundup-server</span></code> and <code class="docutils literal notranslate"><span class="pre">ZRoundup</span></code> (<code class="docutils literal notranslate"><span class="pre">ZRoundup</span></code> is broken, until further notice). In all cases, we determine which tracker is being accessed (the first part of the URL path inside the scope of the CGI handler) and pass control on to the <code class="docutils literal notranslate"><span class="pre">roundup.cgi.client.Client</span></code> class - which handles the rest of the access through its <code class="docutils literal notranslate"><span class="pre">main()</span></code> method. This means that you can do pretty much anything you want as a web interface to your tracker.</p> 
     <div class="section" id="repercussions-of-changing-the-tracker-schema"> 
      <h3><a class="toc-backref" href="#id63">Repercussions of changing the tracker schema</a></h3> 
      <p>If you choose to change the <a class="reference internal" href="#tracker-schema">tracker schema</a> you will need to ensure the web interface knows about it:</p> 
      <ol class="arabic simple"> 
       <li>Index, item and search pages for the relevant classes may need to have properties added or removed,</li> 
       <li>The “page” template may require links to be changed, as might the “home” page’s content arguments.</li> 
      </ol> 
     </div> 
     <div class="section" id="how-requests-are-processed"> 
      <h3><a class="toc-backref" href="#id64">How requests are processed</a></h3> 
      <p>The basic processing of a web request proceeds as follows:</p> 
      <ol class="arabic simple"> 
       <li>figure out who we are, defaulting to the “anonymous” user</li> 
       <li>figure out what the request is for - we call this the “context”</li> 
       <li>handle any requested action (item edit, search, …)</li> 
       <li>render the template requested by the context, resulting in HTML output</li> 
      </ol> 
      <p>In some situations, exceptions occur:</p> 
      <ul class="simple"> 
       <li>HTTP Redirect (generally raised by an action)</li> 
       <li>
        <dl class="first docutils"> 
         <dt>
          SendFile (generally raised by <code class="docutils literal notranslate"><span class="pre">determine_context</span></code>)
         </dt> 
         <dd>
          here we serve up a FileClass “content” property
         </dd> 
        </dl> </li> 
       <li>
        <dl class="first docutils"> 
         <dt>
          SendStaticFile (generally raised by <code class="docutils literal notranslate"><span class="pre">determine_context</span></code>)
         </dt> 
         <dd>
          here we serve up a file from the tracker “html” directory
         </dd> 
        </dl> </li> 
       <li>
        <dl class="first docutils"> 
         <dt>
          Unauthorised (generally raised by an action)
         </dt> 
         <dd>
          here the action is cancelled, the request is rendered and an error message is displayed indicating that permission was not granted for the action to take place
         </dd> 
        </dl> </li> 
       <li>
        <dl class="first docutils"> 
         <dt>
          NotFound (raised wherever it needs to be)
         </dt> 
         <dd>
          this exception percolates up to the CGI interface that called the client
         </dd> 
        </dl> </li> 
      </ul> 
     </div> 
     <div class="section" id="roundup-url-design"> 
      <h3><a class="toc-backref" href="#id65">Roundup URL design</a></h3> 
      <p>Each tracker has several hardcoded URLs. These three are equivalent and lead to the main tracker page:</p> 
      <ol class="arabic simple"> 
       <li><code class="docutils literal notranslate"><span class="pre">/</span></code></li> 
       <li><code class="docutils literal notranslate"><span class="pre">/index</span></code></li> 
       <li><code class="docutils literal notranslate"><span class="pre">/home</span></code></li> 
      </ol> 
      <p>The following prefix is used to access static resources:</p> 
      <ol class="arabic simple" start="4"> 
       <li><code class="docutils literal notranslate"><span class="pre">/@@file/</span></code></li> 
      </ol> 
      <p>Two additional url’s are used for the API’s. The <a class="reference external" href="rest.html">REST api</a> is accessed via:</p> 
      <ol class="arabic simple" start="5"> 
       <li><code class="docutils literal notranslate"><span class="pre">/rest/</span></code></li> 
      </ol> 
      <p>and the <a class="reference external" href="xmlrpc.html">XMLRPC api</a> is available at:</p> 
      <ol class="arabic simple" start="6"> 
       <li><code class="docutils literal notranslate"><span class="pre">/rest/</span></code></li> 
      </ol> 
      <p>All other URLs depend on the classes configured in Roundup database. Each class receives two URLs - one for the class itself and another for specific items of that class. Example for class URL:</p> 
      <ol class="arabic simple" start="7"> 
       <li><code class="docutils literal notranslate"><span class="pre">/issue</span></code></li> 
      </ol> 
      <p>This is usually used to show listings of class items. The URL for for specific object of issue class with id 1 will look like:</p> 
      <ol class="arabic simple" start="8"> 
       <li><code class="docutils literal notranslate"><span class="pre">/issue1</span></code></li> 
      </ol> 
     </div> 
     <div class="section" id="determining-web-context"> 
      <h3><a class="toc-backref" href="#id66">Determining web context</a></h3> 
      <p>To determine the “context” of a request (what request is for), we look at the URL path after the tracker root and at <code class="docutils literal notranslate"><span class="pre">@template</span></code> request parameter. Typical URL paths look like:</p> 
      <ol class="arabic simple"> 
       <li><code class="docutils literal notranslate"><span class="pre">/tracker/issue</span></code></li> 
       <li><code class="docutils literal notranslate"><span class="pre">/tracker/issue1</span></code></li> 
       <li><code class="docutils literal notranslate"><span class="pre">/tracker/@@file/style.css</span></code></li> 
       <li><code class="docutils literal notranslate"><span class="pre">/cgi-bin/roundup.cgi/tracker/file1</span></code></li> 
       <li><code class="docutils literal notranslate"><span class="pre">/cgi-bin/roundup.cgi/tracker/file1/kitten.png</span></code></li> 
      </ol> 
      <p>where tracker root is <code class="docutils literal notranslate"><span class="pre">/tracker/</span></code> or <code class="docutils literal notranslate"><span class="pre">/cgi-bin/roundup.cgi/tracker/</span></code> We’re looking at “issue”, “issue1”, “@@file/style.css”, “file1” and “file1/kitten.png” in the cases above.</p> 
      <ol class="loweralpha simple"> 
       <li>with is no path we are in the “home” context. See <a class="reference internal" href="#the-home-context">the “home” context</a> below for details. “index” or “home” paths may also be used to switch into “home” context.</li> 
       <li>for paths starting with “@@file” the additional path entry (“style.css” in the example above) specifies the static file to be served from the tracker TEMPLATES directory (or STATIC_FILES, if configured). This is usually the tracker’s “html” directory. Internally this works by raising SendStaticFile exception.</li> 
       <li>if there is something in the path (as in example 1, “issue”), it identifies the tracker class to display.</li> 
       <li>if the path is an item designator (as in examples 2 and 4, “issue1” and “file1”), then we’re to display a specific item.</li> 
       <li>if the path starts with an item designator and is longer than one entry (as in example 5, “file1/kitten.png”), then we’re assumed to be handling an item of a <code class="docutils literal notranslate"><span class="pre">FileClass</span></code>, and the extra path information gives the filename that the client is going to label the download with (i.e. “file1/kitten.png” is nicer to download than “file1”). This raises a <code class="docutils literal notranslate"><span class="pre">SendFile</span></code> exception.</li> 
      </ol> 
      <p>Neither b. or e. use templates and stop before the template is determined. For other contexts the template used is specified by the <code class="docutils literal notranslate"><span class="pre">@template</span></code> variable, which defaults to:</p> 
      <ul class="simple"> 
       <li>only classname supplied: “index”</li> 
       <li>full item designator supplied: “item”</li> 
      </ul> 
     </div> 
     <div class="section" id="the-home-context"> 
      <h3><a class="toc-backref" href="#id67">The “home” Context</a></h3> 
      <p>The “home” context is special because it allows you to add templated pages to your tracker that don’t rely on a class or item (ie. an issues list or specific issue).</p> 
      <p>Let’s say you wish to add frames to control the layout of your tracker’s interface. You’d probably have:</p> 
      <ul> 
       <li><p class="first">A top-level frameset page. This page probably wouldn’t be templated, so it could be served as a static file (see <a class="reference internal" href="#serving-static-content">serving static content</a>)</p> </li> 
       <li><p class="first">A sidebar frame that is templated. Let’s call this page “home.navigation.html” in your tracker’s “html” directory. To load that page up, you use the URL:</p> 
        <blockquote> 
         <div>
          <p>&lt;tracker url&gt;/<a class="reference external" href="mailto:home?%40template=navigation">home?<span>@</span>template=navigation</a></p> 
         </div>
        </blockquote> </li> 
      </ul> 
     </div> 
     <div class="section" id="serving-static-content"> 
      <h3><a class="toc-backref" href="#id68">Serving static content</a></h3> 
      <p>See the previous section <a class="reference internal" href="#determining-web-context">determining web context</a> where it describes <code class="docutils literal notranslate"><span class="pre">@@file</span></code> paths.</p> 
     </div> 
     <div class="section" id="performing-actions-in-web-requests"> 
      <h3><a class="toc-backref" href="#id69">Performing actions in web requests</a></h3> 
      <p>When a user requests a web page, they may optionally also request for an action to take place. As described in <a class="reference internal" href="#how-requests-are-processed">how requests are processed</a>, the action is performed before the requested page is generated. Actions are triggered by using a <code class="docutils literal notranslate"><span class="pre">@action</span></code> CGI variable, where the value is one of:</p> 
      <dl class="docutils"> 
       <dt>
        <strong>login</strong>
       </dt> 
       <dd>
        Attempt to log a user in.
       </dd> 
       <dt>
        <strong>logout</strong>
       </dt> 
       <dd>
        Log the user out - make them “anonymous”.
       </dd> 
       <dt>
        <strong>register</strong>
       </dt> 
       <dd>
        Attempt to create a new user based on the contents of the form and then log them in.
       </dd> 
       <dt>
        <strong>edit</strong>
       </dt> 
       <dd>
        Perform an edit of an item in the database. There are some <a class="reference internal" href="#special-form-variables">special form variables</a> you may use. Also you can set the <code class="docutils literal notranslate"><span class="pre">__redirect_to</span></code> form variable to the URL that should be displayed after the edit is succesfully completed. If you wanted to edit a sequence of issues, users etc. this could be used to display the next item in the sequence to the user.
       </dd> 
       <dt>
        <strong>new</strong>
       </dt> 
       <dd>
        Add a new item to the database. You may use the same <a class="reference internal" href="#special-form-variables">special form variables</a> as in the “edit” action. Also you can set the <code class="docutils literal notranslate"><span class="pre">__redirect_to</span></code> form variable to the URL that should be displayed after the new item is created. This is useful if you want to create another item rather than edit the newly created item.
       </dd> 
       <dt>
        <strong>retire</strong>
       </dt> 
       <dd>
        Retire the item in the database.
       </dd> 
       <dt>
        <strong>editCSV</strong>
       </dt> 
       <dd>
        Performs an edit of all of a class’ items in one go. See also the <em>class</em>.csv templating method which generates the CSV data to be edited, and the <code class="docutils literal notranslate"><span class="pre">'_generic.index'</span></code> template which uses both of these features.
       </dd> 
       <dt>
        <strong>search</strong>
       </dt> 
       <dd>
        <p class="first">Mangle some of the form variables:</p> 
        <ul class="last simple"> 
         <li>Set the form “:filter” variable based on the values of the filter variables - if they’re set to anything other than “dontcare” then add them to :filter.</li> 
         <li>Also handle the “:queryname” variable and save off the query to the user’s query list.</li> 
        </ul> 
       </dd> 
      </dl> 
      <p>Each of the actions is implemented by a corresponding <code class="docutils literal notranslate"><span class="pre">*XxxAction*</span></code> (where “Xxx” is the name of the action) class in the <code class="docutils literal notranslate"><span class="pre">roundup.cgi.actions</span></code> module. These classes are registered with <code class="docutils literal notranslate"><span class="pre">roundup.cgi.client.Client</span></code>. If you need to define new actions, you may add them there (see <a class="reference internal" href="#defining-new-web-actions">defining new web actions</a>).</p> 
      <p>Each action class also has a <code class="docutils literal notranslate"><span class="pre">*permission*</span></code> method which determines whether the action is permissible given the current user. The base permission checks for each action are:</p> 
      <dl class="docutils"> 
       <dt>
        <strong>login</strong>
       </dt> 
       <dd>
        Determine whether the user has the “Web Access” Permission.
       </dd> 
       <dt>
        <strong>logout</strong>
       </dt> 
       <dd>
        No permission checks are made.
       </dd> 
       <dt>
        <strong>register</strong>
       </dt> 
       <dd>
        Determine whether the user has the (“Create”, “user”) Permission.
       </dd> 
       <dt>
        <strong>edit</strong>
       </dt> 
       <dd>
        Determine whether the user has permission to edit this item. If we’re editing the “user” class, users are allowed to edit their own details - unless they try to edit the “roles” property, which requires the special Permission “Web Roles”.
       </dd> 
       <dt>
        <strong>new</strong>
       </dt> 
       <dd>
        Determine whether the user has permission to create this item. No additional property checks are made. Additionally, new user items may be created if the user has the (“Create”, “user”) Permission.
       </dd> 
       <dt>
        <strong>editCSV</strong>
       </dt> 
       <dd>
        Determine whether the user has permission to edit this class.
       </dd> 
       <dt>
        <strong>search</strong>
       </dt> 
       <dd>
        Determine whether the user has permission to view this class.
       </dd> 
      </dl> 
     </div> 
     <div class="section" id="protecting-users-from-web-application-attacks"> 
      <h3><a class="toc-backref" href="#id70">Protecting users from web application attacks</a></h3> 
      <p>There is a class of attacks known as Cross Site Request Forgeries (CSRF). Malicious code running in the browser can making a request to roundup while you are logged into roundup. The malicious code piggy backs on your existing roundup session to make changes without your knowledge. Roundup 1.6 has support for defending against this by analyzing the</p> 
      <ul class="simple"> 
       <li>Referer,</li> 
       <li>Origin, and</li> 
       <li>Host or</li> 
       <li>X-Forwarded-Host</li> 
      </ul> 
      <p>HTTP headers. It compares the headers to the value of the web setting in the [tracker] section of the tracker’s <code class="docutils literal notranslate"><span class="pre">config.ini</span></code>.</p> 
      <p>Also a per form token (also called a nonce) can be enabled for the tracker using the <code class="docutils literal notranslate"><span class="pre">csrf_enforce_token</span></code> option in config.ini. When enabled, roundup will validate a hidden form field called <code class="docutils literal notranslate"><span class="pre">@csrf</span></code>. If the validation fails (or the token is used more than once) the request is rejected. The <code class="docutils literal notranslate"><span class="pre">@csrf</span></code> input field is added automatically by calling the <code class="docutils literal notranslate"><span class="pre">submit</span></code> function/path. It can also be added manually by calling anti_csrf_nonce() directly. For example:</p> 
      <blockquote> 
       <div>
        <dl class="docutils"> 
         <dt>
          &lt;input name=”@csrf” type=”hidden”
         </dt> 
         <dd>
          tal:attributes=”value python:utils.anti_csrf_nonce(lifetime=10)”&gt;
         </dd> 
        </dl> 
       </div>
      </blockquote> 
      <p>By default a nonce lifetime is 2 weeks. However the lifetime (in minutes) can be set by passing a lifetime argument as shown above. The example above makes the nonce lifetime 10 minutes.</p> 
      <p>Search for @csrf in this document for more examples. There are more examples and information in <code class="docutils literal notranslate"><span class="pre">upgrading.txt</span></code>.</p> 
      <p>The token protects you because malicious code supplied by another site is unable to obtain the token. Thus many attempts they make to submit a request are rejected.</p> 
      <p>The protection on the xmlrpc interface is untested, but is based on a valid header check against the roundup url and the presence of the <code class="docutils literal notranslate"><span class="pre">X-REQUESTED-WITH</span></code> header. Work to improve this is a future project after the 1.6 release.</p> 
      <p>The enforcement levels can be modified in <code class="docutils literal notranslate"><span class="pre">config.ini</span></code>. Refer to that file for details.</p> 
     </div> 
     <div class="section" id="special-form-variables"> 
      <h3><a class="toc-backref" href="#id71">Special form variables</a></h3> 
      <p>Item properties and their values are edited with html FORM variables and their values. You can:</p> 
      <ul class="simple"> 
       <li>Change the value of some property of the current item.</li> 
       <li>Create a new item of any class, and edit the new item’s properties,</li> 
       <li>Attach newly created items to a multilink property of the current item.</li> 
       <li>Remove items from a multilink property of the current item.</li> 
       <li>Specify that some properties are required for the edit operation to be successful.</li> 
       <li>Redirect to a different page after creating a new item (new action only, not edit action). Usually you end up on the page for the created item.</li> 
       <li>Set up user interface locale.</li> 
      </ul> 
      <p>These operations will only take place if the form action (the <code class="docutils literal notranslate"><span class="pre">@action</span></code> variable) is “edit” or “new”.</p> 
      <p>In the following, &lt;bracketed&gt; values are variable, “@” may be either “:” or “@”, and other text “required” is fixed.</p> 
      <p>Two special form variables are used to specify user language preferences:</p> 
      <dl class="docutils"> 
       <dt>
        <code class="docutils literal notranslate"><span class="pre">@language</span></code>
       </dt> 
       <dd>
        value may be locale name or <code class="docutils literal notranslate"><span class="pre">none</span></code>. If this variable is set to locale name, web interface language is changed to given value (provided that appropriate translation is available), the value is stored in the browser cookie and will be used for all following requests. If value is <code class="docutils literal notranslate"><span class="pre">none</span></code> the cookie is removed and the language is changed to the tracker default, set up in the tracker configuration or OS environment.
       </dd> 
       <dt>
        <code class="docutils literal notranslate"><span class="pre">@charset</span></code>
       </dt> 
       <dd>
        value may be character set name or <code class="docutils literal notranslate"><span class="pre">none</span></code>. Character set name is stored in the browser cookie and sets output encoding for all HTML pages generated by Roundup. If value is <code class="docutils literal notranslate"><span class="pre">none</span></code> the cookie is removed and HTML output is reset to Roundup internal encoding (UTF-8).
       </dd> 
      </dl> 
      <p>Most properties are specified as form variables:</p> 
      <dl class="docutils"> 
       <dt>
        <code class="docutils literal notranslate"><span class="pre">&lt;propname&gt;</span></code>
       </dt> 
       <dd>
        property on the current context item
       </dd> 
       <dt>
        <code class="docutils literal notranslate"><span class="pre">&lt;designator&gt;"@"&lt;propname&gt;</span></code>
       </dt> 
       <dd>
        property on the indicated item (for editing related information)
       </dd> 
      </dl> 
      <p>Designators name a specific item of a class.</p> 
      <dl class="docutils"> 
       <dt>
        <code class="docutils literal notranslate"><span class="pre">&lt;classname&gt;&lt;N&gt;</span></code>
       </dt> 
       <dd>
        Name an existing item of class &lt;classname&gt;.
       </dd> 
       <dt>
        <code class="docutils literal notranslate"><span class="pre">&lt;classname&gt;"-"&lt;N&gt;</span></code>
       </dt> 
       <dd>
        Name the &lt;N&gt;th new item of class &lt;classname&gt;. If the form submission is successful, a new item of &lt;classname&gt; is created. Within the submitted form, a particular designator of this form always refers to the same new item.
       </dd> 
      </dl> 
      <p>Once we have determined the “propname”, we look at it to see if it’s special:</p> 
      <dl class="docutils"> 
       <dt>
        <code class="docutils literal notranslate"><span class="pre">@required</span></code>
       </dt> 
       <dd>
        <p class="first">The associated form value is a comma-separated list of property names that must be specified when the form is submitted for the edit operation to succeed.</p> 
        <p>When the &lt;designator&gt; is missing, the properties are for the current context item. When &lt;designator&gt; is present, they are for the item specified by &lt;designator&gt;.</p> 
        <p class="last">The “@required” specifier must come before any of the properties it refers to are assigned in the form.</p> 
       </dd> 
       <dt>
        <code class="docutils literal notranslate"><span class="pre">@remove@&lt;propname&gt;=id(s)</span></code> or <code class="docutils literal notranslate"><span class="pre">@add@&lt;propname&gt;=id(s)</span></code>
       </dt> 
       <dd>
        The “@add@” and “@remove@” edit actions apply only to Multilink properties. The form value must be a comma-separate list of keys for the class specified by the simple form variable. The listed items are added to (respectively, removed from) the specified property.
       </dd> 
       <dt>
        <code class="docutils literal notranslate"><span class="pre">@link@&lt;propname&gt;=&lt;designator&gt;</span></code>
       </dt> 
       <dd>
        If the edit action is “@link@”, the simple form variable must specify a Link or Multilink property. The form value is a comma-separated list of designators. The item corresponding to each designator is linked to the property given by simple form variable.
       </dd> 
       <dt>
        None of the above (ie. just a simple form value)
       </dt> 
       <dd>
        <p class="first">The value of the form variable is converted appropriately, depending on the type of the property.</p> 
        <p>For a Link(‘klass’) property, the form value is a single key for ‘klass’, where the key field is specified in schema.py.</p> 
        <p>For a Multilink(‘klass’) property, the form value is a comma-separated list of keys for ‘klass’, where the key field is specified in schema.py.</p> 
        <p>Note that for simple-form-variables specifiying Link and Multilink properties, the linked-to class must have a key field.</p> 
        <p>For a String() property specifying a filename, the file named by the form value is uploaded. This means we try to set additional properties “filename” and “type” (if they are valid for the class). Otherwise, the property is set to the form value.</p> 
        <p class="last">For Date(), Interval(), Boolean(), Integer() and Number() properties, the form value is converted to the appropriate value.</p> 
       </dd> 
      </dl> 
      <p>Any of the form variables may be prefixed with a classname or designator.</p> 
      <p>Setting the form variable: <code class="docutils literal notranslate"><span class="pre">__redirect_to=</span></code> to a url when @action=new redirects the user to the specified url after successfully creating the new item. This is useful if you want the user to create another item rather than edit the newly created item. Note that the url assigned to <code class="docutils literal notranslate"><span class="pre">__redirect_to</span></code> must be url encoded/quoted and be under the tracker’s base url. If the base_url uses http, you can set the url to https.</p> 
      <p>Two special form values are supported for backwards compatibility:</p> 
      <dl class="docutils"> 
       <dt>
        @note
       </dt> 
       <dd>
        <p class="first">This is equivalent to:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="nd">@link@messages</span><span class="o">=</span><span class="n">msg</span><span class="o">-</span><span class="mi">1</span>
<span class="n">msg</span><span class="o">-</span><span class="mi">1</span><span class="nd">@content</span><span class="o">=</span><span class="n">value</span>
</pre>
         </div> 
        </div> 
        <p>which is equivalent to the html:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="o">&lt;</span><span class="n">textarea</span> <span class="n">name</span><span class="o">=</span><span class="s2">"msg-1@content"</span><span class="o">&gt;&lt;/</span><span class="n">textarea</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"@link@messages"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"msg-1"</span><span class="o">&gt;</span>
</pre>
         </div> 
        </div> 
        <p class="last">except that in addition, the “author” and “date” properties of “msg-1” are set to the userid of the submitter, and the current time, respectively.</p> 
       </dd> 
       <dt>
        @file
       </dt> 
       <dd>
        <p class="first">This is equivalent to:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="nd">@link@files</span><span class="o">=</span><span class="n">file</span><span class="o">-</span><span class="mi">1</span>
<span class="n">file</span><span class="o">-</span><span class="mi">1</span><span class="nd">@content</span><span class="o">=</span><span class="n">value</span>
</pre>
         </div> 
        </div> 
        <p>by adding the HTML:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"file"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"file-1@content"</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"@link@files"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"file-1"</span><span class="o">&gt;</span>
</pre>
         </div> 
        </div> 
        <p class="last">The String content value is handled as described above for file uploads.</p> 
       </dd> 
      </dl> 
      <p>If both the “@note” and “@file” form variables are specified, the action:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="n">msg</span><span class="o">-</span><span class="mi">1</span><span class="nd">@link@files</span><span class="o">=</span><span class="n">file</span><span class="o">-</span><span class="mi">1</span>
</pre>
       </div> 
      </div> 
      <p>is also performed. This would be expressed in HTML with:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"msg-1@link@files"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"file-1"</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
      <p>We also check that FileClass items have a “content” property with actual content, otherwise we remove them from all_props before returning.</p> 
     </div> 
     <div class="section" id="default-templates"> 
      <h3><a class="toc-backref" href="#id72">Default templates</a></h3> 
      <p>The default templates are html4 compliant. If you wish to change them to be xhtml compliant, you’ll need to change the <code class="docutils literal notranslate"><span class="pre">html_version</span></code> configuration variable in <code class="docutils literal notranslate"><span class="pre">config.ini</span></code> to <code class="docutils literal notranslate"><span class="pre">'xhtml'</span></code> instead of <code class="docutils literal notranslate"><span class="pre">'html4'</span></code>.</p> 
      <p>Most customisation of the web view can be done by modifying the templates in the tracker <code class="docutils literal notranslate"><span class="pre">'html'</span></code> directory. There are several types of files in there. The <em>minimal</em> template includes:</p> 
      <dl class="docutils"> 
       <dt>
        <strong>page.html</strong>
       </dt> 
       <dd>
        This template usually defines the overall look of your tracker. When you view an issue, it appears inside this template. When you view an index, it also appears inside this template. This template defines a macro called “icing” which is used by almost all other templates as a coating for their content, using its “content” slot. It also defines the “head_title” and “body_title” slots to allow setting of the page title.
       </dd> 
       <dt>
        <strong>home.html</strong>
       </dt> 
       <dd>
        the default page displayed when no other page is indicated by the user
       </dd> 
       <dt>
        <strong>home.classlist.html</strong>
       </dt> 
       <dd>
        a special version of the default page that lists the classes in the tracker
       </dd> 
       <dt>
        <strong>classname.item.html</strong>
       </dt> 
       <dd>
        displays an item of the <em>classname</em> class
       </dd> 
       <dt>
        <strong>classname.index.html</strong>
       </dt> 
       <dd>
        displays a list of <em>classname</em> items
       </dd> 
       <dt>
        <strong>classname.search.html</strong>
       </dt> 
       <dd>
        displays a search page for <em>classname</em> items
       </dd> 
       <dt>
        <strong>_generic.index.html</strong>
       </dt> 
       <dd>
        used to display a list of items where there is no <code class="docutils literal notranslate"><span class="pre">*classname*.index</span></code> available
       </dd> 
       <dt>
        <strong>_generic.help.html</strong>
       </dt> 
       <dd>
        used to display a “class help” page where there is no <code class="docutils literal notranslate"><span class="pre">*classname*.help</span></code>
       </dd> 
       <dt>
        <strong>user.register.html</strong>
       </dt> 
       <dd>
        a special page just for the user class, that renders the registration page
       </dd> 
       <dt>
        <strong>style.css</strong>
       </dt> 
       <dd>
        a static file that is served up as-is
       </dd> 
      </dl> 
      <p>The <em>classic</em> template has a number of additional templates.</p> 
      <p>Remember that you can create any template extension you want to, so if you just want to play around with the templating for new issues, you can copy the current “issue.item” template to “issue.test”, and then access the test template using the “@template” URL argument:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span>http://your.tracker.example/tracker/issue?@template=test
</pre>
       </div> 
      </div> 
      <p>and it won’t affect your users using the “issue.item” template.</p> 
      <p>You can also put templates into a subdirectory of the template directory. So if you specify:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span>http://your.tracker.example/tracker/issue?@template=test/item
</pre>
       </div> 
      </div> 
      <p>you will use the template at: <code class="docutils literal notranslate"><span class="pre">test/issue.item.html</span></code>. If that template doesn’t exit it will try to use <code class="docutils literal notranslate"><span class="pre">test/_generic.item.html</span></code>. If that template doesn’t exist it will return an error.</p> 
     </div> 
     <div class="section" id="implementing-modal-editing-using-template"> 
      <h3><a class="toc-backref" href="#id73">Implementing Modal Editing Using @template</a></h3> 
      <p>Many item templates allow you to edit the item. They contain code that renders edit boxes if the user has edit permissions. Otherwise the template will just display the item information.</p> 
      <p>In some cases you want to do a modal edit. The user has to take some action (click a button or follow a link) to shift from display mode to edit mode. When the changes are submitted, ending the edit mode, the user is returned to display mode.</p> 
      <p>Modal workflows usually slow things down and are not implemented by default templates. However for some workflows a modal edit is useful. For example a batch edit mode that allows the user to edit a number of issues all from one form could be implemented as a modal workflow of:</p> 
      <ul class="simple"> 
       <li>search for issues to modify</li> 
       <li>switch to edit mode and change values</li> 
       <li>exit back to the results of the search</li> 
      </ul> 
      <p>To implement the modal edit, assume you have an issue.edit.html template that implements an edit form. On the display page (a version of issue.item.html modified to only display information) add a link that calls the display url, but adds <code class="docutils literal notranslate"><span class="pre">@template=edit</span></code> to the link.</p> 
      <p>This will now display the edit page. On the edit page you want to add a hidden text field to your form named <code class="docutils literal notranslate"><span class="pre">@template</span></code> with the value: <code class="docutils literal notranslate"><span class="pre">item|edit</span></code>. When the form is submitted it is validated. If the form is correct the user will see the item rendered using the item template. If there is an error (validation failed) the item will be rendered using the edit template. The edit template that is rendered will display all the changes that the user made to the form before it was submitted. The user can correct the error and resubmit the changes until the form validates.</p> 
      <p>If the form failed to validate but the <code class="docutils literal notranslate"><span class="pre">@template</span></code> field had the value <code class="docutils literal notranslate"><span class="pre">item</span></code> the user would still see the error, but all of the data the user entered would be discarded. The user would have to redo all the edits again.</p> 
     </div> 
     <div class="section" id="how-the-templates-work"> 
      <h3><a class="toc-backref" href="#id74">How the templates work</a></h3> 
      <div class="section" id="templating-engines"> 
       <h4><a class="toc-backref" href="#id75">Templating engines</a></h4> 
       <p>Since version 1.4.20 Roundup supports two templating engines: the original <a class="reference external" href="https://pagetemplates.readthedocs.io/en/latest/history/TALSpecification14.html">Template Attribute Language</a> (TAL) engine from Zope and the standalone Chameleon templating engine. Chameleon is intended as a replacement for the original TAL engine, and supports the same syntax, but they are not 100% compatible. The major (and most likely the only) incompatibility is the default expression type being <code class="docutils literal notranslate"><span class="pre">python:</span></code> instead of <code class="docutils literal notranslate"><span class="pre">path:</span></code>. See also “Incompatibilities and differences” section of <a class="reference external" href="https://chameleon.readthedocs.io/en/latest/reference.html?highlight=differences#incompatibilities-and-differences">Chameleon documentation</a>.</p> 
       <p><strong>NOTE1</strong>: For historical reasons, examples given below assumes path expression as default expression type. With Chameleon you have to manually resolve the path expressions. A Chameleon-based, z3c.pt, that is fully compatible with the old TAL implementation, is planned to be included in a future release.</p> 
       <p><strong>NOTE2</strong>: As of 1.4.20 Chameleon support is highly experimental and <strong>not</strong> recommended for production use.</p> 
      </div> 
      <div class="section" id="basic-templating-actions"> 
       <h4><a class="toc-backref" href="#id76">Basic Templating Actions</a></h4> 
       <p>Roundup’s templates consist of special attributes on the HTML tags. These attributes form the <strong>Template Attribute Language</strong>, or TAL. The basic TAL commands are:</p> 
       <dl class="docutils"> 
        <dt>
         <strong>tal:define=”variable expression; variable expression; …”</strong>
        </dt> 
        <dd>
         <p class="first">Define a new variable that is local to this tag and its contents. For example:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">html</span> <span class="n">tal</span><span class="p">:</span><span class="n">define</span><span class="o">=</span><span class="s2">"title request/description"</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;&lt;</span><span class="n">title</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"title"</span><span class="o">&gt;&lt;/</span><span class="n">title</span><span class="o">&gt;&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> 
         <p class="last">In this example, the variable “title” is defined as the result of the expression “request/description”. The “tal:content” command inside the &lt;html&gt; tag may then use the “title” variable.</p> 
        </dd> 
        <dt>
         <strong>tal:condition=”expression”</strong>
        </dt> 
        <dd>
         <p class="first">Only keep this tag and its contents if the expression is true. For example:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">p</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"python:request.user.hasPermission('View', 'issue')"</span><span class="o">&gt;</span>
 <span class="n">Display</span> <span class="n">some</span> <span class="n">issue</span> <span class="n">information</span><span class="o">.</span>
<span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> 
         <p class="last">In the example, the &lt;p&gt; tag and its contents are only displayed if the user has the “View” permission for issues. We consider the number zero, a blank string, an empty list, and the built-in variable nothing to be false values. Nearly every other value is true, including non-zero numbers, and strings with anything in them (even spaces!).</p> 
        </dd> 
        <dt>
         <strong>tal:repeat=”variable expression”</strong>
        </dt> 
        <dd>
         <p class="first">Repeat this tag and its contents for each element of the sequence that the expression returns, defining a new local variable and a special “repeat” variable for each element. For example:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">tr</span> <span class="n">tal</span><span class="p">:</span><span class="n">repeat</span><span class="o">=</span><span class="s2">"u user/list"</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"u/id"</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"u/username"</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"u/realname"</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> 
         <p class="last">The example would iterate over the sequence of users returned by “user/list” and define the local variable “u” for each entry. Using the repeat command creates a new variable called “repeat” which you may access to gather information about the iteration. See the section below on <a class="reference internal" href="#the-repeat-variable">the repeat variable</a>.</p> 
        </dd> 
        <dt>
         <strong>tal:replace=”expression”</strong>
        </dt> 
        <dd>
         <p class="first">Replace this tag with the result of the expression. For example:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">span</span> <span class="n">tal</span><span class="p">:</span><span class="n">replace</span><span class="o">=</span><span class="s2">"request/user/realname"</span> <span class="o">/&gt;</span>
</pre>
          </div> 
         </div> 
         <p class="last">The example would replace the &lt;span&gt; tag and its contents with the user’s realname. If the user’s realname was “Bruce”, then the resultant output would be “Bruce”.</p> 
        </dd> 
        <dt>
         <strong>tal:content=”expression”</strong>
        </dt> 
        <dd>
         <p class="first">Replace the contents of this tag with the result of the expression. For example:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">span</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"request/user/realname"</span><span class="o">&gt;</span><span class="n">user</span><span class="s1">'s name appears here</span>
<span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> 
         <p class="last">The example would replace the contents of the &lt;span&gt; tag with the user’s realname. If the user’s realname was “Bruce” then the resultant output would be “&lt;span&gt;Bruce&lt;/span&gt;”.</p> 
        </dd> 
        <dt>
         <strong>tal:attributes=”attribute expression; attribute expression; …”</strong>
        </dt> 
        <dd>
         <p class="first">Set attributes on this tag to the results of expressions. For example:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">a</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"href string:user${request/user/id}"</span><span class="o">&gt;</span><span class="n">My</span> <span class="n">Details</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> 
         <p class="last">In the example, the “href” attribute of the &lt;a&gt; tag is set to the value of the “string:user${request/user/id}” expression, which will be something like “user123”.</p> 
        </dd> 
        <dt>
         <strong>tal:omit-tag=”expression”</strong>
        </dt> 
        <dd>
         <p class="first">Remove this tag (but not its contents) if the expression is true. For example:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span>&lt;span tal:omit-tag="python:1"&gt;Hello, world!&lt;/span&gt;
</pre>
          </div> 
         </div> 
         <p>would result in output of:</p> 
         <div class="last highlight-default notranslate">
          <div class="highlight">
           <pre><span></span>Hello, world!
</pre>
          </div> 
         </div> 
        </dd> 
       </dl> 
       <p>Note that the commands on a given tag are evaulated in the order above, so <em>define</em> comes before <em>condition</em>, and so on.</p> 
       <p>Additionally, you may include tags such as &lt;tal:block&gt;, which are removed from output. Its content is kept, but the tag itself is not (so don’t go using any “tal:attributes” commands on it). This is useful for making arbitrary blocks of HTML conditional or repeatable (very handy for repeating multiple table rows, which would otherwise require an illegal tag placement to effect the repeat).</p> 
      </div> 
      <div class="section" id="templating-expressions"> 
       <h4><a class="toc-backref" href="#id77">Templating Expressions</a></h4> 
       <p>Templating Expressions are covered by <a class="reference external" href="https://pagetemplates.readthedocs.io/en/latest/history/TALESSpecification13.html">Template Attribute Language Expression Syntax</a>, or TALES. The expressions you may use in the attribute values may be one of the following forms:</p> 
       <dl class="docutils"> 
        <dt>
         <strong>Path Expressions</strong> - eg. <code class="docutils literal notranslate"><span class="pre">item/status/checklist</span></code>
        </dt> 
        <dd>
         <p class="first">These are object attribute / item accesses. Roughly speaking, the path <code class="docutils literal notranslate"><span class="pre">item/status/checklist</span></code> is broken into parts <code class="docutils literal notranslate"><span class="pre">item</span></code>, <code class="docutils literal notranslate"><span class="pre">status</span></code> and <code class="docutils literal notranslate"><span class="pre">checklist</span></code>. The <code class="docutils literal notranslate"><span class="pre">item</span></code> part is the root of the expression. We then look for a <code class="docutils literal notranslate"><span class="pre">status</span></code> attribute on <code class="docutils literal notranslate"><span class="pre">item</span></code>, or failing that, a <code class="docutils literal notranslate"><span class="pre">status</span></code> item (as in <code class="docutils literal notranslate"><span class="pre">item['status']</span></code>). If that fails, the path expression fails. When we get to the end, the object we’re left with is evaluated to get a string - if it is a method, it is called; if it is an object, it is stringified. Path expressions may have an optional <code class="docutils literal notranslate"><span class="pre">path:</span></code> prefix, but they are the default expression type, so it’s not necessary.</p> 
         <p>If an expression evaluates to <code class="docutils literal notranslate"><span class="pre">default</span></code>, then the expression is “cancelled” - whatever HTML already exists in the template will remain (tag content in the case of <code class="docutils literal notranslate"><span class="pre">tal:content</span></code>, attributes in the case of <code class="docutils literal notranslate"><span class="pre">tal:attributes</span></code>).</p> 
         <p>If an expression evaluates to <code class="docutils literal notranslate"><span class="pre">nothing</span></code> then the target of the expression is removed (tag content in the case of <code class="docutils literal notranslate"><span class="pre">tal:content</span></code>, attributes in the case of <code class="docutils literal notranslate"><span class="pre">tal:attributes</span></code> and the tag itself in the case of <code class="docutils literal notranslate"><span class="pre">tal:replace</span></code>).</p> 
         <p>If an element in the path may not exist, then you can use the <code class="docutils literal notranslate"><span class="pre">|</span></code> operator in the expression to provide an alternative. So, the expression <code class="docutils literal notranslate"><span class="pre">request/form/foo/value</span> <span class="pre">|</span> <span class="pre">default</span></code> would simply leave the current HTML in place if the “foo” form variable doesn’t exist.</p> 
         <p class="last">You may use the python function <code class="docutils literal notranslate"><span class="pre">path</span></code>, as in <code class="docutils literal notranslate"><span class="pre">path("item/status")</span></code>, to embed path expressions in Python expressions.</p> 
        </dd> 
        <dt>
         <strong>String Expressions</strong> - eg. <code class="docutils literal notranslate"><span class="pre">string:hello</span> <span class="pre">${user/name}</span></code>
        </dt> 
        <dd>
         These expressions are simple string interpolations - though they can be just plain strings with no interpolation if you want. The expression in the <code class="docutils literal notranslate"><span class="pre">${</span> <span class="pre">...</span> <span class="pre">}</span></code> is just a path expression as above.
        </dd> 
        <dt>
         <strong>Python Expressions</strong> - eg. <code class="docutils literal notranslate"><span class="pre">python:</span> <span class="pre">1+1</span></code>
        </dt> 
        <dd>
         These expressions give the full power of Python. All the “root level” variables are available, so <code class="docutils literal notranslate"><span class="pre">python:item.status.checklist()</span></code> would be equivalent to <code class="docutils literal notranslate"><span class="pre">item/status/checklist</span></code>, assuming that <code class="docutils literal notranslate"><span class="pre">checklist</span></code> is a method.
        </dd> 
       </dl> 
       <p>Modifiers:</p> 
       <dl class="docutils"> 
        <dt>
         <strong>structure</strong> - eg. <code class="docutils literal notranslate"><span class="pre">structure</span> <span class="pre">python:msg.content.plain(hyperlink=1)</span></code>
        </dt> 
        <dd>
         The result of expressions are normally <em>escaped</em> to be safe for HTML display (all “&lt;”, “&gt;” and “&amp;” are turned into special entities). The <code class="docutils literal notranslate"><span class="pre">structure</span></code> expression modifier turns off this escaping - the result of the expression is now assumed to be HTML, which is passed to the web browser for rendering.
        </dd> 
        <dt>
         <strong>not:</strong> - eg. <code class="docutils literal notranslate"><span class="pre">not:python:1=1</span></code>
        </dt> 
        <dd>
         This simply inverts the logical true/false value of another expression.
        </dd> 
       </dl> 
      </div> 
      <div class="section" id="template-macros"> 
       <h4><a class="toc-backref" href="#id78">Template Macros</a></h4> 
       <p>Macros are used in Roundup to save us from repeating the same common page stuctures over and over. The most common (and probably only) macro you’ll use is the “icing” macro defined in the “page” template.</p> 
       <p>Macros are generated and used inside your templates using special attributes similar to the <a class="reference internal" href="#basic-templating-actions">basic templating actions</a>. In this case, though, the attributes belong to the <a class="reference external" href="https://pagetemplates.readthedocs.io/en/latest/history/TALESSpecification13.html">Macro Expansion Template Attribute Language</a>, or METAL. The macro commands are:</p> 
       <dl class="docutils"> 
        <dt>
         <strong>metal:define-macro=”macro name”</strong>
        </dt> 
        <dd>
         <p class="first">Define that the tag and its contents are now a macro that may be inserted into other templates using the <em>use-macro</em> command. For example:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">html</span> <span class="n">metal</span><span class="p">:</span><span class="n">define</span><span class="o">-</span><span class="n">macro</span><span class="o">=</span><span class="s2">"page"</span><span class="o">&gt;</span>
 <span class="o">...</span>
<span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> 
         <p class="last">defines a macro called “page” using the <code class="docutils literal notranslate"><span class="pre">&lt;html&gt;</span></code> tag and its contents. Once defined, macros are stored on the template they’re defined on in the <code class="docutils literal notranslate"><span class="pre">macros</span></code> attribute. You can access them later on through the <code class="docutils literal notranslate"><span class="pre">templates</span></code> variable, eg. the most common <code class="docutils literal notranslate"><span class="pre">templates/page/macros/icing</span></code> to access the “page” macro of the “page” template.</p> 
        </dd> 
        <dt>
         <strong>metal:use-macro=”path expression”</strong>
        </dt> 
        <dd>
         <p class="first">Use a macro, which is identified by the path expression (see above). This will replace the current tag with the identified macro contents. For example:</p> 
         <div class="last highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span> <span class="n">metal</span><span class="p">:</span><span class="n">use</span><span class="o">-</span><span class="n">macro</span><span class="o">=</span><span class="s2">"templates/page/macros/icing"</span><span class="o">&gt;</span>
 <span class="o">...</span>
<span class="o">&lt;/</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span><span class="o">&gt;</span>

<span class="n">will</span> <span class="n">replace</span> <span class="n">the</span> <span class="n">tag</span> <span class="ow">and</span> <span class="n">its</span> <span class="n">contents</span> <span class="k">with</span> <span class="n">the</span> <span class="s2">"page"</span> <span class="n">macro</span> <span class="n">of</span> <span class="n">the</span>
<span class="s2">"page"</span> <span class="n">template</span><span class="o">.</span>
</pre>
          </div> 
         </div> 
        </dd> 
        <dt>
         <strong>metal:define-slot=”slot name”</strong> and <strong>metal:fill-slot=”slot name”</strong>
        </dt> 
        <dd>
         <p class="first">To define <em>dynamic</em> parts of the macro, you define “slots” which may be filled when the macro is used with a <em>use-macro</em> command. For example, the <code class="docutils literal notranslate"><span class="pre">templates/page/macros/icing</span></code> macro defines a slot like so:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">title</span> <span class="n">metal</span><span class="p">:</span><span class="n">define</span><span class="o">-</span><span class="n">slot</span><span class="o">=</span><span class="s2">"head_title"</span><span class="o">&gt;</span><span class="n">title</span> <span class="n">goes</span> <span class="n">here</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> 
         <p>In your <em>use-macro</em> command, you may now use a <em>fill-slot</em> command like this:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">title</span> <span class="n">metal</span><span class="p">:</span><span class="n">fill</span><span class="o">-</span><span class="n">slot</span><span class="o">=</span><span class="s2">"head_title"</span><span class="o">&gt;</span><span class="n">My</span> <span class="n">Title</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> 
         <p class="last">where the tag that fills the slot completely replaces the one defined as the slot in the macro.</p> 
        </dd> 
       </dl> 
       <p>Note that you may not mix <a class="reference external" href="https://pagetemplates.readthedocs.io/en/latest/history/TALESSpecification13.html">METAL</a> and <a class="reference external" href="https://pagetemplates.readthedocs.io/en/latest/history/TALSpecification14.html">TAL</a> commands on the same tag, but TAL commands may be used freely inside METAL-using tags (so your <em>fill-slots</em> tags may have all manner of TAL inside them).</p> 
      </div> 
     </div> 
     <div class="section" id="information-available-to-templates"> 
      <h3><a class="toc-backref" href="#id79">Information available to templates</a></h3> 
      <p>This is implemented by <code class="docutils literal notranslate"><span class="pre">roundup.cgi.templating.RoundupPageTemplate</span></code></p> 
      <p>The following variables are available to templates.</p> 
      <dl class="docutils"> 
       <dt>
        <strong>context</strong>
       </dt> 
       <dd>
        The current context. This is either None, a <a class="reference internal" href="#hyperdb-class-wrapper">hyperdb class wrapper</a> or a <a class="reference internal" href="#hyperdb-item-wrapper">hyperdb item wrapper</a>
       </dd> 
       <dt>
        <strong>request</strong>
       </dt> 
       <dd>
        <dl class="first last docutils"> 
         <dt>
          Includes information about the current request, including:
         </dt> 
         <dd>
          <ul class="first last simple"> 
           <li>the current index information (<code class="docutils literal notranslate"><span class="pre">filterspec</span></code>, <code class="docutils literal notranslate"><span class="pre">filter</span></code> args, <code class="docutils literal notranslate"><span class="pre">properties</span></code>, etc) parsed out of the form.</li> 
           <li>methods for easy filterspec link generation</li> 
           <li>“form” The current CGI form information as a mapping of form argument name to value (specifically a cgi.FieldStorage)</li> 
           <li>“env” the CGI environment variables</li> 
           <li>“base” the base URL for this instance</li> 
           <li>“user” a HTMLItem instance for the current user</li> 
           <li>“language” as determined by the browser or config</li> 
           <li>“classname” the current classname (possibly None)</li> 
           <li>“template” the current template (suffix, also possibly None)</li> 
          </ul> 
         </dd> 
        </dl> 
       </dd> 
       <dt>
        <strong>config</strong>
       </dt> 
       <dd>
        This variable holds all the values defined in the tracker config.ini file (eg. TRACKER_NAME, etc.)
       </dd> 
       <dt>
        <strong>db</strong>
       </dt> 
       <dd>
        The current database, used to access arbitrary database items.
       </dd> 
       <dt>
        <strong>templates</strong>
       </dt> 
       <dd>
        Access to all the tracker templates by name. Used mainly in <em>use-macro</em> commands.
       </dd> 
       <dt>
        <strong>utils</strong>
       </dt> 
       <dd>
        This variable makes available some utility functions like batching.
       </dd> 
       <dt>
        <strong>nothing</strong>
       </dt> 
       <dd>
        <p class="first">This is a special variable - if an expression evaluates to this, then the tag (in the case of a <code class="docutils literal notranslate"><span class="pre">tal:replace</span></code>), its contents (in the case of <code class="docutils literal notranslate"><span class="pre">tal:content</span></code>) or some attributes (in the case of <code class="docutils literal notranslate"><span class="pre">tal:attributes</span></code>) will not appear in the the output. So, for example:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span>&lt;span tal:attributes="class nothing"&gt;Hello, World!&lt;/span&gt;
</pre>
         </div> 
        </div> 
        <p>would result in:</p> 
        <div class="last highlight-default notranslate">
         <div class="highlight">
          <pre><span></span>&lt;span&gt;Hello, World!&lt;/span&gt;
</pre>
         </div> 
        </div> 
       </dd> 
       <dt>
        <strong>default</strong>
       </dt> 
       <dd>
        <p class="first">Also a special variable - if an expression evaluates to this, then the existing HTML in the template will not be replaced or removed, it will remain. So:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span>&lt;span tal:replace="default"&gt;Hello, World!&lt;/span&gt;
</pre>
         </div> 
        </div> 
        <p>would result in:</p> 
        <div class="last highlight-default notranslate">
         <div class="highlight">
          <pre><span></span>&lt;span&gt;Hello, World!&lt;/span&gt;
</pre>
         </div> 
        </div> 
       </dd> 
       <dt>
        <strong>true</strong>, <strong>false</strong>
       </dt> 
       <dd>
        Boolean constants that may be used in <a class="reference internal" href="#templating-expressions">templating expressions</a> instead of <code class="docutils literal notranslate"><span class="pre">python:1</span></code> and <code class="docutils literal notranslate"><span class="pre">python:0</span></code>.
       </dd> 
       <dt>
        <strong>i18n</strong>
       </dt> 
       <dd>
        <p class="first">Internationalization service, providing two string translation methods:</p> 
        <dl class="last docutils"> 
         <dt>
          <strong>gettext</strong> (<em>message</em>)
         </dt> 
         <dd>
          Return the localized translation of message
         </dd> 
         <dt>
          <strong>ngettext</strong> (<em>singular</em>, <em>plural</em>, <em>number</em>)
         </dt> 
         <dd>
          Like <code class="docutils literal notranslate"><span class="pre">gettext()</span></code>, but consider plural forms. If a translation is found, apply the plural formula to <em>number</em>, and return the resulting message (some languages have more than two plural forms). If no translation is found, return singular if <em>number</em> is 1; return plural otherwise.
         </dd> 
        </dl> 
       </dd> 
      </dl> 
      <div class="section" id="the-context-variable"> 
       <h4><a class="toc-backref" href="#id80">The context variable</a></h4> 
       <p>The <em>context</em> variable is one of three things based on the current context (see <a class="reference internal" href="#determining-web-context">determining web context</a> for how we figure this out):</p> 
       <ol class="arabic simple"> 
        <li>if we’re looking at a “home” page, then it’s None</li> 
        <li>if we’re looking at a specific hyperdb class, it’s a <a class="reference internal" href="#hyperdb-class-wrapper">hyperdb class wrapper</a>.</li> 
        <li>if we’re looking at a specific hyperdb item, it’s a <a class="reference internal" href="#hyperdb-item-wrapper">hyperdb item wrapper</a>.</li> 
       </ol> 
       <p>If the context is not None, we can access the properties of the class or item. The only real difference between cases 2 and 3 above are:</p> 
       <ol class="arabic simple"> 
        <li>the properties may have a real value behind them, and this will appear if the property is displayed through <code class="docutils literal notranslate"><span class="pre">context/property</span></code> or <code class="docutils literal notranslate"><span class="pre">context/property/field</span></code>.</li> 
        <li>the context’s “id” property will be a false value in the second case, but a real, or true value in the third. Thus we can determine whether we’re looking at a real item from the hyperdb by testing “context/id”.</li> 
       </ol> 
       <div class="section" id="hyperdb-class-wrapper"> 
        <h5><a class="toc-backref" href="#id81">Hyperdb class wrapper</a></h5> 
        <p>This is implemented by the <code class="docutils literal notranslate"><span class="pre">roundup.cgi.templating.HTMLClass</span></code> class.</p> 
        <p>This wrapper object provides access to a hyperdb class. It is used primarily in both index view and new item views, but it’s also usable anywhere else that you wish to access information about a class, or the items of a class, when you don’t have a specific item of that class in mind.</p> 
        <p>We allow access to properties. There will be no “id” property. The value accessed through the property will be the current value of the same name from the CGI form.</p> 
        <p>There are several methods available on these wrapper objects:</p> 
        <table border="1" class="docutils"> 
         <colgroup> 
          <col width="15%"> 
          <col width="85%"> 
         </colgroup> 
         <thead valign="bottom"> 
          <tr class="row-odd">
           <th class="head">Method</th> 
           <th class="head">Description</th> 
          </tr> 
         </thead> 
         <tbody valign="top"> 
          <tr class="row-even">
           <td>properties</td> 
           <td>return a <a class="reference internal" href="#hyperdb-property-wrapper">hyperdb property wrapper</a> for all of this class’s properties that are searchable by the user. You can use the argument cansearch=False to get all properties.</td> 
          </tr> 
          <tr class="row-odd">
           <td>list</td> 
           <td>lists all of the active (not retired) items in the class.</td> 
          </tr> 
          <tr class="row-even">
           <td>csv</td> 
           <td>return the items of this class as a chunk of CSV text.</td> 
          </tr> 
          <tr class="row-odd">
           <td>propnames</td> 
           <td>lists the names of the properties of this class.</td> 
          </tr> 
          <tr class="row-even">
           <td>filter</td> 
           <td><p class="first">lists of items from this class, filtered and sorted. Two options are available for sorting:</p> 
            <ol class="arabic"> 
             <li><p class="first">by the current <em>request</em> filterspec/filter/sort/group args</p> </li> 
             <li><p class="first">by the “filterspec”, “sort” and “group” keyword args. “filterspec” is <code class="docutils literal notranslate"><span class="pre">{propname:</span> <span class="pre">value(s)}</span></code>. “sort” and “group” are an optionally empty list <code class="docutils literal notranslate"><span class="pre">[(dir,</span> <span class="pre">prop)]</span></code> where dir is ‘+’, ‘-‘ or None and prop is a prop name or None.</p> <p>The propname in filterspec and prop in a sort/group spec may be transitive, i.e., it may contain properties of the form link.link.link.name.</p> </li> 
            </ol> <p>eg. All issues with a priority of “1” with messages added in the last week, sorted by activity date: <code class="docutils literal notranslate"><span class="pre">issue.filter(filterspec={"priority":</span> <span class="pre">"1",</span> <span class="pre">'messages.creation'</span> <span class="pre">:</span> <span class="pre">'.-1w;'},</span> <span class="pre">sort=[('activity',</span> <span class="pre">'+')])</span></code></p> <p>Note that when searching for Link and Multilink values, the special value ‘-1’ searches for empty Link or Multilink values. For both, Links and Multilinks, multiple values given in a filter call are combined with ‘OR’ by default. For Multilinks a postfix expression syntax using negative ID numbers (as strings) as operators is supported. Each non-negative number (or ‘-1’) is pushed on an operand stack. A negative number pops the required number of arguments from the stack, applies the operator, and pushes the result. The following operators are supported:</p> 
            <ul class="simple"> 
             <li>‘-2’ stands for ‘NOT’ and takes one argument</li> 
             <li>‘-3’ stands for ‘AND’ and takes two arguments</li> 
             <li>‘-4’ stands for ‘OR’ and takes two arguments</li> 
            </ul> <p>Note that this special handling of ID arguments is applied only when a negative number smaller than -1 is encountered as an ID in the filter call. Otherwise the implicit OR default applies. Examples of using Multilink expressions would be</p> 
            <ul class="last simple"> 
             <li>‘1’, ‘2’, ‘-4’, ‘3’, ‘4’, ‘-4’, ‘-3’ would search for IDs (1 or 2) and (3 or 4)</li> 
             <li>‘-1’ ‘-2’ would search for all non-empty Multilinks</li> 
            </ul> </td> 
          </tr> 
          <tr class="row-odd">
           <td>filter_sql</td> 
           <td><p class="first"><strong>Only in SQL backends</strong></p> <p>Lists the items that match the SQL provided. The SQL is a complete “select” statement.</p> <p>The SQL select must include the item id as the first column.</p> <p class="last">This function <strong>does not</strong> filter out retired items, add on a where clause “__retired__ &lt;&gt; 1” if you don’t want retired nodes.</p> </td> 
          </tr> 
          <tr class="row-even">
           <td>classhelp</td> 
           <td><p class="first">display a link to a javascript popup containing this class’ “help” template.</p> <p>This generates a link to a popup window which displays the properties indicated by “properties” of the class named by “classname”. The “properties” should be a comma-separated list (eg. ‘id,name,description’). Properties defaults to all the properties of a class (excluding id, creator, created and activity).</p> <p>You may optionally override the “label” displayed, the “width”, the “height”, the number of items per page (“pagesize”) and the field on which the list is sorted (“sort”).</p> <p>With the “filter” arg it is possible to specify a filter for which items are supposed to be displayed. It has to be of the format “&lt;field&gt;=&lt;values&gt;;&lt;field&gt;=&lt;values&gt;;…”.</p> <p>The popup window will be resizable and scrollable.</p> <p>If the “property” arg is given, it’s passed through to the javascript help_window function. This allows updating of a property in the calling HTML page.</p> <p class="last">If the “form” arg is given, it’s passed through to the javascript help_window function - it’s the name of the form the “property” belongs to.</p> </td> 
          </tr> 
          <tr class="row-odd">
           <td>submit</td> 
           <td>generate a submit button (and action and @csrf hidden elements)</td> 
          </tr> 
          <tr class="row-even">
           <td>renderWith</td> 
           <td>render this class with the given template.</td> 
          </tr> 
          <tr class="row-odd">
           <td>history</td> 
           <td>returns ‘New node - no history’ :)</td> 
          </tr> 
          <tr class="row-even">
           <td>is_edit_ok</td> 
           <td>is the user allowed to Edit the current class?</td> 
          </tr> 
          <tr class="row-odd">
           <td>is_view_ok</td> 
           <td>is the user allowed to View the current class?</td> 
          </tr> 
         </tbody> 
        </table> 
        <p>Note that if you have a property of the same name as one of the above methods, you’ll need to access it using a python “item access” expression. For example:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="n">python</span><span class="p">:</span><span class="n">context</span><span class="p">[</span><span class="s1">'list'</span><span class="p">]</span>
</pre>
         </div> 
        </div> 
        <p>will access the “list” property, rather than the list method.</p> 
       </div> 
       <div class="section" id="hyperdb-item-wrapper"> 
        <h5><a class="toc-backref" href="#id82">Hyperdb item wrapper</a></h5> 
        <p>This is implemented by the <code class="docutils literal notranslate"><span class="pre">roundup.cgi.templating.HTMLItem</span></code> class.</p> 
        <p>This wrapper object provides access to a hyperdb item.</p> 
        <p>We allow access to properties. There will be no “id” property. The value accessed through the property will be the current value of the same name from the CGI form.</p> 
        <p>There are several methods available on these wrapper objects:</p> 
        <table border="1" class="docutils"> 
         <colgroup> 
          <col width="19%"> 
          <col width="81%"> 
         </colgroup> 
         <thead valign="bottom"> 
          <tr class="row-odd">
           <th class="head">Method</th> 
           <th class="head">Description</th> 
          </tr> 
         </thead> 
         <tbody valign="top"> 
          <tr class="row-even">
           <td>submit</td> 
           <td>generate a submit button (and action and @csrf hidden elements)</td> 
          </tr> 
          <tr class="row-odd">
           <td>journal</td> 
           <td>return the journal of the current item (<strong>not implemented</strong>)</td> 
          </tr> 
          <tr class="row-even">
           <td>history</td> 
           <td>render the journal of the current item as HTML. By default properties marked as “quiet” (see <a class="reference external" href="design.html">design documentation</a>) are not shown unless the function is called with the showall=True parameter. Properties that are not Viewable to the user are not shown.</td> 
          </tr> 
          <tr class="row-odd">
           <td>renderQueryForm</td> 
           <td>specific to the “query” class - render the search form for the query</td> 
          </tr> 
          <tr class="row-even">
           <td>hasPermission</td> 
           <td><p class="first">specific to the “user” class - determine whether the user has a Permission. The signature is:</p> 
            <div class="highlight-default notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">hasPermission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="p">[</span><span class="n">classname</span><span class="o">=</span><span class="p">],</span>
    <span class="p">[</span><span class="nb">property</span><span class="o">=</span><span class="p">],</span> <span class="p">[</span><span class="n">itemid</span><span class="o">=</span><span class="p">])</span>
</pre>
             </div> 
            </div> <p class="last">where the classname defaults to the current context.</p> </td> 
          </tr> 
          <tr class="row-odd">
           <td>hasRole</td> 
           <td><p class="first">specific to the “user” class - determine whether the user has a Role. The signature is:</p> 
            <div class="last highlight-default notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">hasRole</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rolename</span><span class="p">)</span>
</pre>
             </div> 
            </div> </td> 
          </tr> 
          <tr class="row-even">
           <td>is_edit_ok</td> 
           <td>is the user allowed to Edit the current item?</td> 
          </tr> 
          <tr class="row-odd">
           <td>is_view_ok</td> 
           <td>is the user allowed to View the current item?</td> 
          </tr> 
          <tr class="row-even">
           <td>is_retired</td> 
           <td>is the item retired?</td> 
          </tr> 
          <tr class="row-odd">
           <td>download_url</td> 
           <td>generate a url-quoted link for download of FileClass item contents (ie. file&lt;id&gt;/&lt;name&gt;)</td> 
          </tr> 
          <tr class="row-even">
           <td>copy_url</td> 
           <td>generate a url-quoted link for creating a copy of this item. By default, the copy will acquire all properties of the current item except for <code class="docutils literal notranslate"><span class="pre">messages</span></code> and <code class="docutils literal notranslate"><span class="pre">files</span></code>. This can be overridden by passing <code class="docutils literal notranslate"><span class="pre">exclude</span></code> argument which contains a list (or any iterable) of property names that shall not be copied. Database-driven properties like <code class="docutils literal notranslate"><span class="pre">id</span></code> or <code class="docutils literal notranslate"><span class="pre">activity</span></code> cannot be copied.</td> 
          </tr> 
         </tbody> 
        </table> 
        <p>Note that if you have a property of the same name as one of the above methods, you’ll need to access it using a python “item access” expression. For example:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="n">python</span><span class="p">:</span><span class="n">context</span><span class="p">[</span><span class="s1">'journal'</span><span class="p">]</span>
</pre>
         </div> 
        </div> 
        <p>will access the “journal” property, rather than the journal method.</p> 
       </div> 
       <div class="section" id="hyperdb-property-wrapper"> 
        <h5><a class="toc-backref" href="#id83">Hyperdb property wrapper</a></h5> 
        <p>This is implemented by subclasses of the <code class="docutils literal notranslate"><span class="pre">roundup.cgi.templating.HTMLProperty</span></code> class (<code class="docutils literal notranslate"><span class="pre">HTMLStringProperty</span></code>, <code class="docutils literal notranslate"><span class="pre">HTMLNumberProperty</span></code>, and so on).</p> 
        <p>This wrapper object provides access to a single property of a class. Its value may be either:</p> 
        <ol class="arabic simple"> 
         <li>if accessed through a <a class="reference internal" href="#hyperdb-item-wrapper">hyperdb item wrapper</a>, then it’s a value from the hyperdb</li> 
         <li>if access through a <a class="reference internal" href="#hyperdb-class-wrapper">hyperdb class wrapper</a>, then it’s a value from the CGI form</li> 
        </ol> 
        <p>The property wrapper has some useful attributes:</p> 
        <table border="1" class="docutils"> 
         <colgroup> 
          <col width="21%"> 
          <col width="79%"> 
         </colgroup> 
         <thead valign="bottom"> 
          <tr class="row-odd">
           <th class="head">Attribute</th> 
           <th class="head">Description</th> 
          </tr> 
         </thead> 
         <tbody valign="top"> 
          <tr class="row-even">
           <td>_name</td> 
           <td>the name of the property</td> 
          </tr> 
          <tr class="row-odd">
           <td>_value</td> 
           <td>the value of the property if any - this is the actual value retrieved from the hyperdb for this property</td> 
          </tr> 
         </tbody> 
        </table> 
        <p>There are several methods available on these wrapper objects:</p> 
        <table border="1" class="docutils"> 
         <colgroup> 
          <col width="15%"> 
          <col width="85%"> 
         </colgroup> 
         <thead valign="bottom"> 
          <tr class="row-odd">
           <th class="head">Method</th> 
           <th class="head">Description</th> 
          </tr> 
         </thead> 
         <tbody valign="top"> 
          <tr class="row-even">
           <td>plain</td> 
           <td><p class="first">render a “plain” representation of the property. This method may take two arguments:</p> 
            <dl class="last docutils"> 
             <dt>
              escape
             </dt> 
             <dd>
              <p class="first">If true, escape the text so it is HTML safe (default: no). The reason this defaults to off is that text is usually escaped at a later stage by the TAL commands, unless the “structure” option is used in the template. The following <code class="docutils literal notranslate"><span class="pre">tal:content</span></code> expressions are all equivalent:</p> 
              <div class="highlight-default notranslate">
               <div class="highlight">
                <pre><span></span><span class="s2">"structure python:msg.content.plain(escape=1)"</span>
<span class="s2">"python:msg.content.plain()"</span>
<span class="s2">"msg/content/plain"</span>
<span class="s2">"msg/content"</span>
</pre>
               </div> 
              </div> 
              <p class="last">Usually you’ll only want to use the escape option in a complex expression.</p> 
             </dd> 
             <dt>
              hyperlink
             </dt> 
             <dd>
              <p class="first">If true, turn URLs, email addresses and hyperdb item designators in the text into hyperlinks (default: no). Note that you’ll need to use the “structure” TAL option if you want to use this <code class="docutils literal notranslate"><span class="pre">tal:content</span></code> expression:</p> 
              <div class="highlight-default notranslate">
               <div class="highlight">
                <pre><span></span><span class="s2">"structure python:msg.content.plain(hyperlink=1)"</span>
</pre>
               </div> 
              </div> 
              <p class="last">The text is automatically HTML-escaped before the hyperlinking transformation done in the plain() method.</p> 
             </dd> 
            </dl> </td> 
          </tr> 
          <tr class="row-odd">
           <td>hyperlinked</td> 
           <td><p class="first">The same as msg.content.plain(hyperlink=1), but nicer:</p> 
            <div class="last highlight-default notranslate">
             <div class="highlight">
              <pre><span></span><span class="s2">"structure msg/content/hyperlinked"</span>
</pre>
             </div> 
            </div> </td> 
          </tr> 
          <tr class="row-even">
           <td>field</td> 
           <td><p class="first">render an appropriate form edit field for the property - for most types this is a text entry box, but for Booleans it’s a tri-state yes/no/neither selection. This method may take some arguments:</p> 
            <dl class="last docutils"> 
             <dt>
              size
             </dt> 
             <dd>
              Sets the width in characters of the edit field
             </dd> 
             <dt>
              format (Date properties only)
             </dt> 
             <dd>
              Sets the format of the date in the field - uses the same format string argument as supplied to the <code class="docutils literal notranslate"><span class="pre">pretty</span></code> method below.
             </dd> 
             <dt>
              popcal (Date properties only)
             </dt> 
             <dd>
              Include the Javascript-based popup calendar for date selection. Defaults to on.
             </dd> 
            </dl> </td> 
          </tr> 
          <tr class="row-odd">
           <td>stext</td> 
           <td>only on String properties - render the value of the property as StructuredText (requires the StructureText module to be installed separately)</td> 
          </tr> 
          <tr class="row-even">
           <td>multiline</td> 
           <td>only on String properties - render a multiline form edit field for the property</td> 
          </tr> 
          <tr class="row-odd">
           <td>email</td> 
           <td>only on String properties - render the value of the property as an obscured email address</td> 
          </tr> 
          <tr class="row-even">
           <td>url_quote</td> 
           <td>only on String properties. It quotes any characters in the string so it is safe to use in a url. E.G. a space is replaced with %20.</td> 
          </tr> 
          <tr class="row-odd">
           <td>confirm</td> 
           <td>only on Password properties - render a second form edit field for the property, used for confirmation that the user typed the password correctly. Generates a field with name “name:confirm”.</td> 
          </tr> 
          <tr class="row-even">
           <td>now</td> 
           <td>only on Date properties - return the current date as a new property</td> 
          </tr> 
          <tr class="row-odd">
           <td>reldate</td> 
           <td>only on Date properties - render the interval between the date and now</td> 
          </tr> 
          <tr class="row-even">
           <td>local</td> 
           <td><p class="first">only on Date properties - return this date as a new property with some timezone offset, for example:</p> 
            <div class="highlight-default notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">python</span><span class="p">:</span><span class="n">context</span><span class="o">.</span><span class="n">creation</span><span class="o">.</span><span class="n">local</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre>
             </div> 
            </div> <p class="last">will render the date with a +10 hour offset.</p> </td> 
          </tr> 
          <tr class="row-odd">
           <td>pretty</td> 
           <td><p class="first">Date properties - render the date as “dd Mon YYYY” (eg. “19 Mar 2004”). Takes an optional format argument, for example:</p> 
            <div class="highlight-default notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">python</span><span class="p">:</span><span class="n">context</span><span class="o">.</span><span class="n">activity</span><span class="o">.</span><span class="n">pretty</span><span class="p">(</span><span class="s1">'%Y-%m-</span><span class="si">%d</span><span class="s1">'</span><span class="p">)</span>
</pre>
             </div> 
            </div> <p>Will format as “2004-03-19” instead.</p> <p class="last">Interval properties - render the interval in a pretty format (eg. “yesterday”). The format arguments are those used in the standard <code class="docutils literal notranslate"><span class="pre">strftime</span></code> call (see the <a class="reference external" href="https://docs.python.org/2/library/time.html">Python Library Reference: time module</a>)</p> </td> 
          </tr> 
          <tr class="row-even">
           <td>popcal</td> 
           <td><p class="first">Generate a link to a popup calendar which may be used to edit the date field, for example:</p> 
            <div class="highlight-default notranslate">
             <div class="highlight">
              <pre><span></span><span class="o">&lt;</span><span class="n">span</span> <span class="n">tal</span><span class="p">:</span><span class="n">replace</span><span class="o">=</span><span class="s2">"structure context/due/popcal"</span> <span class="o">/&gt;</span>
</pre>
             </div> 
            </div> <p>you still need to include the <code class="docutils literal notranslate"><span class="pre">field</span></code> for the property, so typically you’d have:</p> 
            <div class="last highlight-default notranslate">
             <div class="highlight">
              <pre><span></span><span class="o">&lt;</span><span class="n">span</span> <span class="n">tal</span><span class="p">:</span><span class="n">replace</span><span class="o">=</span><span class="s2">"structure context/due/field"</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">span</span> <span class="n">tal</span><span class="p">:</span><span class="n">replace</span><span class="o">=</span><span class="s2">"structure context/due/popcal"</span> <span class="o">/&gt;</span>
</pre>
             </div> 
            </div> </td> 
          </tr> 
          <tr class="row-odd">
           <td>menu</td> 
           <td><p class="first">only on Link and Multilink properties - render a form select list for this property. Takes a number of optional arguments</p> 
            <dl class="docutils"> 
             <dt>
              size
             </dt> 
             <dd>
              is used to limit the length of the list labels
             </dd> 
             <dt>
              height
             </dt> 
             <dd>
              is used to set the &lt;select&gt; tag’s “size” attribute
             </dd> 
             <dt>
              showid
             </dt> 
             <dd>
              includes the item ids in the list labels
             </dd> 
             <dt>
              additional
             </dt> 
             <dd>
              lists properties which should be included in the label
             </dd> 
             <dt>
              sort_on
             </dt> 
             <dd>
              indicates the property to sort the list on as (direction, (direction, property) where direction is ‘+’ or ‘-‘. A single string with the direction prepended may be used. For example: (‘-‘, ‘order’), ‘+name’.
             </dd> 
             <dt>
              value
             </dt> 
             <dd>
              gives a default value to preselect in the menu
             </dd> 
            </dl> <p>The remaining keyword arguments are used as conditions for filtering the items in the list - they’re passed as the “filterspec” argument to a Class.filter() call. For example:</p> 
            <div class="last highlight-default notranslate">
             <div class="highlight">
              <pre><span></span><span class="o">&lt;</span><span class="n">span</span> <span class="n">tal</span><span class="p">:</span><span class="n">replace</span><span class="o">=</span><span class="s2">"structure context/status/menu"</span> <span class="o">/&gt;</span>

<span class="o">&lt;</span><span class="n">span</span> <span class="n">tal</span><span class="p">:</span><span class="n">replace</span><span class="o">=</span><span class="s2">"python:context.status.menu(order='+name"</span><span class="p">,</span>
                      <span class="n">value</span><span class="o">=</span><span class="s1">'chatting'</span><span class="p">,</span>
                      <span class="n">filterspec</span><span class="o">=</span><span class="p">{</span><span class="s1">'status'</span><span class="p">:</span> <span class="s1">'1,2,3,4'</span><span class="p">}</span><span class="s2">" /&gt;</span>
</pre>
             </div> 
            </div> </td> 
          </tr> 
          <tr class="row-even">
           <td>sorted</td> 
           <td><p class="first">only on Multilink properties - produce a list of the linked items sorted by some property, for example:</p> 
            <div class="highlight-default notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">python</span><span class="p">:</span><span class="n">context</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="s1">'creation'</span><span class="p">)</span>
</pre>
             </div> 
            </div> <p>Will list the files by upload date. While</p> 
            <blockquote> 
             <div>
              python:context.files.sorted(‘creation’, reverse=True)
             </div>
            </blockquote> <p>Will list the files by upload date in reverse order from the prior example. If the property can be unset, you can use the <code class="docutils literal notranslate"><span class="pre">NoneFirst</span></code> parameter to sort the None/Unset values at the front or the end of the list. For example:</p> 
            <div class="highlight-default notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">python</span><span class="p">:</span><span class="n">context</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="s1">'creation'</span><span class="p">,</span> <span class="n">NoneFirst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre>
             </div> 
            </div> <p class="last">will sort files by creation date with files missing a creation date at the start of the list. The default for <code class="docutils literal notranslate"><span class="pre">NoneFirst</span></code> is False so these files will sort at the end by default. (Note creation date is never unset, but you get the idea.) If you combine NoneFirst with <code class="docutils literal notranslate"><span class="pre">reverse=True</span></code> the meaning of NoneFirst is inverted: True sorts None/unset at the end and False sorts at the beginning.</p> </td> 
          </tr> 
          <tr class="row-odd">
           <td>reverse</td> 
           <td>only on Multilink properties - produce a list of the linked items in reverse order</td> 
          </tr> 
          <tr class="row-even">
           <td>isset</td> 
           <td>returns True if the property has been set to a value</td> 
          </tr> 
         </tbody> 
        </table> 
        <p>All of the above functions perform checks for permissions required to display or edit the data they are manipulating. The simplest case is editing an issue title. Including the expression:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="n">context</span><span class="o">/</span><span class="n">title</span><span class="o">/</span><span class="n">field</span>
</pre>
         </div> 
        </div> 
        <p>Will present the user with an edit field, if they have edit permission. If not, then they will be presented with a static display if they have view permission. If they don’t even have view permission, then an error message is raised, preventing the display of the page, indicating that they don’t have permission to view the information.</p> 
       </div> 
      </div> 
      <div class="section" id="the-request-variable"> 
       <h4><a class="toc-backref" href="#id84">The request variable</a></h4> 
       <p>This is implemented by the <code class="docutils literal notranslate"><span class="pre">roundup.cgi.templating.HTMLRequest</span></code> class.</p> 
       <p>The request variable is packed with information about the current request.</p> 
       <table border="1" class="docutils"> 
        <colgroup> 
         <col width="15%"> 
         <col width="85%"> 
        </colgroup> 
        <thead valign="bottom"> 
         <tr class="row-odd">
          <th class="head">Variable</th> 
          <th class="head">Holds</th> 
         </tr> 
        </thead> 
        <tbody valign="top"> 
         <tr class="row-even">
          <td>form</td> 
          <td>the CGI form as a cgi.FieldStorage</td> 
         </tr> 
         <tr class="row-odd">
          <td>env</td> 
          <td>the CGI environment variables</td> 
         </tr> 
         <tr class="row-even">
          <td>base</td> 
          <td>the base URL for this tracker</td> 
         </tr> 
         <tr class="row-odd">
          <td>user</td> 
          <td>a HTMLUser instance for this user</td> 
         </tr> 
         <tr class="row-even">
          <td>classname</td> 
          <td>the current classname (possibly None)</td> 
         </tr> 
         <tr class="row-odd">
          <td>template</td> 
          <td>the current template (suffix, also possibly None)</td> 
         </tr> 
         <tr class="row-even">
          <td>form</td> 
          <td>the current CGI form variables in a FieldStorage</td> 
         </tr> 
        </tbody> 
       </table> 
       <p><strong>Index page specific variables (indexing arguments)</strong></p> 
       <table border="1" class="docutils"> 
        <colgroup> 
         <col width="15%"> 
         <col width="85%"> 
        </colgroup> 
        <thead valign="bottom"> 
         <tr class="row-odd">
          <th class="head">Variable</th> 
          <th class="head">Holds</th> 
         </tr> 
        </thead> 
        <tbody valign="top"> 
         <tr class="row-even">
          <td>columns</td> 
          <td>dictionary of the columns to display in an index page</td> 
         </tr> 
         <tr class="row-odd">
          <td>show</td> 
          <td>a convenience access to columns - request/show/colname will be true if the columns should be displayed, false otherwise</td> 
         </tr> 
         <tr class="row-even">
          <td>sort</td> 
          <td>index sort columns [(direction, column name)]</td> 
         </tr> 
         <tr class="row-odd">
          <td>group</td> 
          <td>index grouping properties [(direction, column name)]</td> 
         </tr> 
         <tr class="row-even">
          <td>filter</td> 
          <td>properties to filter the index on</td> 
         </tr> 
         <tr class="row-odd">
          <td>filterspec</td> 
          <td>values to filter the index on (property=value, eg <code class="docutils literal notranslate"><span class="pre">priority=1</span></code> or <code class="docutils literal notranslate"><span class="pre">messages.author=42</span></code></td> 
         </tr> 
         <tr class="row-even">
          <td>search_text</td> 
          <td>text to perform a full-text search on for an index</td> 
         </tr> 
        </tbody> 
       </table> 
       <p>There are several methods available on the request variable:</p> 
       <table border="1" class="docutils"> 
        <colgroup> 
         <col width="21%"> 
         <col width="79%"> 
        </colgroup> 
        <thead valign="bottom"> 
         <tr class="row-odd">
          <th class="head">Method</th> 
          <th class="head">Description</th> 
         </tr> 
        </thead> 
        <tbody valign="top"> 
         <tr class="row-even">
          <td>description</td> 
          <td>render a description of the request - handle for the page title</td> 
         </tr> 
         <tr class="row-odd">
          <td>indexargs_form</td> 
          <td>render the current index args as form elements</td> 
         </tr> 
         <tr class="row-even">
          <td>indexargs_url</td> 
          <td>render the current index args as a URL</td> 
         </tr> 
         <tr class="row-odd">
          <td>base_javascript</td> 
          <td>render some javascript that is used by other components of the templating</td> 
         </tr> 
         <tr class="row-even">
          <td>batch</td> 
          <td>run the current index args through a filter and return a list of items (see <a class="reference internal" href="#hyperdb-item-wrapper">hyperdb item wrapper</a>, and <a class="reference internal" href="#batching">batching</a>)</td> 
         </tr> 
        </tbody> 
       </table> 
       <div class="section" id="the-form-variable"> 
        <h5><a class="toc-backref" href="#id85">The form variable</a></h5> 
        <p>The form variable is a bit special because it’s actually a python FieldStorage object. That means that you have two ways to access its contents. For example, to look up the CGI form value for the variable “name”, use the path expression:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="n">request</span><span class="o">/</span><span class="n">form</span><span class="o">/</span><span class="n">name</span><span class="o">/</span><span class="n">value</span>
</pre>
         </div> 
        </div> 
        <p>or the python expression:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="n">python</span><span class="p">:</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
</pre>
         </div> 
        </div> 
        <p>Note the “item” access used in the python case, and also note the explicit “value” attribute we have to access. That’s because the form variables are stored as MiniFieldStorages. If there’s more than one “name” value in the form, then the above will break since <code class="docutils literal notranslate"><span class="pre">request/form/name</span></code> is actually a <em>list</em> of MiniFieldStorages. So it’s best to know beforehand what you’re dealing with.</p> 
       </div> 
      </div> 
      <div class="section" id="the-db-variable"> 
       <h4><a class="toc-backref" href="#id86">The db variable</a></h4> 
       <p>This is implemented by the <code class="docutils literal notranslate"><span class="pre">roundup.cgi.templating.HTMLDatabase</span></code> class.</p> 
       <p>Allows access to all hyperdb classes as attributes of this variable. If you want access to the “user” class, for example, you would use:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">db</span><span class="o">/</span><span class="n">user</span>
<span class="n">python</span><span class="p">:</span><span class="n">db</span><span class="o">.</span><span class="n">user</span>
</pre>
        </div> 
       </div> 
       <p>Also, the current id of the current user is available as <code class="docutils literal notranslate"><span class="pre">db.getuid()</span></code>. This isn’t so useful in templates (where you have <code class="docutils literal notranslate"><span class="pre">request/user</span></code>), but it can be useful in detectors or interfaces.</p> 
       <p>The access results in a <a class="reference internal" href="#hyperdb-class-wrapper">hyperdb class wrapper</a>.</p> 
      </div> 
      <div class="section" id="the-templates-variable"> 
       <h4><a class="toc-backref" href="#id87">The templates variable</a></h4> 
       <p>This was implemented by the <code class="docutils literal notranslate"><span class="pre">roundup.cgi.templating.Templates</span></code> class before 1.4.20. In later versions it is the instance of appropriate template engine loader class.</p> 
       <p>This variable is used to access other templates in expressions and template macros. It doesn’t have any useful methods defined. The templates can be accessed using the following path expression:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">templates</span><span class="o">/</span><span class="n">name</span>
</pre>
        </div> 
       </div> 
       <p>or the python expression:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">templates</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</pre>
        </div> 
       </div> 
       <p>where “name” is the name of the template you wish to access. The template has one useful attribute, namely “macros”. To access a specific macro (called “macro_name”), use the path expression:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">templates</span><span class="o">/</span><span class="n">name</span><span class="o">/</span><span class="n">macros</span><span class="o">/</span><span class="n">macro_name</span>
</pre>
        </div> 
       </div> 
       <p>or the python expression:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">templates</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">macros</span><span class="p">[</span><span class="n">macro_name</span><span class="p">]</span>
</pre>
        </div> 
       </div> 
      </div> 
      <div class="section" id="the-repeat-variable"> 
       <h4><a class="toc-backref" href="#id88">The repeat variable</a></h4> 
       <p>The repeat variable holds an entry for each active iteration. That is, if you have a <code class="docutils literal notranslate"><span class="pre">tal:repeat="user</span> <span class="pre">db/users"</span></code> command, then there will be a repeat variable entry called “user”. This may be accessed as either:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">repeat</span><span class="o">/</span><span class="n">user</span>
<span class="n">python</span><span class="p">:</span><span class="n">repeat</span><span class="p">[</span><span class="s1">'user'</span><span class="p">]</span>
</pre>
        </div> 
       </div> 
       <p>The “user” entry has a number of methods available for information:</p> 
       <table border="1" class="docutils"> 
        <colgroup> 
         <col width="21%"> 
         <col width="79%"> 
        </colgroup> 
        <thead valign="bottom"> 
         <tr class="row-odd">
          <th class="head">Method</th> 
          <th class="head">Description</th> 
         </tr> 
        </thead> 
        <tbody valign="top"> 
         <tr class="row-even">
          <td>first</td> 
          <td>True if the current item is the first in the sequence.</td> 
         </tr> 
         <tr class="row-odd">
          <td>last</td> 
          <td>True if the current item is the last in the sequence.</td> 
         </tr> 
         <tr class="row-even">
          <td>even</td> 
          <td>True if the current item is an even item in the sequence.</td> 
         </tr> 
         <tr class="row-odd">
          <td>odd</td> 
          <td>True if the current item is an odd item in the sequence.</td> 
         </tr> 
         <tr class="row-even">
          <td>number</td> 
          <td>Current position in the sequence, starting from 1.</td> 
         </tr> 
         <tr class="row-odd">
          <td>letter</td> 
          <td>Current position in the sequence as a letter, a through z, then aa through zz, and so on.</td> 
         </tr> 
         <tr class="row-even">
          <td>Letter</td> 
          <td>Same as letter(), except uppercase.</td> 
         </tr> 
         <tr class="row-odd">
          <td>roman</td> 
          <td>Current position in the sequence as lowercase roman numerals.</td> 
         </tr> 
         <tr class="row-even">
          <td>Roman</td> 
          <td>Same as roman(), except uppercase.</td> 
         </tr> 
        </tbody> 
       </table> 
      </div> 
      <div class="section" id="the-utils-variable"> 
       <h4><a class="toc-backref" href="#id89">The utils variable</a></h4> 
       <p id="templating-utilities">This is implemented by the <code class="docutils literal notranslate"><span class="pre">roundup.cgi.templating.TemplatingUtils</span></code> class, which may be extended with additional methods by <a class="reference internal" href="#extensions">extensions</a>.</p> 
       <table border="1" class="docutils"> 
        <colgroup> 
         <col width="21%"> 
         <col width="79%"> 
        </colgroup> 
        <thead valign="bottom"> 
         <tr class="row-odd">
          <th class="head">Method</th> 
          <th class="head">Description</th> 
         </tr> 
        </thead> 
        <tbody valign="top"> 
         <tr class="row-even">
          <td>Batch</td> 
          <td>return a batch object using the supplied list</td> 
         </tr> 
         <tr class="row-odd">
          <td>url_quote</td> 
          <td>quote some text as safe for a URL (ie. space, %, …)</td> 
         </tr> 
         <tr class="row-even">
          <td>html_quote</td> 
          <td>quote some text as safe in HTML (ie. &lt;, &gt;, …)</td> 
         </tr> 
         <tr class="row-odd">
          <td>html_calendar</td> 
          <td>renders an HTML calendar used by the <code class="docutils literal notranslate"><span class="pre">_generic.calendar.html</span></code> template (itself invoked by the popupCalendar DateHTMLProperty method</td> 
         </tr> 
         <tr class="row-even">
          <td>anti_csrf_nonce</td> 
          <td>returns the random noncue generated for this session</td> 
         </tr> 
        </tbody> 
       </table> 
       <div class="section" id="batching"> 
        <h5><a class="toc-backref" href="#id90">Batching</a></h5> 
        <p>Use Batch to turn a list of items, or item ids of a given class, into a series of batches. Its usage is:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="n">python</span><span class="p">:</span><span class="n">utils</span><span class="o">.</span><span class="n">Batch</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">orphan</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="n">overlap</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre>
         </div> 
        </div> 
        <p>or, to get the current index batch:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="n">request</span><span class="o">/</span><span class="n">batch</span>
</pre>
         </div> 
        </div> 
        <p>The parameters are:</p> 
        <table border="1" class="docutils"> 
         <colgroup> 
          <col width="13%"> 
          <col width="87%"> 
         </colgroup> 
         <thead valign="bottom"> 
          <tr class="row-odd">
           <th class="head">Parameter</th> 
           <th class="head">Usage</th> 
          </tr> 
         </thead> 
         <tbody valign="top"> 
          <tr class="row-even">
           <td>sequence</td> 
           <td>a list of HTMLItems</td> 
          </tr> 
          <tr class="row-odd">
           <td>size</td> 
           <td>how big to make the sequence.</td> 
          </tr> 
          <tr class="row-even">
           <td>start</td> 
           <td>where to start (0-indexed) in the sequence.</td> 
          </tr> 
          <tr class="row-odd">
           <td>end</td> 
           <td>where to end (0-indexed) in the sequence.</td> 
          </tr> 
          <tr class="row-even">
           <td>orphan</td> 
           <td>if the next batch would contain less items than this value, then it is combined with this batch</td> 
          </tr> 
          <tr class="row-odd">
           <td>overlap</td> 
           <td>the number of items shared between adjacent batches</td> 
          </tr> 
         </tbody> 
        </table> 
        <p>All of the parameters are assigned as attributes on the batch object. In addition, it has several more attributes:</p> 
        <table border="1" class="docutils"> 
         <colgroup> 
          <col width="21%"> 
          <col width="79%"> 
         </colgroup> 
         <thead valign="bottom"> 
          <tr class="row-odd">
           <th class="head">Attribute</th> 
           <th class="head">Description</th> 
          </tr> 
         </thead> 
         <tbody valign="top"> 
          <tr class="row-even">
           <td>start</td> 
           <td>indicates the start index of the batch. <em>Unlike the argument, is a 1-based index (I know, lame)</em></td> 
          </tr> 
          <tr class="row-odd">
           <td>first</td> 
           <td>indicates the start index of the batch <em>as a 0-based index</em></td> 
          </tr> 
          <tr class="row-even">
           <td>length</td> 
           <td>the actual number of elements in the batch</td> 
          </tr> 
          <tr class="row-odd">
           <td>sequence_length</td> 
           <td>the length of the original, unbatched, sequence.</td> 
          </tr> 
         </tbody> 
        </table> 
        <p>And several methods:</p> 
        <table border="1" class="docutils"> 
         <colgroup> 
          <col width="21%"> 
          <col width="79%"> 
         </colgroup> 
         <thead valign="bottom"> 
          <tr class="row-odd">
           <th class="head">Method</th> 
           <th class="head">Description</th> 
          </tr> 
         </thead> 
         <tbody valign="top"> 
          <tr class="row-even">
           <td>previous</td> 
           <td>returns a new Batch with the previous batch settings</td> 
          </tr> 
          <tr class="row-odd">
           <td>next</td> 
           <td>returns a new Batch with the next batch settings</td> 
          </tr> 
          <tr class="row-even">
           <td>propchanged</td> 
           <td>detect if the named property changed on the current item when compared to the last item</td> 
          </tr> 
         </tbody> 
        </table> 
        <p>An example of batching:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="o">&lt;</span><span class="n">table</span> <span class="n">class</span><span class="o">=</span><span class="s2">"otherinfo"</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">th</span> <span class="n">colspan</span><span class="o">=</span><span class="s2">"4"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"header"</span><span class="o">&gt;</span><span class="n">Existing</span> <span class="n">Keywords</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">tr</span> <span class="n">tal</span><span class="p">:</span><span class="n">define</span><span class="o">=</span><span class="s2">"keywords db/keyword/list"</span>
     <span class="n">tal</span><span class="p">:</span><span class="n">repeat</span><span class="o">=</span><span class="s2">"start python:range(0, len(keywords), 4)"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">define</span><span class="o">=</span><span class="s2">"batch python:utils.Batch(keywords, 4, start)"</span>
      <span class="n">tal</span><span class="p">:</span><span class="n">repeat</span><span class="o">=</span><span class="s2">"keyword batch"</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"keyword/name"</span><span class="o">&gt;</span>
      <span class="n">keyword</span> <span class="n">here</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>
</pre>
         </div> 
        </div> 
        <p>… which will produce a table with four columns containing the items of the “keyword” class (well, their “name” anyway).</p> 
       </div> 
      </div> 
      <div class="section" id="translations"> 
       <h4><a class="toc-backref" href="#id91">Translations</a></h4> 
       <p>Should you wish to enable multiple languages in template content that you create you’ll need to add new locale files in the tracker home under a <code class="docutils literal notranslate"><span class="pre">locale</span></code> directory. Use the instructions in the <code class="docutils literal notranslate"><span class="pre">developer's</span> <span class="pre">guide</span></code> to create the locale files.</p> 
      </div> 
     </div> 
     <div class="section" id="displaying-properties"> 
      <h3><a class="toc-backref" href="#id92">Displaying Properties</a></h3> 
      <p>Properties appear in the user interface in three contexts: in indices, in editors, and as search arguments. For each type of property, there are several display possibilities. For example, in an index view, a string property may just be printed as a plain string, but in an editor view, that property may be displayed in an editable field.</p> 
     </div> 
     <div class="section" id="index-views"> 
      <h3><a class="toc-backref" href="#id93">Index Views</a></h3> 
      <p>This is one of the class context views. It is also the default view for classes. The template used is “<em>classname</em>.index”.</p> 
      <div class="section" id="index-view-specifiers"> 
       <h4><a class="toc-backref" href="#id94">Index View Specifiers</a></h4> 
       <p>An index view specifier (URL fragment) looks like this (whitespace has been added for clarity):</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span>/issue?status=unread,in-progress,resolved&amp;
    keyword=security,ui&amp;
    @group=priority,-status&amp;
    @sort=-activity&amp;
    @filters=status,keyword&amp;
    @columns=title,status,fixer
</pre>
        </div> 
       </div> 
       <p>The index view is determined by two parts of the specifier: the layout part and the filter part. The layout part consists of the query parameters that begin with colons, and it determines the way that the properties of selected items are displayed. The filter part consists of all the other query parameters, and it determines the criteria by which items are selected for display. The filter part is interactively manipulated with the form widgets displayed in the filter section. The layout part is interactively manipulated by clicking on the column headings in the table.</p> 
       <p>The filter part selects the union of the sets of items with values matching any specified Link properties and the intersection of the sets of items with values matching any specified Multilink properties.</p> 
       <p>The example specifies an index of “issue” items. Only items with a “status” of either “unread” or “in-progress” or “resolved” are displayed, and only items with “keyword” values including both “security” and “ui” are displayed. The items are grouped by priority arranged in ascending order and in descending order by status; and within groups, sorted by activity, arranged in descending order. The filter section shows filters for the “status” and “keyword” properties, and the table includes columns for the “title”, “status”, and “fixer” properties.</p> 
       <table border="1" class="docutils"> 
        <colgroup> 
         <col width="16%"> 
         <col width="84%"> 
        </colgroup> 
        <thead valign="bottom"> 
         <tr class="row-odd">
          <th class="head">Argument</th> 
          <th class="head">Description</th> 
         </tr> 
        </thead> 
        <tbody valign="top"> 
         <tr class="row-even">
          <td>@sort</td> 
          <td>sort by prop name, optionally preceeded with ‘-‘ to give descending or nothing for ascending sorting. Several properties can be specified delimited with comma. Internally a search-page using several sort properties may use @sort0, @sort1 etc. with option @sortdir0, @sortdir1 etc. for the direction of sorting (a non-empty value of sortdir0 specifies reverse order).</td> 
         </tr> 
         <tr class="row-odd">
          <td>@group</td> 
          <td>group by prop name, optionally preceeded with ‘-‘ or to sort in descending or nothing for ascending order. Several properties can be specified delimited with comma. Internally a search-page using several grouping properties may use @group0, @group1 etc. with option @groupdir0, @groupdir1 etc. for the direction of grouping (a non-empty value of groupdir0 specifies reverse order).</td> 
         </tr> 
         <tr class="row-even">
          <td>@columns</td> 
          <td>selects the columns that should be displayed. Default is all.</td> 
         </tr> 
         <tr class="row-odd">
          <td>@filter</td> 
          <td>indicates which properties are being used in filtering. Default is none.</td> 
         </tr> 
         <tr class="row-even">
          <td>propname</td> 
          <td>selects the values the item properties given by propname must have (very basic search/filter).</td> 
         </tr> 
         <tr class="row-odd">
          <td>@search_text</td> 
          <td>if supplied, performs a full-text search (message bodies, issue titles, etc)</td> 
         </tr> 
        </tbody> 
       </table> 
      </div> 
     </div> 
     <div class="section" id="searching-views"> 
      <h3><a class="toc-backref" href="#id95">Searching Views</a></h3> 
      <div class="admonition note"> 
       <p class="first admonition-title">Note</p> 
       <p class="last">if you add a new column to the <code class="docutils literal notranslate"><span class="pre">@columns</span></code> form variable potentials then you will need to add the column to the appropriate <a class="reference internal" href="#index-views">index views</a> template so that it is actually displayed.</p> 
      </div> 
      <p>This is one of the class context views. The template used is typically “<em>classname</em>.search”. The form on this page should have “search” as its <code class="docutils literal notranslate"><span class="pre">@action</span></code> variable. The “search” action:</p> 
      <ul class="simple"> 
       <li>sets up additional filtering, as well as performing indexed text searching</li> 
       <li>sets the <code class="docutils literal notranslate"><span class="pre">@filter</span></code> variable correctly</li> 
       <li>saves the query off if <code class="docutils literal notranslate"><span class="pre">@query_name</span></code> is set.</li> 
      </ul> 
      <p>The search page should lay out any fields that you wish to allow the user to search on. If your schema contains a large number of properties, you should be wary of making all of those properties available for searching, as this can cause confusion. If the additional properties are Strings, consider having their value indexed, and then they will be searchable using the full text indexed search. This is both faster, and more useful for the end user.</p> 
      <p>If the search view does specify the “search” <code class="docutils literal notranslate"><span class="pre">@action</span></code>, then it may also provide an additional argument:</p> 
      <table border="1" class="docutils"> 
       <colgroup> 
        <col width="16%"> 
        <col width="84%"> 
       </colgroup> 
       <thead valign="bottom"> 
        <tr class="row-odd">
         <th class="head">Argument</th> 
         <th class="head">Description</th> 
        </tr> 
       </thead> 
       <tbody valign="top"> 
        <tr class="row-even">
         <td>@query_name</td> 
         <td>if supplied, the index parameters (including @search_text) will be saved off as a the query item and registered against the user’s queries property. Note that the <em>classic</em> template schema has this ability, but the <em>minimal</em> template schema does not.</td> 
        </tr> 
       </tbody> 
      </table> 
     </div> 
     <div class="section" id="item-views"> 
      <h3><a class="toc-backref" href="#id96">Item Views</a></h3> 
      <p>The basic view of a hyperdb item is provided by the “<em>classname</em>.item” template. It generally has three sections; an “editor”, a “spool” and a “history” section.</p> 
      <div class="section" id="editor-section"> 
       <h4><a class="toc-backref" href="#id97">Editor Section</a></h4> 
       <p>The editor section is used to manipulate the item - it may be a static display if the user doesn’t have permission to edit the item.</p> 
       <p>Here’s an example of a basic editor template (this is the default “classic” template issue item edit form - from the “issue.item.html” template):</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="o">&lt;</span><span class="n">table</span> <span class="n">class</span><span class="o">=</span><span class="s2">"form"</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Title</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span> <span class="n">colspan</span><span class="o">=</span><span class="s2">"3"</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"structure python:context.title.field(size=60)"</span><span class="o">&gt;</span><span class="n">title</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Priority</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"structure context/priority/menu"</span><span class="o">&gt;</span><span class="n">priority</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Status</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"structure context/status/menu"</span><span class="o">&gt;</span><span class="n">status</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Superseder</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">span</span> <span class="n">tal</span><span class="p">:</span><span class="n">replace</span><span class="o">=</span><span class="s2">"structure python:context.superseder.field(showid=1, size=20)"</span> <span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="n">span</span> <span class="n">tal</span><span class="p">:</span><span class="n">replace</span><span class="o">=</span><span class="s2">"structure python:db.issue.classhelp('id,title')"</span> <span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="n">span</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"context/superseder"</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span><span class="n">View</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">span</span> <span class="n">tal</span><span class="p">:</span><span class="n">replace</span><span class="o">=</span><span class="s2">"structure python:context.superseder.link(showid=1)"</span> <span class="o">/&gt;</span>
  <span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Nosy</span> <span class="n">List</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">span</span> <span class="n">tal</span><span class="p">:</span><span class="n">replace</span><span class="o">=</span><span class="s2">"structure context/nosy/field"</span> <span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="n">span</span> <span class="n">tal</span><span class="p">:</span><span class="n">replace</span><span class="o">=</span><span class="s2">"structure python:db.user.classhelp('username,realname,address,phone')"</span> <span class="o">/&gt;</span>
 <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Assigned</span> <span class="n">To</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"structure context/assignedto/menu"</span><span class="o">&gt;</span>
  <span class="n">assignedto</span> <span class="n">menu</span>
 <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Change</span> <span class="n">Note</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span> <span class="n">colspan</span><span class="o">=</span><span class="s2">"3"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">textarea</span> <span class="n">name</span><span class="o">=</span><span class="s2">":note"</span> <span class="n">wrap</span><span class="o">=</span><span class="s2">"hard"</span> <span class="n">rows</span><span class="o">=</span><span class="s2">"5"</span> <span class="n">cols</span><span class="o">=</span><span class="s2">"60"</span><span class="o">&gt;&lt;/</span><span class="n">textarea</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">File</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span> <span class="n">colspan</span><span class="o">=</span><span class="s2">"3"</span><span class="o">&gt;&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"file"</span> <span class="n">name</span><span class="o">=</span><span class="s2">":file"</span> <span class="n">size</span><span class="o">=</span><span class="s2">"40"</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span> <span class="n">colspan</span><span class="o">=</span><span class="s2">"3"</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"structure context/submit"</span><span class="o">&gt;</span>
  <span class="n">submit</span> <span class="n">button</span> <span class="n">will</span> <span class="n">go</span> <span class="n">here</span>
 <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>
</pre>
        </div> 
       </div> 
       <p>When a change is submitted, the system automatically generates a message describing the changed properties. As shown in the example, the editor template can use the “:note” and “:file” fields, which are added to the standard changenote message generated by Roundup.</p> 
       <div class="section" id="form-values"> 
        <h5><a class="toc-backref" href="#id98">Form values</a></h5> 
        <p>We have a number of ways to pull properties out of the form in order to meet the various needs of:</p> 
        <ol class="arabic simple"> 
         <li>editing the current item (perhaps an issue item)</li> 
         <li>editing information related to the current item (eg. messages or attached files)</li> 
         <li>creating new information to be linked to the current item (eg. time spent on an issue)</li> 
        </ol> 
        <p>In the following, <code class="docutils literal notranslate"><span class="pre">&lt;bracketed&gt;</span></code> values are variable, “:” may be one of “:” or “@”, and other text (“required”) is fixed.</p> 
        <p>Properties are specified as form variables:</p> 
        <dl class="docutils"> 
         <dt>
          <code class="docutils literal notranslate"><span class="pre">&lt;propname&gt;</span></code>
         </dt> 
         <dd>
          property on the current context item
         </dd> 
         <dt>
          <code class="docutils literal notranslate"><span class="pre">&lt;designator&gt;:&lt;propname&gt;</span></code>
         </dt> 
         <dd>
          property on the indicated item (for editing related information)
         </dd> 
         <dt>
          <code class="docutils literal notranslate"><span class="pre">&lt;classname&gt;-&lt;N&gt;:&lt;propname&gt;</span></code>
         </dt> 
         <dd>
          property on the Nth new item of classname (generally for creating new items to attach to the current item)
         </dd> 
        </dl> 
        <p>Once we have determined the “propname”, we check to see if it is one of the special form values:</p> 
        <dl class="docutils"> 
         <dt>
          <code class="docutils literal notranslate"><span class="pre">@required</span></code>
         </dt> 
         <dd>
          The named property values must be supplied or a ValueError will be raised.
         </dd> 
         <dt>
          <code class="docutils literal notranslate"><span class="pre">@remove@&lt;propname&gt;=id(s)</span></code>
         </dt> 
         <dd>
          The ids will be removed from the multilink property.
         </dd> 
         <dt>
          <code class="docutils literal notranslate"><span class="pre">:add:&lt;propname&gt;=id(s)</span></code>
         </dt> 
         <dd>
          The ids will be added to the multilink property.
         </dd> 
         <dt>
          <code class="docutils literal notranslate"><span class="pre">:link:&lt;propname&gt;=&lt;designator&gt;</span></code>
         </dt> 
         <dd>
          Used to add a link to new items created during edit. These are collected and returned in <code class="docutils literal notranslate"><span class="pre">all_links</span></code>. This will result in an additional linking operation (either Link set or Multilink append) after the edit/create is done using <code class="docutils literal notranslate"><span class="pre">all_props</span></code> in <code class="docutils literal notranslate"><span class="pre">_editnodes</span></code>. The &lt;propname&gt; on the current item will be set/appended the id of the newly created item of class &lt;designator&gt; (where &lt;designator&gt; must be &lt;classname&gt;-&lt;N&gt;).
         </dd> 
        </dl> 
        <p>Any of the form variables may be prefixed with a classname or designator.</p> 
        <p>Two special form values are supported for backwards compatibility:</p> 
        <dl class="docutils"> 
         <dt>
          <code class="docutils literal notranslate"><span class="pre">:note</span></code>
         </dt> 
         <dd>
          create a message (with content, author and date), linked to the context item. This is ALWAYS designated “msg-1”.
         </dd> 
         <dt>
          <code class="docutils literal notranslate"><span class="pre">:file</span></code>
         </dt> 
         <dd>
          create a file, attached to the current item and any message created by :note. This is ALWAYS designated “file-1”.
         </dd> 
        </dl> 
       </div> 
      </div> 
      <div class="section" id="spool-section"> 
       <h4><a class="toc-backref" href="#id99">Spool Section</a></h4> 
       <p>The spool section lists related information like the messages and files of an issue.</p> 
       <p>TODO</p> 
      </div> 
      <div class="section" id="history-section"> 
       <h4><a class="toc-backref" href="#id100">History Section</a></h4> 
       <p>The final section displayed is the history of the item - its database journal. This is generally generated with the template:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="o">&lt;</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span> <span class="n">tal</span><span class="p">:</span><span class="n">replace</span><span class="o">=</span><span class="s2">"structure context/history"</span> <span class="o">/&gt;</span>
</pre>
        </div> 
       </div> 
       <p>or:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="o">&lt;</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span>
    <span class="n">tal</span><span class="p">:</span><span class="n">replace</span><span class="o">=</span><span class="s2">"structure python:context.history(showall=True)"</span> <span class="o">/&gt;</span>
</pre>
        </div> 
       </div> 
       <p>if you want to show history entries for quiet properties.</p> 
       <p><em>To be done:</em></p> 
       <p><em>The actual history entries of the item may be accessed for manual templating through the “journal” method of the item</em>:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="o">&lt;</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span> <span class="n">tal</span><span class="p">:</span><span class="n">repeat</span><span class="o">=</span><span class="s2">"entry context/journal"</span><span class="o">&gt;</span>
 <span class="n">a</span> <span class="n">journal</span> <span class="n">entry</span>
<span class="o">&lt;/</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span><span class="o">&gt;</span>
</pre>
        </div> 
       </div> 
       <p><em>where each journal entry is an HTMLJournalEntry.</em></p> 
      </div> 
     </div> 
     <div class="section" id="defining-new-web-actions"> 
      <h3><a class="toc-backref" href="#id101">Defining new web actions</a></h3> 
      <p>You may define new actions to be triggered by the <code class="docutils literal notranslate"><span class="pre">@action</span></code> form variable. These are added to the tracker <code class="docutils literal notranslate"><span class="pre">extensions</span></code> directory and registered using <code class="docutils literal notranslate"><span class="pre">instance.registerAction</span></code>.</p> 
      <p>All the existing Actions are defined in <code class="docutils literal notranslate"><span class="pre">roundup.cgi.actions</span></code>.</p> 
      <p>Adding action classes takes three steps; first you <a class="reference internal" href="#define-the-new-action-class">define the new action class</a>, then you <a class="reference internal" href="#register-the-action-class">register the action class</a> with the cgi interface so it may be triggered by the <code class="docutils literal notranslate"><span class="pre">@action</span></code> form variable. Finally you <a class="reference internal" href="#use-the-new-action">use the new action</a> in your HTML form.</p> 
      <p>See “<a class="reference internal" href="#setting-up-a-wizard-or-druid-for-controlled-adding-of-issues">setting up a “wizard” (or “druid”) for controlled adding of issues</a>” for an example.</p> 
      <div class="section" id="define-the-new-action-class"> 
       <h4><a class="toc-backref" href="#id102">Define the new action class</a></h4> 
       <p>Create a new action class in your tracker’s <code class="docutils literal notranslate"><span class="pre">extensions</span></code> directory, for example <code class="docutils literal notranslate"><span class="pre">myaction.py</span></code>:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="kn">from</span> <span class="nn">roundup.cgi.actions</span> <span class="k">import</span> <span class="n">Action</span>

<span class="k">class</span> <span class="nc">MyAction</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">''' Perform some action. No return value is required.</span>
<span class="sd">        '''</span>
</pre>
        </div> 
       </div> 
       <p>The <em>self.client</em> attribute is an instance of <code class="docutils literal notranslate"><span class="pre">roundup.cgi.client.Client</span></code>. See the docstring of that class for details of what it can do.</p> 
       <p>The method will typically check the <code class="docutils literal notranslate"><span class="pre">self.form</span></code> variable’s contents. It may then:</p> 
       <ul class="simple"> 
        <li>add information to <code class="docutils literal notranslate"><span class="pre">self.client._ok_message</span></code> or <code class="docutils literal notranslate"><span class="pre">self.client._error_message</span></code> (by using <code class="docutils literal notranslate"><span class="pre">self.client.add_ok_message</span></code> or <code class="docutils literal notranslate"><span class="pre">self.client.add_error_message</span></code>, respectively)</li> 
        <li>change the <code class="docutils literal notranslate"><span class="pre">self.client.template</span></code> variable to alter what the user will see next</li> 
        <li>raise Unauthorised, SendStaticFile, SendFile, NotFound or Redirect exceptions (import them from roundup.cgi.exceptions)</li> 
       </ul> 
      </div> 
      <div class="section" id="register-the-action-class"> 
       <h4><a class="toc-backref" href="#id103">Register the action class</a></h4> 
       <p>The class is now written, but isn’t available to the user until you register it with the following code appended to your <code class="docutils literal notranslate"><span class="pre">myaction.py</span></code> file:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="n">instance</span><span class="p">):</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">registerAction</span><span class="p">(</span><span class="s1">'myaction'</span><span class="p">,</span> <span class="n">myActionClass</span><span class="p">)</span>
</pre>
        </div> 
       </div> 
       <p>This maps the action name “myaction” to the action class we defined.</p> 
      </div> 
      <div class="section" id="use-the-new-action"> 
       <h4><a class="toc-backref" href="#id104">Use the new action</a></h4> 
       <p>In your HTML form, add a hidden form element like so:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"@action"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"myaction"</span><span class="o">&gt;</span>
</pre>
        </div> 
       </div> 
       <p>where “myaction” is the name you registered in the previous step.</p> 
      </div> 
      <div class="section" id="actions-may-return-content-to-the-user"> 
       <h4><a class="toc-backref" href="#id105">Actions may return content to the user</a></h4> 
       <p>Actions generally perform some database manipulation and then pass control on to the rendering of a template in the current context (see <a class="reference internal" href="#determining-web-context">Determining web context</a> for how that works.) Some actions will want to generate the actual content returned to the user. Action methods may return their own content string to be displayed to the user, overriding the templating step. In this situation, we assume that the content is HTML by default. You may override the content type indicated to the user by calling <code class="docutils literal notranslate"><span class="pre">setHeader</span></code>:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">setHeader</span><span class="p">(</span><span class="s1">'Content-Type'</span><span class="p">,</span> <span class="s1">'text/csv'</span><span class="p">)</span>
</pre>
        </div> 
       </div> 
       <p>This example indicates that the value sent back to the user is actually comma-separated value content (eg. something to be loaded into a spreadsheet or database).</p> 
      </div> 
     </div> 
     <div class="section" id="bit-character-set-support-in-web-interface"> 
      <h3><a class="toc-backref" href="#id106">8-bit character set support in Web interface</a></h3> 
      <p>The web interface uses UTF-8 default. It may be overridden in both forms and a browser cookie.</p> 
      <ul class="simple"> 
       <li>In forms, use the <code class="docutils literal notranslate"><span class="pre">@charset</span></code> variable.</li> 
       <li>To use the cookie override, have the <code class="docutils literal notranslate"><span class="pre">roundup_charset</span></code> cookie set.</li> 
      </ul> 
      <p>In both cases, the value is a valid charset name (eg. <code class="docutils literal notranslate"><span class="pre">utf-8</span></code> or <code class="docutils literal notranslate"><span class="pre">kio8-r</span></code>).</p> 
      <p>Inside Roundup, all strings are stored and processed in utf-8. Unfortunately, some older browsers do not work properly with utf-8-encoded pages (e.g. Netscape Navigator 4 displays wrong characters in form fields). This version allows one to change the character set for http transfers. To do so, you may add the following code to your <code class="docutils literal notranslate"><span class="pre">page.html</span></code> template:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span> <span class="n">define</span><span class="o">=</span><span class="s2">"uri string:${request/base}${request/env/PATH_INFO}"</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">a</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"href python:request.indexargs_url(uri,</span>
  <span class="p">{</span><span class="s1">'@charset'</span><span class="p">:</span><span class="s1">'utf-8'</span><span class="p">})</span><span class="s2">"&gt;utf-8&lt;/a&gt;</span>
 <span class="o">&lt;</span><span class="n">a</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"href python:request.indexargs_url(uri,</span>
  <span class="p">{</span><span class="s1">'@charset'</span><span class="p">:</span><span class="s1">'koi8-r'</span><span class="p">})</span><span class="s2">"&gt;koi8-r&lt;/a&gt;</span>
<span class="o">&lt;/</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span><span class="o">&gt;</span>
</pre>
       </div> 
      </div> 
      <p>(substitute <code class="docutils literal notranslate"><span class="pre">koi8-r</span></code> with appropriate charset for your language). Charset preference is kept in the browser cookie <code class="docutils literal notranslate"><span class="pre">roundup_charset</span></code>.</p> 
      <p><code class="docutils literal notranslate"><span class="pre">meta</span> <span class="pre">http-equiv</span></code> lines added to the tracker templates in version 0.6.0 should be changed to include actual character set name:</p> 
      <div class="highlight-default notranslate">
       <div class="highlight">
        <pre><span></span><span class="o">&lt;</span><span class="n">meta</span> <span class="n">http</span><span class="o">-</span><span class="n">equiv</span><span class="o">=</span><span class="s2">"Content-Type"</span>
 <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"content string:text/html;; charset=${request/client/charset}"</span>
<span class="o">/&gt;</span>
</pre>
       </div> 
      </div> 
      <p>The charset is also sent in the http header.</p> 
     </div> 
    </div> 
    <div class="section" id="examples"> <span id="customexamples"></span>
     <h2><a class="toc-backref" href="#id56">Examples</a></h2> 
     <div class="contents local topic" id="id6"> 
      <ul class="simple"> 
       <li><a class="reference internal" href="#changing-what-s-stored-in-the-database" id="id107">Changing what’s stored in the database</a>
        <ul> 
         <li><a class="reference internal" href="#adding-a-new-field-to-the-classic-schema" id="id108">Adding a new field to the classic schema</a></li> 
         <li><a class="reference internal" href="#adding-a-new-constrained-field-to-the-classic-schema" id="id109">Adding a new constrained field to the classic schema</a></li> 
         <li><a class="reference internal" href="#adding-a-time-log-to-your-issues" id="id110">Adding a time log to your issues</a></li> 
         <li><a class="reference internal" href="#tracking-different-types-of-issues" id="id111">Tracking different types of issues</a></li> 
        </ul> </li> 
       <li><a class="reference internal" href="#using-external-user-databases" id="id112">Using External User Databases</a>
        <ul> 
         <li><a class="reference internal" href="#using-an-external-password-validation-source" id="id113">Using an external password validation source</a></li> 
         <li><a class="reference internal" href="#using-a-un-x-passwd-file-as-the-user-database" id="id114">Using a UN*X passwd file as the user database</a></li> 
         <li><a class="reference internal" href="#using-an-ldap-database-for-user-information" id="id115">Using an LDAP database for user information</a></li> 
        </ul> </li> 
       <li><a class="reference internal" href="#changes-to-tracker-behaviour" id="id116">Changes to Tracker Behaviour</a>
        <ul> 
         <li><a class="reference internal" href="#preventing-spam" id="id117">Preventing SPAM</a></li> 
         <li><a class="reference internal" href="#stop-nosy-messages-going-to-people-on-vacation" id="id118">Stop “nosy” messages going to people on vacation</a></li> 
         <li><a class="reference internal" href="#adding-in-state-transition-control" id="id119">Adding in state transition control</a></li> 
         <li><a class="reference internal" href="#blocking-issues-that-depend-on-other-issues" id="id120">Blocking issues that depend on other issues</a></li> 
         <li><a class="reference internal" href="#add-users-to-the-nosy-list-based-on-the-keyword" id="id121">Add users to the nosy list based on the keyword</a></li> 
         <li><a class="reference internal" href="#restricting-updates-that-arrive-by-email" id="id122">Restricting updates that arrive by email</a></li> 
        </ul> </li> 
       <li><a class="reference internal" href="#changes-to-security-and-permissions" id="id123">Changes to Security and Permissions</a>
        <ul> 
         <li><a class="reference internal" href="#restricting-the-list-of-users-that-are-assignable-to-a-task" id="id124">Restricting the list of users that are assignable to a task</a></li> 
         <li><a class="reference internal" href="#users-may-only-edit-their-issues" id="id125">Users may only edit their issues</a></li> 
         <li><a class="reference internal" href="#all-users-may-only-view-and-edit-issues-files-and-messages-they-create" id="id126">All users may only view and edit issues, files and messages they create</a></li> 
         <li><a class="reference internal" href="#moderating-user-registration" id="id127">Moderating user registration</a></li> 
        </ul> </li> 
       <li><a class="reference internal" href="#changes-to-the-web-user-interface" id="id128">Changes to the Web User Interface</a>
        <ul> 
         <li><a class="reference internal" href="#adding-action-links-to-the-index-page" id="id129">Adding action links to the index page</a></li> 
         <li><a class="reference internal" href="#colouring-the-rows-in-the-issue-index-according-to-priority" id="id130">Colouring the rows in the issue index according to priority</a></li> 
         <li><a class="reference internal" href="#editing-multiple-items-in-an-index-view" id="id131">Editing multiple items in an index view</a></li> 
         <li><a class="reference internal" href="#displaying-only-message-summaries-in-the-issue-display" id="id132">Displaying only message summaries in the issue display</a></li> 
         <li><a class="reference internal" href="#enabling-display-of-either-message-summaries-or-the-entire-messages" id="id133">Enabling display of either message summaries or the entire messages</a></li> 
         <li><a class="reference internal" href="#setting-up-a-wizard-or-druid-for-controlled-adding-of-issues" id="id134">Setting up a “wizard” (or “druid”) for controlled adding of issues</a></li> 
         <li><a class="reference internal" href="#silent-submit" id="id135">Silent Submit</a></li> 
        </ul> </li> 
      </ul> 
     </div> 
     <div class="section" id="changing-what-s-stored-in-the-database"> 
      <h3><a class="toc-backref" href="#id107">Changing what’s stored in the database</a></h3> 
      <p>The following examples illustrate ways to change the information stored in the database.</p> 
      <div class="section" id="adding-a-new-field-to-the-classic-schema"> 
       <h4><a class="toc-backref" href="#id108">Adding a new field to the classic schema</a></h4> 
       <p>This example shows how to add a simple field (a due date) to the default classic schema. It does not add any additional behaviour, such as enforcing the due date, or causing automatic actions to fire if the due date passes.</p> 
       <p>You add new fields by editing the <code class="docutils literal notranslate"><span class="pre">schema.py</span></code> file in you tracker’s home. Schema changes are automatically applied to the database on the next tracker access (note that roundup-server would need to be restarted as it caches the schema).</p> 
       <ol class="arabic" id="index-43"> 
        <li><p class="first">Modify the <code class="docutils literal notranslate"><span class="pre">schema.py</span></code>:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">issue</span> <span class="o">=</span> <span class="n">IssueClass</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"issue"</span><span class="p">,</span>
                <span class="n">assignedto</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"user"</span><span class="p">),</span> <span class="n">keyword</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">"keyword"</span><span class="p">),</span>
                <span class="n">priority</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"priority"</span><span class="p">),</span> <span class="n">status</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"status"</span><span class="p">),</span>
                <span class="n">due_date</span><span class="o">=</span><span class="n">Date</span><span class="p">())</span>
</pre>
          </div> 
         </div> </li> 
        <li><p class="first">Add an edit field to the <code class="docutils literal notranslate"><span class="pre">issue.item.html</span></code> template:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Due</span> <span class="n">Date</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"structure context/due_date/field"</span> <span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> <p>If you want to show only the date part of due_date then do this instead:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Due</span> <span class="n">Date</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"structure python:context.due_date.field(format='%Y-%m-</span><span class="si">%d</span><span class="s2">')"</span> <span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> </li> 
        <li><p class="first">Add the property to the <code class="docutils literal notranslate"><span class="pre">issue.index.html</span></code> page:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="p">(</span><span class="ow">in</span> <span class="n">the</span> <span class="n">heading</span> <span class="n">row</span><span class="p">)</span>
  <span class="o">&lt;</span><span class="n">th</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"request/show/due_date"</span><span class="o">&gt;</span><span class="n">Due</span> <span class="n">Date</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
<span class="p">(</span><span class="ow">in</span> <span class="n">the</span> <span class="n">data</span> <span class="n">row</span><span class="p">)</span>
  <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"request/show/due_date"</span>
      <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"i/due_date"</span> <span class="o">/&gt;</span>
</pre>
          </div> 
         </div> <p>If you want format control of the display of the due date you can enter the following in the data row to show only the actual due date:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"request/show/due_date"</span>
    <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"python:i.due_date.pretty('%Y-%m-</span><span class="si">%d</span><span class="s2">')"</span><span class="o">&gt;&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> </li> 
        <li><p class="first">Add the property to the <code class="docutils literal notranslate"><span class="pre">issue.search.html</span></code> page:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">tr</span> <span class="n">tal</span><span class="p">:</span><span class="n">define</span><span class="o">=</span><span class="s2">"name string:due_date"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">th</span> <span class="n">i18n</span><span class="p">:</span><span class="n">translate</span><span class="o">=</span><span class="s2">""</span><span class="o">&gt;</span><span class="n">Due</span> <span class="n">Date</span><span class="p">:</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span> <span class="n">metal</span><span class="p">:</span><span class="n">use</span><span class="o">-</span><span class="n">macro</span><span class="o">=</span><span class="s2">"search_input"</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span> <span class="n">metal</span><span class="p">:</span><span class="n">use</span><span class="o">-</span><span class="n">macro</span><span class="o">=</span><span class="s2">"column_input"</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span> <span class="n">metal</span><span class="p">:</span><span class="n">use</span><span class="o">-</span><span class="n">macro</span><span class="o">=</span><span class="s2">"sort_input"</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span> <span class="n">metal</span><span class="p">:</span><span class="n">use</span><span class="o">-</span><span class="n">macro</span><span class="o">=</span><span class="s2">"group_input"</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> </li> 
        <li><p class="first">If you wish for the due date to appear in the standard views listed in the sidebar of the web interface then you’ll need to add “due_date” to the columns and columns_showall lists in your <code class="docutils literal notranslate"><span class="pre">page.html</span></code>:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">columns</span> <span class="n">string</span><span class="p">:</span><span class="nb">id</span><span class="p">,</span><span class="n">activity</span><span class="p">,</span><span class="n">due_date</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">creator</span><span class="p">,</span><span class="n">status</span><span class="p">;</span>
<span class="n">columns_showall</span> <span class="n">string</span><span class="p">:</span><span class="nb">id</span><span class="p">,</span><span class="n">activity</span><span class="p">,</span><span class="n">due_date</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">creator</span><span class="p">,</span><span class="n">assignedto</span><span class="p">,</span><span class="n">status</span><span class="p">;</span>
</pre>
          </div> 
         </div> </li> 
       </ol> 
      </div> 
      <div class="section" id="adding-a-new-constrained-field-to-the-classic-schema"> 
       <h4><a class="toc-backref" href="#id109">Adding a new constrained field to the classic schema</a></h4> 
       <p>This example shows how to add a new constrained property (i.e. a selection of distinct values) to your tracker.</p> 
       <div class="section" id="introduction"> 
        <h5>Introduction</h5> 
        <p>To make the classic schema of Roundup useful as a TODO tracking system for a group of systems administrators, it needs an extra data field per issue: a category.</p> 
        <p>This would let sysadmins quickly list all TODOs in their particular area of interest without having to do complex queries, and without relying on the spelling capabilities of other sysadmins (a losing proposition at best).</p> 
       </div> 
       <div class="section" id="adding-a-field-to-the-database"> 
        <h5>Adding a field to the database</h5> 
        <p>This is the easiest part of the change. The category would just be a plain string, nothing fancy. To change what is in the database you need to add some lines to the <code class="docutils literal notranslate"><span class="pre">schema.py</span></code> file of your tracker instance. Under the comment:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="c1"># add any additional database schema configuration here</span>
</pre>
         </div> 
        </div> 
        <p>add:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="n">category</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"category"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>
<span class="n">category</span><span class="o">.</span><span class="n">setkey</span><span class="p">(</span><span class="s2">"name"</span><span class="p">)</span>
</pre>
         </div> 
        </div> 
        <p>Here we are setting up a chunk of the database which we are calling “category”. It contains a string, which we are refering to as “name” for lack of a more imaginative title. (Since “name” is one of the properties that Roundup looks for on items if you do not set a key for them, it’s probably a good idea to stick with it for new classes if at all appropriate.) Then we are setting the key of this chunk of the database to be that “name”. This is equivalent to an index for database types. This also means that there can only be one category with a given name.</p> 
        <p>Adding the above lines allows us to create categories, but they’re not tied to the issues that we are going to be creating. It’s just a list of categories off on its own, which isn’t much use. We need to link it in with the issues. To do that, find the lines in <code class="docutils literal notranslate"><span class="pre">schema.py</span></code> which set up the “issue” class, and then add a link to the category:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="n">issue</span> <span class="o">=</span> <span class="n">IssueClass</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"issue"</span><span class="p">,</span> <span class="o">...</span> <span class="p">,</span>
    <span class="n">category</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">"category"</span><span class="p">),</span> <span class="o">...</span> <span class="p">)</span>
</pre>
         </div> 
        </div> 
        <p>The <code class="docutils literal notranslate"><span class="pre">Multilink()</span></code> means that each issue can have many categories. If you were adding something with a one-to-one relationship to issues (such as the “assignedto” property), use <code class="docutils literal notranslate"><span class="pre">Link()</span></code> instead.</p> 
        <p>That is all you need to do to change the schema. The rest of the effort is fiddling around so you can actually use the new category.</p> 
       </div> 
       <div class="section" id="populating-the-new-category-class"> 
        <h5>Populating the new category class</h5> 
        <p>If you haven’t initialised the database with the “<code class="docutils literal notranslate"><span class="pre">roundup-admin</span> <span class="pre">initialise</span></code>” command, then you can add the following to the tracker <code class="docutils literal notranslate"><span class="pre">initial_data.py</span></code> under the comment:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="c1"># add any additional database creation steps here - but only if you</span>
<span class="c1"># haven't initialised the database with the admin "initialise" command</span>
</pre>
         </div> 
        </div> 
        <p>Add:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="n">category</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">getclass</span><span class="p">(</span><span class="s1">'category'</span><span class="p">)</span>
<span class="n">category</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"scipy"</span><span class="p">)</span>
<span class="n">category</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"chaco"</span><span class="p">)</span>
<span class="n">category</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"weave"</span><span class="p">)</span>
</pre>
         </div> 
        </div> 
        <p id="index-44">If the database has already been initalised, then you need to use the <code class="docutils literal notranslate"><span class="pre">roundup-admin</span></code> tool:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span>% roundup-admin -i &lt;tracker home&gt;
Roundup &lt;version&gt; ready for input.
Type "help" for help.
roundup&gt; create category name=scipy
1
roundup&gt; create category name=chaco
2
roundup&gt; create category name=weave
3
roundup&gt; exit...
There are unsaved changes. Commit them (y/N)? y
</pre>
         </div> 
        </div> 
       </div> 
       <div class="section" id="setting-up-security-on-the-new-objects"> 
        <h5>Setting up security on the new objects</h5> 
        <p>By default only the admin user can look at and change objects. This doesn’t suit us, as we want any user to be able to create new categories as required, and obviously everyone needs to be able to view the categories of issues for it to be useful.</p> 
        <p>We therefore need to change the security of the category objects. This is also done in <code class="docutils literal notranslate"><span class="pre">schema.py</span></code>.</p> 
        <p>There are currently two loops which set up permissions and then assign them to various roles. Simply add the new “category” to both lists:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="c1"># Assign the access and edit permissions for issue, file and message</span>
<span class="c1"># to regular users now</span>
<span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="s1">'issue'</span><span class="p">,</span> <span class="s1">'file'</span><span class="p">,</span> <span class="s1">'msg'</span><span class="p">,</span> <span class="s1">'category'</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">'View'</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="s1">'View'</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="s1">'Edit'</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="s1">'Create'</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
</pre>
         </div> 
        </div> 
        <p>These lines assign the “View” and “Edit” Permissions to the “User” role, so that normal users can view and edit “category” objects.</p> 
        <p>This is all the work that needs to be done for the database. It will store categories, and let users view and edit them. Now on to the interface stuff.</p> 
       </div> 
       <div class="section" id="changing-the-web-left-hand-frame"> 
        <h5>Changing the web left hand frame</h5> 
        <p>We need to give the users the ability to create new categories, and the place to put the link to this functionality is in the left hand function bar, under the “Issues” area. The file that defines how this area looks is <code class="docutils literal notranslate"><span class="pre">html/page.html</span></code>, which is what we are going to be editing next.</p> 
        <p>If you look at this file you can see that it contains a lot of “classblock” sections which are chunks of HTML that will be included or excluded in the output depending on whether the condition in the classblock is met. We are going to add the category code at the end of the classblock for the <em>issue</em> class:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="o">&lt;</span><span class="n">p</span> <span class="n">class</span><span class="o">=</span><span class="s2">"classblock"</span>
   <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"python:request.user.hasPermission('View', 'category')"</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">Categories</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;&lt;</span><span class="n">br</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">a</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"python:request.user.hasPermission('Edit', 'category')"</span>
    <span class="n">href</span><span class="o">=</span><span class="s2">"category?@template=item"</span><span class="o">&gt;</span><span class="n">New</span> <span class="n">Category</span><span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</pre>
         </div> 
        </div> 
        <p>The first two lines is the classblock definition, which sets up a condition that only users who have “View” permission for the “category” object will have this section included in their output. Next comes a plain “Categories” header in bold. Everyone who can view categories will get that.</p> 
        <p>Next comes the link to the editing area of categories. This link will only appear if the condition - that the user has “Edit” permissions for the “category” objects - is matched. If they do have permission then they will get a link to another page which will let the user add new categories.</p> 
        <p>Note that if you have permission to <em>view</em> but not to <em>edit</em> categories, then all you will see is a “Categories” header with nothing underneath it. This is obviously not very good interface design, but will do for now. I just claim that it is so I can add more links in this section later on. However, to fix the problem you could change the condition in the classblock statement, so that only users with “Edit” permission would see the “Categories” stuff.</p> 
       </div> 
       <div class="section" id="setting-up-a-page-to-edit-categories"> 
        <h5>Setting up a page to edit categories</h5> 
        <p>We defined code in the previous section which let users with the appropriate permissions see a link to a page which would let them edit conditions. Now we have to write that page.</p> 
        <p>The link was for the <em>item</em> template of the <em>category</em> object. This translates into Roundup looking for a file called <code class="docutils literal notranslate"><span class="pre">category.item.html</span></code> in the <code class="docutils literal notranslate"><span class="pre">html</span></code> tracker directory. This is the file that we are going to write now.</p> 
        <p>First, we add an info tag in a comment which doesn’t affect the outcome of the code at all, but is useful for debugging. If you load a page in a browser and look at the page source, you can see which sections come from which files by looking for these comments:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span>&lt;!-- category.item --&gt;
</pre>
         </div> 
        </div> 
        <p>Next we need to add in the METAL macro stuff so we get the normal page trappings:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="o">&lt;</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span> <span class="n">metal</span><span class="p">:</span><span class="n">use</span><span class="o">-</span><span class="n">macro</span><span class="o">=</span><span class="s2">"templates/page/macros/icing"</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">title</span> <span class="n">metal</span><span class="p">:</span><span class="n">fill</span><span class="o">-</span><span class="n">slot</span><span class="o">=</span><span class="s2">"head_title"</span><span class="o">&gt;</span><span class="n">Category</span> <span class="n">editing</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span> <span class="n">class</span><span class="o">=</span><span class="s2">"page-header-top"</span> <span class="n">metal</span><span class="p">:</span><span class="n">fill</span><span class="o">-</span><span class="n">slot</span><span class="o">=</span><span class="s2">"body_title"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">h2</span><span class="o">&gt;</span><span class="n">Category</span> <span class="n">editing</span><span class="o">&lt;/</span><span class="n">h2</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span> <span class="n">class</span><span class="o">=</span><span class="s2">"content"</span> <span class="n">metal</span><span class="p">:</span><span class="n">fill</span><span class="o">-</span><span class="n">slot</span><span class="o">=</span><span class="s2">"content"</span><span class="o">&gt;</span>
</pre>
         </div> 
        </div> 
        <p>Next we need to setup up a standard HTML form, which is the whole purpose of this file. We link to some handy javascript which sends the form through only once. This is to stop users hitting the send button multiple times when they are impatient and thus having the form sent multiple times:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">"POST"</span> <span class="n">onSubmit</span><span class="o">=</span><span class="s2">"return submit_once()"</span>
      <span class="n">enctype</span><span class="o">=</span><span class="s2">"multipart/form-data"</span><span class="o">&gt;</span>
</pre>
         </div> 
        </div> 
        <p>Next we define some code which sets up the minimum list of fields that we require the user to enter. There will be only one field - “name” - so they better put something in it, otherwise the whole form is pointless:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"@required"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"name"</span><span class="o">&gt;</span>
</pre>
         </div> 
        </div> 
        <p>To get everything to line up properly we will put everything in a table, and put a nice big header on it so the user has an idea what is happening:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="o">&lt;</span><span class="n">table</span> <span class="n">class</span><span class="o">=</span><span class="s2">"form"</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">th</span> <span class="n">class</span><span class="o">=</span><span class="s2">"header"</span> <span class="n">colspan</span><span class="o">=</span><span class="s2">"2"</span><span class="o">&gt;</span><span class="n">Category</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
</pre>
         </div> 
        </div> 
        <p>Next, we need the field into which the user is going to enter the new category. The <code class="docutils literal notranslate"><span class="pre">context.name.field(size=60)</span></code> bit tells Roundup to generate a normal HTML field of size 60, and the contents of that field will be the “name” variable of the current context (namely “category”). The upshot of this is that when the user types something in to the form, a new category will be created with that name:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Name</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"structure python:context.name.field(size=60)"</span><span class="o">&gt;</span>
 <span class="n">name</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
</pre>
         </div> 
        </div> 
        <p>Then a submit button so that the user can submit the new category:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span> <span class="n">colspan</span><span class="o">=</span><span class="s2">"3"</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"structure context/submit"</span><span class="o">&gt;</span>
  <span class="n">submit</span> <span class="n">button</span> <span class="n">will</span> <span class="n">go</span> <span class="n">here</span>
 <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
</pre>
         </div> 
        </div> 
        <p>The <code class="docutils literal notranslate"><span class="pre">context/submit</span></code> bit generates the submit button but also generates the @action and @csrf hidden fields. The @action field is used to tell roundup how to process the form. The @csrf field provides a unique single use token to defend against CSRF attacks. (More about anti-csrf measures can be found in <code class="docutils literal notranslate"><span class="pre">upgrading.txt</span></code>.)</p> 
        <p>Finally we finish off the tags we used at the start to do the METAL stuff:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span> <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span><span class="o">&gt;</span>
</pre>
         </div> 
        </div> 
        <p>So putting it all together, and closing the table and form we get:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span>&lt;!-- category.item --&gt;
&lt;tal:block metal:use-macro="templates/page/macros/icing"&gt;
 &lt;title metal:fill-slot="head_title"&gt;Category editing&lt;/title&gt;
 &lt;td class="page-header-top" metal:fill-slot="body_title"&gt;
  &lt;h2&gt;Category editing&lt;/h2&gt;
 &lt;/td&gt;
 &lt;td class="content" metal:fill-slot="content"&gt;
  &lt;form method="POST" onSubmit="return submit_once()"
        enctype="multipart/form-data"&gt;

   &lt;table class="form"&gt;
    &lt;tr&gt;&lt;th class="header" colspan="2"&gt;Category&lt;/th&gt;&lt;/tr&gt;

    &lt;tr&gt;
     &lt;th&gt;Name&lt;/th&gt;
     &lt;td tal:content="structure python:context.name.field(size=60)"&gt;
     name&lt;/td&gt;
    &lt;/tr&gt;

    &lt;tr&gt;
     &lt;td&gt;
       &amp;nbsp;
       &lt;input type="hidden" name="@required" value="name"&gt;
     &lt;/td&gt;
     &lt;td colspan="3" tal:content="structure context/submit"&gt;
      submit button will go here
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/table&gt;
  &lt;/form&gt;
 &lt;/td&gt;
&lt;/tal:block&gt;
</pre>
         </div> 
        </div> 
        <p>This is quite a lot to just ask the user one simple question, but there is a lot of setup for basically one line (the form line) to do its work. To add another field to “category” would involve one more line (well, maybe a few extra to get the formatting correct).</p> 
       </div> 
       <div class="section" id="adding-the-category-to-the-issue"> 
        <h5>Adding the category to the issue</h5> 
        <p>We now have the ability to create issues to our heart’s content, but that is pointless unless we can assign categories to issues. Just like the <code class="docutils literal notranslate"><span class="pre">html/category.item.html</span></code> file was used to define how to add a new category, the <code class="docutils literal notranslate"><span class="pre">html/issue.item.html</span></code> is used to define how a new issue is created.</p> 
        <p>Just like <code class="docutils literal notranslate"><span class="pre">category.issue.html</span></code>, this file defines a form which has a table to lay things out. It doesn’t matter where in the table we add new stuff, it is entirely up to your sense of aesthetics:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Category</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">span</span> <span class="n">tal</span><span class="p">:</span><span class="n">replace</span><span class="o">=</span><span class="s2">"structure context/category/field"</span> <span class="o">/&gt;</span>
 <span class="o">&lt;</span><span class="n">span</span> <span class="n">tal</span><span class="p">:</span><span class="n">replace</span><span class="o">=</span><span class="s2">"structure python:db.category.classhelp('name',</span>
             <span class="nb">property</span><span class="o">=</span><span class="s1">'category'</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s1">'200'</span><span class="p">)</span><span class="s2">" /&gt;</span>
<span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
</pre>
         </div> 
        </div> 
        <p>First, we define a nice header so that the user knows what the next section is, then the middle line does what we are most interested in. This <code class="docutils literal notranslate"><span class="pre">context/category/field</span></code> gets replaced by a field which contains the category in the current context (the current context being the new issue).</p> 
        <p>The classhelp lines generate a link (labelled “list”) to a popup window which contains the list of currently known categories.</p> 
       </div> 
       <div class="section" id="searching-on-categories"> 
        <h5>Searching on categories</h5> 
        <p>Now we can add categories, and create issues with categories. The next obvious thing that we would like to be able to do, would be to search for issues based on their category, so that, for example, anyone working on the web server could look at all issues in the category “Web”.</p> 
        <p>If you look for “Search Issues” in the <code class="docutils literal notranslate"><span class="pre">html/page.html</span></code> file, you will find that it looks something like <code class="docutils literal notranslate"><span class="pre">&lt;a</span> <span class="pre">href="issue?@template=search"&gt;Search</span> <span class="pre">Issues&lt;/a&gt;</span></code>. This shows us that when you click on “Search Issues” it will be looking for a <code class="docutils literal notranslate"><span class="pre">issue.search.html</span></code> file to display. So that is the file that we will change.</p> 
        <p>If you look at this file it should begin to seem familiar, although it does use some new macros. You can add the new category search code anywhere you like within that form:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="o">&lt;</span><span class="n">tr</span> <span class="n">tal</span><span class="p">:</span><span class="n">define</span><span class="o">=</span><span class="s2">"name string:category;</span>
                <span class="n">db_klass</span> <span class="n">string</span><span class="p">:</span><span class="n">category</span><span class="p">;</span>
                <span class="n">db_content</span> <span class="n">string</span><span class="p">:</span><span class="n">name</span><span class="p">;</span><span class="s2">"&gt;</span>
  <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Priority</span><span class="p">:</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span> <span class="n">metal</span><span class="p">:</span><span class="n">use</span><span class="o">-</span><span class="n">macro</span><span class="o">=</span><span class="s2">"search_select"</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span> <span class="n">metal</span><span class="p">:</span><span class="n">use</span><span class="o">-</span><span class="n">macro</span><span class="o">=</span><span class="s2">"column_input"</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span> <span class="n">metal</span><span class="p">:</span><span class="n">use</span><span class="o">-</span><span class="n">macro</span><span class="o">=</span><span class="s2">"sort_input"</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span> <span class="n">metal</span><span class="p">:</span><span class="n">use</span><span class="o">-</span><span class="n">macro</span><span class="o">=</span><span class="s2">"group_input"</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
</pre>
         </div> 
        </div> 
        <p>The definitions in the <code class="docutils literal notranslate"><span class="pre">&lt;tr&gt;</span></code> opening tag are used by the macros:</p> 
        <ul class="simple"> 
         <li><code class="docutils literal notranslate"><span class="pre">search_select</span></code> expands to a drop-down box with all categories using <code class="docutils literal notranslate"><span class="pre">db_klass</span></code> and <code class="docutils literal notranslate"><span class="pre">db_content</span></code>.</li> 
         <li><code class="docutils literal notranslate"><span class="pre">column_input</span></code> expands to a checkbox for selecting what columns should be displayed.</li> 
         <li><code class="docutils literal notranslate"><span class="pre">sort_input</span></code> expands to a radio button for selecting what property should be sorted on.</li> 
         <li><code class="docutils literal notranslate"><span class="pre">group_input</span></code> expands to a radio button for selecting what property should be grouped on.</li> 
        </ul> 
        <p>The category search code above would expand to the following:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Category</span><span class="p">:</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">select</span> <span class="n">name</span><span class="o">=</span><span class="s2">"category"</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">option</span> <span class="n">value</span><span class="o">=</span><span class="s2">""</span><span class="o">&gt;</span><span class="n">don</span><span class="s1">'t care&lt;/option&gt;</span>
      <span class="o">&lt;</span><span class="n">option</span> <span class="n">value</span><span class="o">=</span><span class="s2">""</span><span class="o">&gt;------------&lt;/</span><span class="n">option</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">option</span> <span class="n">value</span><span class="o">=</span><span class="s2">"1"</span><span class="o">&gt;</span><span class="n">scipy</span><span class="o">&lt;/</span><span class="n">option</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">option</span> <span class="n">value</span><span class="o">=</span><span class="s2">"2"</span><span class="o">&gt;</span><span class="n">chaco</span><span class="o">&lt;/</span><span class="n">option</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">option</span> <span class="n">value</span><span class="o">=</span><span class="s2">"3"</span><span class="o">&gt;</span><span class="n">weave</span><span class="o">&lt;/</span><span class="n">option</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">select</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"checkbox"</span> <span class="n">name</span><span class="o">=</span><span class="s2">":columns"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"category"</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"radio"</span> <span class="n">name</span><span class="o">=</span><span class="s2">":sort0"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"category"</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"radio"</span> <span class="n">name</span><span class="o">=</span><span class="s2">":group0"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"category"</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
</pre>
         </div> 
        </div> 
       </div> 
       <div class="section" id="adding-category-to-the-default-view"> 
        <h5>Adding category to the default view</h5> 
        <p>We can now add categories, add issues with categories, and search for issues based on categories. This is everything that we need to do; however, there is some more icing that we would like. I think the category of an issue is important enough that it should be displayed by default when listing all the issues.</p> 
        <p>Unfortunately, this is a bit less obvious than the previous steps. The code defining how the issues look is in <code class="docutils literal notranslate"><span class="pre">html/issue.index.html</span></code>. This is a large table with a form down at the bottom for redisplaying and so forth.</p> 
        <p>Firstly we need to add an appropriate header to the start of the table:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="o">&lt;</span><span class="n">th</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"request/show/category"</span><span class="o">&gt;</span><span class="n">Category</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
</pre>
         </div> 
        </div> 
        <p>The <em>condition</em> part of this statement is to avoid displaying the Category column if the user has selected not to see it.</p> 
        <p>The rest of the table is a loop which will go through every issue that matches the display criteria. The loop variable is “i” - which means that every issue gets assigned to “i” in turn.</p> 
        <p>The new part of code to display the category will look like this:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"request/show/category"</span>
    <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"i/category"</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
</pre>
         </div> 
        </div> 
        <p>The condition is the same as above: only display the condition when the user hasn’t asked for it to be hidden. The next part is to set the content of the cell to be the category part of “i” - the current issue.</p> 
        <p>Finally we have to edit <code class="docutils literal notranslate"><span class="pre">html/page.html</span></code> again. This time, we need to tell it that when the user clicks on “Unassigned Issues” or “All Issues”, the category column should be included in the resulting list. If you scroll down the page file, you can see the links with lots of options. The option that we are interested in is the <code class="docutils literal notranslate"><span class="pre">:columns=</span></code> one which tells roundup which fields of the issue to display. Simply add “category” to that list and it all should work.</p> 
       </div> 
      </div> 
      <div class="section" id="adding-a-time-log-to-your-issues"> 
       <h4><a class="toc-backref" href="#id110">Adding a time log to your issues</a></h4> 
       <p>We want to log the dates and amount of time spent working on issues, and be able to give a summary of the total time spent on a particular issue.</p> 
       <ol class="arabic"> 
        <li><p class="first">Add a new class to your tracker <code class="docutils literal notranslate"><span class="pre">schema.py</span></code>:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="c1"># storage for time logging</span>
<span class="n">timelog</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"timelog"</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="n">Interval</span><span class="p">())</span>
</pre>
          </div> 
         </div> <p>Note that we automatically get the date of the time log entry creation through the standard property “creation”.</p> <p>You will need to grant “Creation” permission to the users who are allowed to add timelog entries. You may do this with:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="s1">'Create'</span><span class="p">,</span> <span class="s1">'timelog'</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="s1">'View'</span><span class="p">,</span> <span class="s1">'timelog'</span><span class="p">)</span>
</pre>
          </div> 
         </div> <p>If users are also able to <em>edit</em> timelog entries, then also include:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="s1">'Edit'</span><span class="p">,</span> <span class="s1">'timelog'</span><span class="p">)</span>
</pre>
          </div> 
         </div> </li> 
       </ol> 
       <ol class="arabic" id="index-45" start="2"> 
        <li><p class="first">Link to the new class from your issue class (again, in <code class="docutils literal notranslate"><span class="pre">schema.py</span></code>):</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">issue</span> <span class="o">=</span> <span class="n">IssueClass</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"issue"</span><span class="p">,</span>
                <span class="n">assignedto</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"user"</span><span class="p">),</span> <span class="n">keyword</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">"keyword"</span><span class="p">),</span>
                <span class="n">priority</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"priority"</span><span class="p">),</span> <span class="n">status</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"status"</span><span class="p">),</span>
                <span class="n">times</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">"timelog"</span><span class="p">))</span>
</pre>
          </div> 
         </div> <p>the “times” property is the new link to the “timelog” class.</p> </li> 
        <li><p class="first">We’ll need to let people add in times to the issue, so in the web interface we’ll have a new entry field. This is a special field because unlike the other fields in the <code class="docutils literal notranslate"><span class="pre">issue.item</span></code> template, it affects a different item (a timelog item) and not the template’s item (an issue). We have a special syntax for form fields that affect items other than the template default item (see the cgi documentation on <a class="reference internal" href="#special-form-variables">special form variables</a>). In particular, we add a field to capture a new timelog item’s period:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Time</span> <span class="n">Log</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">3</span><span class="o">&gt;&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"text"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"timelog-1@period"</span> <span class="o">/&gt;</span>
  <span class="p">(</span><span class="n">enter</span> <span class="k">as</span> <span class="s1">'3y 1m 4d 2:40:02'</span> <span class="ow">or</span> <span class="n">parts</span> <span class="n">thereof</span><span class="p">)</span>
 <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> <p>and another hidden field that links that new timelog item (new because it’s marked as having id “-1”) to the issue item. It looks like this:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"@link@times"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"timelog-1"</span> <span class="o">/&gt;</span>
</pre>
          </div> 
         </div> <p>On submission, the “-1” timelog item will be created and assigned a real item id. The “times” property of the issue will have the new id added to it.</p> <p>The full entry will now look like this:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Time</span> <span class="n">Log</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">3</span><span class="o">&gt;&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"text"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"timelog-1@period"</span> <span class="o">/&gt;</span>
  <span class="p">(</span><span class="n">enter</span> <span class="k">as</span> <span class="s1">'3y 1m 4d 2:40:02'</span> <span class="ow">or</span> <span class="n">parts</span> <span class="n">thereof</span><span class="p">)</span>
  <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"@link@times"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"timelog-1"</span> <span class="o">/&gt;</span>
 <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> </li> 
        <li><p class="first">We want to display a total of the timelog times that have been accumulated for an issue. To do this, we’ll need to actually write some Python code, since it’s beyond the scope of PageTemplates to perform such calculations. We do this by adding a module <code class="docutils literal notranslate"><span class="pre">timespent.py</span></code> to the <code class="docutils literal notranslate"><span class="pre">extensions</span></code> directory in our tracker. The contents of this file is as follows:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="kn">from</span> <span class="nn">roundup</span> <span class="k">import</span> <span class="n">date</span>

<span class="k">def</span> <span class="nf">totalTimeSpent</span><span class="p">(</span><span class="n">times</span><span class="p">):</span>
    <span class="sd">''' Call me with a list of timelog items (which have an</span>
<span class="sd">        Interval "period" property)</span>
<span class="sd">    '''</span>
    <span class="n">total</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">Interval</span><span class="p">(</span><span class="s1">'0d'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">times</span><span class="p">:</span>
        <span class="n">total</span> <span class="o">+=</span> <span class="n">time</span><span class="o">.</span><span class="n">period</span><span class="o">.</span><span class="n">_value</span>
    <span class="k">return</span> <span class="n">total</span>

<span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="n">instance</span><span class="p">):</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">registerUtil</span><span class="p">(</span><span class="s1">'totalTimeSpent'</span><span class="p">,</span> <span class="n">totalTimeSpent</span><span class="p">)</span>
</pre>
          </div> 
         </div> <p>We will now be able to access the <code class="docutils literal notranslate"><span class="pre">totalTimeSpent</span></code> function via the <code class="docutils literal notranslate"><span class="pre">utils</span></code> variable in our templates, as shown in the next step.</p> </li> 
        <li><p class="first">Display the timelog for an issue:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">table</span> <span class="n">class</span><span class="o">=</span><span class="s2">"otherinfo"</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"context/times"</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">th</span> <span class="n">colspan</span><span class="o">=</span><span class="s2">"3"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"header"</span><span class="o">&gt;</span><span class="n">Time</span> <span class="n">Log</span>
  <span class="o">&lt;</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span>
       <span class="n">tal</span><span class="p">:</span><span class="n">replace</span><span class="o">=</span><span class="s2">"python:utils.totalTimeSpent(context.times)"</span> <span class="o">/&gt;</span>
 <span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Date</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Period</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Logged</span> <span class="n">By</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">tr</span> <span class="n">tal</span><span class="p">:</span><span class="n">repeat</span><span class="o">=</span><span class="s2">"time context/times"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"time/creation"</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"time/period"</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"time/creator"</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> <p>I put this just above the Messages log in my issue display. Note our use of the <code class="docutils literal notranslate"><span class="pre">totalTimeSpent</span></code> method which will total up the times for the issue and return a new Interval. That will be automatically displayed in the template as text like “+ 1y 2:40” (1 year, 2 hours and 40 minutes).</p> </li> 
        <li><p class="first">If you’re using a persistent web server - <code class="docutils literal notranslate"><span class="pre">roundup-server</span></code> or <code class="docutils literal notranslate"><span class="pre">mod_wsgi</span></code> for example - then you’ll need to restart that to pick up the code changes. When that’s done, you’ll be able to use the new time logging interface.</p> </li> 
       </ol> 
       <p>An extension of this modification attaches the timelog entries to any change message entered at the time of the timelog entry:</p> 
       <ol class="upperalpha"> 
        <li><p class="first">Add a link to the timelog to the msg class in <code class="docutils literal notranslate"><span class="pre">schema.py</span></code>:</p> 
         <blockquote> 
          <div>
           <dl class="docutils"> 
            <dt>
             msg = FileClass(db, “msg”,
            </dt> 
            <dd>
             <p class="first last">author=Link(“user”, do_journal=’no’), recipients=Multilink(“user”, do_journal=’no’), date=Date(), summary=String(), files=Multilink(“file”), messageid=String(), inreplyto=String(), times=Multilink(“timelog”))</p> 
            </dd> 
           </dl> 
          </div>
         </blockquote> </li> 
        <li><p class="first">Add a new hidden field that links that new timelog item (new because it’s marked as having id “-1”) to the new message. The link is placed in <code class="docutils literal notranslate"><span class="pre">issue.item.html</span></code> in the same section that handles the timelog entry.</p> <p>It looks like this after this addition:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Time</span> <span class="n">Log</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">3</span><span class="o">&gt;&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"text"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"timelog-1@period"</span> <span class="o">/&gt;</span>
  <span class="p">(</span><span class="n">enter</span> <span class="k">as</span> <span class="s1">'3y 1m 4d 2:40:02'</span> <span class="ow">or</span> <span class="n">parts</span> <span class="n">thereof</span><span class="p">)</span>
  <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"@link@times"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"timelog-1"</span> <span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"msg-1@link@times"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"timelog-1"</span> <span class="o">/&gt;</span>
 <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> <p>The “times” property of the message will have the new id added to it.</p> </li> 
        <li><p class="first">Add the timelog listing from step 5. to the <code class="docutils literal notranslate"><span class="pre">msg.item.html</span></code> template so that the timelog entry appears on the message view page. Note that the call to totalTimeSpent is not used here since there will only be one single timelog entry for each message.</p> <p>I placed it after the Date entry like this:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">th</span> <span class="n">i18n</span><span class="p">:</span><span class="n">translate</span><span class="o">=</span><span class="s2">""</span><span class="o">&gt;</span><span class="n">Date</span><span class="p">:</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"context/date"</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">table</span> <span class="n">class</span><span class="o">=</span><span class="s2">"otherinfo"</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"context/times"</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">th</span> <span class="n">colspan</span><span class="o">=</span><span class="s2">"3"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"header"</span><span class="o">&gt;</span><span class="n">Time</span> <span class="n">Log</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Date</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Period</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Logged</span> <span class="n">By</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">tr</span> <span class="n">tal</span><span class="p">:</span><span class="n">repeat</span><span class="o">=</span><span class="s2">"time context/times"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"time/creation"</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"time/period"</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"time/creator"</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">table</span> <span class="n">class</span><span class="o">=</span><span class="s2">"messages"</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> </li> 
       </ol> 
      </div> 
      <div class="section" id="tracking-different-types-of-issues"> 
       <h4><a class="toc-backref" href="#id111">Tracking different types of issues</a></h4> 
       <p>Sometimes you will want to track different types of issues - developer, customer support, systems, sales leads, etc. A single Roundup tracker is able to support multiple types of issues. This example demonstrates adding a system support issue class to a tracker.</p> 
       <ol class="arabic"> 
        <li><p class="first">Figure out what information you’re going to want to capture. OK, so this is obvious, but sometimes it’s better to actually sit down for a while and think about the schema you’re going to implement.</p> </li> 
        <li><p class="first">Add the new issue class to your tracker’s <code class="docutils literal notranslate"><span class="pre">schema.py</span></code>. Just after the “issue” class definition, add:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="c1"># list our systems</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"system"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span> <span class="n">order</span><span class="o">=</span><span class="n">Number</span><span class="p">())</span>
<span class="n">system</span><span class="o">.</span><span class="n">setkey</span><span class="p">(</span><span class="s2">"name"</span><span class="p">)</span>

<span class="c1"># store issues related to those systems</span>
<span class="n">support</span> <span class="o">=</span> <span class="n">IssueClass</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"support"</span><span class="p">,</span>
                <span class="n">assignedto</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"user"</span><span class="p">),</span> <span class="n">keyword</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">"keyword"</span><span class="p">),</span>
                <span class="n">status</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"status"</span><span class="p">),</span> <span class="n">deadline</span><span class="o">=</span><span class="n">Date</span><span class="p">(),</span>
                <span class="n">affects</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">"system"</span><span class="p">))</span>
</pre>
          </div> 
         </div> </li> 
        <li><p class="first">Copy the existing <code class="docutils literal notranslate"><span class="pre">issue.*</span></code> (item, search and index) templates in the tracker’s <code class="docutils literal notranslate"><span class="pre">html</span></code> to <code class="docutils literal notranslate"><span class="pre">support.*</span></code>. Edit them so they use the properties defined in the <code class="docutils literal notranslate"><span class="pre">support</span></code> class. Be sure to check for hidden form variables like “required” to make sure they have the correct set of required properties.</p> </li> 
        <li><p class="first">Edit the modules in the <code class="docutils literal notranslate"><span class="pre">detectors</span></code>, adding lines to their <code class="docutils literal notranslate"><span class="pre">init</span></code> functions where appropriate. Look for <code class="docutils literal notranslate"><span class="pre">audit</span></code> and <code class="docutils literal notranslate"><span class="pre">react</span></code> registrations on the <code class="docutils literal notranslate"><span class="pre">issue</span></code> class, and duplicate them for <code class="docutils literal notranslate"><span class="pre">support</span></code>.</p> </li> 
        <li><p class="first">Create a new sidebar box for the new support class. Duplicate the existing issues one, changing the <code class="docutils literal notranslate"><span class="pre">issue</span></code> class name to <code class="docutils literal notranslate"><span class="pre">support</span></code>.</p> </li> 
        <li><p class="first">Re-start your tracker and start using the new <code class="docutils literal notranslate"><span class="pre">support</span></code> class.</p> </li> 
       </ol> 
       <p>Optionally, you might want to restrict the users able to access this new class to just the users with a new “SysAdmin” Role. To do this, we add some security declarations:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'SysAdmin'</span><span class="p">,</span> <span class="s1">'View'</span><span class="p">,</span> <span class="s1">'support'</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'SysAdmin'</span><span class="p">,</span> <span class="s1">'Create'</span><span class="p">,</span> <span class="s1">'support'</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'SysAdmin'</span><span class="p">,</span> <span class="s1">'Edit'</span><span class="p">,</span> <span class="s1">'support'</span><span class="p">)</span>
</pre>
        </div> 
       </div> 
       <p>You would then (as an “admin” user) edit the details of the appropriate users, and add “SysAdmin” to their Roles list.</p> 
       <p>Alternatively, you might want to change the Edit/View permissions granted for the <code class="docutils literal notranslate"><span class="pre">issue</span></code> class so that it’s only available to users with the “System” or “Developer” Role, and then the new class you’re adding is available to all with the “User” Role.</p> 
      </div> 
     </div> 
     <div class="section" id="using-external-user-databases"> <span id="external-authentication"></span>
      <h3><a class="toc-backref" href="#id112">Using External User Databases</a></h3> 
      <div class="section" id="using-an-external-password-validation-source"> 
       <h4><a class="toc-backref" href="#id113">Using an external password validation source</a></h4> 
       <div class="admonition note"> 
        <p class="first admonition-title">Note</p> 
        <p class="last">You will need to either have an “admin” user in your external password source <em>or</em> have one of your regular users have the Admin Role assigned. If you need to assign the Role <em>after</em> making the changes below, you may use the <code class="docutils literal notranslate"><span class="pre">roundup-admin</span></code> program to edit a user’s details.</p> 
       </div> 
       <p>We have a centrally-managed password changing system for our users. This results in a UN*X passwd-style file that we use for verification of users. Entries in the file consist of <code class="docutils literal notranslate"><span class="pre">name:password</span></code> where the password is encrypted using the standard UN*X <code class="docutils literal notranslate"><span class="pre">crypt()</span></code> function (see the <code class="docutils literal notranslate"><span class="pre">crypt</span></code> module in your Python distribution). An example entry would be:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">admin</span><span class="p">:</span><span class="n">aamrgyQfDFSHw</span>
</pre>
        </div> 
       </div> 
       <p>Each user of Roundup must still have their information stored in the Roundup database - we just use the passwd file to check their password. To do this, we need to override the standard <code class="docutils literal notranslate"><span class="pre">verifyPassword</span></code> method defined in <code class="docutils literal notranslate"><span class="pre">roundup.cgi.actions.LoginAction</span></code> and register the new class. The following is added as <code class="docutils literal notranslate"><span class="pre">externalpassword.py</span></code> in the tracker <code class="docutils literal notranslate"><span class="pre">extensions</span></code> directory:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">crypt</span>
<span class="kn">from</span> <span class="nn">roundup.cgi.actions</span> <span class="k">import</span> <span class="n">LoginAction</span>

<span class="k">class</span> <span class="nc">ExternalPasswordLoginAction</span><span class="p">(</span><span class="n">LoginAction</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">verifyPassword</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userid</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="sd">'''Look through the file, line by line, looking for a</span>
<span class="sd">        name that matches.</span>
<span class="sd">        '''</span>
        <span class="c1"># get the user's username</span>
        <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">userid</span><span class="p">,</span> <span class="s1">'username'</span><span class="p">)</span>

        <span class="c1"># the passwords are stored in the "passwd.txt" file in the</span>
        <span class="c1"># tracker home</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">TRACKER_HOME</span><span class="p">,</span> <span class="s1">'passwd.txt'</span><span class="p">)</span>

        <span class="c1"># see if we can find a match</span>
        <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">':'</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span>
                                            <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]:</span>
            <span class="k">if</span> <span class="n">ent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">username</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">crypt</span><span class="o">.</span><span class="n">crypt</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">ent</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="n">ent</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># user doesn't exist in the file</span>
        <span class="k">return</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="n">instance</span><span class="p">):</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">registerAction</span><span class="p">(</span><span class="s1">'login'</span><span class="p">,</span> <span class="n">ExternalPasswordLoginAction</span><span class="p">)</span>
</pre>
        </div> 
       </div> 
       <p>You should also remove the redundant password fields from the <code class="docutils literal notranslate"><span class="pre">user.item</span></code> template.</p> 
      </div> 
      <div class="section" id="using-a-un-x-passwd-file-as-the-user-database"> 
       <h4><a class="toc-backref" href="#id114">Using a UN*X passwd file as the user database</a></h4> 
       <p>On some systems the primary store of users is the UN*X passwd file. It holds information on users such as their username, real name, password and primary user group.</p> 
       <p>Roundup can use this store as its primary source of user information, but it needs additional information too - email address(es), roundup Roles, vacation flags, roundup hyperdb item ids, etc. Also, “retired” users must still exist in the user database, unlike some passwd files in which the users are removed when they no longer have access to a system.</p> 
       <p>To make use of the passwd file, we therefore synchronise between the two user stores. We also use the passwd file to validate the user logins, as described in the previous example, <a class="reference internal" href="#using-an-external-password-validation-source">using an external password validation source</a>. We keep the user lists in sync using a fairly simple script that runs once a day, or several times an hour if more immediate access is needed. In short, it:</p> 
       <ol class="arabic simple"> 
        <li>parses the passwd file, finding usernames, passwords and real names,</li> 
        <li>compares that list to the current roundup user list:
         <ol class="loweralpha"> 
          <li>entries no longer in the passwd file are <em>retired</em></li> 
          <li>entries with mismatching real names are <em>updated</em></li> 
          <li>entries only exist in the passwd file are <em>created</em></li> 
         </ol> </li> 
        <li>send an email to administrators to let them know what’s been done.</li> 
       </ol> 
       <p>The retiring and updating are simple operations, requiring only a call to <code class="docutils literal notranslate"><span class="pre">retire()</span></code> or <code class="docutils literal notranslate"><span class="pre">set()</span></code>. The creation operation requires more information though - the user’s email address and their Roundup Roles. We’re going to assume that the user’s email address is the same as their login name, so we just append the domain name to that. The Roles are determined using the passwd group identifier - mapping their UN*X group to an appropriate set of Roles.</p> 
       <p>The script to perform all this, broken up into its main components, is as follows. Firstly, we import the necessary modules and open the tracker we’re to work on:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">smtplib</span>
<span class="kn">from</span> <span class="nn">roundup</span> <span class="k">import</span> <span class="n">instance</span><span class="p">,</span> <span class="n">date</span>

<span class="c1"># open the tracker</span>
<span class="n">tracker_home</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">tracker</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tracker_home</span><span class="p">)</span>
</pre>
        </div> 
       </div> 
       <p>Next we read in the <em>passwd</em> file from the tracker home:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="c1"># read in the users from the "passwd.txt" file</span>
<span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tracker_home</span><span class="p">,</span> <span class="s1">'passwd.txt'</span><span class="p">)</span>
<span class="n">users</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">':'</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]</span>
</pre>
        </div> 
       </div> 
       <p>Handle special users (those to ignore in the file, and those who don’t appear in the file):</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="c1"># users to not keep ever, pre-load with the users I know aren't</span>
<span class="c1"># "real" users</span>
<span class="n">ignore</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'ekmmon'</span><span class="p">,</span> <span class="s1">'bfast'</span><span class="p">,</span> <span class="s1">'csrmail'</span><span class="p">]</span>

<span class="c1"># users to keep - pre-load with the roundup-specific users</span>
<span class="n">keep</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'comment_pool'</span><span class="p">,</span> <span class="s1">'network_pool'</span><span class="p">,</span> <span class="s1">'admin'</span><span class="p">,</span> <span class="s1">'dev-team'</span><span class="p">,</span>
        <span class="s1">'cs_pool'</span><span class="p">,</span> <span class="s1">'anonymous'</span><span class="p">,</span> <span class="s1">'system_pool'</span><span class="p">,</span> <span class="s1">'automated'</span><span class="p">]</span>
</pre>
        </div> 
       </div> 
       <p>Now we map the UN*X group numbers to the Roles that users should have:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">roles</span> <span class="o">=</span> <span class="p">{</span>
 <span class="s1">'501'</span><span class="p">:</span> <span class="s1">'User,Tech'</span><span class="p">,</span>  <span class="c1"># tech</span>
 <span class="s1">'502'</span><span class="p">:</span> <span class="s1">'User'</span><span class="p">,</span>       <span class="c1"># finance</span>
 <span class="s1">'503'</span><span class="p">:</span> <span class="s1">'User,CSR'</span><span class="p">,</span>   <span class="c1"># customer service reps</span>
 <span class="s1">'504'</span><span class="p">:</span> <span class="s1">'User'</span><span class="p">,</span>       <span class="c1"># sales</span>
 <span class="s1">'505'</span><span class="p">:</span> <span class="s1">'User'</span><span class="p">,</span>       <span class="c1"># marketing</span>
<span class="p">}</span>
</pre>
        </div> 
       </div> 
       <p>Now we do all the work. Note that the body of the script (where we have the tracker database open) is wrapped in a <code class="docutils literal notranslate"><span class="pre">try</span></code> / <code class="docutils literal notranslate"><span class="pre">finally</span></code> clause, so that we always close the database cleanly when we’re finished. So, we now do all the work:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="c1"># open the database</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'admin'</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="c1"># store away messages to send to the tracker admins</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># loop over the users list read in from the passwd file</span>
    <span class="k">for</span> <span class="n">user</span><span class="p">,</span><span class="n">passw</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">gid</span><span class="p">,</span><span class="n">real</span><span class="p">,</span><span class="n">home</span><span class="p">,</span><span class="n">shell</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">ignore</span><span class="p">:</span>
            <span class="c1"># this user shouldn't appear in our tracker</span>
            <span class="k">continue</span>
        <span class="n">keep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># see if the user exists in the tracker</span>
            <span class="n">uid</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>

            <span class="c1"># yes, they do - now check the real name for correctness</span>
            <span class="k">if</span> <span class="n">real</span> <span class="o">!=</span> <span class="n">db</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="s1">'realname'</span><span class="p">):</span>
                <span class="n">db</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">realname</span><span class="o">=</span><span class="n">real</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'FIX </span><span class="si">%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1">'</span><span class="o">%</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">real</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c1"># nope, the user doesn't exist</span>
            <span class="n">db</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">realname</span><span class="o">=</span><span class="n">real</span><span class="p">,</span>
                <span class="n">address</span><span class="o">=</span><span class="s1">'</span><span class="si">%s</span><span class="s1">@ekit-inc.com'</span><span class="o">%</span><span class="n">user</span><span class="p">,</span> <span class="n">roles</span><span class="o">=</span><span class="n">roles</span><span class="p">[</span><span class="n">gid</span><span class="p">])</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'ADD </span><span class="si">%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)'</span><span class="o">%</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">real</span><span class="p">,</span> <span class="n">roles</span><span class="p">[</span><span class="n">gid</span><span class="p">]))</span>

    <span class="c1"># now check that all the users in the tracker are also in our</span>
    <span class="c1"># "keep" list - retire those who aren't</span>
    <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">list</span><span class="p">():</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="s1">'username'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keep</span><span class="p">:</span>
            <span class="n">db</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">retire</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'RET </span><span class="si">%s</span><span class="s1">'</span><span class="o">%</span><span class="n">user</span><span class="p">)</span>

    <span class="c1"># if we did work, then send email to the tracker admins</span>
    <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
        <span class="c1"># create the email</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">'''Subject: </span><span class="si">%s</span><span class="s1"> user database maintenance</span>

<span class="s1">        </span><span class="si">%s</span><span class="s1"></span>
<span class="s1">        '''</span><span class="o">%</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">TRACKER_NAME</span><span class="p">,</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>

        <span class="c1"># send the email</span>
        <span class="n">smtp</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">MAILHOST</span><span class="p">)</span>
        <span class="n">addr</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ADMIN_EMAIL</span>
        <span class="n">smtp</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

    <span class="c1"># now we're done - commit the changes</span>
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="c1"># always close the database cleanly</span>
    <span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre>
        </div> 
       </div> 
       <p>And that’s it!</p> 
      </div> 
      <div class="section" id="using-an-ldap-database-for-user-information"> 
       <h4><a class="toc-backref" href="#id115">Using an LDAP database for user information</a></h4> 
       <p>A script that reads users from an LDAP store using <a class="reference external" href="https://pypi.org/project/python-ldap/">https://pypi.org/project/python-ldap/</a> and then compares the list to the users in the roundup user database would be pretty easy to write. You’d then have it run once an hour / day (or on demand if you can work that into your LDAP store workflow). See the example <a class="reference internal" href="#using-a-un-x-passwd-file-as-the-user-database">Using a UN*X passwd file as the user database</a> for more information about doing this.</p> 
       <p>To authenticate off the LDAP store (rather than using the passwords in the Roundup user database) you’d use the same python-ldap module inside an extension to the cgi interface. You’d do this by overriding the method called <code class="docutils literal notranslate"><span class="pre">verifyPassword</span></code> on the <code class="docutils literal notranslate"><span class="pre">LoginAction</span></code> class in your tracker’s <code class="docutils literal notranslate"><span class="pre">extensions</span></code> directory (see <a class="reference internal" href="#using-an-external-password-validation-source">using an external password validation source</a>). The method is implemented by default as:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="k">def</span> <span class="nf">verifyPassword</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userid</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
    <span class="sd">''' Verify the password that the user has supplied</span>
<span class="sd">    '''</span>
    <span class="n">stored</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">userid</span><span class="p">,</span> <span class="s1">'password'</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">password</span> <span class="o">==</span> <span class="n">stored</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">password</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">stored</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre>
        </div> 
       </div> 
       <p>So you could reimplement this as something like:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="k">def</span> <span class="nf">verifyPassword</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userid</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
    <span class="sd">''' Verify the password that the user has supplied</span>
<span class="sd">    '''</span>
    <span class="c1"># look up some unique LDAP information about the user</span>
    <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">userid</span><span class="p">,</span> <span class="s1">'username'</span><span class="p">)</span>
    <span class="c1"># now verify the password supplied against the LDAP store</span>
</pre>
        </div> 
       </div> 
      </div> 
     </div> 
     <div class="section" id="changes-to-tracker-behaviour"> 
      <h3><a class="toc-backref" href="#id116">Changes to Tracker Behaviour</a></h3> 
      <div class="section" id="preventing-spam"> <span id="index-46"></span>
       <h4><a class="toc-backref" href="#id117">Preventing SPAM</a></h4> 
       <p>The following detector code may be installed in your tracker’s <code class="docutils literal notranslate"><span class="pre">detectors</span></code> directory. It will block any messages being created that have HTML attachments (a very common vector for spam and phishing) and any messages that have more than 2 HTTP URLs in them. Just copy the following into <code class="docutils literal notranslate"><span class="pre">detectors/anti_spam.py</span></code> in your tracker:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="kn">from</span> <span class="nn">roundup.exceptions</span> <span class="k">import</span> <span class="n">Reject</span>

<span class="k">def</span> <span class="nf">reject_html</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">cl</span><span class="p">,</span> <span class="n">nodeid</span><span class="p">,</span> <span class="n">newvalues</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">newvalues</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'text/html'</span><span class="p">:</span>
    <span class="k">raise</span> <span class="n">Reject</span><span class="p">(</span><span class="s1">'not allowed'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">reject_manylinks</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">cl</span><span class="p">,</span> <span class="n">nodeid</span><span class="p">,</span> <span class="n">newvalues</span><span class="p">):</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">newvalues</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">content</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">'http://'</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">raise</span> <span class="n">Reject</span><span class="p">(</span><span class="s1">'not allowed'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
    <span class="n">db</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">audit</span><span class="p">(</span><span class="s1">'create'</span><span class="p">,</span> <span class="n">reject_html</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">audit</span><span class="p">(</span><span class="s1">'create'</span><span class="p">,</span> <span class="n">reject_manylinks</span><span class="p">)</span>
</pre>
        </div> 
       </div> 
       <p>You may also wish to block image attachments if your tracker does not need that ability:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="k">if</span> <span class="n">newvalues</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'image/'</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">Reject</span><span class="p">(</span><span class="s1">'not allowed'</span><span class="p">)</span>
</pre>
        </div> 
       </div> 
      </div> 
      <div class="section" id="stop-nosy-messages-going-to-people-on-vacation"> 
       <h4><a class="toc-backref" href="#id118">Stop “nosy” messages going to people on vacation</a></h4> 
       <p>When users go on vacation and set up vacation email bouncing, you’ll start to see a lot of messages come back through Roundup “Fred is on vacation”. Not very useful, and relatively easy to stop.</p> 
       <ol class="arabic"> 
        <li><p class="first">add a “vacation” flag to your users:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"user"</span><span class="p">,</span>
           <span class="n">username</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>   <span class="n">password</span><span class="o">=</span><span class="n">Password</span><span class="p">(),</span>
           <span class="n">address</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>    <span class="n">realname</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
           <span class="n">phone</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>      <span class="n">organisation</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
           <span class="n">alternate_addresses</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
           <span class="n">roles</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span> <span class="n">queries</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">"query"</span><span class="p">),</span>
           <span class="n">vacation</span><span class="o">=</span><span class="n">Boolean</span><span class="p">())</span>
</pre>
          </div> 
         </div> </li> 
        <li><p class="first">So that users may edit the vacation flags, add something like the following to your <code class="docutils literal notranslate"><span class="pre">user.item</span></code> template:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">On</span> <span class="n">Vacation</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"structure context/vacation/field"</span><span class="o">&gt;</span><span class="n">vacation</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> </li> 
        <li><p class="first">edit your detector <code class="docutils literal notranslate"><span class="pre">nosyreactor.py</span></code> so that the <code class="docutils literal notranslate"><span class="pre">nosyreaction()</span></code> consists of:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="k">def</span> <span class="nf">nosyreaction</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">cl</span><span class="p">,</span> <span class="n">nodeid</span><span class="p">,</span> <span class="n">oldvalues</span><span class="p">):</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">user</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">msg</span>
    <span class="c1"># send a copy of all new messages to the nosy list</span>
    <span class="k">for</span> <span class="n">msgid</span> <span class="ow">in</span> <span class="n">determineNewMessages</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span> <span class="n">nodeid</span><span class="p">,</span> <span class="n">oldvalues</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># figure the recipient ids</span>
            <span class="n">sendto</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">seen_message</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">recipients</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">msgid</span><span class="p">,</span> <span class="s1">'recipients'</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">recipid</span> <span class="ow">in</span> <span class="n">messages</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">msgid</span><span class="p">,</span> <span class="s1">'recipients'</span><span class="p">):</span>
                <span class="n">seen_message</span><span class="p">[</span><span class="n">recipid</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1"># figure the author's id, and indicate they've received</span>
            <span class="c1"># the message</span>
            <span class="n">authid</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">msgid</span><span class="p">,</span> <span class="s1">'author'</span><span class="p">)</span>

            <span class="c1"># possibly send the message to the author, as long as</span>
            <span class="c1"># they aren't anonymous</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">MESSAGES_TO_AUTHOR</span> <span class="o">==</span> <span class="s1">'yes'</span> <span class="ow">and</span>
                    <span class="n">users</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">authid</span><span class="p">,</span> <span class="s1">'username'</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">'anonymous'</span><span class="p">):</span>
                <span class="n">sendto</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">authid</span><span class="p">)</span>
            <span class="n">seen_message</span><span class="p">[</span><span class="n">authid</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1"># now figure the nosy people who weren't recipients</span>
            <span class="n">nosy</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">nodeid</span><span class="p">,</span> <span class="s1">'nosy'</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">nosyid</span> <span class="ow">in</span> <span class="n">nosy</span><span class="p">:</span>
                <span class="c1"># Don't send nosy mail to the anonymous user (that</span>
                <span class="c1"># user shouldn't appear in the nosy list, but just</span>
                <span class="c1"># in case they do...)</span>
                <span class="k">if</span> <span class="n">users</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">nosyid</span><span class="p">,</span> <span class="s1">'username'</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'anonymous'</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="c1"># make sure they haven't seen the message already</span>
                <span class="k">if</span> <span class="n">nosyid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen_message</span><span class="p">:</span>
                    <span class="c1"># send it to them</span>
                    <span class="n">sendto</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nosyid</span><span class="p">)</span>
                    <span class="n">recipients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nosyid</span><span class="p">)</span>

            <span class="c1"># generate a change note</span>
            <span class="k">if</span> <span class="n">oldvalues</span><span class="p">:</span>
                <span class="n">note</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">generateChangeNote</span><span class="p">(</span><span class="n">nodeid</span><span class="p">,</span> <span class="n">oldvalues</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">note</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">generateCreateNote</span><span class="p">(</span><span class="n">nodeid</span><span class="p">)</span>

            <span class="c1"># we have new recipients</span>
            <span class="k">if</span> <span class="n">sendto</span><span class="p">:</span>
                <span class="c1"># filter out the people on vacation</span>
                <span class="n">sendto</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sendto</span>
                          <span class="k">if</span> <span class="ow">not</span> <span class="n">users</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s1">'vacation'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>

                <span class="c1"># map userids to addresses</span>
                <span class="n">sendto</span> <span class="o">=</span> <span class="p">[</span><span class="n">users</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s1">'address'</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sendto</span><span class="p">]</span>

                <span class="c1"># update the message's recipients list</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">msgid</span><span class="p">,</span> <span class="n">recipients</span><span class="o">=</span><span class="n">recipients</span><span class="p">)</span>

                <span class="c1"># send the message</span>
                <span class="n">cl</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">nodeid</span><span class="p">,</span> <span class="n">msgid</span><span class="p">,</span> <span class="n">note</span><span class="p">,</span> <span class="n">sendto</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">roundupdb</span><span class="o">.</span><span class="n">MessageSendError</span> <span class="k">as</span> <span class="n">message</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">roundupdb</span><span class="o">.</span><span class="n">DetectorError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</pre>
          </div> 
         </div> <p>Note that this is the standard nosy reaction code, with the small addition of:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="c1"># filter out the people on vacation</span>
<span class="n">sendto</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sendto</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">users</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s1">'vacation'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
</pre>
          </div> 
         </div> <p>which filters out the users that have the vacation flag set to true.</p> </li> 
       </ol> 
      </div> 
      <div class="section" id="adding-in-state-transition-control"> 
       <h4><a class="toc-backref" href="#id119">Adding in state transition control</a></h4> 
       <p>Sometimes tracker admins want to control the states to which users may move issues. You can do this by following these steps:</p> 
       <ol class="arabic"> 
        <li><p class="first">make “status” a required variable. This is achieved by adding the following to the top of the form in the <code class="docutils literal notranslate"><span class="pre">issue.item.html</span></code> template:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"@required"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"status"</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> <p>This will force users to select a status.</p> </li> 
        <li><p class="first">add a Multilink property to the status class:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">stat</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"status"</span><span class="p">,</span> <span class="o">...</span> <span class="p">,</span> <span class="n">transitions</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s1">'status'</span><span class="p">),</span>
             <span class="o">...</span><span class="p">)</span>
</pre>
          </div> 
         </div> <p>and then edit the statuses already created, either:</p> 
         <ol class="loweralpha simple"> 
          <li>through the web using the class list -&gt; status class editor, or</li> 
          <li>using the <code class="docutils literal notranslate"><span class="pre">roundup-admin</span></code> “set” command.</li> 
         </ol> </li> 
        <li><p class="first">add an auditor module <code class="docutils literal notranslate"><span class="pre">checktransition.py</span></code> in your tracker’s <code class="docutils literal notranslate"><span class="pre">detectors</span></code> directory, for example:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="k">def</span> <span class="nf">checktransition</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">cl</span><span class="p">,</span> <span class="n">nodeid</span><span class="p">,</span> <span class="n">newvalues</span><span class="p">):</span>
    <span class="sd">''' Check that the desired transition is valid for the "status"</span>
<span class="sd">        property.</span>
<span class="sd">    '''</span>
    <span class="k">if</span> <span class="s1">'status'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">newvalues</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">current</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">nodeid</span><span class="p">,</span> <span class="s1">'status'</span><span class="p">)</span>
    <span class="n">new</span> <span class="o">=</span> <span class="n">newvalues</span><span class="p">[</span><span class="s1">'status'</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">new</span> <span class="o">==</span> <span class="n">current</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">ok</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="s1">'transitions'</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">new</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ok</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Status not allowed to move from "</span><span class="si">%s</span><span class="s1">" to "</span><span class="si">%s</span><span class="s1">"'</span><span class="o">%</span><span class="p">(</span>
            <span class="n">db</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">),</span> <span class="n">db</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">)))</span>

<span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
    <span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">audit</span><span class="p">(</span><span class="s1">'set'</span><span class="p">,</span> <span class="n">checktransition</span><span class="p">)</span>
</pre>
          </div> 
         </div> </li> 
        <li><p class="first">in the <code class="docutils literal notranslate"><span class="pre">issue.item.html</span></code> template, change the status editing bit from:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Status</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"structure context/status/menu"</span><span class="o">&gt;</span><span class="n">status</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> <p>to:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Status</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">select</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"context/id"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"status"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span> <span class="n">tal</span><span class="p">:</span><span class="n">define</span><span class="o">=</span><span class="s2">"ok context/status/transitions"</span>
             <span class="n">tal</span><span class="p">:</span><span class="n">repeat</span><span class="o">=</span><span class="s2">"state db/status/list"</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">option</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"python:state.id in ok"</span>
           <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"</span>
                <span class="n">value</span> <span class="n">state</span><span class="o">/</span><span class="nb">id</span><span class="p">;</span>
                <span class="n">selected</span> <span class="n">python</span><span class="p">:</span><span class="n">state</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">context</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">id</span><span class="s2">"</span>
           <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"state/name"</span><span class="o">&gt;&lt;/</span><span class="n">option</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">select</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"not:context/id"</span>
            <span class="n">tal</span><span class="p">:</span><span class="n">replace</span><span class="o">=</span><span class="s2">"structure context/status/menu"</span> <span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> <p>which displays only the allowed status to transition to.</p> </li> 
       </ol> 
      </div> 
      <div class="section" id="blocking-issues-that-depend-on-other-issues"> 
       <h4><a class="toc-backref" href="#id120">Blocking issues that depend on other issues</a></h4> 
       <p>We needed the ability to mark certain issues as “blockers” - that is, they can’t be resolved until another issue (the blocker) they rely on is resolved. To achieve this:</p> 
       <ol class="arabic"> 
        <li><p class="first">Create a new property on the <code class="docutils literal notranslate"><span class="pre">issue</span></code> class: <code class="docutils literal notranslate"><span class="pre">blockers=Multilink("issue")</span></code>. To do this, edit the definition of this class in your tracker’s <code class="docutils literal notranslate"><span class="pre">schema.py</span></code> file. Change this:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">issue</span> <span class="o">=</span> <span class="n">IssueClass</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"issue"</span><span class="p">,</span>
                <span class="n">assignedto</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"user"</span><span class="p">),</span> <span class="n">keyword</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">"keyword"</span><span class="p">),</span>
                <span class="n">priority</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"priority"</span><span class="p">),</span> <span class="n">status</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"status"</span><span class="p">))</span>
</pre>
          </div> 
         </div> <p>to this, adding the blockers entry:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">issue</span> <span class="o">=</span> <span class="n">IssueClass</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"issue"</span><span class="p">,</span>
                <span class="n">blockers</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">"issue"</span><span class="p">),</span>
                <span class="n">assignedto</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"user"</span><span class="p">),</span> <span class="n">keyword</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">"keyword"</span><span class="p">),</span>
                <span class="n">priority</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"priority"</span><span class="p">),</span> <span class="n">status</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">"status"</span><span class="p">))</span>
</pre>
          </div> 
         </div> </li> 
        <li><p class="first">Add the new <code class="docutils literal notranslate"><span class="pre">blockers</span></code> property to the <code class="docutils literal notranslate"><span class="pre">issue.item.html</span></code> edit page, using something like:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Waiting</span> <span class="n">On</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">span</span> <span class="n">tal</span><span class="p">:</span><span class="n">replace</span><span class="o">=</span><span class="s2">"structure python:context.blockers.field(showid=1,</span>
                              <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span><span class="s2">" /&gt;</span>
 <span class="o">&lt;</span><span class="n">span</span> <span class="n">tal</span><span class="p">:</span><span class="n">replace</span><span class="o">=</span><span class="s2">"structure python:db.issue.classhelp('id,title',</span>
                              <span class="nb">property</span><span class="o">=</span><span class="s1">'blockers'</span><span class="p">)</span><span class="s2">" /&gt;</span>
 <span class="o">&lt;</span><span class="n">span</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"context/blockers"</span>
       <span class="n">tal</span><span class="p">:</span><span class="n">repeat</span><span class="o">=</span><span class="s2">"blk context/blockers"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span><span class="n">View</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"href string:issue${blk/id}"</span>
               <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"blk/id"</span><span class="o">&gt;&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> <p>You’ll need to fiddle with your item page layout to find an appropriate place to put it - I’ll leave that fun part up to you. Just make sure it appears in the first table, possibly somewhere near the “superseders” field.</p> </li> 
        <li><p class="first">Create a new detector module (see below) which enforces the rules:</p> 
         <ul class="simple"> 
          <li>issues may not be resolved if they have blockers</li> 
          <li>when a blocker is resolved, it’s removed from issues it blocks</li> 
         </ul> <p>The contents of the detector should be something like this:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="k">def</span> <span class="nf">blockresolution</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">cl</span><span class="p">,</span> <span class="n">nodeid</span><span class="p">,</span> <span class="n">newvalues</span><span class="p">):</span>
    <span class="sd">''' If the issue has blockers, don't allow it to be resolved.</span>
<span class="sd">    '''</span>
    <span class="k">if</span> <span class="n">nodeid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">blockers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">blockers</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">nodeid</span><span class="p">,</span> <span class="s1">'blockers'</span><span class="p">)</span>
    <span class="n">blockers</span> <span class="o">=</span> <span class="n">newvalues</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'blockers'</span><span class="p">,</span> <span class="n">blockers</span><span class="p">)</span>

    <span class="c1"># don't do anything if there's no blockers or the status hasn't</span>
    <span class="c1"># changed</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">blockers</span> <span class="ow">or</span> <span class="s1">'status'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">newvalues</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># get the resolved state ID</span>
    <span class="n">resolved_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s1">'resolved'</span><span class="p">)</span>

    <span class="c1"># format the info</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">TRACKER_WEB</span>
    <span class="n">s</span> <span class="o">=</span> <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">'&lt;a href="</span><span class="si">%s</span><span class="s1">issue</span><span class="si">%s</span><span class="s1">"&gt;</span><span class="si">%s</span><span class="s1">&lt;/a&gt;'</span><span class="o">%</span><span class="p">(</span>
                    <span class="n">u</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="nb">id</span><span class="p">)</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">blockers</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">blockers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">'issue </span><span class="si">%s</span><span class="s1"> is'</span><span class="o">%</span><span class="n">s</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">'issues </span><span class="si">%s</span><span class="s1"> are'</span><span class="o">%</span><span class="n">s</span>

    <span class="c1"># ok, see if we're trying to resolve</span>
    <span class="k">if</span> <span class="n">newvalues</span><span class="p">[</span><span class="s1">'status'</span><span class="p">]</span> <span class="o">==</span> <span class="n">resolved_id</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"This issue can't be resolved until </span><span class="si">%s</span><span class="s2"> resolved."</span><span class="o">%</span><span class="n">s</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">resolveblockers</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">cl</span><span class="p">,</span> <span class="n">nodeid</span><span class="p">,</span> <span class="n">oldvalues</span><span class="p">):</span>
    <span class="sd">''' When we resolve an issue that's a blocker, remove it from the</span>
<span class="sd">        blockers list of the issue(s) it blocks.</span>
<span class="sd">    '''</span>
    <span class="n">newstatus</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">nodeid</span><span class="p">,</span><span class="s1">'status'</span><span class="p">)</span>

    <span class="c1"># no change?</span>
    <span class="k">if</span> <span class="n">oldvalues</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'status'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="n">newstatus</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">resolved_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s1">'resolved'</span><span class="p">)</span>

    <span class="c1"># interesting?</span>
    <span class="k">if</span> <span class="n">newstatus</span> <span class="o">!=</span> <span class="n">resolved_id</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># yes - find all the blocked issues, if any, and remove me from</span>
    <span class="c1"># their blockers list</span>
    <span class="n">issues</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">blockers</span><span class="o">=</span><span class="n">nodeid</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">issueid</span> <span class="ow">in</span> <span class="n">issues</span><span class="p">:</span>
        <span class="n">blockers</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">issueid</span><span class="p">,</span> <span class="s1">'blockers'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nodeid</span> <span class="ow">in</span> <span class="n">blockers</span><span class="p">:</span>
            <span class="n">blockers</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">nodeid</span><span class="p">)</span>
            <span class="n">cl</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">issueid</span><span class="p">,</span> <span class="n">blockers</span><span class="o">=</span><span class="n">blockers</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
    <span class="c1"># might, in an obscure situation, happen in a create</span>
    <span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">audit</span><span class="p">(</span><span class="s1">'create'</span><span class="p">,</span> <span class="n">blockresolution</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">audit</span><span class="p">(</span><span class="s1">'set'</span><span class="p">,</span> <span class="n">blockresolution</span><span class="p">)</span>

    <span class="c1"># can only happen on a set</span>
    <span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">react</span><span class="p">(</span><span class="s1">'set'</span><span class="p">,</span> <span class="n">resolveblockers</span><span class="p">)</span>
</pre>
          </div> 
         </div> <p>Put the above code in a file called “blockers.py” in your tracker’s “detectors” directory.</p> </li> 
        <li><p class="first">Finally, and this is an optional step, modify the tracker web page URLs so they filter out issues with any blockers. You do this by adding an additional filter on “blockers” for the value “-1”. For example, the existing “Show All” link in the “page” template (in the tracker’s “html” directory) looks like this:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">"#"</span>
   <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"href python:request.indexargs_url('issue', {</span>
  <span class="s1">'@sort'</span><span class="p">:</span> <span class="s1">'-activity'</span><span class="p">,</span>
  <span class="s1">'@group'</span><span class="p">:</span> <span class="s1">'priority'</span><span class="p">,</span>
  <span class="s1">'@filter'</span><span class="p">:</span> <span class="s1">'status'</span><span class="p">,</span>
  <span class="s1">'@columns'</span><span class="p">:</span> <span class="n">columns_showall</span><span class="p">,</span>
  <span class="s1">'@search_text'</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span>
  <span class="s1">'status'</span><span class="p">:</span> <span class="n">status_notresolved</span><span class="p">,</span>
  <span class="s1">'@dispname'</span><span class="p">:</span> <span class="n">i18n</span><span class="o">.</span><span class="n">gettext</span><span class="p">(</span><span class="s1">'Show All'</span><span class="p">),</span>
 <span class="p">})</span><span class="s2">"</span>
   <span class="n">i18n</span><span class="p">:</span><span class="n">translate</span><span class="o">=</span><span class="s2">""</span><span class="o">&gt;</span><span class="n">Show</span> <span class="n">All</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;</span><span class="n">br</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> <p>modify it to add the “blockers” info to the URL (note, both the “@filter” <em>and</em> “blockers” values must be specified):</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">"#"</span>
   <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"href python:request.indexargs_url('issue', {</span>
  <span class="s1">'@sort'</span><span class="p">:</span> <span class="s1">'-activity'</span><span class="p">,</span>
  <span class="s1">'@group'</span><span class="p">:</span> <span class="s1">'priority'</span><span class="p">,</span>
  <span class="s1">'@filter'</span><span class="p">:</span> <span class="s1">'status,blockers'</span><span class="p">,</span>
  <span class="s1">'@columns'</span><span class="p">:</span> <span class="n">columns_showall</span><span class="p">,</span>
  <span class="s1">'@search_text'</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span>
  <span class="s1">'status'</span><span class="p">:</span> <span class="n">status_notresolved</span><span class="p">,</span>
  <span class="s1">'blockers'</span><span class="p">:</span> <span class="s1">'-1'</span><span class="p">,</span>
  <span class="s1">'@dispname'</span><span class="p">:</span> <span class="n">i18n</span><span class="o">.</span><span class="n">gettext</span><span class="p">(</span><span class="s1">'Show All'</span><span class="p">),</span>
 <span class="p">})</span><span class="s2">"</span>
   <span class="n">i18n</span><span class="p">:</span><span class="n">translate</span><span class="o">=</span><span class="s2">""</span><span class="o">&gt;</span><span class="n">Show</span> <span class="n">All</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;</span><span class="n">br</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> <p>The above examples are line-wrapped on the trailing &amp; and should be unwrapped.</p> </li> 
       </ol> 
       <p>That’s it. You should now be able to set blockers on your issues. Note that if you want to know whether an issue has any other issues dependent on it (i.e. it’s in their blockers list) you can look at the journal history at the bottom of the issue page - look for a “link” event to another issue’s “blockers” property.</p> 
      </div> 
      <div class="section" id="add-users-to-the-nosy-list-based-on-the-keyword"> 
       <h4><a class="toc-backref" href="#id121">Add users to the nosy list based on the keyword</a></h4> 
       <p>Let’s say we need the ability to automatically add users to the nosy list based on the occurance of a keyword. Every user should be allowed to edit their own list of keywords for which they want to be added to the nosy list.</p> 
       <p>Below, we’ll show that this change can be done with minimal understanding of the Roundup system, using only copy and paste.</p> 
       <p>This requires three changes to the tracker: a change in the database to allow per-user recording of the lists of keywords for which he wants to be put on the nosy list, a change in the user view allowing them to edit this list of keywords, and addition of an auditor which updates the nosy list when a keyword is set.</p> 
       <div class="section" id="adding-the-nosy-keyword-list"> 
        <h5>Adding the nosy keyword list</h5> 
        <p>The change to make in the database, is that for any user there should be a list of keywords for which he wants to be put on the nosy list. Adding a <code class="docutils literal notranslate"><span class="pre">Multilink</span></code> of <code class="docutils literal notranslate"><span class="pre">keyword</span></code> seems to fullfill this. As such, all that has to be done is to add a new field to the definition of <code class="docutils literal notranslate"><span class="pre">user</span></code> within the file <code class="docutils literal notranslate"><span class="pre">schema.py</span></code>. We will call this new field <code class="docutils literal notranslate"><span class="pre">nosy_keywords</span></code>, and the updated definition of user will be:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">"user"</span><span class="p">,</span>
                <span class="n">username</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>   <span class="n">password</span><span class="o">=</span><span class="n">Password</span><span class="p">(),</span>
                <span class="n">address</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>    <span class="n">realname</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">phone</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>      <span class="n">organisation</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">alternate_addresses</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">queries</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s1">'query'</span><span class="p">),</span> <span class="n">roles</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">timezone</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">nosy_keywords</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s1">'keyword'</span><span class="p">))</span>
</pre>
         </div> 
        </div> 
       </div> 
       <div class="section" id="changing-the-user-view-to-allow-changing-the-nosy-keyword-list"> 
        <h5>Changing the user view to allow changing the nosy keyword list</h5> 
        <p>We want any user to be able to change the list of keywords for which he will by default be added to the nosy list. We choose to add this to the user view, as is generated by the file <code class="docutils literal notranslate"><span class="pre">html/user.item.html</span></code>. We can easily see that the keyword field in the issue view has very similar editing requirements as our nosy keywords, both being lists of keywords. As such, we look for Keywords in <code class="docutils literal notranslate"><span class="pre">issue.item.html</span></code>, and extract the associated parts from there. We add this to <code class="docutils literal notranslate"><span class="pre">user.item.html</span></code> at the bottom of the list of viewed items (i.e. just below the ‘Alternate E-mail addresses’ in the classic template):</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Nosy</span> <span class="n">Keywords</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">span</span> <span class="n">tal</span><span class="p">:</span><span class="n">replace</span><span class="o">=</span><span class="s2">"structure context/nosy_keywords/field"</span> <span class="o">/&gt;</span>
 <span class="o">&lt;</span><span class="n">span</span> <span class="n">tal</span><span class="p">:</span><span class="n">replace</span><span class="o">=</span><span class="s2">"structure python:db.keyword.classhelp(property='nosy_keywords')"</span> <span class="o">/&gt;</span>
 <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
</pre>
         </div> 
        </div> 
       </div> 
       <div class="section" id="addition-of-an-auditor-to-update-the-nosy-list"> 
        <h5>Addition of an auditor to update the nosy list</h5> 
        <p>The more difficult part is the logic to add the users to the nosy list when required. We choose to perform this action whenever the keywords on an item are set (this includes the creation of items). Here we choose to start out with a copy of the <code class="docutils literal notranslate"><span class="pre">detectors/nosyreaction.py</span></code> detector, which we copy to the file <code class="docutils literal notranslate"><span class="pre">detectors/nosy_keyword_reaction.py</span></code>. This looks like a good start as it also adds users to the nosy list. A look through the code reveals that the <code class="docutils literal notranslate"><span class="pre">nosyreaction</span></code> function actually sends the e-mail. We don’t need this. Therefore, we can change the <code class="docutils literal notranslate"><span class="pre">init</span></code> function to:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
    <span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">audit</span><span class="p">(</span><span class="s1">'create'</span><span class="p">,</span> <span class="n">update_kw_nosy</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">audit</span><span class="p">(</span><span class="s1">'set'</span><span class="p">,</span> <span class="n">update_kw_nosy</span><span class="p">)</span>
</pre>
         </div> 
        </div> 
        <p>After that, we rename the <code class="docutils literal notranslate"><span class="pre">updatenosy</span></code> function to <code class="docutils literal notranslate"><span class="pre">update_kw_nosy</span></code>. The first two blocks of code in that function relate to setting <code class="docutils literal notranslate"><span class="pre">current</span></code> to a combination of the old and new nosy lists. This functionality is left in the new auditor. The following block of code, which handled adding the assignedto user(s) to the nosy list in <code class="docutils literal notranslate"><span class="pre">updatenosy</span></code>, should be replaced by a block of code to add the interested users to the nosy list. We choose here to loop over all new keywords, than looping over all users, and assign the user to the nosy list when the keyword occurs in the user’s <code class="docutils literal notranslate"><span class="pre">nosy_keywords</span></code>. The next part in <code class="docutils literal notranslate"><span class="pre">updatenosy</span></code> – adding the author and/or recipients of a message to the nosy list – is obviously not relevant here and is thus deleted from the new auditor. The last part, copying the new nosy list to <code class="docutils literal notranslate"><span class="pre">newvalues</span></code>, can stay as is. This results in the following function:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="k">def</span> <span class="nf">update_kw_nosy</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">cl</span><span class="p">,</span> <span class="n">nodeid</span><span class="p">,</span> <span class="n">newvalues</span><span class="p">):</span>
    <span class="sd">'''Update the nosy list for changes to the keywords</span>
<span class="sd">    '''</span>
    <span class="c1"># nodeid will be None if this is a new node</span>
    <span class="n">current</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">nodeid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'new'</span><span class="p">,</span> <span class="s1">'yes'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'yes'</span><span class="p">,)</span>
        <span class="c1"># old node, get the current values from the node if they haven't</span>
        <span class="c1"># changed</span>
        <span class="k">if</span> <span class="s1">'nosy'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">newvalues</span><span class="p">:</span>
            <span class="n">nosy</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">nodeid</span><span class="p">,</span> <span class="s1">'nosy'</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">nosy</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current</span><span class="p">:</span>
                    <span class="n">current</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># if the nosy list changed in this transaction, init from the new value</span>
    <span class="k">if</span> <span class="s1">'nosy'</span> <span class="ow">in</span> <span class="n">newvalues</span><span class="p">:</span>
        <span class="n">nosy</span> <span class="o">=</span> <span class="n">newvalues</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'nosy'</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">nosy</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">db</span><span class="o">.</span><span class="n">hasnode</span><span class="p">(</span><span class="s1">'user'</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current</span><span class="p">:</span>
                <span class="n">current</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># add users with keyword in nosy_keywords to the nosy list</span>
    <span class="k">if</span> <span class="s1">'keyword'</span> <span class="ow">in</span> <span class="n">newvalues</span> <span class="ow">and</span> <span class="n">newvalues</span><span class="p">[</span><span class="s1">'keyword'</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">keyword_ids</span> <span class="o">=</span> <span class="n">newvalues</span><span class="p">[</span><span class="s1">'keyword'</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">keyword_ids</span><span class="p">:</span>
            <span class="c1"># loop over all users,</span>
            <span class="c1"># and assign user to nosy when keyword in nosy_keywords</span>
            <span class="k">for</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">list</span><span class="p">():</span>
                <span class="n">nosy_kw</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="s2">"nosy_keywords"</span><span class="p">)</span>
                <span class="n">found</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">nosy_kw</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">kw</span> <span class="o">==</span> <span class="n">keyword</span><span class="p">:</span>
                        <span class="n">found</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
                    <span class="n">current</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># that's it, save off the new nosy list</span>
    <span class="n">newvalues</span><span class="p">[</span><span class="s1">'nosy'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre>
         </div> 
        </div> 
        <p>These two function are the only ones needed in the file.</p> 
        <p>TODO: update this example to use the <code class="docutils literal notranslate"><span class="pre">find()</span></code> Class method.</p> 
       </div> 
       <div class="section" id="caveats"> 
        <h5>Caveats</h5> 
        <p>A few problems with the design here can be noted:</p> 
        <dl class="docutils"> 
         <dt>
          Multiple additions
         </dt> 
         <dd>
          <p class="first">When a user, after automatic selection, is manually removed from the nosy list, he is added to the nosy list again when the keyword list of the issue is updated. A better design might be to only check which keywords are new compared to the old list of keywords, and only add users when they have indicated interest on a new keyword.</p> 
          <p class="last">The code could also be changed to only trigger on the <code class="docutils literal notranslate"><span class="pre">create()</span></code> event, rather than also on the <code class="docutils literal notranslate"><span class="pre">set()</span></code> event, thus only setting the nosy list when the issue is created.</p> 
         </dd> 
         <dt>
          Scalability
         </dt> 
         <dd>
          In the auditor, there is a loop over all users. For a site with only few users this will pose no serious problem; however, with many users this will be a serious performance bottleneck. A way out would be to link from the keywords to the users who selected these keywords as nosy keywords. This will eliminate the loop over all users. See the <code class="docutils literal notranslate"><span class="pre">rev_multilink</span></code> attribute to make this easier.
         </dd> 
        </dl> 
       </div> 
      </div> 
      <div class="section" id="restricting-updates-that-arrive-by-email"> 
       <h4><a class="toc-backref" href="#id122">Restricting updates that arrive by email</a></h4> 
       <p>Roundup supports multiple update methods:</p> 
       <ol class="arabic simple"> 
        <li>command line</li> 
        <li>plain email</li> 
        <li>pgp signed email</li> 
        <li>web access</li> 
       </ol> 
       <p>in some cases you may need to prevent changes to properties by some of these methods. For example you can set up issues that are viewable only by people on the nosy list. So you must prevent unauthenticated changes to the nosy list.</p> 
       <p>Since plain email can be easily forged, it does not provide sufficient authentication in this senario.</p> 
       <p>To prevent this we can add a detector that audits the source of the transaction and rejects the update if it changes the nosy list.</p> 
       <p>Create the detector (auditor) module and add it to the detectors directory of your tracker:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="kn">from</span> <span class="nn">roundup</span> <span class="k">import</span> <span class="n">roundupdb</span><span class="p">,</span> <span class="n">hyperdb</span>

<span class="kn">from</span> <span class="nn">roundup.mailgw</span> <span class="k">import</span> <span class="n">Unauthorized</span>

<span class="k">def</span> <span class="nf">restrict_nosy_changes</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">cl</span><span class="p">,</span> <span class="n">nodeid</span><span class="p">,</span> <span class="n">newvalues</span><span class="p">):</span>
    <span class="sd">'''Do not permit changes to nosy via email.'''</span>

    <span class="k">if</span> <span class="s1">'nosy'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">newvalues</span><span class="p">:</span>
        <span class="c1"># the nosy field has not changed so no need to check.</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">tx_Source</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'web'</span><span class="p">,</span> <span class="s1">'rest'</span><span class="p">,</span> <span class="s1">'xmlrpc'</span><span class="p">,</span> <span class="s1">'email-sig-openpgp'</span><span class="p">,</span> <span class="s1">'cli'</span> <span class="p">]:</span>
        <span class="c1"># if the source of the transaction is from an authenticated</span>
        <span class="c1"># source or a privileged process allow the transaction.</span>
        <span class="c1"># Other possible sources: 'email'</span>
        <span class="k">return</span>

    <span class="c1"># otherwise raise an error</span>
    <span class="k">raise</span> <span class="n">Unauthorized</span><span class="p">(</span> \
        <span class="s1">'Changes to nosy property not allowed via </span><span class="si">%s</span><span class="s1"> for this issue.'</span><span class="o">%</span>\
        <span class="n">tx_Source</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
   <span class="sd">''' Install restrict_nosy_changes to run after other auditors.</span>

<span class="sd">       Allow initial creation email to set nosy.</span>
<span class="sd">       So don't execute: db.issue.audit('create', requestedbyauditor)</span>

<span class="sd">       Set priority to 110 to run this auditor after other auditors</span>
<span class="sd">       that can cause nosy to change.</span>
<span class="sd">   '''</span>
   <span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">audit</span><span class="p">(</span><span class="s1">'set'</span><span class="p">,</span> <span class="n">restrict_nosy_changes</span><span class="p">,</span> <span class="mi">110</span><span class="p">)</span>
</pre>
        </div> 
       </div> 
       <p>This detector (auditor) will prevent updates to the nosy field if it arrives by email. Since it runs after other auditors (due to the priority of 110), it will also prevent changes to the nosy field that are done by other auditors if triggered by an email.</p> 
       <p>Note that db.tx_Source was not present in roundup versions before 1.4.22, so you must be running a newer version to use this detector. Read the CHANGES.txt document in the roundup source code for further details on tx_Source.</p> 
      </div> 
     </div> 
     <div class="section" id="changes-to-security-and-permissions"> 
      <h3><a class="toc-backref" href="#id123">Changes to Security and Permissions</a></h3> 
      <div class="section" id="restricting-the-list-of-users-that-are-assignable-to-a-task"> 
       <h4><a class="toc-backref" href="#id124">Restricting the list of users that are assignable to a task</a></h4> 
       <ol class="arabic"> 
        <li><p class="first">In your tracker’s <code class="docutils literal notranslate"><span class="pre">schema.py</span></code>, create a new Role, say “Developer”:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addRole</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Developer'</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">'A developer'</span><span class="p">)</span>
</pre>
          </div> 
         </div> </li> 
        <li><p class="first">Just after that, create a new Permission, say “Fixer”, specific to “issue”:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Fixer'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'issue'</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">'User is allowed to be assigned to fix issues'</span><span class="p">)</span>
</pre>
          </div> 
         </div> </li> 
        <li><p class="first">Then assign the new Permission to your “Developer” Role:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'Developer'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre>
          </div> 
         </div> </li> 
        <li><p class="first">In the issue item edit page (<code class="docutils literal notranslate"><span class="pre">html/issue.item.html</span></code> in your tracker directory), use the new Permission in restricting the “assignedto” list:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">select</span> <span class="n">name</span><span class="o">=</span><span class="s2">"assignedto"</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">option</span> <span class="n">value</span><span class="o">=</span><span class="s2">"-1"</span><span class="o">&gt;-</span> <span class="n">no</span> <span class="n">selection</span> <span class="o">-&lt;/</span><span class="n">option</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span> <span class="n">tal</span><span class="p">:</span><span class="n">repeat</span><span class="o">=</span><span class="s2">"user db/user/list"</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">option</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"python:user.hasPermission(</span>
                            <span class="s1">'Fixer'</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">_classname</span><span class="p">)</span><span class="s2">"</span>
         <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"</span>
            <span class="n">value</span> <span class="n">user</span><span class="o">/</span><span class="nb">id</span><span class="p">;</span>
            <span class="n">selected</span> <span class="n">python</span><span class="p">:</span><span class="n">user</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">context</span><span class="o">.</span><span class="n">assignedto</span><span class="s2">"</span>
         <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"user/realname"</span><span class="o">&gt;&lt;/</span><span class="n">option</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">select</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> </li> 
       </ol> 
       <p>For extra security, you may wish to setup an auditor to enforce the Permission requirement (install this as <code class="docutils literal notranslate"><span class="pre">assignedtoFixer.py</span></code> in your tracker <code class="docutils literal notranslate"><span class="pre">detectors</span></code> directory):</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="k">def</span> <span class="nf">assignedtoMustBeFixer</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">cl</span><span class="p">,</span> <span class="n">nodeid</span><span class="p">,</span> <span class="n">newvalues</span><span class="p">):</span>
    <span class="sd">''' Ensure the assignedto value in newvalues is used with the</span>
<span class="sd">        Fixer Permission</span>
<span class="sd">    '''</span>
    <span class="k">if</span> <span class="s1">'assignedto'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">newvalues</span><span class="p">:</span>
        <span class="c1"># don't care</span>
        <span class="k">return</span>

    <span class="c1"># get the userid</span>
    <span class="n">userid</span> <span class="o">=</span> <span class="n">newvalues</span><span class="p">[</span><span class="s1">'assignedto'</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">hasPermission</span><span class="p">(</span><span class="s1">'Fixer'</span><span class="p">,</span> <span class="n">userid</span><span class="p">,</span> <span class="n">cl</span><span class="o">.</span><span class="n">classname</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'You do not have permission to edit </span><span class="si">%s</span><span class="s1">'</span><span class="o">%</span><span class="n">cl</span><span class="o">.</span><span class="n">classname</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
    <span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">audit</span><span class="p">(</span><span class="s1">'set'</span><span class="p">,</span> <span class="n">assignedtoMustBeFixer</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">audit</span><span class="p">(</span><span class="s1">'create'</span><span class="p">,</span> <span class="n">assignedtoMustBeFixer</span><span class="p">)</span>
</pre>
        </div> 
       </div> 
       <p>So now, if an edit action attempts to set “assignedto” to a user that doesn’t have the “Fixer” Permission, the error will be raised.</p> 
      </div> 
      <div class="section" id="users-may-only-edit-their-issues"> 
       <h4><a class="toc-backref" href="#id125">Users may only edit their issues</a></h4> 
       <p>In this case, users registering themselves are granted Provisional access, meaning they have access to edit the issues they submit, but not others. We create a new Role called “Provisional User” which is granted to newly-registered users, and has limited access. One of the Permissions they have is the new “Edit Own” on issues (regular users have “Edit”.)</p> 
       <p>First up, we create the new Role and Permission structure in <code class="docutils literal notranslate"><span class="pre">schema.py</span></code>:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="c1">#</span>
<span class="c1"># New users not approved by the admin</span>
<span class="c1">#</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addRole</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Provisional User'</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">'New user registered via web or email'</span><span class="p">)</span>

<span class="c1"># These users need to be able to view and create issues but only edit</span>
<span class="c1"># and view their own</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'Provisional User'</span><span class="p">,</span> <span class="s1">'Create'</span><span class="p">,</span> <span class="s1">'issue'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">own_issue</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">userid</span><span class="p">,</span> <span class="n">itemid</span><span class="p">):</span>
    <span class="sd">'''Determine whether the userid matches the creator of the issue.'''</span>
    <span class="k">return</span> <span class="n">userid</span> <span class="o">==</span> <span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">itemid</span><span class="p">,</span> <span class="s1">'creator'</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Edit'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'issue'</span><span class="p">,</span>
    <span class="n">check</span><span class="o">=</span><span class="n">own_issue</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">'Can only edit own issues'</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'Provisional User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'View'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'issue'</span><span class="p">,</span>
    <span class="n">check</span><span class="o">=</span><span class="n">own_issue</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">'Can only view own issues'</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'Provisional User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="c1"># This allows the interface to get the names of the properties</span>
<span class="c1"># in the issue. Used for selecting sorting and grouping</span>
<span class="c1"># on the index page.</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Search'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'issue'</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span> <span class="p">(</span><span class="s1">'Provisional User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>


<span class="c1"># Assign the Permissions for issue-related classes</span>
<span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="s1">'file'</span><span class="p">,</span> <span class="s1">'msg'</span><span class="p">,</span> <span class="s1">'query'</span><span class="p">,</span> <span class="s1">'keyword'</span><span class="p">:</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'Provisional User'</span><span class="p">,</span> <span class="s1">'View'</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'Provisional User'</span><span class="p">,</span> <span class="s1">'Edit'</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'Provisional User'</span><span class="p">,</span> <span class="s1">'Create'</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
<span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="s1">'priority'</span><span class="p">,</span> <span class="s1">'status'</span><span class="p">:</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'Provisional User'</span><span class="p">,</span> <span class="s1">'View'</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>

<span class="c1"># and give the new users access to the web and email interface</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'Provisional User'</span><span class="p">,</span> <span class="s1">'Web Access'</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'Provisional User'</span><span class="p">,</span> <span class="s1">'Email Access'</span><span class="p">)</span>

<span class="c1"># make sure they can view &amp; edit their own user record</span>
<span class="k">def</span> <span class="nf">own_record</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">userid</span><span class="p">,</span> <span class="n">itemid</span><span class="p">):</span>
    <span class="sd">'''Determine whether the userid matches the item being accessed.'''</span>
    <span class="k">return</span> <span class="n">userid</span> <span class="o">==</span> <span class="n">itemid</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'View'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'user'</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="n">own_record</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"User is allowed to view their own user details"</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'Provisional User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Edit'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'user'</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="n">own_record</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"User is allowed to edit their own user details"</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'Provisional User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre>
        </div> 
       </div> 
       <p>Then, in <code class="docutils literal notranslate"><span class="pre">config.ini</span></code>, we change the Role assigned to newly-registered users, replacing the existing <code class="docutils literal notranslate"><span class="pre">'User'</span></code> values:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="p">[</span><span class="n">main</span><span class="p">]</span>
<span class="o">...</span>
<span class="n">new_web_user_roles</span> <span class="o">=</span> <span class="n">Provisional</span> <span class="n">User</span>
<span class="n">new_email_user_roles</span> <span class="o">=</span> <span class="n">Provisional</span> <span class="n">User</span>
</pre>
        </div> 
       </div> 
      </div> 
      <div class="section" id="all-users-may-only-view-and-edit-issues-files-and-messages-they-create"> 
       <h4><a class="toc-backref" href="#id126">All users may only view and edit issues, files and messages they create</a></h4> 
       <p>Replace the standard “classic” tracker View and Edit Permission assignments for the “issue”, “file” and “msg” classes with the following:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="k">def</span> <span class="nf">checker</span><span class="p">(</span><span class="n">klass</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">userid</span><span class="p">,</span> <span class="n">itemid</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="n">klass</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">db</span><span class="o">.</span><span class="n">getclass</span><span class="p">(</span><span class="n">klass</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">itemid</span><span class="p">,</span> <span class="s1">'creator'</span><span class="p">)</span> <span class="o">==</span> <span class="n">userid</span>
    <span class="k">return</span> <span class="n">check</span>
<span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="s1">'issue'</span><span class="p">,</span> <span class="s1">'file'</span><span class="p">,</span> <span class="s1">'msg'</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'View'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="n">cl</span><span class="p">,</span>
        <span class="n">check</span><span class="o">=</span><span class="n">checker</span><span class="p">(</span><span class="n">cl</span><span class="p">),</span>
        <span class="n">description</span><span class="o">=</span><span class="s1">'User can view only if creator.'</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Edit'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="n">cl</span><span class="p">,</span>
        <span class="n">check</span><span class="o">=</span><span class="n">checker</span><span class="p">(</span><span class="n">cl</span><span class="p">),</span>
        <span class="n">description</span><span class="o">=</span><span class="s1">'User can edit only if creator.'</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="s1">'Create'</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
<span class="c1"># This allows the interface to get the names of the properties</span>
<span class="c1"># in the issue. Used for selecting sorting and grouping</span>
<span class="c1"># on the index page.</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'Search'</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">'issue'</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span> <span class="p">(</span><span class="s1">'User'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre>
        </div> 
       </div> 
      </div> 
      <div class="section" id="moderating-user-registration"> 
       <h4><a class="toc-backref" href="#id127">Moderating user registration</a></h4> 
       <p>You could set up new-user moderation in a public tracker by:</p> 
       <ol class="arabic simple"> 
        <li>creating a new highly-restricted user role “Pending”,</li> 
        <li>set the config new_web_user_roles and/or new_email_user_roles to that role,</li> 
        <li>have an auditor that emails you when new users are created with that role using roundup.mailer</li> 
        <li>edit the role to “User” for valid users.</li> 
       </ol> 
       <p>Some simple javascript might help in the last step. If you have high volume you could search for all currently-Pending users and do a bulk edit of all their roles at once (again probably with some simple javascript help).</p> 
      </div> 
     </div> 
     <div class="section" id="changes-to-the-web-user-interface"> 
      <h3><a class="toc-backref" href="#id128">Changes to the Web User Interface</a></h3> 
      <div class="section" id="adding-action-links-to-the-index-page"> 
       <h4><a class="toc-backref" href="#id129">Adding action links to the index page</a></h4> 
       <p>Add a column to the <code class="docutils literal notranslate"><span class="pre">item.index.html</span></code> template.</p> 
       <p>Resolving the issue:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span>&lt;a tal:attributes="href
   string:issue${i/id}?:status=resolved&amp;:action=edit"&gt;resolve&lt;/a&gt;
</pre>
        </div> 
       </div> 
       <p>“Take” the issue:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span>&lt;a tal:attributes="href
   string:issue${i/id}?:assignedto=${request/user/id}&amp;:action=edit"&gt;take&lt;/a&gt;
</pre>
        </div> 
       </div> 
       <p>… and so on.</p> 
      </div> 
      <div class="section" id="colouring-the-rows-in-the-issue-index-according-to-priority"> 
       <h4><a class="toc-backref" href="#id130">Colouring the rows in the issue index according to priority</a></h4> 
       <p>A simple <code class="docutils literal notranslate"><span class="pre">tal:attributes</span></code> statement will do the bulk of the work here. In the <code class="docutils literal notranslate"><span class="pre">issue.index.html</span></code> template, add this to the <code class="docutils literal notranslate"><span class="pre">&lt;tr&gt;</span></code> that displays the rows of data:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="o">&lt;</span><span class="n">tr</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"class string:priority-${i/priority/plain}"</span><span class="o">&gt;</span>
</pre>
        </div> 
       </div> 
       <p>and then in your stylesheet (<code class="docutils literal notranslate"><span class="pre">style.css</span></code>) specify the colouring for the different priorities, as follows:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="n">tr</span><span class="o">.</span><span class="n">priority</span><span class="o">-</span><span class="n">critical</span> <span class="n">td</span> <span class="p">{</span>
    <span class="n">background</span><span class="o">-</span><span class="n">color</span><span class="p">:</span> <span class="n">red</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">tr</span><span class="o">.</span><span class="n">priority</span><span class="o">-</span><span class="n">urgent</span> <span class="n">td</span> <span class="p">{</span>
    <span class="n">background</span><span class="o">-</span><span class="n">color</span><span class="p">:</span> <span class="n">orange</span><span class="p">;</span>
<span class="p">}</span>
</pre>
        </div> 
       </div> 
       <p>and so on, with far less offensive colours :)</p> 
      </div> 
      <div class="section" id="editing-multiple-items-in-an-index-view"> 
       <h4><a class="toc-backref" href="#id131">Editing multiple items in an index view</a></h4> 
       <p>To edit the status of all items in the item index view, edit the <code class="docutils literal notranslate"><span class="pre">issue.index.html</span></code>:</p> 
       <ol class="arabic"> 
        <li><p class="first">add a form around the listing table (separate from the existing index-page form), so at the top it reads:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">"POST"</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"action request/classname"</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">table</span> <span class="n">class</span><span class="o">=</span><span class="s2">"list"</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> <p>and at the bottom of that table:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span> <span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">form</span>
</pre>
          </div> 
         </div> <p>making sure you match the <code class="docutils literal notranslate"><span class="pre">&lt;/table&gt;</span></code> from the list table, not the navigation table or the subsequent form table.</p> </li> 
        <li><p class="first">in the display for the issue property, change:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"request/show/status"</span>
    <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"python:i.status.plain() or default"</span><span class="o">&gt;&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> <p>to:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"request/show/status"</span>
    <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"structure i/status/field"</span><span class="o">&gt;&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> <p>this will result in an edit field for the status property.</p> </li> 
        <li><p class="first">after the <code class="docutils literal notranslate"><span class="pre">tal:block</span></code> which lists the index items (marked by <code class="docutils literal notranslate"><span class="pre">tal:repeat="i</span> <span class="pre">batch"</span></code>) add a new table row:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"colspan python:len(request.columns)"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">input</span> <span class="n">name</span><span class="o">=</span><span class="s2">"@csrf"</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span>
       <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"value python:utils.anti_csrf_nonce()"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"submit"</span> <span class="n">value</span><span class="o">=</span><span class="s2">" Save Changes "</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"@action"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"edit"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span> <span class="n">replace</span><span class="o">=</span><span class="s2">"structure request/indexargs_form"</span> <span class="o">/&gt;</span>
 <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> <p>which gives us a submit button, indicates that we are performing an edit on any changed statuses, and provides a defense against cross site request forgery attacks.</p> <p>The final <code class="docutils literal notranslate"><span class="pre">tal:block</span></code> will make sure that the current index view parameters (filtering, columns, etc) will be used in rendering the next page (the results of the editing).</p> </li> 
       </ol> 
      </div> 
      <div class="section" id="displaying-only-message-summaries-in-the-issue-display"> 
       <h4><a class="toc-backref" href="#id132">Displaying only message summaries in the issue display</a></h4> 
       <p>Alter the <code class="docutils literal notranslate"><span class="pre">issue.item</span></code> template section for messages to:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="o">&lt;</span><span class="n">table</span> <span class="n">class</span><span class="o">=</span><span class="s2">"messages"</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"context/messages"</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">th</span> <span class="n">colspan</span><span class="o">=</span><span class="s2">"5"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"header"</span><span class="o">&gt;</span><span class="n">Messages</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">tr</span> <span class="n">tal</span><span class="p">:</span><span class="n">repeat</span><span class="o">=</span><span class="s2">"msg context/messages"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"href string:msg${msg/id}"</span>
         <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"string:msg${msg/id}"</span><span class="o">&gt;&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"msg/author"</span><span class="o">&gt;</span><span class="n">author</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span> <span class="n">class</span><span class="o">=</span><span class="s2">"date"</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"msg/date/pretty"</span><span class="o">&gt;</span><span class="n">date</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"msg/summary"</span><span class="o">&gt;</span><span class="n">summary</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">a</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"href string:?@remove@messages=${msg/id}&amp;@action=edit"</span><span class="o">&gt;</span>
   <span class="n">remove</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>
</pre>
        </div> 
       </div> 
      </div> 
      <div class="section" id="enabling-display-of-either-message-summaries-or-the-entire-messages"> 
       <h4><a class="toc-backref" href="#id133">Enabling display of either message summaries or the entire messages</a></h4> 
       <p>This is pretty simple - all we need to do is copy the code from the example <a class="reference internal" href="#displaying-only-message-summaries-in-the-issue-display">displaying only message summaries in the issue display</a> into our template alongside the summary display, and then introduce a switch that shows either the one or the other. We’ll use a new form variable, <code class="docutils literal notranslate"><span class="pre">@whole_messages</span></code> to achieve this:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="o">&lt;</span><span class="n">table</span> <span class="n">class</span><span class="o">=</span><span class="s2">"messages"</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"context/messages"</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"not:request/form/@whole_messages/value | python:0"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">th</span> <span class="n">colspan</span><span class="o">=</span><span class="s2">"3"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"header"</span><span class="o">&gt;</span><span class="n">Messages</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">th</span> <span class="n">colspan</span><span class="o">=</span><span class="s2">"2"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"header"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">"?@whole_messages=yes"</span><span class="o">&gt;</span><span class="n">show</span> <span class="n">entire</span> <span class="n">messages</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
      <span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">tr</span> <span class="n">tal</span><span class="p">:</span><span class="n">repeat</span><span class="o">=</span><span class="s2">"msg context/messages"</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"href string:msg${msg/id}"</span>
          <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"string:msg${msg/id}"</span><span class="o">&gt;&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"msg/author"</span><span class="o">&gt;</span><span class="n">author</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">td</span> <span class="n">class</span><span class="o">=</span><span class="s2">"date"</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"msg/date/pretty"</span><span class="o">&gt;</span><span class="n">date</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"msg/summary"</span><span class="o">&gt;</span><span class="n">summary</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">a</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"href string:?@remove@messages=${msg/id}&amp;@action=edit"</span><span class="o">&gt;</span><span class="n">remove</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span><span class="o">&gt;</span>

 <span class="o">&lt;</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"request/form/@whole_messages/value | python:0"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">th</span> <span class="n">colspan</span><span class="o">=</span><span class="s2">"2"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"header"</span><span class="o">&gt;</span><span class="n">Messages</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">th</span> <span class="n">class</span><span class="o">=</span><span class="s2">"header"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">"?@whole_messages="</span><span class="o">&gt;</span><span class="n">show</span> <span class="n">only</span> <span class="n">summaries</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
      <span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span> <span class="n">tal</span><span class="p">:</span><span class="n">repeat</span><span class="o">=</span><span class="s2">"msg context/messages"</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">th</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"msg/author"</span><span class="o">&gt;</span><span class="n">author</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">th</span> <span class="n">class</span><span class="o">=</span><span class="s2">"date"</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"msg/date/pretty"</span><span class="o">&gt;</span><span class="n">date</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">th</span> <span class="n">style</span><span class="o">=</span><span class="s2">"text-align: right"</span><span class="o">&gt;</span>
     <span class="p">(</span><span class="o">&lt;</span><span class="n">a</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"href string:?@remove@messages=${msg/id}&amp;@action=edit"</span><span class="o">&gt;</span><span class="n">remove</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">td</span> <span class="n">colspan</span><span class="o">=</span><span class="s2">"3"</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"msg/content"</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>
</pre>
        </div> 
       </div> 
      </div> 
      <div class="section" id="setting-up-a-wizard-or-druid-for-controlled-adding-of-issues"> 
       <h4><a class="toc-backref" href="#id134">Setting up a “wizard” (or “druid”) for controlled adding of issues</a></h4> 
       <ol class="arabic"> 
        <li><p class="first">Set up the page templates you wish to use for data input. My wizard is going to be a two-step process: first figuring out what category of issue the user is submitting, and then getting details specific to that category. The first page includes a table of help, explaining what the category names mean, and then the core of the form:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">"POST"</span> <span class="n">onSubmit</span><span class="o">=</span><span class="s2">"return submit_once()"</span>
      <span class="n">enctype</span><span class="o">=</span><span class="s2">"multipart/form-data"</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="nb">input</span> <span class="n">name</span><span class="o">=</span><span class="s2">"@csrf"</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span>
      <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"value python:utils.anti_csrf_nonce()"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"@template"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"add_page1"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"@action"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"page1_submit"</span><span class="o">&gt;</span>

  <span class="o">&lt;</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">Category</span><span class="p">:</span><span class="o">&lt;/</span><span class="n">strong</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span> <span class="n">tal</span><span class="p">:</span><span class="n">replace</span><span class="o">=</span><span class="s2">"structure context/category/menu"</span> <span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"submit"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"Continue"</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> <p>The next page has the usual issue entry information, with the addition of the following form fragments:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">"POST"</span> <span class="n">onSubmit</span><span class="o">=</span><span class="s2">"return submit_once()"</span>
      <span class="n">enctype</span><span class="o">=</span><span class="s2">"multipart/form-data"</span>
      <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"context/is_edit_ok"</span>
      <span class="n">tal</span><span class="p">:</span><span class="n">define</span><span class="o">=</span><span class="s2">"cat request/form/category/value"</span><span class="o">&gt;</span>

  <span class="o">&lt;</span><span class="nb">input</span> <span class="n">name</span><span class="o">=</span><span class="s2">"@csrf"</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span>
      <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"value python:utils.anti_csrf_nonce()"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"@template"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"add_page2"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"@required"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"title"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"category"</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">"value cat"</span><span class="o">&gt;</span>
   <span class="o">.</span>
   <span class="o">.</span>
   <span class="o">.</span>
<span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> <p>Note that later in the form, I use the value of “cat” to decide which form elements should be displayed. For example:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="o">&lt;</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"python:cat in '6 10 13 14 15 16 17'.split()"</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Operating</span> <span class="n">System</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"structure context/os/field"</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Web</span> <span class="n">Browser</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">"structure context/browser/field"</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tal</span><span class="p">:</span><span class="n">block</span><span class="o">&gt;</span>
</pre>
          </div> 
         </div> <p>… the above section will only be displayed if the category is one of 6, 10, 13, 14, 15, 16 or 17.</p> </li> 
       </ol> 
       <ol class="arabic" start="3"> 
        <li><p class="first">Determine what actions need to be taken between the pages - these are usually to validate user choices and determine what page is next. Now encode those actions in a new <code class="docutils literal notranslate"><span class="pre">Action</span></code> class (see <a class="reference internal" href="#defining-new-web-actions">defining new web actions</a>):</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="kn">from</span> <span class="nn">roundup.cgi.actions</span> <span class="k">import</span> <span class="n">Action</span>

<span class="k">class</span> <span class="nc">Page1SubmitAction</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">''' Verify that the user has selected a category, and then move</span>
<span class="sd">            on to page 2.</span>
<span class="sd">        '''</span>
        <span class="n">category</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">'category'</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s1">'-1'</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">add_error_message</span><span class="p">(</span><span class="s1">'You must select a category of report'</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1"># everything's ok, move on to the next page</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="s1">'add_page2'</span>

<span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="n">instance</span><span class="p">):</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">registerAction</span><span class="p">(</span><span class="s1">'page1_submit'</span><span class="p">,</span> <span class="n">Page1SubmitAction</span><span class="p">)</span>
</pre>
          </div> 
         </div> </li> 
        <li><p class="first">Use the usual “new” action as the <code class="docutils literal notranslate"><span class="pre">@action</span></code> on the final page, and you’re done (the standard context/submit method can do this for you).</p> </li> 
       </ol> 
      </div> 
      <div class="section" id="silent-submit"> 
       <h4><a class="toc-backref" href="#id135">Silent Submit</a></h4> 
       <p>When working on an issue, most of the time the people on the nosy list need to be notified of changes. There are cases where a user wants to add a comment to an issue and not bother other users on the nosy list. This feature is called Silent Submit because it allows the user to silently modify an issue and not tell anyone.</p> 
       <p>There are several parts to this change. The main activity part involves editing the stock detectors/nosyreaction.py file in your tracker. Insert the following lines near the top of the nosyreaction function:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="c1"># Did user click button to do a silent change?</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">web</span><span class="p">[</span><span class="s1">'submit'</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"silent_change"</span><span class="p">:</span>
        <span class="k">return</span>
<span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
    <span class="c1"># The web attribute or submit key don't exist.</span>
    <span class="c1"># That's fine. We were probably triggered by an email</span>
    <span class="c1"># or cli based change.</span>
    <span class="k">pass</span>
</pre>
        </div> 
       </div> 
       <p>This checks the submit button to see if it is the silent type. If there are exceptions trying to make that determination they are ignored and processing continues. You may wonder how db.web gets set. This is done by creating an extension. Add the file extensions/edit.py with this content:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="kn">from</span> <span class="nn">roundup.cgi.actions</span> <span class="k">import</span> <span class="n">EditItemAction</span>

<span class="k">class</span> <span class="nc">Edit2Action</span><span class="p">(</span><span class="n">EditItemAction</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">web</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># create the dict</span>
      <span class="c1"># populate the dict by getting the value of the submit_button</span>
      <span class="c1"># element from the form.</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">web</span><span class="p">[</span><span class="s1">'submit'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">'submit_button'</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

      <span class="c1"># call the core EditItemAction to process the edit.</span>
      <span class="n">EditItemAction</span><span class="o">.</span><span class="n">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="n">instance</span><span class="p">):</span>
  <span class="sd">'''Override the default edit action with this new version'''</span>
  <span class="n">instance</span><span class="o">.</span><span class="n">registerAction</span><span class="p">(</span><span class="s1">'edit'</span><span class="p">,</span> <span class="n">Edit2Action</span><span class="p">)</span>
</pre>
        </div> 
       </div> 
       <p>This code is a wrapper for the roundup EditItemAction. It checks the form’s submit button to save the value element. The rest of the changes needed for the Silent Submit feature involves editing html/issue.item.html to add the silent submit button. In the stock issue.item.html the submit button is on a line that contains “submit button”. Replace that line with something like the following:</p> 
       <div class="highlight-default notranslate">
        <div class="highlight">
         <pre><span></span><span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"submit"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"submit_button"</span>
       <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"context/is_edit_ok"</span>
       <span class="n">value</span><span class="o">=</span><span class="s2">"Submit Changes"</span><span class="o">&gt;&amp;</span><span class="n">nbsp</span><span class="p">;</span>
<span class="o">&lt;</span><span class="n">button</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"submit"</span> <span class="n">name</span><span class="o">=</span><span class="s2">"submit_button"</span>
        <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">"context/is_edit_ok"</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">"Click this to submit but not send nosy email."</span>
        <span class="n">value</span><span class="o">=</span><span class="s2">"silent_change"</span> <span class="n">i18n</span><span class="p">:</span><span class="n">translate</span><span class="o">=</span><span class="s2">""</span><span class="o">&gt;</span>
  <span class="n">Silent</span> <span class="n">Change</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
</pre>
        </div> 
       </div> 
       <p>Note the difference in the value attribute for the two submit buttons. The value “silent_change” in the button specification must match the string in the nosy reaction function.</p> 
      </div> 
     </div> 
    </div> 
    <div class="section" id="debugging-trackers"> 
     <h2><a class="toc-backref" href="#id62">Debugging Trackers</a></h2> 
     <p>There are three switches in tracker configs that turn on debugging in Roundup:</p> 
     <ol class="arabic simple"> 
      <li>web :: debug</li> 
      <li>mail :: debug</li> 
      <li>logging :: level</li> 
     </ol> 
     <p>See the config.ini file or the <a class="reference internal" href="#tracker-configuration">tracker configuration</a> section above for more information.</p> 
     <p>Additionally, the <code class="docutils literal notranslate"><span class="pre">roundup-server.py</span></code> script has its own debugging mode in which it reloads edited templates immediately when they are changed, rather than requiring a web server restart.</p> 
    </div> 
   </div> 
  </div> 
  <div class="footer"> 
   <div> <span class="source">[<a href="../_sources/docs/customizing.txt" rel="nofollow">page source</a>]</span> © Copyright 2009-2021, Richard Jones, Roundup-Team. 
   </div> 
   <div>
     Last updated on May 09, 2022. <span>Hosted by <a href="https://sourceforge.net"><img src="https://sflogo.sourceforge.net/sflogo.php?group_id=31577&amp;type=1" width="88" height="31" border="0" alt="SourceForge.net Logo"></a></span> 
   </div> 
  </div> 
  <script>
      /* locally hosted goatcounter https://www.goatcounter.com/ */
      /* include site info in path url to allow multiple sites to be
      tracked together */
      window.goatcounter = {
      path: function(p) { return location.host + p }
      }
    </script> 
  <script data-goatcounter="https://stats.rouilj.dynamic-dns.net/count" integrity="sha384-QGgNMMRFTi8ul5kHJ+vXysPe8gySvSA/Y3rpXZiRLzKPIw8CWY+a3ObKmQsyDr+a" async src="/_static/goatcounter_count.v3.js">
    </script>  
 </body>
</html>