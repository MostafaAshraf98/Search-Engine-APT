<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en"> 
 <head> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
  <title>Tune the system for benchmarks — pyperf 2.3.1 documentation</title> 
  <link rel="stylesheet" href="_static/alabaster.css" type="text/css"> 
  <link rel="stylesheet" href="_static/pygments.css" type="text/css"> 
  <link rel="stylesheet" type="text/css" href="https://assets.readthedocs.org/static/css/badge_only.css"> 
  <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script> 
  <script type="text/javascript" src="_static/jquery.js"></script> 
  <script type="text/javascript" src="_static/underscore.js"></script> 
  <script type="text/javascript" src="_static/doctools.js"></script> 
  <script type="text/javascript" src="_static/language_data.js"></script> 
  <script async type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-doc-embed.js"></script> 
  <link rel="canonical" href="https://pyperf.readthedocs.io/en/latest/system.html"> 
  <link rel="index" title="Index" href="genindex.html"> 
  <link rel="search" title="Search" href="search.html"> 
  <link rel="next" title="Perf Developer Guide" href="developer_guide.html"> 
  <link rel="prev" title="Runner CLI" href="runner.html"> 
  <link rel="stylesheet" href="_static/custom.css" type="text/css"> 
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9"> <!-- RTD Extra Head --> 
  <link rel="stylesheet" href="https://assets.readthedocs.org/static/css/readthedocs-doc-embed.css" type="text/css"> 
  <script type="application/json" id="READTHEDOCS_DATA">{"ad_free": false, "api_host": "https://readthedocs.org", "build_date": "2022-02-03T14:13:52Z", "builder": "sphinx", "canonical_url": null, "commit": "f6f16066", "docroot": "/doc/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "system", "programming_language": "py", "project": "pyperf", "proxied_api_host": "/_", "source_suffix": ".rst", "subprojects": {}, "theme": "alabaster", "user_analytics_code": "", "version": "latest"}</script> <!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
--> 
  <script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script> 
  <script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-analytics.js" async></script> <!-- end RTD <extrahead> --> 
 </head>
 <body> 
  <div class="document"> 
   <div class="documentwrapper"> 
    <div class="bodywrapper"> 
     <div class="body" role="main"> 
      <div class="section" id="tune-the-system-for-benchmarks"> <span id="system"></span>
       <h1>Tune the system for benchmarks<a class="headerlink" href="#tune-the-system-for-benchmarks" title="Permalink to this headline">¶</a></h1> 
       <div class="section" id="cpu-pinning-and-cpu-isolation"> <span id="pin-cpu"></span>
        <h2>CPU pinning and CPU isolation<a class="headerlink" href="#cpu-pinning-and-cpu-isolation" title="Permalink to this headline">¶</a></h2> 
        <p>On Linux with a multicore CPU, isolating at least 1 core has a significant impact on the stability of benchmarks. The <a class="reference external" href="https://vstinner.github.io/journey-to-stable-benchmark-system.html">My journey to stable benchmark, part 1 (system)</a> article explains how to tune Linux for this and shows the effect of CPU isolation and CPU pinning.</p> 
        <p>The pyperf <a class="reference internal" href="api.html#Runner" title="Runner"><code class="xref py py-class docutils literal notranslate"><span class="pre">Runner</span></code></a> class automatically pin worker processes to isolated CPUs (when isolated CPUs are detected). CPU pinning can be checked in benchmark metadata: it is enabled if the <code class="docutils literal notranslate"><span class="pre">cpu_affinity</span></code> <a class="reference internal" href="api.html#metadata"><span class="std std-ref">metadata</span></a> is set.</p> 
        <p><code class="xref py py-func docutils literal notranslate"><span class="pre">os.sched_setaffinity()</span></code> is used to pin processes.</p> 
        <p>Even if no CPU is isolated, CPU pining makes benchmarks more stable: use the <code class="docutils literal notranslate"><span class="pre">--affinity</span></code> command line option.</p> 
        <p>Check the CPU topology for HyperThreading and NUMA for best performances.</p> 
        <p>See also:</p> 
        <ul class="simple"> 
         <li><a class="reference external" href="https://jeremyeder.com/2013/11/15/nohz_fullgodmode/">nohz_full=godmode ?</a> (by Jeremy Eder, November 2013)</li> 
         <li><a class="reference external" href="http://skebanga.blogspot.it/2012/06/cset-shield-easily-configure-cpusets.html">cset shield - easily configure cpusets</a></li> 
         <li><a class="reference external" href="https://github.com/lpechacek/cpuset">cpuset</a></li> 
        </ul> 
       </div> 
       <div class="section" id="process-priority"> 
        <h2>Process priority<a class="headerlink" href="#process-priority" title="Permalink to this headline">¶</a></h2> 
        <p>On Windows, worker process are set to the highest priority: <code class="docutils literal notranslate"><span class="pre">REALTIME_PRIORITY_CLASS</span></code>. See the <a class="reference external" href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms686219(v=vs.85).aspx">SetPriorityClass function</a>.</p> 
       </div> 
       <div class="section" id="isolate-cpus-on-linux"> 
        <h2>Isolate CPUs on Linux<a class="headerlink" href="#isolate-cpus-on-linux" title="Permalink to this headline">¶</a></h2> 
        <div class="section" id="enable-isolcpus"> 
         <h3>Enable isolcpus<a class="headerlink" href="#enable-isolcpus" title="Permalink to this headline">¶</a></h3> 
         <p>Identify physical CPU cores (required for Intel Hyper-Threading CPUs):</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span>$ lscpu --extended
CPU NODE SOCKET CORE L1d:L1i:L2:L3 ONLINE MAXMHZ    MINMHZ
0   0    0      0    0:0:0:0       oui    5900,0000 1600,0000
1   0    0      1    1:1:1:0       oui    5900,0000 1600,0000
2   0    0      2    2:2:2:0       oui    5900,0000 1600,0000
3   0    0      3    3:3:3:0       oui    5900,0000 1600,0000
4   0    0      0    0:0:0:0       oui    5900,0000 1600,0000
5   0    0      1    1:1:1:0       oui    5900,0000 1600,0000
6   0    0      2    2:2:2:0       oui    5900,0000 1600,0000
7   0    0      3    3:3:3:0       oui    5900,0000 1600,0000
</pre>
          </div> 
         </div> 
         <p>I have a single CPU on a single socket. We will isolate physical cores 2 and 3, and logical CPUs 2, 3, 6 and 7. Be also careful of NUMA: here all physical cores are on the same NUMA node (0).</p> 
         <p>Reboot, enter GRUB and modify the Linux command line to add:</p> 
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">isolcpus</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span>
</pre>
          </div> 
         </div> 
        </div> 
        <div class="section" id="check-stability-of-a-benchmark"> 
         <h3>Check stability of a benchmark<a class="headerlink" href="#check-stability-of-a-benchmark" title="Permalink to this headline">¶</a></h3> 
         <p>Download the <a class="reference external" href="https://github.com/vstinner/misc/raw/master/bin/system_load.py">system_load.py</a>: script to simulate busy system, run enough dummy workers until the system load is higher than the minimum specified on the command line.</p> 
         <ul class="simple"> 
          <li>Prefix benchmark command with <code class="docutils literal notranslate"><span class="pre">taskset</span> <span class="pre">-c</span> <span class="pre">2,3,6,7</span></code> to run the benchmark on isolated CPUs</li> 
          <li>Run the benchmark on an idle system</li> 
          <li>Run the benchmark with <code class="docutils literal notranslate"><span class="pre">system_load.py</span> <span class="pre">5</span></code> running in a different window</li> 
         </ul> 
         <p>The two results must be close. Otherwise, CPU isolation doesn’t work.</p> 
         <p>You can also check the number of context switches by reading <code class="docutils literal notranslate"><span class="pre">/proc/pid/status</span></code>: read <code class="docutils literal notranslate"><span class="pre">voluntary_ctxt_switches</span></code> and <code class="docutils literal notranslate"><span class="pre">nonvoluntary_ctxt_switches</span></code>. It must be low on a CPU-bound benchmark.</p> 
         <p>On Linux, pyperf adds a <code class="docutils literal notranslate"><span class="pre">runnable_threads</span></code> metadata to runs: “number of currently runnable kernel scheduling entities (processes, threads)” (the value comes from the 4th field of <code class="docutils literal notranslate"><span class="pre">/proc/loadavg</span></code>).</p> 
         <p>See also the <a class="reference external" href="https://vstinner.github.io/perf-visualize-system-noise-with-cpu-isolation.html">Visualize the system noise using perf and CPU isolation</a> article (by Victor Stinner, June 2016).</p> 
        </div> 
       </div> 
       <div class="section" id="numa"> 
        <h2>NUMA<a class="headerlink" href="#numa" title="Permalink to this headline">¶</a></h2> 
        <p>In 2017, high performance Intel and AMD CPUs can have multiple nodes of CPU cores where each node is assigned to a memory region. The latency for a memory region depends on the CPU node. This configuration is called <a class="reference external" href="https://en.wikipedia.org/wiki/Non-uniform_memory_access">Non-uniform memory access: NUMA</a>.</p> 
        <p>Use <code class="docutils literal notranslate"><span class="pre">lscpu</span> <span class="pre">-a</span> <span class="pre">-e</span></code> command to list CPUs and their affected NUMA node.</p> 
        <p><a class="reference internal" href="#pin-cpu"><span class="std std-ref">CPU pinning</span></a> is very important on NUMA systems to get best performances.</p> 
        <p>See also the <code class="docutils literal notranslate"><span class="pre">numactl</span></code> command.</p> 
       </div> 
       <div class="section" id="features-of-intel-cpus"> 
        <h2>Features of Intel CPUs<a class="headerlink" href="#features-of-intel-cpus" title="Permalink to this headline">¶</a></h2> 
        <p>Modern Intel CPUs has many dynamic features impacting performances:</p> 
        <ul class="simple"> 
         <li>HyperThreading: run two threads per CPU code, share L1 caches</li> 
         <li>Turbo Boost: CPU frequency is optimized for best performances depending on the number of “active” cores, CPU temperature, etc.</li> 
         <li>P-state and C-state: the frequency of a CPU core frequency changes depending of C-state and P-state which are tuned by the operating system (by the kernel).</li> 
        </ul> 
        <p>Tools to measure CPU frequency, P-state and C-state:</p> 
        <ul class="simple"> 
         <li><code class="docutils literal notranslate"><span class="pre">turbostat</span></code></li> 
         <li><code class="docutils literal notranslate"><span class="pre">cpupower</span></code></li> 
         <li><a class="reference external" href="https://github.com/cyring/corefreq">corefreq</a></li> 
        </ul> 
        <p>On Fedora, type <code class="docutils literal notranslate"><span class="pre">dnf</span> <span class="pre">install</span> <span class="pre">-y</span> <span class="pre">kernel-tools</span></code> to install <code class="docutils literal notranslate"><span class="pre">turbostat</span></code> and <code class="docutils literal notranslate"><span class="pre">cpupower</span></code>.</p> 
        <p>See also:</p> 
        <ul class="simple"> 
         <li><a class="reference external" href="https://llvmdevelopersmeetingbay2016.sched.org/event/8YzY/causes-of-performance-instability-due-to-code-placement-in-x86">Causes of Performance Swings Due to Code Placement in IA</a> by Zia Ansari (Intel), November 2016.</li> 
         <li><a class="reference external" href="https://vstinner.github.io/intel-cpus.html">Intel CPUs: P-state, C-state, Turbo Boost, CPU frequency, etc.</a> by Victor Stinner, July 2016</li> 
         <li><a class="reference external" href="https://vstinner.github.io/intel-cpus-part2.html">Intel CPUs (part 2): Turbo Boost, temperature, frequency and Pstate C0 bug</a> by Victor Stinner, September 2016</li> 
        </ul> 
        <p>If <code class="docutils literal notranslate"><span class="pre">nohz_full</span></code> kernel option is used, the CPU frequency must be fixed, otherwise the CPU frequency will be unstable. See <a class="reference external" href="https://bugzilla.redhat.com/show_bug.cgi?id=1378529">Bug 1378529: intel_pstate driver doesn’t support NOHZ_FULL</a>.</p> 
        <p><a class="reference external" href="https://en.wikipedia.org/wiki/List_of_Intel_Core_i7_microprocessors">Intel i7 cores</a>:</p> 
        <ul class="simple"> 
         <li>Skylake: 6th generation</li> 
         <li>Broadwell: 5th generation</li> 
         <li>Haswell: 4th generation</li> 
         <li>Ivy Bridge: 3rd</li> 
         <li>Sandy Bridge: 2nd</li> 
         <li>Nehalem: 1st</li> 
        </ul> 
       </div> 
       <div class="section" id="operations-and-checks-of-the-pyperf-system-command"> <span id="system-cmd-ops"></span>
        <h2>Operations and checks of the pyperf system command<a class="headerlink" href="#operations-and-checks-of-the-pyperf-system-command" title="Permalink to this headline">¶</a></h2> 
        <div class="section" id="operations"> 
         <h3>Operations<a class="headerlink" href="#operations" title="Permalink to this headline">¶</a></h3> 
         <p>The <a class="reference internal" href="cli.html#system-cmd"><span class="std std-ref">pyperf system command</span></a> implements the following operations:</p> 
         <ul class="simple"> 
          <li>“CPU scaling governor (intel_pstate driver)”: Get/Set the CPU scaling governor. <code class="docutils literal notranslate"><span class="pre">tune</span></code> sets the governor to <code class="docutils literal notranslate"><span class="pre">performance</span></code>, <code class="docutils literal notranslate"><span class="pre">reset</span></code> sets the governor to <code class="docutils literal notranslate"><span class="pre">powersave</span></code>.</li> 
          <li>“CPU Frequency”: Read/Write <code class="docutils literal notranslate"><span class="pre">/sys/devices/system/cpu/cpuN/cpufreq/scaling_min_freq</span></code> sysfs. <code class="docutils literal notranslate"><span class="pre">tune</span></code> sets <code class="docutils literal notranslate"><span class="pre">scaling_min_freq</span></code> to the maximum frequency, <code class="docutils literal notranslate"><span class="pre">reset</span></code> resets <code class="docutils literal notranslate"><span class="pre">scaling_min_freq</span></code> to the minimum frequency.</li> 
          <li>“IRQ affinity”: Handle the state of the <code class="docutils literal notranslate"><span class="pre">irqbalance</span> <span class="pre">service</span></code>: <code class="docutils literal notranslate"><span class="pre">tune</span></code> stops the service, <code class="docutils literal notranslate"><span class="pre">reset</span></code> starts the service. Read/Write the CPU affinity of interruptions: <code class="docutils literal notranslate"><span class="pre">/proc/irq/default_smp_affinity</span></code> and <code class="docutils literal notranslate"><span class="pre">/proc/irq/N/smp_affinity</span></code> of all IRQs</li> 
          <li>“Perf event”: Use <code class="docutils literal notranslate"><span class="pre">/proc/sys/kernel/perf_event_max_sample_rate</span></code> to set the maximum sample rate of perf event to <code class="docutils literal notranslate"><span class="pre">1</span></code> for tune, or <code class="docutils literal notranslate"><span class="pre">100,000</span></code> for reset.</li> 
          <li>“Power supply”: check that the power cable is plugged. If the power cable is unplugged (a laptop running only on a battery), the CPU speed can change when the battery level becomes too low.</li> 
          <li>“Turbo Boost (MSR)”: use <code class="docutils literal notranslate"><span class="pre">/dev/cpu/N/msr</span></code> to read/write the Turbo Boost mode of Intel CPUs</li> 
          <li>“Turbo Boost (intel_pstate driver)”: read from/write into <code class="docutils literal notranslate"><span class="pre">/sys/devices/system/cpu/intel_pstate/no_turbo</span></code> to control the Turbo Boost mode of the Intel CPU using the <code class="docutils literal notranslate"><span class="pre">intel_pstate</span></code> driver</li> 
         </ul> 
         <p>“Turbo Boost (intel_pstate driver)” is used automatically if the CPU 0 uses the <code class="docutils literal notranslate"><span class="pre">intel_pstate</span></code> driver.</p> 
        </div> 
        <div class="section" id="checks"> 
         <h3>Checks<a class="headerlink" href="#checks" title="Permalink to this headline">¶</a></h3> 
         <p>The <a class="reference internal" href="cli.html#system-cmd"><span class="std std-ref">pyperf system command</span></a> implements the following checks:</p> 
         <ul class="simple"> 
          <li>“ASLR”: Check that Full randomization (<code class="docutils literal notranslate"><span class="pre">2</span></code>) is enabled in <code class="docutils literal notranslate"><span class="pre">/proc/sys/kernel/randomize_va_space</span></code></li> 
          <li>“Check nohz_full”: Make sure that nohz_full kernel option is not used with the CPU driver intel_pstate. The intel_pstate drive is incompatible with nohz_full: see <a class="reference external" href="https://bugzilla.redhat.com/show_bug.cgi?id=1378529">https://bugzilla.redhat.com/show_bug.cgi?id=1378529</a> bug report.</li> 
          <li>“Linux scheduler”: Check that CPUs are isolated using the <code class="docutils literal notranslate"><span class="pre">isolcpus=&lt;cpu</span> <span class="pre">list&gt;</span></code> parameter of the Linux kernel. Check that <code class="docutils literal notranslate"><span class="pre">rcu_nocbs=&lt;cpu</span> <span class="pre">list&gt;</span></code> parameter is used to no schedule RCU on isolated CPUs.</li> 
         </ul> 
        </div> 
       </div> 
       <div class="section" id="linux-documentation"> 
        <h2>Linux documentation<a class="headerlink" href="#linux-documentation" title="Permalink to this headline">¶</a></h2> 
        <ul class="simple"> 
         <li>CPUFreq: CPU frequency and voltage scaling code in the Linux kernel
          <ul> 
           <li><a class="reference external" href="https://www.kernel.org/doc/Documentation/cpu-freq/user-guide.txt">Linux CPUFreq User Guide</a></li> 
           <li><a class="reference external" href="https://www.kernel.org/doc/Documentation/cpu-freq/governors.txt">CPUFreq Governors</a></li> 
           <li><a class="reference external" href="https://www.kernel.org/doc/Documentation/cpu-freq/boost.txt">Processor boosting control</a></li> 
           <li><a class="reference external" href="https://www.kernel.org/doc/Documentation/cpu-freq/intel-pstate.txt">Intel P-State driver</a></li> 
          </ul> </li> 
         <li><a class="reference external" href="https://kernel.org/doc/Documentation/power/pm_qos_interface.txt">Power Management Quality Of Service Interface (PM QOS)</a> (<code class="docutils literal notranslate"><span class="pre">/dev/cpu_dma_latency</span></code> device)</li> 
         <li>CPU pinning, real-time:
          <ul> 
           <li><a class="reference external" href="https://www.kernel.org/doc/Documentation/IRQ-affinity.txt">SMP IRQ affinity</a></li> 
           <li><a class="reference external" href="https://www.kernel.org/doc/Documentation/timers/NO_HZ.txt">NO_HZ: Reducing Scheduling-Clock Ticks</a></li> 
          </ul> </li> 
        </ul> 
       </div> 
       <div class="section" id="macos"> 
        <h2>macOS<a class="headerlink" href="#macos" title="Permalink to this headline">¶</a></h2> 
        <p>Disable Turbo Boost of Intel CPUs:</p> 
        <ul class="simple"> 
         <li><a class="reference external" href="https://software.intel.com/en-us/articles/intel-power-gadget-20">Intel Power Gadget</a></li> 
         <li><a class="reference external" href="http://www.rugarciap.com/turbo-boost-switcher-for-os-x/">Turbo Boost Switcher for OS X</a></li> 
        </ul> 
       </div> 
       <div class="section" id="articles"> 
        <h2>Articles<a class="headerlink" href="#articles" title="Permalink to this headline">¶</a></h2> 
        <ul class="simple"> 
         <li>Intel: <a class="reference external" href="http://www.intel.com/content/dam/www/public/us/en/documents/white-papers/ia-32-ia-64-benchmark-code-execution-paper.pdf">How to Benchmark Code Execution Times on Intel ® IA-32 and IA -64 Instruction Set Architectures</a></li> 
         <li>Linux-RT: <a class="reference external" href="https://rt.wiki.kernel.org/index.php/HOWTO:_Build_an_RT-application">HOWTO: Build an RT-application</a></li> 
         <li>The <a class="reference external" href="https://rt.wiki.kernel.org/">Linux realtime wiki</a></li> 
        </ul> 
        <p>See also the <a class="reference external" href="https://github.com/softdevteam/krun/">Krun program</a> which tunes Linux and OpenBSD to run benchmarks.</p> 
       </div> 
       <div class="section" id="more-options"> 
        <h2>More options<a class="headerlink" href="#more-options" title="Permalink to this headline">¶</a></h2> 
        <p>The following options were not tested by pyperf developers.</p> 
        <ul class="simple"> 
         <li>Disable HyperThreading in the BIOS</li> 
         <li>Disable Turbo Boost in the BIOS</li> 
         <li>writeback:
          <ul> 
           <li>/sys/bus/workqueue/devices/writeback/cpumask</li> 
           <li>/sys/bus/workqueue/devices/writeback/numa</li> 
          </ul> </li> 
         <li><code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">i</span> <span class="pre">in</span> <span class="pre">$(pgrep</span> <span class="pre">rcu);</span> <span class="pre">do</span> <span class="pre">taskset</span> <span class="pre">-pc</span> <span class="pre">0</span> <span class="pre">$i</span> <span class="pre">;</span> <span class="pre">done</span></code> (is it useful if rcu_nocbs is already used?)</li> 
         <li>nohz_full=cpu_list: be careful of P-state/C-state bug (see below)</li> 
         <li>intel_pstate=disable: force the usage of the ACPI CPU driver</li> 
         <li>Non-maskable interrupts (NMI): add <code class="docutils literal notranslate"><span class="pre">nmi_watchdog=0</span> <span class="pre">nowatchdog</span> <span class="pre">nosoftlockup</span></code> to the Linux kernel command line</li> 
         <li>processor.max_cstate=1 idle=poll <a class="reference external" href="https://access.redhat.com/articles/65410">https://access.redhat.com/articles/65410</a> “You can disable all c-states by booting with idle=poll or just the deep ones with “processor.max_cstate=1”</li> 
         <li><code class="docutils literal notranslate"><span class="pre">/dev/cpu_dma_latency</span></code> can be used to prevent the CPU from entering deep C-states. Open the device, write a 32-bit <code class="docutils literal notranslate"><span class="pre">0</span></code> to it, then keep it open while your tests runs, close when you’re finished. See <a class="reference external" href="https://jeremyeder.com/2012/11/14/processor-max_cstate-intel_idle-max_cstate-and-devcpu_dma_latency/">processor.max_cstate, intel_idle.max_cstate and /dev/cpu_dma_latency</a>.</li> 
        </ul> 
        <p>Misc (untested) Linux commands:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="n">echo</span> <span class="s2">"Disable realtime bandwidth reservation"</span>
<span class="n">echo</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">sched_rt_runtime_us</span>

<span class="n">echo</span> <span class="s2">"Reduce hung_task_check_count"</span>
<span class="n">echo</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">hung_task_check_count</span>

<span class="n">echo</span> <span class="s2">"Disable software watchdog"</span>
<span class="n">echo</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">softlockup_thresh</span>

<span class="n">echo</span> <span class="s2">"Reduce vmstat polling"</span>
<span class="n">echo</span> <span class="mi">20</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">vm</span><span class="o">/</span><span class="n">stat_interval</span>
</pre>
         </div> 
        </div> 
        <p>If available on your kernel (CONFIG_NO_HZ=y and CONFIG_NO_HZ_FULL=y), you may also enable tickness kernel on these nodes. Add the following option to the command line:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span><span class="n">nohz_full</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span>
</pre>
         </div> 
        </div> 
        <p>Check that the Linux command line works:</p> 
        <div class="highlight-default notranslate">
         <div class="highlight">
          <pre><span></span>$ cat /sys/devices/system/cpu/isolated
2-3,6-7
$ cat /sys/devices/system/cpu/nohz_full
2-3,6-7
</pre>
         </div> 
        </div> 
        <p>Be careful of nohz_full using the intel_pstate CPU driver.</p> 
       </div> 
       <div class="section" id="notes"> 
        <h2>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h2> 
        <ul class="simple"> 
         <li>ASLR must <em>not</em> be disabled manually! (it’s enabled by default on Linux)</li> 
        </ul> 
       </div> 
      </div> 
     </div> 
    </div> 
   </div> 
   <div class="sphinxsidebar" role="navigation" aria-label="main navigation"> 
    <div class="sphinxsidebarwrapper"> 
     <h1 class="logo"><a href="index.html">pyperf</a></h1> 
     <h3>Navigation</h3> 
     <ul class="current"> 
      <li class="toctree-l1 current"><a class="reference internal" href="user_guide.html">Perf User Guide</a>
       <ul class="current"> 
        <li class="toctree-l2"><a class="reference internal" href="run_benchmark.html">Run a benchmark</a></li> 
        <li class="toctree-l2"><a class="reference internal" href="analyze.html">Analyze benchmark results</a></li> 
        <li class="toctree-l2"><a class="reference internal" href="cli.html">pyperf commands</a></li> 
        <li class="toctree-l2"><a class="reference internal" href="runner.html">Runner CLI</a></li> 
        <li class="toctree-l2 current"><a class="current reference internal" href="#">Tune the system for benchmarks</a></li> 
       </ul> </li> 
      <li class="toctree-l1"><a class="reference internal" href="developer_guide.html">Perf Developer Guide</a></li> 
     </ul> 
     <div class="relations"> 
      <h3>Related Topics</h3> 
      <ul> 
       <li><a href="index.html">Documentation overview</a>
        <ul> 
         <li><a href="user_guide.html">Perf User Guide</a>
          <ul> 
           <li>Previous: <a href="runner.html" title="previous chapter">Runner CLI</a></li> 
           <li>Next: <a href="developer_guide.html" title="next chapter">Perf Developer Guide</a></li> 
          </ul></li> 
        </ul></li> 
      </ul> 
     </div> 
     <div id="searchbox" style="display: none" role="search"> 
      <h3>Quick search</h3> 
      <div class="searchformwrapper"> 
       <form class="search" action="search.html" method="get"> 
        <input type="text" name="q"> 
        <input type="submit" value="Go"> 
        <input type="hidden" name="check_keywords" value="yes"> 
        <input type="hidden" name="area" value="default"> 
       </form> 
      </div> 
     </div> 
     <script type="text/javascript">$('#searchbox').show(0);</script> 
    </div> 
   </div> 
   <div class="clearer"></div> 
  </div> 
  <div class="footer">
    ©2016, Victor Stinner. | Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.6</a> &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a> | <a href="_sources/system.rst.txt" rel="nofollow">Page source</a> 
  </div>  
 </body>
</html>