<!doctype html>
<html class="writer-html5" lang="en"> 
 <head> 
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>Patterns — Warehouse  documentation</title> 
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css"> 
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css"> 
  <link rel="canonical" href="https://warehouse.pypa.io/development/patterns.html"> <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]--> 
  <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script> 
  <script src="../_static/jquery.js"></script> 
  <script src="../_static/underscore.js"></script> 
  <script src="../_static/doctools.js"></script> 
  <script async src="https://assets.readthedocs.org/static/javascript/readthedocs-doc-embed.js"></script> 
  <script src="../_static/js/theme.js"></script> 
  <link rel="index" title="Index" href="../genindex.html"> 
  <link rel="search" title="Search" href="../search.html"> 
  <link rel="next" title="Database migrations" href="database-migrations.html"> 
  <link rel="prev" title="Frontend" href="frontend.html"> <!-- RTD Extra Head --> 
  <link rel="stylesheet" href="https://assets.readthedocs.org/static/css/readthedocs-doc-embed.css" type="text/css"> 
  <script type="application/json" id="READTHEDOCS_DATA">{"ad_free": false, "api_host": "https://readthedocs.org", "build_date": "2022-05-16T21:16:41Z", "builder": "sphinx", "canonical_url": null, "commit": "140a2cc3", "docroot": "/docs/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "development/patterns", "programming_language": "py", "project": "warehouse", "proxied_api_host": "/_", "source_suffix": ".rst", "subprojects": {}, "theme": "sphinx_rtd_theme", "user_analytics_code": "", "version": "latest"}</script> <!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
--> 
  <script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script> 
  <script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-analytics.js" async></script> <!-- end RTD <extrahead> --> 
 </head> 
 <body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav"> 
   <nav data-toggle="wy-nav-shift" class="wy-nav-side"> 
    <div class="wy-side-scroll"> 
     <div class="wy-side-nav-search"> <a href="../index.html" class="icon icon-home"> Warehouse </a> 
      <div class="version">
        latest 
      </div> 
      <div role="search"> 
       <form id="rtd-search-form" class="wy-form" action="../search.html" method="get"> 
        <input type="text" name="q" placeholder="Search docs"> 
        <input type="hidden" name="check_keywords" value="yes"> 
        <input type="hidden" name="area" value="default"> 
       </form> 
      </div> 
     </div>
     <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu"> 
      <ul class="current"> 
       <li class="toctree-l1 current"><a class="reference internal" href="index.html">Development</a>
        <ul class="current"> 
         <li class="toctree-l2"><a class="reference internal" href="getting-started.html">Getting started</a></li> 
         <li class="toctree-l2"><a class="reference internal" href="frontend.html">Frontend</a></li> 
         <li class="toctree-l2 current"><a class="current reference internal" href="#">Patterns</a>
          <ul> 
           <li class="toctree-l3"><a class="reference internal" href="#dependency-management">Dependency management</a>
            <ul> 
             <li class="toctree-l4"><a class="reference internal" href="#upgrading-existing-dependencies">Upgrading existing dependencies</a></li> 
             <li class="toctree-l4"><a class="reference internal" href="#adding-new-dependencies">Adding new dependencies</a></li> 
             <li class="toctree-l4"><a class="reference internal" href="#removing-existing-dependencies">Removing existing dependencies</a></li> 
            </ul> </li> 
           <li class="toctree-l3"><a class="reference internal" href="#returning-vs-raising-http-exceptions">Returning vs Raising HTTP Exceptions</a></li> 
          </ul> </li> 
         <li class="toctree-l2"><a class="reference internal" href="database-migrations.html">Database migrations</a></li> 
         <li class="toctree-l2"><a class="reference internal" href="submitting-patches.html">Submitting patches</a></li> 
         <li class="toctree-l2"><a class="reference internal" href="reviewing-patches.html">Reviewing and merging patches</a></li> 
         <li class="toctree-l2"><a class="reference internal" href="legacy-application-structure.html">Legacy Application URL Structure</a></li> 
         <li class="toctree-l2"><a class="reference internal" href="development-database.html">Updating Development Database</a></li> 
         <li class="toctree-l2"><a class="reference internal" href="cloud.html">Developing in the cloud</a></li> 
         <li class="toctree-l2"><a class="reference internal" href="email.html">Working with E-mails</a></li> 
         <li class="toctree-l2"><a class="reference internal" href="malware-checks.html">Malware Checks</a></li> 
         <li class="toctree-l2"><a class="reference internal" href="token-scanning.html">Token Scanning</a></li> 
        </ul> </li> 
       <li class="toctree-l1"><a class="reference internal" href="../application.html">Warehouse codebase</a></li> 
       <li class="toctree-l1"><a class="reference internal" href="../api-reference/index.html">API reference</a></li> 
       <li class="toctree-l1"><a class="reference internal" href="../ui-principles.html">UI principles</a></li> 
       <li class="toctree-l1"><a class="reference internal" href="../security.html">Security</a></li> 
       <li class="toctree-l1"><a class="reference internal" href="../translations.html">Translations</a></li> 
       <li class="toctree-l1"><a class="reference internal" href="../roadmap.html">Roadmap and Sprints</a></li> 
      </ul> 
     </div> 
    </div> 
   </nav> 
   <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <nav class="wy-nav-top" aria-label="Mobile navigation menu"> <i data-toggle="wy-nav-top" class="fa fa-bars"></i> <a href="../index.html">Warehouse</a> 
    </nav> 
    <div class="wy-nav-content"> 
     <div class="rst-content"> 
      <div role="navigation" aria-label="Page navigation"> 
       <ul class="wy-breadcrumbs"> 
        <li><a href="../index.html" class="icon icon-home"></a> »</li> 
        <li><a href="index.html">Development</a> »</li> 
        <li>Patterns</li> 
        <li class="wy-breadcrumbs-aside"> <a href="https://github.com/pypa/warehouse/blob/main/docs/development/patterns.rst" class="fa fa-github"> Edit on GitHub</a> </li> 
       </ul> 
       <hr> 
      </div> 
      <div role="main" class="document" itemscope itemtype="http://schema.org/Article"> 
       <div itemprop="articleBody"> 
        <section id="patterns"> 
         <h1>Patterns<a class="headerlink" href="#patterns" title="Permalink to this headline">¶</a></h1> 
         <div class="contents local topic" id="contents"> 
          <ul class="simple"> 
           <li><p><a class="reference internal" href="#dependency-management" id="id1">Dependency management</a></p> 
            <ul> 
             <li><p><a class="reference internal" href="#upgrading-existing-dependencies" id="id2">Upgrading existing dependencies</a></p></li> 
             <li><p><a class="reference internal" href="#adding-new-dependencies" id="id3">Adding new dependencies</a></p></li> 
             <li><p><a class="reference internal" href="#removing-existing-dependencies" id="id4">Removing existing dependencies</a></p></li> 
            </ul> </li> 
           <li><p><a class="reference internal" href="#returning-vs-raising-http-exceptions" id="id5">Returning vs Raising HTTP Exceptions</a></p></li> 
          </ul> 
         </div> 
         <section id="dependency-management"> 
          <h2><a class="toc-backref" href="#id1">Dependency management</a><a class="headerlink" href="#dependency-management" title="Permalink to this headline">¶</a></h2> 
          <p>Warehouse’s approach to dependency management can be summarized as follows:</p> 
          <ul class="simple"> 
           <li><p>Separate requirements files for different environments (deploy, development, docs, linting, testing, etc.);</p></li> 
           <li><p>All dependencies are pinned to precise versions, and include artifact hashes;</p></li> 
           <li><p>Pinned requirements and subdependencies are compiled from <code class="docutils literal notranslate"><span class="pre">.in</span></code> files.</p></li> 
          </ul> 
          <p>We install all dependencies with <code class="docutils literal notranslate"><span class="pre">pip</span></code>, and we use <a class="reference external" href="https://pypi.org/project/pip-tools/"><code class="docutils literal notranslate"><span class="pre">pip-tools</span></code></a> to compile dependencies.</p> 
          <p>In practice, developers need to interact with our dependencies in three ways:</p> 
          <section id="upgrading-existing-dependencies"> 
           <h3><a class="toc-backref" href="#id2">Upgrading existing dependencies</a><a class="headerlink" href="#upgrading-existing-dependencies" title="Permalink to this headline">¶</a></h3> 
           <p>Dependencies are automatically upgraded via <a class="reference external" href="https://github.com/pypa/warehouse/pulls?q=is%3Apr+is%3Aopen+label%3Adependencies">Dependabot pull requests</a>, and occasionally merged by maintainers.</p> 
          </section> 
          <section id="adding-new-dependencies"> 
           <h3><a class="toc-backref" href="#id3">Adding new dependencies</a><a class="headerlink" href="#adding-new-dependencies" title="Permalink to this headline">¶</a></h3> 
           <p>Deciding to add a new dependency should be made carefully. Generally, we are not opposed to adding more dependencies, however some effort should be made to ensure that a given dependency:</p> 
           <ul class="simple"> 
            <li><p>Is reasonably stable;</p></li> 
            <li><p>Is currently maintained;</p></li> 
            <li><p>Doesn’t introduce a large amount of sub-dependencies.</p></li> 
           </ul> 
           <p>All top-level dependencies are included in one or more <code class="docutils literal notranslate"><span class="pre">.in</span></code> files, which are then compiled into <code class="docutils literal notranslate"><span class="pre">.txt</span></code> files with precise versions and artifact hashes.</p> 
           <p>When adding a new dependency, it’s important to add it to the correct <code class="docutils literal notranslate"><span class="pre">.in</span></code> file:</p> 
           <table class="docutils align-default"> 
            <colgroup> 
             <col style="width: 25%"> 
             <col style="width: 75%"> 
            </colgroup> 
            <thead> 
             <tr class="row-odd">
              <th class="head"><p>File</p></th> 
              <th class="head"><p>Purpose</p></th> 
             </tr> 
            </thead> 
            <tbody> 
             <tr class="row-even">
              <td><p><code class="docutils literal notranslate"><span class="pre">deploy.in</span></code></p></td> 
              <td><p>Required only to run in production</p></td> 
             </tr> 
             <tr class="row-odd">
              <td><p><code class="docutils literal notranslate"><span class="pre">docs.in</span></code></p></td> 
              <td><p>For our documentation</p></td> 
             </tr> 
             <tr class="row-even">
              <td><p><code class="docutils literal notranslate"><span class="pre">lint.in</span></code></p></td> 
              <td><p>For linting our docs and codebase</p></td> 
             </tr> 
             <tr class="row-odd">
              <td><p><code class="docutils literal notranslate"><span class="pre">main.in</span></code></p></td> 
              <td><p>Every dependency of our web service</p></td> 
             </tr> 
             <tr class="row-even">
              <td><p><code class="docutils literal notranslate"><span class="pre">tests.in</span></code></p></td> 
              <td><p>Required to run our tests</p></td> 
             </tr> 
            </tbody> 
           </table> 
           <p>Dependencies that are either private or aren’t deployed to production aren’t compiled:</p> 
           <table class="docutils align-default"> 
            <colgroup> 
             <col style="width: 25%"> 
             <col style="width: 75%"> 
            </colgroup> 
            <thead> 
             <tr class="row-odd">
              <th class="head"><p>File</p></th> 
              <th class="head"><p>Purpose</p></th> 
             </tr> 
            </thead> 
            <tbody> 
             <tr class="row-even">
              <td><p><code class="docutils literal notranslate"><span class="pre">dev.txt</span></code></p></td> 
              <td><p>Various development dependencies</p></td> 
             </tr> 
             <tr class="row-odd">
              <td><p><code class="docutils literal notranslate"><span class="pre">ipython.txt</span></code></p></td> 
              <td><p>Specific to using IPython as your shell</p></td> 
             </tr> 
            </tbody> 
           </table> 
           <p>To add a new dependency:</p> 
           <ol class="arabic"> 
            <li><p>Add the project name to the appropriate <code class="docutils literal notranslate"><span class="pre">.in</span></code> file</p></li> 
            <li><p>From the repositories root directory, recompile the dependencies for each modified <code class="docutils literal notranslate"><span class="pre">.in</span></code> file:</p> 
             <div class="highlight-default notranslate">
              <div class="highlight">
               <pre><span></span>$ make requirements/{file}.txt
</pre>
              </div> 
             </div> </li> 
            <li><p>Commit the changes</p></li> 
           </ol> 
          </section> 
          <section id="removing-existing-dependencies"> 
           <h3><a class="toc-backref" href="#id4">Removing existing dependencies</a><a class="headerlink" href="#removing-existing-dependencies" title="Permalink to this headline">¶</a></h3> 
           <p>Only top-level dependencies should be removed. The process is similar to the process for adding new dependencies:</p> 
           <ol class="arabic"> 
            <li><p>Remove the project name from the appropriate <code class="docutils literal notranslate"><span class="pre">.in</span></code> file</p></li> 
            <li><p>From the repositories root directory, recompile the dependencies for each modified <code class="docutils literal notranslate"><span class="pre">.in</span></code> file:</p> 
             <div class="highlight-default notranslate">
              <div class="highlight">
               <pre><span></span>$ make requirements/{file}.txt
</pre>
              </div> 
             </div> </li> 
            <li><p>Commit the changes</p></li> 
           </ol> 
          </section> 
         </section> 
         <section id="returning-vs-raising-http-exceptions"> 
          <h2><a class="toc-backref" href="#id5">Returning vs Raising HTTP Exceptions</a><a class="headerlink" href="#returning-vs-raising-http-exceptions" title="Permalink to this headline">¶</a></h2> 
          <p>Pyramid allows the various HTTP Exceptions to be either returned or raised, and the difference between whether you return or raise them are subtle. The differences between returning and raising a response are:</p> 
          <ul class="simple"> 
           <li><p>Returning a response commits the transaction associated with the request, while raising rolls it back.</p></li> 
           <li><p>Returning a response does not invoke the <code class="docutils literal notranslate"><span class="pre">exec_view</span></code> handler, while raising does.</p></li> 
          </ul> 
          <p>The follow table shows what the <em>default</em> method should be for each type of HTTP exception, this is only the default and judgement should be applied to each situation.</p> 
          <table class="docutils align-default"> 
           <colgroup> 
            <col style="width: 33%"> 
            <col style="width: 67%"> 
           </colgroup> 
           <thead> 
            <tr class="row-odd">
             <th class="head"><p>Class</p></th> 
             <th class="head"><p>Method</p></th> 
            </tr> 
           </thead> 
           <tbody> 
            <tr class="row-even">
             <td><p><code class="docutils literal notranslate"><span class="pre">HTTPSuccessful</span></code> (2xx)</p></td> 
             <td><p>Return</p></td> 
            </tr> 
            <tr class="row-odd">
             <td><p><code class="docutils literal notranslate"><span class="pre">HTTPRedirection</span></code> (3xx)</p></td> 
             <td><p>Return</p></td> 
            </tr> 
            <tr class="row-even">
             <td><p><code class="docutils literal notranslate"><span class="pre">HTTPClientError</span></code> (4xx)</p></td> 
             <td><p>Raise, except for <code class="docutils literal notranslate"><span class="pre">HTTPNotFound</span></code> which should be return.</p></td> 
            </tr> 
            <tr class="row-odd">
             <td><p><code class="docutils literal notranslate"><span class="pre">HTTPServerError</span></code> (5xx)</p></td> 
             <td><p>Raise</p></td> 
            </tr> 
           </tbody> 
          </table> 
         </section> 
        </section> 
       </div> 
      </div> 
      <footer>
       <div class="rst-footer-buttons" role="navigation" aria-label="Footer"> <a href="frontend.html" class="btn btn-neutral float-left" title="Frontend" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a> <a href="database-migrations.html" class="btn btn-neutral float-right" title="Database migrations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a> 
       </div> 
       <hr> 
       <div role="contentinfo"> 
        <p>© Copyright 2022. <span class="commit">Revision <code>140a2cc3</code>. </span></p> 
       </div> Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 
      </footer> 
     </div> 
    </div> 
   </section> 
  </div> 
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="Versions"> <span class="rst-current-version" data-toggle="rst-current-version"> <span class="fa fa-book"> Read the Docs</span> v: latest <span class="fa fa-caret-down"></span> </span> 
   <div class="rst-other-versions"> 
    <dl> 
     <dt>
      Versions
     </dt> 
     <dd>
      <a href="/en/latest/">latest</a>
     </dd> 
     <dd>
      <a href="/en/stable/">stable</a>
     </dd> 
    </dl> 
    <dl> 
     <dt>
      Downloads
     </dt> 
    </dl> 
    <dl> 
     <dt>
      On Read the Docs
     </dt> 
     <dd> <a href="//readthedocs.org/projects/warehouse/?fromdocs=warehouse">Project Home</a> 
     </dd> 
     <dd> <a href="//readthedocs.org/builds/warehouse/?fromdocs=warehouse">Builds</a> 
     </dd> 
    </dl> 
   </div> 
  </div> 
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  
 </body>
</html>